# æ£€æŸ¥è®¢å•æ•°æ®æ¥æºå’ŒçŠ¶æ€

## ğŸ“‹ è®¢å•æ•°æ®æ¥æº

### 1. æ•°æ®å­˜å‚¨ä½ç½®

**è¡¨å**ï¼š`execution_orders`

**æ•°æ®æ¥æº**ï¼š
- é€šè¿‡`basic-execution.service.ts`çš„`recordOrder`æ–¹æ³•ä¿å­˜
- è®¢å•æäº¤æ—¶åˆ›å»ºè®°å½•ï¼Œåˆå§‹çŠ¶æ€ä¸º`SUBMITTED`
- è®¢å•çŠ¶æ€é€šè¿‡`strategy-scheduler.service.ts`çš„`trackPendingOrders`æ–¹æ³•æ›´æ–°

### 2. çŠ¶æ€å€¼è¯´æ˜

**æ•°æ®åº“ä¸­çš„çŠ¶æ€å€¼**ï¼ˆè§„èŒƒåŒ–åçš„å€¼ï¼‰ï¼š
- `SUBMITTED`ï¼šå·²æäº¤
- `NEW`ï¼šæ–°å»º
- `FILLED`ï¼šå·²æˆäº¤
- `PARTIALLY_FILLED`ï¼šéƒ¨åˆ†æˆäº¤
- `CANCELLED`ï¼šå·²å–æ¶ˆ
- `FAILED`ï¼šå¤±è´¥

**APIè¿”å›çš„çŠ¶æ€å€¼**ï¼ˆåŸå§‹å€¼ï¼‰ï¼š
- `FilledStatus`ï¼šå·²æˆäº¤
- `PartialFilledStatus`ï¼šéƒ¨åˆ†æˆäº¤
- `CanceledStatus`ï¼šå·²å–æ¶ˆ
- `RejectedStatus`ï¼šå·²æ‹’ç»
- `NotReported`ï¼šæœªæŠ¥å‘Š
- `NewStatus`ï¼šæ–°å»º
- ç­‰ç­‰...

**çŠ¶æ€è½¬æ¢**ï¼š
- APIè¿”å›çš„çŠ¶æ€ä¼šè¢«`normalizeOrderStatus`æ–¹æ³•è½¬æ¢ä¸ºæ•°æ®åº“çŠ¶æ€
- `FilledStatus` â†’ `FILLED`
- `PartialFilledStatus` â†’ `PARTIALLY_FILLED`
- `CanceledStatus` â†’ `CANCELLED`
- `RejectedStatus` â†’ `FAILED`

---

## ğŸ” æ£€æŸ¥è®¢å•æ•°æ®

### SQLæŸ¥è¯¢ï¼šæ£€æŸ¥è®¢å•çŠ¶æ€åˆ†å¸ƒ

```sql
-- æ£€æŸ¥è®¢å•çŠ¶æ€åˆ†å¸ƒ
SELECT 
  current_status,
  COUNT(*) as count,
  COUNT(CASE WHEN signal_id IS NULL THEN 1 END) as unlinked_count
FROM execution_orders
GROUP BY current_status
ORDER BY count DESC;

-- æ£€æŸ¥æœªå…³è”è®¢å•ï¼ˆæŒ‰çŠ¶æ€ï¼‰
SELECT 
  current_status,
  COUNT(*) as count
FROM execution_orders
WHERE signal_id IS NULL
GROUP BY current_status
ORDER BY count DESC;

-- æ£€æŸ¥æ‰€æœ‰è®¢å•ï¼ˆåŒ…æ‹¬å·²å…³è”å’Œæœªå…³è”ï¼‰
SELECT 
  COUNT(*) as total_orders,
  COUNT(CASE WHEN signal_id IS NULL THEN 1 END) as unlinked_orders,
  COUNT(CASE WHEN signal_id IS NOT NULL THEN 1 END) as linked_orders
FROM execution_orders;
```

### æ£€æŸ¥è®¢å•åˆ›å»ºæ—¶é—´

```sql
-- æ£€æŸ¥è®¢å•åˆ›å»ºæ—¶é—´åˆ†å¸ƒ
SELECT 
  DATE(created_at) as date,
  COUNT(*) as total_count,
  COUNT(CASE WHEN signal_id IS NULL THEN 1 END) as unlinked_count
FROM execution_orders
GROUP BY DATE(created_at)
ORDER BY date DESC
LIMIT 30;
```

---

## ğŸ’¡ é—®é¢˜åˆ†æ

### ä¸ºä»€ä¹ˆæ‰¾åˆ°0ä¸ªè®¢å•ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š

1. **çŠ¶æ€å€¼ä¸åŒ¹é…** âš ï¸ **é«˜æ¦‚ç‡**
   - è„šæœ¬æŸ¥è¯¢ï¼š`current_status IN ('FilledStatus', 'PartialFilledStatus')`
   - æ•°æ®åº“å®é™…å€¼ï¼š`FILLED`, `PARTIALLY_FILLED`
   - **å·²ä¿®å¤**ï¼šæ›´æ–°æŸ¥è¯¢æ¡ä»¶ä¸ºè§„èŒƒåŒ–åçš„çŠ¶æ€å€¼

2. **æ‰€æœ‰è®¢å•éƒ½å·²å…³è”** âš ï¸ **ä¸­æ¦‚ç‡**
   - æ‰€æœ‰è®¢å•éƒ½æœ‰`signal_id`
   - æŸ¥è¯¢æ¡ä»¶`signal_id IS NULL`æ‰¾ä¸åˆ°æ•°æ®

3. **è®¢å•çŠ¶æ€ä¸æ˜¯å·²æˆäº¤** âš ï¸ **ä¸­æ¦‚ç‡**
   - è®¢å•çŠ¶æ€å¯èƒ½æ˜¯`SUBMITTED`, `NEW`, `CANCELLED`ç­‰
   - æŸ¥è¯¢æ¡ä»¶`current_status IN ('FILLED', 'PARTIALLY_FILLED')`æ‰¾ä¸åˆ°æ•°æ®

---

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®å¤çŠ¶æ€å€¼æŸ¥è¯¢ï¼ˆå·²ä¿®å¤ï¼‰

**ä¿®æ”¹**ï¼šä½¿ç”¨è§„èŒƒåŒ–åçš„çŠ¶æ€å€¼

```typescript
// ä¿®æ”¹å‰
ordersQuery += ` AND current_status IN ('FilledStatus', 'PartialFilledStatus')`;

// ä¿®æ”¹å
ordersQuery += ` AND current_status IN ('FILLED', 'PARTIALLY_FILLED')`;
```

### æ–¹æ¡ˆ2ï¼šæ”¾å®½æŸ¥è¯¢æ¡ä»¶ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ–¹æ¡ˆ1ä»ç„¶æ‰¾ä¸åˆ°æ•°æ®ï¼Œå¯ä»¥æ”¾å®½æŸ¥è¯¢æ¡ä»¶ï¼š

```typescript
// æŸ¥è¯¢æ‰€æœ‰æœªå…³è”è®¢å•ï¼ˆä¸é™åˆ¶çŠ¶æ€ï¼‰
ordersQuery = `
  SELECT 
    id, 
    strategy_id, 
    symbol, 
    side, 
    created_at, 
    current_status,
    order_id,
    quantity,
    price
  FROM execution_orders
  WHERE signal_id IS NULL
  ORDER BY created_at ASC
`;
```

---

## ğŸ“ å»ºè®®çš„æ£€æŸ¥æ­¥éª¤

### æ­¥éª¤1ï¼šæ£€æŸ¥è®¢å•æ•°æ®

è¿è¡Œä»¥ä¸‹SQLæŸ¥è¯¢ï¼Œäº†è§£å®é™…æ•°æ®æƒ…å†µï¼š

```sql
-- 1. æ£€æŸ¥è®¢å•æ€»æ•°å’Œæœªå…³è”è®¢å•æ•°
SELECT 
  COUNT(*) as total_orders,
  COUNT(CASE WHEN signal_id IS NULL THEN 1 END) as unlinked_orders
FROM execution_orders;

-- 2. æ£€æŸ¥è®¢å•çŠ¶æ€åˆ†å¸ƒ
SELECT 
  current_status,
  COUNT(*) as count
FROM execution_orders
GROUP BY current_status;

-- 3. æ£€æŸ¥æœªå…³è”è®¢å•çš„çŠ¶æ€åˆ†å¸ƒ
SELECT 
  current_status,
  COUNT(*) as count
FROM execution_orders
WHERE signal_id IS NULL
GROUP BY current_status;
```

### æ­¥éª¤2ï¼šæ ¹æ®æ£€æŸ¥ç»“æœè°ƒæ•´è„šæœ¬

- **å¦‚æœæœªå…³è”è®¢å•çŠ¶æ€æ˜¯`FILLED`**ï¼šè„šæœ¬åº”è¯¥èƒ½æ‰¾åˆ°
- **å¦‚æœæœªå…³è”è®¢å•çŠ¶æ€æ˜¯å…¶ä»–å€¼**ï¼šéœ€è¦è°ƒæ•´æŸ¥è¯¢æ¡ä»¶
- **å¦‚æœæ‰€æœ‰è®¢å•éƒ½å·²å…³è”**ï¼šè¯´æ˜ä¸éœ€è¦åˆ›å»ºä¿¡å·

---

## ğŸ“Š é¢„æœŸç»“æœ

ä¿®å¤åï¼Œè„šæœ¬åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… æ‰¾åˆ°æœªå…³è”çš„å·²æˆäº¤è®¢å•
- âœ… ä¸ºè¿™äº›è®¢å•åˆ›å»ºä¿¡å·è®°å½•
- âœ… å…³è”è®¢å•åˆ°ä¿¡å·

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**ï¼š2025-12-16  
**ä¸‹æ¬¡æ›´æ–°è®¡åˆ’**ï¼šæ£€æŸ¥è®¢å•æ•°æ®åæ›´æ–°




