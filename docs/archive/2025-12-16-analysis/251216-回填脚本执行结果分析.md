# å›å¡«è„šæœ¬æ‰§è¡Œç»“æœåˆ†æ

## ğŸ“‹ æ‰§è¡Œç»“æœ

**æ‰§è¡Œæ—¶é—´**ï¼š2025-12-16 14:21:10

**ç»Ÿè®¡ä¿¡æ¯**ï¼š
- âœ… æ‰¾åˆ°æœªå…³è”è®¢å•çš„ä¿¡å·ï¼š**40,193ä¸ª**ï¼ˆå…¨éƒ¨ä¸ºPENDINGçŠ¶æ€ï¼‰
- âŒ åŒ¹é…çš„è®¢å•æ•°ï¼š**0**
- âŒ æ›´æ–°çš„ä¿¡å·æ•°ï¼š**0**
- âš ï¸ æœªæ‰¾åˆ°ä¿¡å·çš„è®¢å•æ•°ï¼š**45**
- âš ï¸ æœªæ‰¾åˆ°è®¢å•çš„ä¿¡å·æ•°ï¼š**40,193**

---

## ğŸ” é—®é¢˜åˆ†æ

### 1. æ ¸å¿ƒé—®é¢˜ï¼šæ—¶é—´çª—å£åŒ¹é…å¤±è´¥

**ç°è±¡**ï¼š0ä¸ªè®¢å•å’Œä¿¡å·åŒ¹é…æˆåŠŸ

**å¯èƒ½åŸå› **ï¼š

#### åŸå› 1ï¼šæ—¶é—´çª—å£å¤ªå° âš ï¸ **é«˜æ¦‚ç‡**

- **å½“å‰è®¾ç½®**ï¼šé»˜è®¤Â±5åˆ†é’Ÿ
- **é—®é¢˜**ï¼šä¿¡å·å’Œè®¢å•çš„åˆ›å»ºæ—¶é—´å¯èƒ½å·®è·è¾ƒå¤§
- **å½±å“**ï¼šè¶…è¿‡5åˆ†é’Ÿçš„æ—¶é—´å·®æ— æ³•åŒ¹é…

**éªŒè¯æ–¹æ³•**ï¼š
```sql
-- æ£€æŸ¥è®¢å•å’Œä¿¡å·çš„æ—¶é—´å·®åˆ†å¸ƒ
SELECT 
  eo.order_id,
  eo.created_at as order_time,
  ss.id as signal_id,
  ss.created_at as signal_time,
  ABS(EXTRACT(EPOCH FROM (eo.created_at - ss.created_at))) / 60 as time_diff_minutes
FROM execution_orders eo
CROSS JOIN strategy_signals ss
WHERE eo.strategy_id = ss.strategy_id
  AND eo.symbol = ss.symbol
  AND eo.side = CASE 
    WHEN ss.signal_type = 'BUY' THEN 'BUY'
    WHEN ss.signal_type = 'SELL' THEN 'SELL'
    ELSE NULL
  END
ORDER BY time_diff_minutes
LIMIT 100;
```

#### åŸå› 2ï¼šä¿¡å·çŠ¶æ€é—®é¢˜ âš ï¸ **é«˜æ¦‚ç‡**

- **ç°è±¡**ï¼š40,193ä¸ªä¿¡å·å…¨éƒ¨ä¸ºPENDINGçŠ¶æ€
- **é—®é¢˜**ï¼šPENDINGçŠ¶æ€çš„ä¿¡å·å¯èƒ½å·²ç»è¿‡æœŸæˆ–æ— æ•ˆ
- **å½±å“**ï¼šè„šæœ¬åªåŒ¹é…PENDINGçŠ¶æ€çš„ä¿¡å·ï¼Œä½†è¿™äº›ä¿¡å·å¯èƒ½å·²ç»ä¸åº”è¯¥åŒ¹é…

**éªŒè¯æ–¹æ³•**ï¼š
```sql
-- æ£€æŸ¥ä¿¡å·çŠ¶æ€åˆ†å¸ƒ
SELECT status, COUNT(*) as count
FROM strategy_signals
GROUP BY status;

-- æ£€æŸ¥PENDINGä¿¡å·çš„åˆ›å»ºæ—¶é—´åˆ†å¸ƒ
SELECT 
  DATE(created_at) as date,
  COUNT(*) as count
FROM strategy_signals
WHERE status = 'PENDING'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

#### åŸå› 3ï¼šæ•°æ®ä¸åŒ¹é… âš ï¸ **ä¸­æ¦‚ç‡**

- **é—®é¢˜**ï¼šè®¢å•å’Œä¿¡å·çš„strategy_idã€symbolã€sideå¯èƒ½ä¸å®Œå…¨åŒ¹é…
- **å½±å“**ï¼šå³ä½¿æ—¶é—´çª—å£è¶³å¤Ÿï¼Œä¹Ÿæ— æ³•åŒ¹é…

**éªŒè¯æ–¹æ³•**ï¼š
```sql
-- æ£€æŸ¥è®¢å•å’Œä¿¡å·çš„åŒ¹é…æ¡ä»¶
SELECT 
  eo.strategy_id,
  eo.symbol,
  eo.side,
  COUNT(DISTINCT eo.id) as order_count,
  COUNT(DISTINCT ss.id) as signal_count
FROM execution_orders eo
LEFT JOIN strategy_signals ss ON 
  eo.strategy_id = ss.strategy_id
  AND eo.symbol = ss.symbol
  AND (
    (eo.side = 'BUY' AND ss.signal_type = 'BUY')
    OR (eo.side = 'SELL' AND ss.signal_type = 'SELL')
  )
GROUP BY eo.strategy_id, eo.symbol, eo.side;
```

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ‰©å¤§æ—¶é—´çª—å£ â­ **æ¨è**

**å®æ–½æ­¥éª¤**ï¼š

1. **ä½¿ç”¨æ›´å¤§çš„æ—¶é—´çª—å£**ï¼š
   ```bash
   # ä½¿ç”¨30åˆ†é’Ÿæ—¶é—´çª—å£
   npm run backfill-signals:dry-run -- --time-window-minutes=30
   
   # æˆ–ä½¿ç”¨60åˆ†é’Ÿæ—¶é—´çª—å£
   npm run backfill-signals:dry-run -- --time-window-minutes=60
   ```

2. **é€æ­¥æ‰©å¤§**ï¼š
   - å…ˆå°è¯•30åˆ†é’Ÿ
   - å¦‚æœåŒ¹é…ç‡ä»ç„¶å¾ˆä½ï¼Œå°è¯•60åˆ†é’Ÿ
   - å¦‚æœåŒ¹é…ç‡ä»ç„¶å¾ˆä½ï¼Œå°è¯•120åˆ†é’Ÿ

**æ³¨æ„äº‹é¡¹**ï¼š
- âš ï¸ æ—¶é—´çª—å£è¶Šå¤§ï¼Œè¯¯åŒ¹é…çš„é£é™©è¶Šé«˜
- âš ï¸ å»ºè®®å…ˆè¿è¡Œdry-runæ¨¡å¼æŸ¥çœ‹ç»“æœ

### æ–¹æ¡ˆ2ï¼šæ¸…ç†æ— æ•ˆä¿¡å· â­ **æ¨è**

**é—®é¢˜**ï¼š40,193ä¸ªPENDINGä¿¡å·å¯èƒ½å¤§éƒ¨åˆ†æ˜¯æ— æ•ˆçš„

**å®æ–½æ­¥éª¤**ï¼š

1. **åˆ†æä¿¡å·åˆ›å»ºæ—¶é—´**ï¼š
   ```sql
   -- æŸ¥çœ‹PENDINGä¿¡å·çš„åˆ›å»ºæ—¶é—´åˆ†å¸ƒ
   SELECT 
     DATE(created_at) as date,
     COUNT(*) as count,
     MIN(created_at) as earliest,
     MAX(created_at) as latest
   FROM strategy_signals
   WHERE status = 'PENDING'
   GROUP BY DATE(created_at)
   ORDER BY date DESC;
   ```

2. **æ¸…ç†è¿‡æœŸä¿¡å·**ï¼ˆè°¨æ…æ“ä½œï¼‰ï¼š
   ```sql
   -- å°†è¶…è¿‡7å¤©çš„PENDINGä¿¡å·æ ‡è®°ä¸ºIGNORED
   UPDATE strategy_signals
   SET status = 'IGNORED'
   WHERE status = 'PENDING'
     AND created_at < NOW() - INTERVAL '7 days';
   ```

3. **é‡æ–°è¿è¡Œå›å¡«è„šæœ¬**ï¼š
   ```bash
   npm run backfill-signals:dry-run
   ```

### æ–¹æ¡ˆ3ï¼šä¼˜åŒ–åŒ¹é…é€»è¾‘ â­ **é•¿æœŸä¼˜åŒ–**

**é—®é¢˜**ï¼šå½“å‰åŒ¹é…é€»è¾‘å¯èƒ½ä¸å¤Ÿçµæ´»

**æ”¹è¿›å»ºè®®**ï¼š

1. **ä¼˜å…ˆçº§åŒ¹é…**ï¼š
   - ä¼˜å…ˆåŒ¹é…è®¢å•åˆ›å»ºæ—¶é—´ä¹‹å‰çš„ä¿¡å·ï¼ˆæœ€è¿‘çš„ï¼‰
   - é™çº§åŒ¹é…è®¢å•åˆ›å»ºæ—¶é—´ä¹‹åçš„ä¿¡å·ï¼ˆæœ€è¿‘çš„ï¼‰

2. **æ”¾å®½åŒ¹é…æ¡ä»¶**ï¼š
   - å…è®¸sideä¸å®Œå…¨åŒ¹é…ï¼ˆBUY/SELL vs Buy/Sellï¼‰
   - å…è®¸symbolæ ¼å¼å·®å¼‚ï¼ˆ.US vs .usï¼‰

3. **æ·»åŠ æ‰‹åŠ¨åŒ¹é…åŠŸèƒ½**ï¼š
   - å¯¹äºæ— æ³•è‡ªåŠ¨åŒ¹é…çš„è®¢å•ï¼Œæä¾›æ‰‹åŠ¨å…³è”ç•Œé¢

---

## ğŸ“Š å»ºè®®çš„æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1ï¼šæ‰©å¤§æ—¶é—´çª—å£æµ‹è¯•

```bash
# æµ‹è¯•30åˆ†é’Ÿæ—¶é—´çª—å£
npm run backfill-signals:dry-run -- --time-window-minutes=30

# æŸ¥çœ‹ç»“æœï¼Œå¦‚æœåŒ¹é…ç‡ä»ç„¶å¾ˆä½ï¼Œå°è¯•60åˆ†é’Ÿ
npm run backfill-signals:dry-run -- --time-window-minutes=60
```

### æ­¥éª¤2ï¼šåˆ†ææ•°æ®è´¨é‡

è¿è¡Œä»¥ä¸‹SQLæŸ¥è¯¢ï¼Œäº†è§£æ•°æ®æƒ…å†µï¼š

```sql
-- 1. æ£€æŸ¥è®¢å•å’Œä¿¡å·çš„æ—¶é—´å·®åˆ†å¸ƒ
SELECT 
  CASE 
    WHEN time_diff <= 5 THEN '0-5åˆ†é’Ÿ'
    WHEN time_diff <= 15 THEN '5-15åˆ†é’Ÿ'
    WHEN time_diff <= 30 THEN '15-30åˆ†é’Ÿ'
    WHEN time_diff <= 60 THEN '30-60åˆ†é’Ÿ'
    ELSE '60åˆ†é’Ÿä»¥ä¸Š'
  END as time_range,
  COUNT(*) as count
FROM (
  SELECT 
    eo.order_id,
    ss.id as signal_id,
    ABS(EXTRACT(EPOCH FROM (eo.created_at - ss.created_at))) / 60 as time_diff
  FROM execution_orders eo
  CROSS JOIN strategy_signals ss
  WHERE eo.strategy_id = ss.strategy_id
    AND eo.symbol = ss.symbol
    AND (
      (eo.side = 'BUY' AND ss.signal_type = 'BUY')
      OR (eo.side = 'SELL' AND ss.signal_type = 'SELL')
    )
) t
GROUP BY time_range
ORDER BY time_range;

-- 2. æ£€æŸ¥PENDINGä¿¡å·çš„åˆ›å»ºæ—¶é—´
SELECT 
  DATE(created_at) as date,
  COUNT(*) as count
FROM strategy_signals
WHERE status = 'PENDING'
GROUP BY DATE(created_at)
ORDER BY date DESC
LIMIT 30;
```

### æ­¥éª¤3ï¼šæ ¹æ®åˆ†æç»“æœå†³å®š

- **å¦‚æœæ—¶é—´å·®ä¸»è¦åœ¨5-30åˆ†é’Ÿ**ï¼šä½¿ç”¨30åˆ†é’Ÿæ—¶é—´çª—å£
- **å¦‚æœæ—¶é—´å·®ä¸»è¦åœ¨30-60åˆ†é’Ÿ**ï¼šä½¿ç”¨60åˆ†é’Ÿæ—¶é—´çª—å£
- **å¦‚æœPENDINGä¿¡å·éƒ½æ˜¯å¾ˆä¹…ä»¥å‰çš„**ï¼šè€ƒè™‘æ¸…ç†è¿‡æœŸä¿¡å·

---

## âš ï¸ é‡è¦æé†’

1. **æ•°æ®å¤‡ä»½**ï¼šæ‰§è¡Œä»»ä½•æ•°æ®ä¿®æ”¹å‰ï¼Œç¡®ä¿æ•°æ®åº“æœ‰å¤‡ä»½
2. **è°¨æ…æ¸…ç†**ï¼šæ¸…ç†PENDINGä¿¡å·å‰ï¼Œç¡®è®¤è¿™äº›ä¿¡å·ç¡®å®æ— æ•ˆ
3. **é€æ­¥æµ‹è¯•**ï¼šå…ˆè¿è¡Œdry-runæ¨¡å¼ï¼Œç¡®è®¤ç»“æœåå†å®é™…æ‰§è¡Œ
4. **ç›‘æ§å½±å“**ï¼šæ‰§è¡Œåç›‘æ§ç³»ç»Ÿè¿è¡Œæƒ…å†µï¼Œç¡®ä¿æ²¡æœ‰è´Ÿé¢å½±å“

---

## ğŸ“ æ€»ç»“

**å½“å‰æƒ…å†µ**ï¼š
- âŒ 0ä¸ªè®¢å•å’Œä¿¡å·åŒ¹é…æˆåŠŸ
- âš ï¸ 40,193ä¸ªPENDINGä¿¡å·æœªå…³è”
- âš ï¸ 45ä¸ªè®¢å•æœªå…³è”ä¿¡å·

**å¯èƒ½åŸå› **ï¼š
1. æ—¶é—´çª—å£å¤ªå°ï¼ˆé»˜è®¤5åˆ†é’Ÿï¼‰
2. PENDINGä¿¡å·å¯èƒ½å·²è¿‡æœŸ
3. æ•°æ®ä¸åŒ¹é…

**å»ºè®®è¡ŒåŠ¨**ï¼š
1. âœ… æ‰©å¤§æ—¶é—´çª—å£æµ‹è¯•ï¼ˆ30-60åˆ†é’Ÿï¼‰
2. âœ… åˆ†ææ•°æ®è´¨é‡ï¼ˆæ—¶é—´å·®åˆ†å¸ƒã€ä¿¡å·åˆ›å»ºæ—¶é—´ï¼‰
3. âœ… æ ¹æ®åˆ†æç»“æœå†³å®šæ˜¯å¦æ¸…ç†è¿‡æœŸä¿¡å·
4. âœ… ä¼˜åŒ–åŒ¹é…é€»è¾‘ï¼ˆé•¿æœŸï¼‰

---

**åˆ†æå®Œæˆæ—¶é—´**ï¼š2025-12-16  
**ä¸‹æ¬¡æ›´æ–°è®¡åˆ’**ï¼šæ‰©å¤§æ—¶é—´çª—å£æµ‹è¯•åæ›´æ–°






