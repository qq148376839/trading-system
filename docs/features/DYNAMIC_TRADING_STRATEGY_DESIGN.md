# åŠ¨æ€äº¤æ˜“ç­–ç•¥è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-03  
**çŠ¶æ€**: å·²å®æ–½ âœ…

## ğŸ“‹ ç›®å½•

- [é—®é¢˜åˆ†æ](#é—®é¢˜åˆ†æ)
- [è®¾è®¡ç›®æ ‡](#è®¾è®¡ç›®æ ‡)
- [æ ¸å¿ƒç­–ç•¥æ¡†æ¶](#æ ¸å¿ƒç­–ç•¥æ¡†æ¶)
- [æŒä»“ç®¡ç†ç­–ç•¥](#æŒä»“ç®¡ç†ç­–ç•¥)
- [åŠ¨æ€æ­¢ç›ˆæ­¢æŸè°ƒæ•´](#åŠ¨æ€æ­¢ç›ˆæ­¢æŸè°ƒæ•´)
- [å¸‚åœºç¯å¢ƒå“åº”æœºåˆ¶](#å¸‚åœºç¯å¢ƒå“åº”æœºåˆ¶)
- [é£é™©æ§åˆ¶æœºåˆ¶](#é£é™©æ§åˆ¶æœºåˆ¶)
- [å®ç°æ–¹æ¡ˆ](#å®ç°æ–¹æ¡ˆ)
- [æµ‹è¯•éªŒè¯](#æµ‹è¯•éªŒè¯)

---

## ğŸ” é—®é¢˜åˆ†æ

### å½“å‰é—®é¢˜

1. **é«˜ä¹°ä½å–é—®é¢˜**
   - ç°è±¡ï¼šIONQä¹°å…¥49.175ï¼Œå–å‡º47.11ï¼›CRSPä¹°å…¥52.8ï¼Œå–å‡º51.86
   - åŸå› ï¼šæŒä»“æ—¶ç®€å•æ ¹æ®å¸‚åœºç¯å¢ƒå˜åŒ–å°±å–å‡ºï¼Œæ²¡æœ‰è€ƒè™‘æŒä»“æˆæœ¬å’Œç›ˆäºæƒ…å†µ
   - å½±å“ï¼šé€ æˆä¸å¿…è¦çš„äºæŸ

2. **é”™è¿‡æœºä¼šé—®é¢˜**
   - ç°è±¡ï¼šå¦‚æœå®Œå…¨ç§»é™¤å¸‚åœºç¯å¢ƒæ£€æŸ¥ï¼Œå¯èƒ½é”™è¿‡æœ€ä½³å–å‡ºæ—¶æœº
   - åŸå› ï¼šå¸‚åœºç¯å¢ƒå˜åŒ–å¯èƒ½é¢„ç¤ºç€è¶‹åŠ¿åè½¬ï¼Œä½†éœ€è¦æ™ºèƒ½åˆ¤æ–­
   - å½±å“ï¼šå¯èƒ½é”™è¿‡æ­¢ç›ˆæœºä¼šæˆ–å¢åŠ äºæŸé£é™©

### æ ¹æœ¬åŸå› 

- **ç­–ç•¥è¿‡äºç®€å•**ï¼šåªè€ƒè™‘å¸‚åœºç¯å¢ƒå˜åŒ–ï¼Œæ²¡æœ‰ç»¼åˆè€ƒè™‘æŒä»“æˆæœ¬ã€ç›ˆäºã€æ—¶é—´ç­‰å› ç´ 
- **ç¼ºä¹åŠ¨æ€è°ƒæ•´**ï¼šæ­¢ç›ˆ/æ­¢æŸè®¾ç½®åä¸å†è°ƒæ•´ï¼Œæ— æ³•é€‚åº”å¸‚åœºå˜åŒ–
- **ç¼ºä¹é£é™©ä¿æŠ¤**ï¼šæ²¡æœ‰è€ƒè™‘æŒä»“æ—¶é—´ã€æ³¢åŠ¨æ€§ç­‰å› ç´ 

---

## ğŸ¯ è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡

1. **é¿å…é«˜ä¹°ä½å–**ï¼šæŒä»“æ—¶ä¸åº”è¯¥ç®€å•åœ°å› ä¸ºå¸‚åœºç¯å¢ƒå˜åŒ–å°±å–å‡º
2. **æŠ“ä½æœºä¼š**ï¼šåœ¨å¸‚åœºç¯å¢ƒæ˜æ˜¾æ¶åŒ–æ—¶ï¼Œåº”è¯¥èƒ½å¤ŸåŠæ—¶æ­¢æŸæˆ–æ­¢ç›ˆ
3. **åŠ¨æ€è°ƒæ•´**ï¼šæ ¹æ®å¸‚åœºå˜åŒ–åŠ¨æ€è°ƒæ•´æ­¢ç›ˆ/æ­¢æŸï¼Œè€Œä¸æ˜¯å›ºå®šä¸å˜
4. **é£é™©æ§åˆ¶**ï¼šç»¼åˆè€ƒè™‘æŒä»“æˆæœ¬ã€ç›ˆäºã€æ—¶é—´ã€æ³¢åŠ¨æ€§ç­‰å› ç´ 

### è®¾è®¡åŸåˆ™

1. **æˆæœ¬ä¼˜å…ˆ**ï¼šä¼˜å…ˆè€ƒè™‘æŒä»“æˆæœ¬ï¼Œé¿å…äºæŸå–å‡º
2. **ç›ˆäºå¹³è¡¡**ï¼šåœ¨ç›ˆäºå¹³è¡¡ç‚¹é™„è¿‘è®¾ç½®ä¿æŠ¤æœºåˆ¶
3. **åŠ¨æ€è°ƒæ•´**ï¼šæ ¹æ®å¸‚åœºå˜åŒ–åŠ¨æ€è°ƒæ•´æ­¢ç›ˆ/æ­¢æŸ
4. **é£é™©æ§åˆ¶**ï¼šè®¾ç½®å¤šé‡é£é™©ä¿æŠ¤æœºåˆ¶

---

## ğŸ—ï¸ æ ¸å¿ƒç­–ç•¥æ¡†æ¶

### ç­–ç•¥çŠ¶æ€æœº

```
IDLE â†’ OPENING â†’ HOLDING â†’ CLOSING â†’ IDLE
         â†“          â†“          â†“
      (ä¹°å…¥)    (æŒä»“ç›‘æ§)  (å–å‡ºç›‘æ§)
```

### æŒä»“ç›‘æ§å†³ç­–æ ‘

```
æŒä»“ç›‘æ§
â”œâ”€â”€ å›ºå®šæ­¢ç›ˆ/æ­¢æŸæ£€æŸ¥
â”‚   â”œâ”€â”€ è§¦å‘æ­¢æŸ â†’ ç«‹å³å–å‡º
â”‚   â””â”€â”€ è§¦å‘æ­¢ç›ˆ â†’ ç«‹å³å–å‡º
â”‚
â”œâ”€â”€ åŠ¨æ€æ­¢ç›ˆ/æ­¢æŸè°ƒæ•´
â”‚   â”œâ”€â”€ å¸‚åœºç¯å¢ƒå˜åŒ– â†’ è°ƒæ•´æ­¢ç›ˆ/æ­¢æŸ
â”‚   â”œâ”€â”€ æŒä»“æ—¶é—´ â†’ è°ƒæ•´æ­¢ç›ˆ/æ­¢æŸ
â”‚   â””â”€â”€ æ³¢åŠ¨æ€§å˜åŒ– â†’ è°ƒæ•´æ­¢ç›ˆ/æ­¢æŸ
â”‚
â”œâ”€â”€ å¸‚åœºç¯å¢ƒå“åº”
â”‚   â”œâ”€â”€ å¸‚åœºç¯å¢ƒæ¶åŒ– + ç›ˆåˆ© â†’ æ”¶ç´§æ­¢ç›ˆ/æ­¢æŸ
â”‚   â”œâ”€â”€ å¸‚åœºç¯å¢ƒæ¶åŒ– + äºæŸ â†’ è¯„ä¼°æ˜¯å¦æ­¢æŸ
â”‚   â””â”€â”€ å¸‚åœºç¯å¢ƒæ”¹å–„ + äºæŸ â†’ æ”¾å®½æ­¢æŸ
â”‚
â””â”€â”€ é£é™©ä¿æŠ¤æœºåˆ¶
    â”œâ”€â”€ ç›ˆäºå¹³è¡¡ä¿æŠ¤
    â”œâ”€â”€ æŒä»“æ—¶é—´ä¿æŠ¤
    â””â”€â”€ æ³¢åŠ¨æ€§ä¿æŠ¤
```

---

## ğŸ“Š æŒä»“ç®¡ç†ç­–ç•¥

### 1. æŒä»“çŠ¶æ€åˆ†ç±»

æ ¹æ®æŒä»“æˆæœ¬å’Œå½“å‰ä»·æ ¼ï¼Œå°†æŒä»“åˆ†ä¸ºä»¥ä¸‹çŠ¶æ€ï¼š

| çŠ¶æ€ | æ¡ä»¶ | ç­–ç•¥ |
|------|------|------|
| **æ·±åº¦äºæŸ** | `currentPrice < entryPrice Ã— 0.95` | ä¸¥æ ¼æ­¢æŸï¼Œä¸è½»æ˜“å–å‡º |
| **è½»åº¦äºæŸ** | `entryPrice Ã— 0.95 â‰¤ currentPrice < entryPrice` | è°¨æ…æŒæœ‰ï¼Œè®¾ç½®ä¿æŠ¤æ­¢æŸ |
| **ç›ˆäºå¹³è¡¡** | `entryPrice â‰¤ currentPrice < entryPrice Ã— 1.02` | è®¾ç½®ç›ˆäºå¹³è¡¡ä¿æŠ¤ |
| **è½»åº¦ç›ˆåˆ©** | `entryPrice Ã— 1.02 â‰¤ currentPrice < takeProfit` | æ­£å¸¸æŒæœ‰ï¼ŒåŠ¨æ€è°ƒæ•´æ­¢ç›ˆ |
| **æ¥è¿‘æ­¢ç›ˆ** | `takeProfit Ã— 0.95 â‰¤ currentPrice < takeProfit` | æ”¶ç´§æ­¢ç›ˆï¼Œå‡†å¤‡å–å‡º |
| **è¶…è¿‡æ­¢ç›ˆ** | `currentPrice â‰¥ takeProfit` | ç«‹å³å–å‡ºæˆ–åˆ†æ‰¹å–å‡º |

### 2. æŒä»“æ—¶é—´åˆ†ç±»

æ ¹æ®æŒä»“æ—¶é—´ï¼Œè®¾ç½®ä¸åŒçš„ç­–ç•¥ï¼š

| æŒä»“æ—¶é—´ | ç­–ç•¥è°ƒæ•´ |
|----------|----------|
| **< 1å°æ—¶** | ä¸¥æ ¼æ­¢æŸï¼Œé¿å…å¿«é€ŸäºæŸ |
| **1-4å°æ—¶** | æ­£å¸¸æŒæœ‰ï¼ŒåŠ¨æ€è°ƒæ•´ |
| **4-24å°æ—¶** | æ”¾å®½æ­¢æŸï¼Œç»™æ›´å¤šæ—¶é—´ |
| **> 24å°æ—¶** | è€ƒè™‘æ—¶é—´æˆæœ¬ï¼Œæ”¶ç´§æ­¢ç›ˆ |

### 3. ç›ˆäºæƒ…å†µå“åº”

æ ¹æ®ç›ˆäºæƒ…å†µï¼Œè®¾ç½®ä¸åŒçš„å“åº”ç­–ç•¥ï¼š

```typescript
// ç›ˆäºç™¾åˆ†æ¯”
const pnlPercent = ((currentPrice - entryPrice) / entryPrice) * 100;

if (pnlPercent < -5) {
  // æ·±åº¦äºæŸï¼šä¸¥æ ¼æ­¢æŸï¼Œä¸è½»æ˜“å–å‡º
  // é™¤éå¸‚åœºç¯å¢ƒæåº¦æ¶åŒ–ï¼Œå¦åˆ™æŒæœ‰
} else if (pnlPercent < 0) {
  // è½»åº¦äºæŸï¼šè°¨æ…æŒæœ‰ï¼Œè®¾ç½®ä¿æŠ¤æ­¢æŸ
  // å¦‚æœå¸‚åœºç¯å¢ƒæ¶åŒ–ï¼Œè€ƒè™‘æ­¢æŸ
} else if (pnlPercent < 2) {
  // ç›ˆäºå¹³è¡¡ï¼šè®¾ç½®ç›ˆäºå¹³è¡¡ä¿æŠ¤
  // å¦‚æœå¸‚åœºç¯å¢ƒæ¶åŒ–ï¼Œè€ƒè™‘æ­¢ç›ˆ
} else if (pnlPercent < 5) {
  // è½»åº¦ç›ˆåˆ©ï¼šæ­£å¸¸æŒæœ‰ï¼ŒåŠ¨æ€è°ƒæ•´æ­¢ç›ˆ
} else {
  // æ¥è¿‘æˆ–è¶…è¿‡æ­¢ç›ˆï¼šå‡†å¤‡å–å‡º
}
```

---

## ğŸ”„ åŠ¨æ€æ­¢ç›ˆæ­¢æŸè°ƒæ•´

### 1. è°ƒæ•´è§¦å‘æ¡ä»¶

æ­¢ç›ˆ/æ­¢æŸè°ƒæ•´åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è§¦å‘ï¼š

1. **å¸‚åœºç¯å¢ƒå˜åŒ–**
   - å¸‚åœºç¯å¢ƒä»"è‰¯å¥½"å˜ä¸º"è¾ƒå·®" â†’ æ”¶ç´§æ­¢ç›ˆ/æ­¢æŸ
   - å¸‚åœºç¯å¢ƒä»"è¾ƒå·®"å˜ä¸º"è‰¯å¥½" â†’ æ”¾å®½æ­¢æŸ

2. **æŒä»“æ—¶é—´å˜åŒ–**
   - æŒä»“æ—¶é—´è¶…è¿‡é˜ˆå€¼ â†’ è°ƒæ•´æ­¢ç›ˆ/æ­¢æŸ

3. **æ³¢åŠ¨æ€§å˜åŒ–**
   - ATRå˜åŒ–è¶…è¿‡é˜ˆå€¼ â†’ è°ƒæ•´æ­¢ç›ˆ/æ­¢æŸ

4. **ä»·æ ¼å˜åŒ–**
   - ä»·æ ¼æ¥è¿‘æ­¢ç›ˆ/æ­¢æŸ â†’ åŠ¨æ€è°ƒæ•´

### 2. è°ƒæ•´ç­–ç•¥

#### å¸‚åœºç¯å¢ƒæ¶åŒ–æ—¶çš„è°ƒæ•´

```typescript
// å¸‚åœºç¯å¢ƒä»"è‰¯å¥½"å˜ä¸º"è¾ƒå·®"æˆ–"ä¸­æ€§åˆ©ç©º"
if (previousMarketEnv === 'è‰¯å¥½' && currentMarketEnv === 'è¾ƒå·®') {
  if (pnlPercent > 0) {
    // ç›ˆåˆ©çŠ¶æ€ï¼šæ”¶ç´§æ­¢ç›ˆï¼Œä¿æŠ¤åˆ©æ¶¦
    // å°†æ­¢ç›ˆè°ƒæ•´ä¸ºå½“å‰ä»·æ ¼ + 1% æˆ– åŸæ­¢ç›ˆçš„ 95%ï¼Œå–è¾ƒå°å€¼
    takeProfit = Math.min(
      currentPrice * 1.01,
      originalTakeProfit * 0.95
    );
  } else if (pnlPercent > -2) {
    // è½»åº¦äºæŸï¼šæ”¶ç´§æ­¢æŸï¼Œé¿å…è¿›ä¸€æ­¥äºæŸ
    // å°†æ­¢æŸè°ƒæ•´ä¸ºå½“å‰ä»·æ ¼ - 1% æˆ– åŸæ­¢æŸçš„ 105%ï¼Œå–è¾ƒå¤§å€¼
    stopLoss = Math.max(
      currentPrice * 0.99,
      originalStopLoss * 1.05
    );
  } else {
    // æ·±åº¦äºæŸï¼šä¿æŒåŸæ­¢æŸï¼Œä¸è½»æ˜“è°ƒæ•´
    // é™¤éå¸‚åœºç¯å¢ƒæåº¦æ¶åŒ–ï¼Œå¦åˆ™æŒæœ‰
  }
}
```

#### å¸‚åœºç¯å¢ƒæ”¹å–„æ—¶çš„è°ƒæ•´

```typescript
// å¸‚åœºç¯å¢ƒä»"è¾ƒå·®"å˜ä¸º"è‰¯å¥½"æˆ–"ä¸­æ€§åˆ©å¥½"
if (previousMarketEnv === 'è¾ƒå·®' && currentMarketEnv === 'è‰¯å¥½') {
  if (pnlPercent < 0) {
    // äºæŸçŠ¶æ€ï¼šæ”¾å®½æ­¢æŸï¼Œç»™æ›´å¤šæ—¶é—´
    // å°†æ­¢æŸè°ƒæ•´ä¸ºåŸæ­¢æŸçš„ 95%
    stopLoss = originalStopLoss * 0.95;
  } else {
    // ç›ˆåˆ©çŠ¶æ€ï¼šæ”¾å®½æ­¢ç›ˆï¼Œè¿½æ±‚æ›´é«˜æ”¶ç›Š
    // å°†æ­¢ç›ˆè°ƒæ•´ä¸ºåŸæ­¢ç›ˆçš„ 105%
    takeProfit = originalTakeProfit * 1.05;
  }
}
```

#### æŒä»“æ—¶é—´è°ƒæ•´

```typescript
// æŒä»“æ—¶é—´è¶…è¿‡é˜ˆå€¼
const holdingHours = (Date.now() - entryTime) / (1000 * 60 * 60);

if (holdingHours > 24) {
  // æŒä»“è¶…è¿‡24å°æ—¶ï¼šæ”¶ç´§æ­¢ç›ˆï¼Œè€ƒè™‘æ—¶é—´æˆæœ¬
  if (pnlPercent > 0) {
    // ç›ˆåˆ©çŠ¶æ€ï¼šæ”¶ç´§æ­¢ç›ˆï¼Œå°½å¿«å–å‡º
    takeProfit = Math.min(
      currentPrice * 1.02,
      originalTakeProfit * 0.98
    );
  }
} else if (holdingHours < 1) {
  // æŒä»“ä¸è¶³1å°æ—¶ï¼šä¸¥æ ¼æ­¢æŸï¼Œé¿å…å¿«é€ŸäºæŸ
  if (pnlPercent < -2) {
    // å¿«é€ŸäºæŸï¼šæ”¶ç´§æ­¢æŸ
    stopLoss = Math.max(
      currentPrice * 0.98,
      originalStopLoss * 1.02
    );
  }
}
```

#### æ³¢åŠ¨æ€§è°ƒæ•´

```typescript
// ATRå˜åŒ–è¶…è¿‡é˜ˆå€¼
const atrChange = (currentATR - originalATR) / originalATR;

if (Math.abs(atrChange) > 0.2) {
  // ATRå˜åŒ–è¶…è¿‡20%ï¼šè°ƒæ•´æ­¢ç›ˆ/æ­¢æŸ
  if (atrChange > 0) {
    // æ³¢åŠ¨æ€§å¢åŠ ï¼šæ”¾å®½æ­¢ç›ˆ/æ­¢æŸ
    takeProfit = originalTakeProfit * (1 + atrChange * 0.5);
    stopLoss = originalStopLoss * (1 - atrChange * 0.5);
  } else {
    // æ³¢åŠ¨æ€§å‡å°‘ï¼šæ”¶ç´§æ­¢ç›ˆ/æ­¢æŸ
    takeProfit = originalTakeProfit * (1 + atrChange * 0.5);
    stopLoss = originalStopLoss * (1 - atrChange * 0.5);
  }
}
```

---

## ğŸŒ å¸‚åœºç¯å¢ƒå“åº”æœºåˆ¶

### 1. å¸‚åœºç¯å¢ƒè¯„ä¼°

å¸‚åœºç¯å¢ƒåˆ†ä¸ºä»¥ä¸‹ç­‰çº§ï¼š

| ç­‰çº§ | æ¡ä»¶ | æŒä»“ç­–ç•¥ |
|------|------|----------|
| **è‰¯å¥½** | è¶‹åŠ¿ä¸€è‡´åˆ©å¥½ + ç»¼åˆå¼ºåº¦ > 50 | æ­£å¸¸æŒæœ‰ï¼Œè¿½æ±‚æ›´é«˜æ”¶ç›Š |
| **ä¸­æ€§åˆ©å¥½** | ç»¼åˆå¼ºåº¦ > 10 | æ­£å¸¸æŒæœ‰ï¼ŒåŠ¨æ€è°ƒæ•´ |
| **ä¸­æ€§** | ç»¼åˆå¼ºåº¦åœ¨ -10 åˆ° 10 ä¹‹é—´ | è°¨æ…æŒæœ‰ï¼Œè®¾ç½®ä¿æŠ¤ |
| **ä¸­æ€§åˆ©ç©º** | ç»¼åˆå¼ºåº¦ < -10 | æ”¶ç´§æ­¢ç›ˆ/æ­¢æŸ |
| **è¾ƒå·®** | è¶‹åŠ¿ä¸€è‡´åˆ©ç©º + ç»¼åˆå¼ºåº¦ < -50 | è€ƒè™‘æ­¢æŸæˆ–æ­¢ç›ˆ |

### 2. å¸‚åœºç¯å¢ƒå“åº”ç­–ç•¥

#### å¸‚åœºç¯å¢ƒæ¶åŒ–å“åº”

```typescript
// å¸‚åœºç¯å¢ƒä»"è‰¯å¥½"æˆ–"ä¸­æ€§åˆ©å¥½"å˜ä¸º"è¾ƒå·®"æˆ–"ä¸­æ€§åˆ©ç©º"
if (
  (previousMarketEnv === 'è‰¯å¥½' || previousMarketEnv === 'ä¸­æ€§åˆ©å¥½') &&
  (currentMarketEnv === 'è¾ƒå·®' || currentMarketEnv === 'ä¸­æ€§åˆ©ç©º')
) {
  // è®¡ç®—å¸‚åœºç¯å¢ƒæ¶åŒ–ç¨‹åº¦
  const marketDeterioration = calculateMarketDeterioration(
    previousMarketEnv,
    currentMarketEnv,
    previousStrength,
    currentStrength
  );
  
  if (pnlPercent > 3) {
    // ç›ˆåˆ©è¶…è¿‡3%ï¼šæ”¶ç´§æ­¢ç›ˆï¼Œä¿æŠ¤åˆ©æ¶¦
    // æ­¢ç›ˆè°ƒæ•´ä¸ºï¼šå½“å‰ä»·æ ¼ + 1% æˆ– åŸæ­¢ç›ˆçš„ 95%
    takeProfit = Math.min(
      currentPrice * 1.01,
      originalTakeProfit * 0.95
    );
    
    // å¦‚æœå¸‚åœºç¯å¢ƒæåº¦æ¶åŒ–ï¼Œè€ƒè™‘ç«‹å³æ­¢ç›ˆ
    if (marketDeterioration > 0.5) {
      shouldSell = true;
      exitReason = 'MARKET_DETERIORATION_PROFIT_PROTECTION';
    }
  } else if (pnlPercent > 0) {
    // è½»åº¦ç›ˆåˆ©ï¼šæ”¶ç´§æ­¢ç›ˆï¼Œä¿æŠ¤åˆ©æ¶¦
    takeProfit = Math.min(
      currentPrice * 1.02,
      originalTakeProfit * 0.97
    );
  } else if (pnlPercent > -2) {
    // è½»åº¦äºæŸï¼šæ”¶ç´§æ­¢æŸï¼Œé¿å…è¿›ä¸€æ­¥äºæŸ
    stopLoss = Math.max(
      currentPrice * 0.99,
      originalStopLoss * 1.03
    );
    
    // å¦‚æœå¸‚åœºç¯å¢ƒæåº¦æ¶åŒ–ï¼Œè€ƒè™‘æ­¢æŸ
    if (marketDeterioration > 0.7) {
      shouldSell = true;
      exitReason = 'MARKET_DETERIORATION_STOP_LOSS';
    }
  } else {
    // æ·±åº¦äºæŸï¼šä¿æŒåŸæ­¢æŸï¼Œä¸è½»æ˜“è°ƒæ•´
    // é™¤éå¸‚åœºç¯å¢ƒæåº¦æ¶åŒ–ï¼Œå¦åˆ™æŒæœ‰
    if (marketDeterioration > 0.8) {
      shouldSell = true;
      exitReason = 'MARKET_DETERIORATION_DEEP_LOSS';
    }
  }
}
```

#### å¸‚åœºç¯å¢ƒæ”¹å–„å“åº”

```typescript
// å¸‚åœºç¯å¢ƒä»"è¾ƒå·®"æˆ–"ä¸­æ€§åˆ©ç©º"å˜ä¸º"è‰¯å¥½"æˆ–"ä¸­æ€§åˆ©å¥½"
if (
  (previousMarketEnv === 'è¾ƒå·®' || previousMarketEnv === 'ä¸­æ€§åˆ©ç©º') &&
  (currentMarketEnv === 'è‰¯å¥½' || currentMarketEnv === 'ä¸­æ€§åˆ©å¥½')
) {
  if (pnlPercent < 0) {
    // äºæŸçŠ¶æ€ï¼šæ”¾å®½æ­¢æŸï¼Œç»™æ›´å¤šæ—¶é—´
    stopLoss = Math.max(
      originalStopLoss * 0.95,
      entryPrice * 0.92  // æœ€å¤šæ”¾å®½åˆ°å…¥åœºä»·çš„92%
    );
  } else {
    // ç›ˆåˆ©çŠ¶æ€ï¼šæ”¾å®½æ­¢ç›ˆï¼Œè¿½æ±‚æ›´é«˜æ”¶ç›Š
    takeProfit = Math.min(
      originalTakeProfit * 1.05,
      entryPrice * 1.15  // æœ€å¤šæ”¾å®½åˆ°å…¥åœºä»·çš„115%
    );
  }
}
```

### 3. å¸‚åœºç¯å¢ƒå˜åŒ–è®¡ç®—

```typescript
function calculateMarketDeterioration(
  previousEnv: string,
  currentEnv: string,
  previousStrength: number,
  currentStrength: number
): number {
  // å¸‚åœºç¯å¢ƒç­‰çº§æ˜ å°„
  const envLevels: Record<string, number> = {
    'è‰¯å¥½': 5,
    'ä¸­æ€§åˆ©å¥½': 4,
    'ä¸­æ€§': 3,
    'ä¸­æ€§åˆ©ç©º': 2,
    'è¾ƒå·®': 1,
  };
  
  const previousLevel = envLevels[previousEnv] || 3;
  const currentLevel = envLevels[currentEnv] || 3;
  
  // ç¯å¢ƒç­‰çº§å˜åŒ–ï¼ˆ0-4ï¼‰
  const levelChange = previousLevel - currentLevel;
  
  // å¼ºåº¦å˜åŒ–ï¼ˆå½’ä¸€åŒ–åˆ°0-1ï¼‰
  const strengthChange = Math.max(0, (previousStrength - currentStrength) / 100);
  
  // ç»¼åˆæ¶åŒ–ç¨‹åº¦ï¼ˆ0-1ï¼‰
  const deterioration = Math.min(1, (levelChange / 4) * 0.6 + strengthChange * 0.4);
  
  return deterioration;
}
```

---

## ğŸ›¡ï¸ é£é™©æ§åˆ¶æœºåˆ¶

### 1. ç›ˆäºå¹³è¡¡ä¿æŠ¤

åœ¨ç›ˆäºå¹³è¡¡ç‚¹é™„è¿‘è®¾ç½®ä¿æŠ¤æœºåˆ¶ï¼š

```typescript
// ç›ˆäºå¹³è¡¡ä¿æŠ¤
const breakEvenPrice = entryPrice * 1.01; // è€ƒè™‘äº¤æ˜“è´¹ç”¨

if (currentPrice >= breakEvenPrice && currentPrice < breakEvenPrice * 1.02) {
  // åœ¨ç›ˆäºå¹³è¡¡ç‚¹é™„è¿‘ï¼šè®¾ç½®ä¿æŠ¤æ­¢æŸ
  // æ­¢æŸä¸ä½äºç›ˆäºå¹³è¡¡ç‚¹
  stopLoss = Math.max(stopLoss, breakEvenPrice * 0.99);
  
  // å¦‚æœå¸‚åœºç¯å¢ƒæ¶åŒ–ï¼Œè€ƒè™‘æ­¢ç›ˆ
  if (currentMarketEnv === 'è¾ƒå·®' || currentMarketEnv === 'ä¸­æ€§åˆ©ç©º') {
    shouldSell = true;
    exitReason = 'BREAK_EVEN_PROTECTION';
  }
}
```

### 2. æŒä»“æ—¶é—´ä¿æŠ¤

æ ¹æ®æŒä»“æ—¶é—´è®¾ç½®ä¿æŠ¤æœºåˆ¶ï¼š

```typescript
// æŒä»“æ—¶é—´ä¿æŠ¤
const holdingHours = (Date.now() - entryTime) / (1000 * 60 * 60);

if (holdingHours > 48) {
  // æŒä»“è¶…è¿‡48å°æ—¶ï¼šå¼ºåˆ¶è¯„ä¼°
  if (pnlPercent > 0) {
    // ç›ˆåˆ©çŠ¶æ€ï¼šè€ƒè™‘æ­¢ç›ˆ
    if (currentPrice >= takeProfit * 0.95) {
      shouldSell = true;
      exitReason = 'HOLDING_TIME_PROFIT';
    }
  } else if (pnlPercent < -3) {
    // äºæŸè¶…è¿‡3%ï¼šè€ƒè™‘æ­¢æŸ
    if (currentPrice <= stopLoss * 1.05) {
      shouldSell = true;
      exitReason = 'HOLDING_TIME_LOSS';
    }
  }
}
```

### 3. æ³¢åŠ¨æ€§ä¿æŠ¤

æ ¹æ®æ³¢åŠ¨æ€§è®¾ç½®ä¿æŠ¤æœºåˆ¶ï¼š

```typescript
// æ³¢åŠ¨æ€§ä¿æŠ¤
const currentATR = calculateATR(candlesticks, 14);
const atrPercent = currentATR / currentPrice;

if (atrPercent > 0.05) {
  // æ³¢åŠ¨æ€§è¶…è¿‡5%ï¼šæ”¶ç´§æ­¢ç›ˆ/æ­¢æŸ
  if (pnlPercent > 0) {
    // ç›ˆåˆ©çŠ¶æ€ï¼šæ”¶ç´§æ­¢ç›ˆï¼Œä¿æŠ¤åˆ©æ¶¦
    takeProfit = Math.min(
      currentPrice * 1.03,
      originalTakeProfit * 0.97
    );
  } else {
    // äºæŸçŠ¶æ€ï¼šæ”¶ç´§æ­¢æŸï¼Œé¿å…è¿›ä¸€æ­¥äºæŸ
    stopLoss = Math.max(
      currentPrice * 0.97,
      originalStopLoss * 1.03
    );
  }
}
```

---

## ğŸ’» å®ç°æ–¹æ¡ˆ

### 1. æ•°æ®ç»“æ„è®¾è®¡

```typescript
interface PositionContext {
  // åŸºç¡€ä¿¡æ¯
  entryPrice: number;
  quantity: number;
  entryTime: Date;
  
  // æ­¢ç›ˆæ­¢æŸ
  originalStopLoss: number;
  originalTakeProfit: number;
  currentStopLoss: number;
  currentTakeProfit: number;
  
  // å¸‚åœºç¯å¢ƒ
  entryMarketEnv: string;
  entryMarketStrength: number;
  previousMarketEnv: string;
  previousMarketStrength: number;
  
  // æ³¢åŠ¨æ€§
  originalATR: number;
  currentATR: number;
  
  // è°ƒæ•´å†å²
  adjustmentHistory: Array<{
    timestamp: Date;
    reason: string;
    stopLoss: number;
    takeProfit: number;
  }>;
}
```

### 2. æ ¸å¿ƒå‡½æ•°è®¾è®¡

#### æŒä»“ç›‘æ§ä¸»å‡½æ•°

```typescript
async function processHoldingPosition(
  strategyInstance: StrategyBase,
  strategyId: number,
  symbol: string
): Promise<void> {
  // 1. è·å–æŒä»“ä¸Šä¸‹æ–‡
  const context = await getPositionContext(strategyId, symbol);
  
  // 2. è·å–å½“å‰ä»·æ ¼å’Œå¸‚åœºç¯å¢ƒ
  const currentPrice = await getCurrentPrice(symbol);
  const currentMarketEnv = await getCurrentMarketEnvironment();
  
  // 3. è®¡ç®—ç›ˆäº
  const pnlPercent = ((currentPrice - context.entryPrice) / context.entryPrice) * 100;
  
  // 4. æ£€æŸ¥å›ºå®šæ­¢ç›ˆ/æ­¢æŸ
  if (currentPrice <= context.currentStopLoss) {
    await executeSell(strategyId, symbol, 'STOP_LOSS', currentPrice);
    return;
  }
  
  if (currentPrice >= context.currentTakeProfit) {
    await executeSell(strategyId, symbol, 'TAKE_PROFIT', currentPrice);
    return;
  }
  
  // 5. åŠ¨æ€è°ƒæ•´æ­¢ç›ˆ/æ­¢æŸ
  const adjusted = await adjustStopLossTakeProfit(
    context,
    currentPrice,
    currentMarketEnv
  );
  
  if (adjusted.shouldSell) {
    await executeSell(strategyId, symbol, adjusted.exitReason, currentPrice);
    return;
  }
  
  // 6. æ›´æ–°æŒä»“ä¸Šä¸‹æ–‡
  await updatePositionContext(strategyId, symbol, adjusted.context);
}
```

#### åŠ¨æ€è°ƒæ•´å‡½æ•°

```typescript
async function adjustStopLossTakeProfit(
  context: PositionContext,
  currentPrice: number,
  currentMarketEnv: string
): Promise<{
  shouldSell: boolean;
  exitReason?: string;
  context: PositionContext;
}> {
  const pnlPercent = ((currentPrice - context.entryPrice) / context.entryPrice) * 100;
  const holdingHours = (Date.now() - context.entryTime.getTime()) / (1000 * 60 * 60);
  
  let newStopLoss = context.currentStopLoss;
  let newTakeProfit = context.currentTakeProfit;
  let shouldSell = false;
  let exitReason = '';
  
  // 1. å¸‚åœºç¯å¢ƒå˜åŒ–è°ƒæ•´
  if (context.previousMarketEnv !== currentMarketEnv) {
    const adjustment = adjustByMarketEnvironment(
      context,
      currentPrice,
      currentMarketEnv,
      pnlPercent
    );
    newStopLoss = adjustment.stopLoss;
    newTakeProfit = adjustment.takeProfit;
    if (adjustment.shouldSell) {
      shouldSell = true;
      exitReason = adjustment.exitReason;
    }
  }
  
  // 2. æŒä»“æ—¶é—´è°ƒæ•´
  const timeAdjustment = adjustByHoldingTime(
    context,
    currentPrice,
    holdingHours,
    pnlPercent
  );
  newStopLoss = Math.max(newStopLoss, timeAdjustment.stopLoss);
  newTakeProfit = Math.min(newTakeProfit, timeAdjustment.takeProfit);
  if (timeAdjustment.shouldSell && !shouldSell) {
    shouldSell = true;
    exitReason = timeAdjustment.exitReason;
  }
  
  // 3. æ³¢åŠ¨æ€§è°ƒæ•´
  const volatilityAdjustment = adjustByVolatility(
    context,
    currentPrice,
    pnlPercent
  );
  newStopLoss = Math.max(newStopLoss, volatilityAdjustment.stopLoss);
  newTakeProfit = Math.min(newTakeProfit, volatilityAdjustment.takeProfit);
  
  // 4. é£é™©ä¿æŠ¤æ£€æŸ¥
  const protectionCheck = checkRiskProtection(
    context,
    currentPrice,
    pnlPercent,
    holdingHours
  );
  if (protectionCheck.shouldSell && !shouldSell) {
    shouldSell = true;
    exitReason = protectionCheck.exitReason;
  }
  
  // 5. æ›´æ–°ä¸Šä¸‹æ–‡
  const updatedContext: PositionContext = {
    ...context,
    currentStopLoss: newStopLoss,
    currentTakeProfit: newTakeProfit,
    previousMarketEnv: currentMarketEnv,
    adjustmentHistory: [
      ...context.adjustmentHistory,
      {
        timestamp: new Date(),
        reason: exitReason || 'DYNAMIC_ADJUSTMENT',
        stopLoss: newStopLoss,
        takeProfit: newTakeProfit,
      },
    ],
  };
  
  return {
    shouldSell,
    exitReason,
    context: updatedContext,
  };
}
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. å•å…ƒæµ‹è¯•

- æµ‹è¯•å¸‚åœºç¯å¢ƒå˜åŒ–è°ƒæ•´é€»è¾‘
- æµ‹è¯•æŒä»“æ—¶é—´è°ƒæ•´é€»è¾‘
- æµ‹è¯•æ³¢åŠ¨æ€§è°ƒæ•´é€»è¾‘
- æµ‹è¯•é£é™©ä¿æŠ¤æœºåˆ¶

### 2. å›æµ‹éªŒè¯

- ä½¿ç”¨å†å²æ•°æ®å›æµ‹ç­–ç•¥
- å¯¹æ¯”ä¿®å¤å‰åçš„è¡¨ç°
- éªŒè¯æ˜¯å¦è§£å†³äº†é«˜ä¹°ä½å–é—®é¢˜
- éªŒè¯æ˜¯å¦èƒ½å¤ŸæŠ“ä½æœºä¼š

### 3. å®ç›˜éªŒè¯

- å°èµ„é‡‘å®ç›˜æµ‹è¯•
- ç›‘æ§ç­–ç•¥æ‰§è¡Œæƒ…å†µ
- æ”¶é›†å®é™…æ•°æ®
- æŒç»­ä¼˜åŒ–ç­–ç•¥

---

## ğŸ“ å®æ–½è®¡åˆ’

### é˜¶æ®µ1: æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆ1-2å‘¨ï¼‰

1. å®ç°æŒä»“ä¸Šä¸‹æ–‡ç®¡ç†
2. å®ç°åŠ¨æ€æ­¢ç›ˆ/æ­¢æŸè°ƒæ•´
3. å®ç°å¸‚åœºç¯å¢ƒå“åº”æœºåˆ¶
4. å®ç°é£é™©ä¿æŠ¤æœºåˆ¶

### é˜¶æ®µ2: æµ‹è¯•ä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

1. å•å…ƒæµ‹è¯•
2. å›æµ‹éªŒè¯
3. æ€§èƒ½ä¼˜åŒ–
4. Bugä¿®å¤

### é˜¶æ®µ3: å®ç›˜éªŒè¯ï¼ˆ2-4å‘¨ï¼‰

1. å°èµ„é‡‘å®ç›˜æµ‹è¯•
2. æ•°æ®æ”¶é›†å’Œåˆ†æ
3. ç­–ç•¥ä¼˜åŒ–
4. æ–‡æ¡£å®Œå–„

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [äº¤æ˜“æ¨èé€»è¾‘æ–‡æ¡£](technical/TRADING_RECOMMENDATION_LOGIC.md)
- [ç­–ç•¥é€»è¾‘å®¡æŸ¥æ–‡æ¡£](technical/STRATEGY_LOGIC_REVIEW.md)
- [è®¢å•æäº¤ä¼˜åŒ–æ–¹æ¡ˆ](archive/ORDER_SUBMIT_OPTIMIZATION.md)

---

**æ–‡æ¡£çŠ¶æ€**: è®¾è®¡å®Œæˆï¼Œç­‰å¾…å®æ–½  
**æœ€åæ›´æ–°**: 2025-12-03

