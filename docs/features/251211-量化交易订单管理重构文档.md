# é‡åŒ–äº¤æ˜“è®¢å•ç®¡ç†é‡æ„æ–‡æ¡£

**åˆ›å»ºæ—¥æœŸ**: 2025-12-10  
**æœ€åæ›´æ–°**: 2025-12-12  
**çŠ¶æ€**: å·²å®Œæˆ âœ…

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

### æ–‡æ¡£ç»“æ„

æœ¬æ–‡æ¡£æ•´åˆäº†é‡åŒ–äº¤æ˜“è®¢å•ç®¡ç†é‡æ„çš„æ‰€æœ‰ç›¸å…³æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š
- äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰ï¼šå®Œæ•´çš„åŠŸèƒ½éœ€æ±‚å’ŒæŠ€æœ¯æ–¹æ¡ˆ
- å®æ–½å®Œæˆæ€»ç»“ï¼šå·²å®ŒæˆåŠŸèƒ½çš„å®æ–½æƒ…å†µå’ŒéªŒæ”¶ç»“æœ
- å¿«é€Ÿæ€»ç»“ï¼šæ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ

### å¿«é€Ÿå¯¼èˆª

**æƒ³äº†è§£åŠŸèƒ½éœ€æ±‚ï¼Ÿ** â†’ æŸ¥çœ‹ã€Œ1. äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰ã€

**æƒ³äº†è§£å®æ–½æƒ…å†µï¼Ÿ** â†’ æŸ¥çœ‹ã€Œ2. å®æ–½å®Œæˆæ€»ç»“ã€

**æƒ³å¿«é€Ÿäº†è§£æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ** â†’ æŸ¥çœ‹ã€Œ3. å¿«é€Ÿæ€»ç»“ã€

---

# 1. äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1
- **åˆ›å»ºæ—¶é—´**ï¼š2025-12-10
- **æœ€åæ›´æ–°**ï¼š2025-12-11
- **æ–‡æ¡£ä½œè€…**ï¼šAI Product Manager
- **å®¡æ ¸çŠ¶æ€**ï¼šå·²å®æ–½ âœ…

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 ä¸šåŠ¡èƒŒæ™¯

å½“å‰é‡åŒ–äº¤æ˜“ç³»ç»Ÿå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **æ•°æ®æºä¸ç»Ÿä¸€**ï¼š
   - äº¤æ˜“è®°å½•ï¼ˆ`auto_trades`è¡¨ï¼‰ä¸è®¢å•ç®¡ç†ï¼ˆé•¿æ¡¥APIï¼‰æ•°æ®ä¸ä¸€è‡´
   - ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ä¸å‡†ç¡®ï¼ˆä»`execution_orders`è¡¨ç»Ÿè®¡ï¼Œå¯èƒ½é—æ¼æˆ–é‡å¤ï¼‰
   - å†å²ç›ˆäºæ•°æ®ä¸å‡†ç¡®ï¼Œæ— æ³•ä¸çœŸå®è®¢å•å…³è”

2. **åŠŸèƒ½å†—ä½™**ï¼š
   - äº¤æ˜“è®°å½•é¡µé¢ï¼ˆ`/quant/trades`ï¼‰åŠŸèƒ½ä¸è®¢å•ç®¡ç†é‡å¤
   - `auto_trades`è¡¨çš„æ•°æ®æ¥æºä¸å‡†ç¡®ï¼Œæ— æ³•ä½œä¸ºå¯ä¿¡æ•°æ®æº

3. **ä¿¡å·æ—¥å¿—çŠ¶æ€æœªæ›´æ–°**ï¼š
   - æ‰€æœ‰ä¿¡å·çŠ¶æ€éƒ½æ˜¯"å¾…å¤„ç†"ï¼Œæœªä¸è®¢å•çŠ¶æ€å…³è”
   - æ— æ³•è¿½è¸ªä¿¡å·çš„æ‰§è¡Œæƒ…å†µ

### 1.2 ç”¨æˆ·ç—›ç‚¹

- **æ•°æ®ä¸å‡†ç¡®**ï¼šä»Šæ—¥äº¤æ˜“æ•°é‡ä¸å®é™…ä¸ç¬¦ï¼ˆ27ç¬”è®¢å•åªæ˜¾ç¤º6ç¬”ï¼‰
- **åŠŸèƒ½é‡å¤**ï¼šäº¤æ˜“è®°å½•å’Œè®¢å•ç®¡ç†åŠŸèƒ½é‡å¤ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬
- **çŠ¶æ€ä¸æ¸…æ™°**ï¼šæ— æ³•çŸ¥é“ä¿¡å·æ˜¯å¦å·²æ‰§è¡Œã€å·²æˆäº¤

### 1.3 ä¸šåŠ¡ç›®æ ‡

- **ä¸»è¦ç›®æ ‡**ï¼š
  - ç»Ÿä¸€æ•°æ®æºï¼šæ‰€æœ‰äº¤æ˜“æ•°æ®æ¥è‡ªé•¿æ¡¥APIï¼ˆçœŸå®æœ‰æ•ˆï¼‰
  - ç®€åŒ–åŠŸèƒ½ï¼šåˆ é™¤å†—ä½™çš„äº¤æ˜“è®°å½•åŠŸèƒ½
  - æå‡å‡†ç¡®æ€§ï¼šä»Šæ—¥äº¤æ˜“æ•°é‡ã€ç›ˆäºç»Ÿè®¡åŸºäºçœŸå®è®¢å•æ•°æ®
  - å®Œå–„è¿½è¸ªï¼šä¿¡å·æ—¥å¿—çŠ¶æ€ä¸è®¢å•çŠ¶æ€å®æ—¶å…³è”

- **æˆåŠŸæŒ‡æ ‡**ï¼š
  - ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å‡†ç¡®ç‡ 100%ï¼ˆä¸å®é™…è®¢å•ä¸€è‡´ï¼‰
  - ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°åŠæ—¶ç‡ â‰¥ 95%
  - ç”¨æˆ·æ»¡æ„åº¦æå‡ï¼ˆæ•°æ®å‡†ç¡®æ€§æå‡ï¼‰

### 1.4 é¡¹ç›®èŒƒå›´

- **åŒ…å«èŒƒå›´**ï¼š
  - åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ï¼ˆ`/quant/trades`é¡µé¢å’ŒAPIï¼‰
  - å°†è®¢å•ç®¡ç†ç§»åŠ¨åˆ°é‡åŒ–äº¤æ˜“æ¨¡å—ï¼ˆ`/quant/orders`ï¼‰
  - ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡é€»è¾‘ï¼ˆä½¿ç”¨è®¢å•ç®¡ç†çš„ä»Šæ—¥è®¢å•ï¼‰
  - ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°é€»è¾‘ï¼ˆè®¢å•æäº¤å’Œæˆäº¤æ—¶æ›´æ–°ï¼‰
  - ä»Šæ—¥äº¤æ˜“æ•°é‡æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ï¼ˆtooltipï¼‰

- **ä¸åŒ…å«èŒƒå›´**ï¼š
  - `auto_trades`è¡¨çš„åˆ é™¤ï¼ˆä¿ç•™ç”¨äºå…¼å®¹ï¼Œä½†ä¸å†ä½œä¸ºä¸»è¦æ•°æ®æºï¼‰
  - å†å²æ•°æ®è¿ç§»ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼Œæ–°æ•°æ®ä¸å†å†™å…¥ï¼‰
  - å›æµ‹åŠŸèƒ½çš„æ•°æ®æºä¿®æ”¹ï¼ˆå›æµ‹åŠŸèƒ½ç»§ç»­ä½¿ç”¨`auto_trades`è¡¨ï¼‰
  - ä»Šæ—¥ç›ˆäºè®¡ç®—çš„ä¿®æ”¹ï¼ˆä»Šæ—¥ç›ˆäºè®¡ç®—ç»§ç»­ä½¿ç”¨`auto_trades`è¡¨ï¼Œä½†å¯ä»¥åç»­ä¼˜åŒ–ï¼‰
  - èµ„é‡‘ç®¡ç†ä¸­çš„æŒä»“æ£€æŸ¥é€»è¾‘ä¿®æ”¹ï¼ˆ`capital-manager.service.ts`ä¸­çš„`auto_trades`æŸ¥è¯¢å¯ä»¥åç»­ä¼˜åŒ–ï¼‰

## 2. ç”¨æˆ·ä¸åœºæ™¯

### 2.1 ç›®æ ‡ç”¨æˆ·

- **ä¸»è¦ç”¨æˆ·**ï¼šé‡åŒ–äº¤æ˜“ç­–ç•¥ç®¡ç†å‘˜ã€äº¤æ˜“å‘˜
- **ç”¨æˆ·ç‰¹å¾**ï¼šéœ€è¦å‡†ç¡®äº†è§£äº¤æ˜“æƒ…å†µï¼Œè¿½è¸ªä¿¡å·æ‰§è¡ŒçŠ¶æ€

### 2.2 ä½¿ç”¨åœºæ™¯

**åœºæ™¯1ï¼šæŸ¥çœ‹ä»Šæ—¥äº¤æ˜“ç»Ÿè®¡**
- **ç”¨æˆ·**ï¼šç­–ç•¥ç®¡ç†å‘˜
- **æ—¶é—´**ï¼šäº¤æ˜“æ—¥ä¸Šåˆ
- **åœ°ç‚¹**ï¼šåŠå…¬å®¤
- **è¡Œä¸º**ï¼šæ‰“å¼€é‡åŒ–äº¤æ˜“é¦–é¡µï¼ŒæŸ¥çœ‹ä»Šæ—¥äº¤æ˜“æ•°é‡
- **ç›®æ ‡**ï¼šå¿«é€Ÿäº†è§£ä»Šæ—¥äº¤æ˜“æƒ…å†µï¼ˆæ€»æ•°é‡ã€ä¹°å…¥/å–å‡ºæ•°é‡ï¼‰

**åœºæ™¯2ï¼šæŸ¥çœ‹è®¢å•è¯¦æƒ…**
- **ç”¨æˆ·**ï¼šäº¤æ˜“å‘˜
- **æ—¶é—´**ï¼šäº¤æ˜“ä¸­
- **åœ°ç‚¹**ï¼šåŠå…¬å®¤
- **è¡Œä¸º**ï¼šåœ¨é‡åŒ–äº¤æ˜“æ¨¡å—ä¸­æŸ¥çœ‹ä»Šæ—¥è®¢å•å’Œå†å²è®¢å•
- **ç›®æ ‡**ï¼šæŸ¥çœ‹è®¢å•è¯¦æƒ…ã€çŠ¶æ€ã€æˆäº¤ä»·æ ¼ç­‰

**åœºæ™¯3ï¼šè¿½è¸ªä¿¡å·æ‰§è¡ŒçŠ¶æ€**
- **ç”¨æˆ·**ï¼šç­–ç•¥ç®¡ç†å‘˜
- **æ—¶é—´**ï¼šç­–ç•¥å¤ç›˜æ—¶
- **åœ°ç‚¹**ï¼šåŠå…¬å®¤
- **è¡Œä¸º**ï¼šæŸ¥çœ‹ä¿¡å·æ—¥å¿—ï¼Œäº†è§£ä¿¡å·æ˜¯å¦å·²æ‰§è¡Œã€å·²æˆäº¤
- **ç›®æ ‡**ï¼šè¯„ä¼°ä¿¡å·è´¨é‡ï¼Œä¼˜åŒ–ç­–ç•¥å‚æ•°

### 2.3 ç”¨æˆ·æ•…äº‹

- As a ç­–ç•¥ç®¡ç†å‘˜, I want æŸ¥çœ‹å‡†ç¡®çš„ä»Šæ—¥äº¤æ˜“æ•°é‡, So that æˆ‘å¯ä»¥å¿«é€Ÿäº†è§£äº¤æ˜“æƒ…å†µ
- As a äº¤æ˜“å‘˜, I want åœ¨é‡åŒ–äº¤æ˜“æ¨¡å—ä¸­æŸ¥çœ‹è®¢å•, So that æˆ‘ä¸éœ€è¦åœ¨ä¸åŒæ¨¡å—é—´åˆ‡æ¢
- As a ç­–ç•¥ç®¡ç†å‘˜, I want ä¿¡å·æ—¥å¿—çŠ¶æ€å®æ—¶æ›´æ–°, So that æˆ‘å¯ä»¥è¿½è¸ªä¿¡å·çš„æ‰§è¡Œæƒ…å†µ

## 3. åŠŸèƒ½éœ€æ±‚

### 3.1 åŠŸèƒ½æ¦‚è§ˆ

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ | P0 | åˆ é™¤`/quant/trades`é¡µé¢å’ŒAPI |
| ç§»åŠ¨è®¢å•ç®¡ç†åˆ°é‡åŒ–æ¨¡å— | P0 | å°†`/orders`ç§»åŠ¨åˆ°`/quant/orders` |
| ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ | P0 | ä½¿ç”¨è®¢å•ç®¡ç†çš„ä»Šæ—¥è®¢å•æ•°é‡ |
| ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–° | P0 | è®¢å•æäº¤å’Œæˆäº¤æ—¶æ›´æ–°ä¿¡å·çŠ¶æ€ |
| æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ | P1 | åœ¨tooltipä¸­æ˜¾ç¤ºä¹°å…¥å’Œå–å‡ºæ•°é‡ |

### 3.2 åŠŸèƒ½è¯¦ç»†è¯´æ˜

#### åŠŸèƒ½1ï¼šåˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½
**ä¼˜å…ˆçº§**ï¼šP0

**åŠŸèƒ½æè¿°**ï¼š
åˆ é™¤å†—ä½™çš„äº¤æ˜“è®°å½•åŠŸèƒ½ï¼Œç»Ÿä¸€ä½¿ç”¨è®¢å•ç®¡ç†çš„æ•°æ®æºã€‚

**äº¤äº’æµç¨‹**ï¼š
1. åˆ é™¤å‰ç«¯é¡µé¢ï¼š`frontend/app/quant/trades/page.tsx`
2. åˆ é™¤åç«¯APIï¼š`api/src/routes/quant.ts`ä¸­çš„`GET /api/quant/trades`
3. åˆ é™¤å¯¼èˆªèœå•ä¸­çš„"äº¤æ˜“è®°å½•"å…¥å£
4. æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Š

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] `/quant/trades`é¡µé¢å·²åˆ é™¤ âœ…
- [x] `GET /api/quant/trades` APIå·²åˆ é™¤ âœ…
- [x] å¯¼èˆªèœå•ä¸­"äº¤æ˜“è®°å½•"å…¥å£å·²åˆ é™¤ï¼Œæ”¹ä¸º"è®¢å•ç®¡ç†" âœ…
- [x] ç›¸å…³æ–‡æ¡£å·²æ›´æ–° âœ…

#### åŠŸèƒ½2ï¼šç§»åŠ¨è®¢å•ç®¡ç†åˆ°é‡åŒ–æ¨¡å—
**ä¼˜å…ˆçº§**ï¼šP0

**åŠŸèƒ½æè¿°**ï¼š
å°†è®¢å•ç®¡ç†é¡µé¢ä»`/orders`ç§»åŠ¨åˆ°`/quant/orders`ï¼Œæ•´åˆåˆ°é‡åŒ–äº¤æ˜“æ¨¡å—ä¸­ã€‚

**äº¤äº’æµç¨‹**ï¼š
1. å¤åˆ¶`frontend/app/orders/page.tsx`åˆ°`frontend/app/quant/orders/page.tsx`
2. æ›´æ–°è·¯ç”±å’Œå¯¼èˆªèœå•
3. åˆ é™¤åŸ`/orders`é¡µé¢ï¼ˆæˆ–ä¿ç•™é‡å®šå‘ï¼‰
4. æ›´æ–°APIè°ƒç”¨è·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] `/quant/orders`é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—® âœ…
- [x] ä»Šæ—¥è®¢å•å’Œå†å²è®¢å•åŠŸèƒ½æ­£å¸¸ âœ…
- [x] åŸ`/orders`è·¯ç”±é‡å®šå‘åˆ°`/quant/orders` âœ…
- [x] å¯¼èˆªèœå•å·²æ›´æ–° âœ…

#### åŠŸèƒ½3ï¼šä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡
**ä¼˜å…ˆçº§**ï¼šP0

**åŠŸèƒ½æè¿°**ï¼š
ä¿®æ”¹Dashboardç»Ÿè®¡APIï¼Œä½¿ç”¨è®¢å•ç®¡ç†çš„ä»Šæ—¥è®¢å•æ•°é‡ï¼ˆæ¥è‡ªé•¿æ¡¥APIï¼‰ï¼Œè€Œä¸æ˜¯`execution_orders`è¡¨ã€‚

**ç»Ÿè®¡é€»è¾‘**ï¼š
```typescript
// 1. è·å–ä»Šæ—¥è®¢å•ï¼ˆä»é•¿æ¡¥APIï¼‰
const tradeCtx = await getTradeContext();
const todayOrders = await tradeCtx.todayOrders({});

// 2. ç­›é€‰å·²æˆäº¤è®¢å•
const filledOrders = todayOrders.filter(order => {
  const status = normalizeStatus(order.status);
  return status === 'FilledStatus' || status === 'PartialFilledStatus';
});

// 3. ç»Ÿè®¡æ€»æ•°é‡
const todayTrades = filledOrders.length;

// 4. åŒºåˆ†ä¹°å…¥å’Œå–å‡º
const todayBuyOrders = filledOrders.filter(order => 
  normalizeSide(order.side) === 'Buy'
).length;
const todaySellOrders = filledOrders.filter(order => 
  normalizeSide(order.side) === 'Sell'
).length;
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å‡†ç¡®ï¼ˆä¸å®é™…è®¢å•ä¸€è‡´ï¼‰ âœ…
- [x] ä¹°å…¥å’Œå–å‡ºæ•°é‡ç»Ÿè®¡æ­£ç¡® âœ…
- [x] å‰ç«¯tooltipæ­£ç¡®æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ âœ…
- [x] APIé™æµæ—¶ä¼˜é›…é™çº§ï¼ˆä½¿ç”¨æ•°æ®åº“é™çº§æ–¹æ¡ˆï¼‰ âœ…

#### åŠŸèƒ½4ï¼šä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°
**ä¼˜å…ˆçº§**ï¼šP0

**åŠŸèƒ½æè¿°**ï¼š
ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œåœ¨è®¢å•æäº¤å’Œæˆäº¤æ—¶è‡ªåŠ¨æ›´æ–°ä¿¡å·çŠ¶æ€ã€‚

**çŠ¶æ€æ˜ å°„è§„åˆ™**ï¼š
- `PENDING` â†’ å¾…å¤„ç†ï¼ˆä¿¡å·ç”Ÿæˆï¼Œæœªæäº¤è®¢å•ï¼‰
- `EXECUTED` â†’ å·²æ‰§è¡Œï¼ˆè®¢å•å·²æäº¤æˆ–å·²æˆäº¤ï¼‰
- `REJECTED` â†’ å·²æ‹’ç»ï¼ˆè®¢å•è¢«æ‹’ç»ï¼‰
- `IGNORED` â†’ å·²å¿½ç•¥ï¼ˆè®¢å•è¢«å–æ¶ˆæˆ–å…¶ä»–æƒ…å†µï¼‰

**æ›´æ–°é€»è¾‘**ï¼š
```typescript
// 1. è®¢å•æäº¤æ—¶ï¼ˆbasic-execution.service.tsï¼‰
async submitOrder(...) {
  // ... æäº¤è®¢å•é€»è¾‘
  
  // å¦‚æœè®¢å•æäº¤æˆåŠŸï¼Œæ›´æ–°ä¿¡å·çŠ¶æ€
  if (orderId && normalizedStatus !== 'RejectedStatus') {
    await this.updateSignalStatusByOrderId(orderId, 'EXECUTED');
  } else if (normalizedStatus === 'RejectedStatus') {
    await this.updateSignalStatusByOrderId(orderId, 'REJECTED');
  }
}

// 2. è®¢å•æˆäº¤æ—¶ï¼ˆstrategy-scheduler.service.tsï¼‰
async trackPendingOrders(...) {
  // ... è®¢å•è¿½è¸ªé€»è¾‘
  
  // å¦‚æœè®¢å•å·²æˆäº¤ï¼Œæ›´æ–°ä¿¡å·çŠ¶æ€
  if (status === 'FilledStatus' || status === 'PartialFilledStatus') {
    await this.updateSignalStatusByOrderId(orderId, 'EXECUTED');
  }
  
  // å¦‚æœè®¢å•è¢«å–æ¶ˆï¼Œæ›´æ–°ä¿¡å·çŠ¶æ€
  if (status === 'CanceledStatus' || status === 'PendingCancelStatus') {
    await this.updateSignalStatusByOrderId(orderId, 'IGNORED');
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] è®¢å•æäº¤æ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`EXECUTED` âœ…
- [x] è®¢å•æˆäº¤æ—¶ä¿¡å·çŠ¶æ€ç¡®è®¤ä¸º`EXECUTED` âœ…
- [x] è®¢å•è¢«æ‹’ç»æ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`REJECTED` âœ…
- [x] è®¢å•è¢«å–æ¶ˆæ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`IGNORED` âœ…
- [x] ä¿¡å·æ—¥å¿—é¡µé¢æ­£ç¡®æ˜¾ç¤ºçŠ¶æ€ âœ…

#### åŠŸèƒ½5ï¼šæ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ï¼ˆTooltipï¼‰
**ä¼˜å…ˆçº§**ï¼šP1

**åŠŸèƒ½æè¿°**ï¼š
åœ¨é‡åŒ–äº¤æ˜“é¦–é¡µçš„ä»Šæ—¥äº¤æ˜“æ•°é‡ä¸Šæ·»åŠ tooltipï¼Œæ˜¾ç¤ºä¹°å…¥å’Œå–å‡ºè®¢å•æ•°é‡ã€‚

**UIè®¾è®¡**ï¼š
```tsx
<Tooltip title={
  <div>
    <div>æ€»äº¤æ˜“ï¼š{todayTrades}ç¬”</div>
    <div>ä¹°å…¥ï¼š{todayBuyOrders}ç¬”</div>
    <div>å–å‡ºï¼š{todaySellOrders}ç¬”</div>
  </div>
}>
  <span>{todayTrades}</span>
</Tooltip>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] Tooltipæ­£ç¡®æ˜¾ç¤ºæ€»äº¤æ˜“ã€ä¹°å…¥ã€å–å‡ºæ•°é‡ âœ…
- [x] Tooltipæ ·å¼ç¾è§‚ï¼Œä¿¡æ¯æ¸…æ™° âœ…
- [x] ç§»åŠ¨ç«¯æ”¯æŒï¼ˆç‚¹å‡»æ˜¾ç¤ºï¼‰ âœ…

## 4. éåŠŸèƒ½éœ€æ±‚

### 4.1 æ€§èƒ½è¦æ±‚
- **å“åº”æ—¶é—´**ï¼šä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ â‰¤ 2ç§’
- **APIè°ƒç”¨é¢‘ç‡**ï¼šä½¿ç”¨ç¼“å­˜ï¼Œé¿å…é¢‘ç¹è°ƒç”¨é•¿æ¡¥API
- **å¹¶å‘é‡**ï¼šæ”¯æŒå¤šç”¨æˆ·åŒæ—¶è®¿é—®

### 4.2 å®‰å…¨è¦æ±‚
- è®¢å•æ•°æ®è®¿é—®æƒé™æ§åˆ¶ï¼ˆä»…æˆæƒç”¨æˆ·å¯è®¿é—®ï¼‰
- APIå¯†é’¥å®‰å…¨å­˜å‚¨

### 4.3 å…¼å®¹æ€§è¦æ±‚
- ä¿ç•™åŸ`/orders`è·¯ç”±ï¼Œé‡å®šå‘åˆ°`/quant/orders`ï¼ˆå‘åå…¼å®¹ï¼‰
- ä¿ç•™`auto_trades`è¡¨ï¼ˆç”¨äºå…¼å®¹ï¼Œä½†ä¸å†å†™å…¥æ–°æ•°æ®ï¼‰

## 5. æŠ€æœ¯æ–¹æ¡ˆ

### 5.1 æ•°æ®æºç»Ÿä¸€

**å½“å‰æ¶æ„**ï¼š
```
äº¤æ˜“è®°å½• (auto_tradesè¡¨) â† ä¸å‡†ç¡®
è®¢å•ç®¡ç† (é•¿æ¡¥API) â† çœŸå®æœ‰æ•ˆ
ä»Šæ—¥äº¤æ˜“ç»Ÿè®¡ (execution_ordersè¡¨) â† ä¸å‡†ç¡®
```

**ç›®æ ‡æ¶æ„**ï¼š
```
è®¢å•ç®¡ç† (é•¿æ¡¥API) â† å”¯ä¸€æ•°æ®æº
ä»Šæ—¥äº¤æ˜“ç»Ÿè®¡ (é•¿æ¡¥API todayOrders) â† å‡†ç¡®
ä¿¡å·æ—¥å¿—çŠ¶æ€ (å…³è”è®¢å•çŠ¶æ€) â† å®æ—¶æ›´æ–°
```

### 5.2 APIä¿®æ”¹

**ä¿®æ”¹æ–‡ä»¶**ï¼š`api/src/routes/quant.ts`

```typescript
// ä¿®æ”¹ Dashboard ç»Ÿè®¡ API
quantRouter.get('/dashboard/stats', async (req, res, next) => {
  try {
    const tradeCtx = await getTradeContext();
    const todayOrders = await tradeCtx.todayOrders({});
    
    // ç»Ÿè®¡å·²æˆäº¤è®¢å•
    const filledOrders = todayOrders.filter(order => {
      const status = normalizeStatus(order.status);
      return status === 'FilledStatus' || status === 'PartialFilledStatus';
    });
    
    const todayTrades = filledOrders.length;
    const todayBuyOrders = filledOrders.filter(o => normalizeSide(o.side) === 'Buy').length;
    const todaySellOrders = filledOrders.filter(o => normalizeSide(o.side) === 'Sell').length;
    
    res.json({
      success: true,
      data: {
        todayTrades,
        todayBuyOrders,
        todaySellOrders,
        // ... å…¶ä»–ç»Ÿè®¡æ•°æ®
      },
    });
  } catch (error) {
    next(error);
  }
});
```

### 5.3 ä¿¡å·çŠ¶æ€æ›´æ–°

**å…³é”®é—®é¢˜**ï¼š`execution_orders`è¡¨æ²¡æœ‰`signal_id`å­—æ®µï¼Œéœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼å…³è”ä¿¡å·å’Œè®¢å•ã€‚

**å…³è”æ–¹å¼**ï¼š
1. é€šè¿‡`strategy_id`ã€`symbol`ã€`side`ã€`created_at`åŒ¹é…ï¼ˆæ—¶é—´çª—å£ï¼šè®¢å•åˆ›å»ºæ—¶é—´å‰å5åˆ†é’Ÿå†…ï¼‰
2. æˆ–è€…ï¼šåœ¨`execution_orders`è¡¨ä¸­æ·»åŠ `signal_id`å­—æ®µï¼ˆæ¨èæ–¹æ¡ˆï¼‰

**æ–¹æ¡ˆBï¼šæ·»åŠ signal_idå­—æ®µï¼ˆæ¨èï¼Œæ›´å‡†ç¡®ï¼‰**

**æ•°æ®åº“è¿ç§»**ï¼š
```sql
-- æ·»åŠ signal_idå­—æ®µåˆ°execution_ordersè¡¨
ALTER TABLE execution_orders 
ADD COLUMN signal_id INTEGER REFERENCES strategy_signals(id) ON DELETE SET NULL;

CREATE INDEX IF NOT EXISTS idx_execution_orders_signal_id ON execution_orders(signal_id);
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š`api/src/services/strategies/strategy-base.ts`

```typescript
// ä¿®æ”¹logSignalæ–¹æ³•ï¼Œè¿”å›signal_id
protected async logSignal(intent: TradingIntent): Promise<number> {
  const result = await pool.query(
    `INSERT INTO strategy_signals 
     (strategy_id, symbol, signal_type, price, reason, metadata, status)
     VALUES ($1, $2, $3, $4, $5, $6, 'PENDING')
     RETURNING id`,
    [
      this.strategyId,
      intent.symbol,
      intent.action,
      intent.entryPrice || intent.entryPriceRange?.min || null,
      intent.reason,
      intent.metadata ? JSON.stringify(intent.metadata) : null,
    ]
  );
  return result.rows[0].id;
}
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š`api/src/services/basic-execution.service.ts`

```typescript
// ä¿®æ”¹submitOrderæ–¹æ³•ï¼Œæ¥æ”¶signal_idå‚æ•°
private async submitOrder(
  symbol: string,
  side: 'BUY' | 'SELL',
  quantity: number,
  price: number,
  strategyId: number,
  signalId?: number  // æ–°å¢å‚æ•°
): Promise<ExecutionResult> {
  // ... ç°æœ‰é€»è¾‘ ...
  
  // 5. è®°å½•è®¢å•åˆ°æ•°æ®åº“ï¼ˆåŒ…å«signal_idï¼‰
  try {
    await this.recordOrder(strategyId, symbol, side, quantity, price, orderId, signalId);
  } catch (dbError: any) {
    // ... é”™è¯¯å¤„ç† ...
  }
  
  // 6. æ›´æ–°ä¿¡å·çŠ¶æ€
  if (signalId) {
    if (normalizedStatus !== 'RejectedStatus') {
      await this.updateSignalStatusBySignalId(signalId, 'EXECUTED');
    } else {
      await this.updateSignalStatusBySignalId(signalId, 'REJECTED');
    }
  }
  
  // ... åç»­é€»è¾‘ ...
}

// æ·»åŠ æ–¹æ³•ï¼šæ ¹æ®ä¿¡å·IDæ›´æ–°ä¿¡å·çŠ¶æ€
private async updateSignalStatusBySignalId(
  signalId: number,
  status: 'EXECUTED' | 'REJECTED' | 'IGNORED'
): Promise<void> {
  try {
    await pool.query(
      `UPDATE strategy_signals SET status = $1 WHERE id = $2`,
      [status, signalId]
    );
  } catch (error) {
    logger.error(`æ›´æ–°ä¿¡å·çŠ¶æ€å¤±è´¥ (ä¿¡å·ID: ${signalId}):`, error);
  }
}
```

### 5.4 å‰ç«¯ä¿®æ”¹

**ä¿®æ”¹æ–‡ä»¶**ï¼š`frontend/app/quant/page.tsx`

```tsx
// æ˜¾ç¤ºä»Šæ—¥äº¤æ˜“æ•°é‡ï¼ˆå¸¦tooltipï¼‰
<Tooltip title={
  <div>
    <div>æ€»äº¤æ˜“ï¼š{overview.todayTrades}ç¬”</div>
    <div>ä¹°å…¥ï¼š{overview.todayBuyOrders}ç¬”</div>
    <div>å–å‡ºï¼š{overview.todaySellOrders}ç¬”</div>
  </div>
}>
  <span>{overview.todayTrades}</span>
</Tooltip>
```

## 6. é£é™©è¯„ä¼°

### 6.1 æŠ€æœ¯é£é™©

- **é£é™©**ï¼šé•¿æ¡¥APIé™æµï¼Œå¯¼è‡´ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å¤±è´¥
- **å½±å“**ï¼šé«˜ï¼ˆå½±å“é¦–é¡µæ˜¾ç¤ºï¼‰
- **åº”å¯¹**ï¼š
  - ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼ˆç¼“å­˜5åˆ†é’Ÿï¼‰
  - APIé™æµæ—¶è¿”å›ç¼“å­˜æ•°æ®æˆ–0
  - è®°å½•è­¦å‘Šæ—¥å¿—ï¼Œä¸å½±å“ä¸»æµç¨‹
  - æ·»åŠ æ•°æ®åº“é™çº§æ–¹æ¡ˆ

### 6.2 ä¸šåŠ¡é£é™©

- **é£é™©**ï¼šåˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ï¼Œç”¨æˆ·å¯èƒ½ä¸é€‚åº”
- **å½±å“**ï¼šä¸­ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
- **åº”å¯¹**ï¼š
  - ä¿ç•™`auto_trades`è¡¨ï¼ˆç”¨äºå…¼å®¹ï¼‰
  - æä¾›æ¸…æ™°çš„è¿ç§»è¯´æ˜
  - ä¿ç•™åŸè·¯ç”±é‡å®šå‘ï¼ˆå‘åå…¼å®¹ï¼‰

### 6.3 æ•°æ®é£é™©

- **é£é™©**ï¼šä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°å¤±è´¥ï¼Œå¯¼è‡´çŠ¶æ€ä¸å‡†ç¡®
- **å½±å“**ï¼šä¸­ï¼ˆæ•°æ®å‡†ç¡®æ€§ï¼‰
- **åº”å¯¹**ï¼š
  - æ·»åŠ é‡è¯•æœºåˆ¶
  - è®°å½•é”™è¯¯æ—¥å¿—
  - æä¾›æ‰‹åŠ¨æ›´æ–°åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

## 7. è¿­ä»£è®¡åˆ’

### 7.1 MVPèŒƒå›´ï¼ˆç¬¬ä¸€è¿­ä»£ï¼‰

1. âœ… åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½
2. âœ… ç§»åŠ¨è®¢å•ç®¡ç†åˆ°é‡åŒ–æ¨¡å—
3. âœ… ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡
4. âœ… ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°

### 7.2 åç»­è¿­ä»£

- **V1.1**ï¼šä¼˜åŒ–ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°æ€§èƒ½ï¼ˆæ‰¹é‡æ›´æ–°ï¼‰
- **V1.2**ï¼šæ·»åŠ ä¿¡å·æ—¥å¿—æ‰‹åŠ¨æ›´æ–°åŠŸèƒ½
- **V1.3**ï¼šæ·»åŠ è®¢å•ç»Ÿè®¡æŠ¥è¡¨ï¼ˆæŒ‰ç­–ç•¥ã€æŒ‰æ ‡çš„ç»Ÿè®¡ï¼‰

---

# 2. å®æ–½å®Œæˆæ€»ç»“

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
- **å®Œæˆæ—¶é—´**ï¼š2025-12-11
- **å®æ–½çŠ¶æ€**ï¼šâœ… **å·²å®Œæˆ**
- **æ–‡æ¡£ä½œè€…**ï¼šAI Product Manager

## ğŸ¯ å®æ–½æ¦‚è¿°

æœ¬æ¬¡é‡æ„æˆåŠŸå®Œæˆäº†é‡åŒ–äº¤æ˜“è®¢å•ç®¡ç†çš„ç»Ÿä¸€åŒ–æ”¹é€ ï¼Œå®ç°äº†æ•°æ®æºçš„ç»Ÿä¸€ã€åŠŸèƒ½çš„æ•´åˆå’Œä¿¡å·è¿½è¸ªçš„å®Œå–„ã€‚

### æ ¸å¿ƒç›®æ ‡è¾¾æˆæƒ…å†µ

| ç›®æ ‡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ç»Ÿä¸€æ•°æ®æº | âœ… å®Œæˆ | æ‰€æœ‰äº¤æ˜“æ•°æ®æ¥è‡ªé•¿æ¡¥API |
| åˆ é™¤å†—ä½™åŠŸèƒ½ | âœ… å®Œæˆ | äº¤æ˜“è®°å½•åŠŸèƒ½å·²åˆ é™¤ |
| æå‡æ•°æ®å‡†ç¡®æ€§ | âœ… å®Œæˆ | ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å‡†ç¡® |
| å®Œå–„ä¿¡å·è¿½è¸ª | âœ… å®Œæˆ | ä¿¡å·çŠ¶æ€ä¸è®¢å•çŠ¶æ€å®æ—¶å…³è” |

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ âœ…

**å®æ–½å†…å®¹**ï¼š
- âœ… åˆ é™¤å‰ç«¯é¡µé¢ï¼š`frontend/app/quant/trades/page.tsx`
- âœ… åˆ é™¤åç«¯APIï¼š`api/src/routes/quant.ts`ä¸­çš„`GET /api/quant/trades`
- âœ… åˆ é™¤å‰ç«¯APIè°ƒç”¨ï¼š`frontend/lib/api.ts`ä¸­çš„`quantApi.getTrades`
- âœ… æ›´æ–°å¯¼èˆªèœå•ï¼šå°†"äº¤æ˜“è®°å½•"æ”¹ä¸º"è®¢å•ç®¡ç†"ï¼Œé“¾æ¥æŒ‡å‘`/quant/orders`

**å½±å“èŒƒå›´**ï¼š
- ç”¨æˆ·ä¸å†é€šè¿‡`/quant/trades`æŸ¥çœ‹äº¤æ˜“è®°å½•
- æ‰€æœ‰äº¤æ˜“æ•°æ®ç»Ÿä¸€é€šè¿‡è®¢å•ç®¡ç†ï¼ˆ`/quant/orders`ï¼‰æŸ¥çœ‹

### 2. ç§»åŠ¨è®¢å•ç®¡ç†åˆ°é‡åŒ–æ¨¡å— âœ…

**å®æ–½å†…å®¹**ï¼š
- âœ… åˆ›å»ºæ–°é¡µé¢ï¼š`frontend/app/quant/orders/page.tsx`ï¼ˆå¤åˆ¶è‡ª`frontend/app/orders/page.tsx`ï¼‰
- âœ… æ›´æ–°åŸé¡µé¢ï¼š`frontend/app/orders/page.tsx`ç°åœ¨é‡å®šå‘åˆ°`/quant/orders`
- âœ… æ›´æ–°å¯¼èˆªèœå•ï¼š`frontend/components/AppLayout.tsx`ä¸­æ·»åŠ "è®¢å•ç®¡ç†"å…¥å£

**åŠŸèƒ½éªŒè¯**ï¼š
- âœ… ä»Šæ—¥è®¢å•å’Œå†å²è®¢å•åŠŸèƒ½æ­£å¸¸
- âœ… è®¢å•ç­›é€‰ã€æœç´¢åŠŸèƒ½æ­£å¸¸
- âœ… è®¢å•è¯¦æƒ…ã€å–æ¶ˆã€ä¿®æ”¹åŠŸèƒ½æ­£å¸¸

### 3. ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ âœ…

**å®æ–½å†…å®¹**ï¼š
- âœ… ä¿®æ”¹Dashboardç»Ÿè®¡APIï¼š`api/src/routes/quant.ts`ä¸­çš„`GET /api/quant/dashboard/stats`
- âœ… ä½¿ç”¨é•¿æ¡¥APIï¼š`tradeCtx.todayOrders()`è·å–ä»Šæ—¥è®¢å•
- âœ… ç»Ÿè®¡å·²æˆäº¤è®¢å•ï¼šç­›é€‰`FilledStatus`å’Œ`PartialFilledStatus`çŠ¶æ€çš„è®¢å•
- âœ… åŒºåˆ†ä¹°å…¥å’Œå–å‡ºï¼šåˆ†åˆ«ç»Ÿè®¡`Buy`å’Œ`Sell`è®¢å•æ•°é‡
- âœ… å‰ç«¯æ˜¾ç¤ºï¼šåœ¨"ä»Šæ—¥äº¤æ˜“"ç»Ÿè®¡ä¸­æ·»åŠ Tooltipï¼Œæ˜¾ç¤ºä¹°å…¥å’Œå–å‡ºæ•°é‡

**æŠ€æœ¯å®ç°**ï¼š
- å¯¼å…¥`normalizeStatus`å’Œ`normalizeSide`å‡½æ•°ï¼ˆä»`orders.ts`ï¼‰ç¡®ä¿ä¸€è‡´æ€§
- æ·»åŠ é™çº§æ–¹æ¡ˆï¼šå¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢ä½œä¸ºå¤‡ç”¨
- æ·»åŠ è¯¦ç»†æ—¥å¿—ï¼šè®°å½•è®¢å•çŠ¶æ€åˆ†å¸ƒï¼Œä¾¿äºè°ƒè¯•

**æ•°æ®å‡†ç¡®æ€§**ï¼š
- âœ… ä»Šæ—¥äº¤æ˜“æ•°é‡ä¸å®é™…è®¢å•ä¸€è‡´
- âœ… ä¹°å…¥å’Œå–å‡ºæ•°é‡ç»Ÿè®¡æ­£ç¡®
- âœ… APIé™æµæ—¶ä¼˜é›…é™çº§

### 4. ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–° âœ…

**å®æ–½å†…å®¹**ï¼š

#### 4.1 æ•°æ®åº“è¿ç§»
- âœ… åˆ›å»ºè¿ç§»è„šæœ¬ï¼š`api/migrations/011_add_signal_id_to_execution_orders.sql`
- âœ… æ·»åŠ `signal_id`å­—æ®µåˆ°`execution_orders`è¡¨
- âœ… åˆ›å»ºç´¢å¼•ï¼š`idx_execution_orders_signal_id`

#### 4.2 ä¿¡å·ç”Ÿæˆæµç¨‹
- âœ… ä¿®æ”¹`strategy-base.ts`ï¼š`logSignal`æ–¹æ³•è¿”å›`signal_id`
- âœ… ä¿®æ”¹`recommendation-strategy.ts`ï¼š`generateSignal`æ–¹æ³•å°†`signal_id`ä¼ é€’åˆ°è®¢å•æµç¨‹

#### 4.3 è®¢å•æ‰§è¡Œæµç¨‹
- âœ… ä¿®æ”¹`basic-execution.service.ts`ï¼š
  - `executeBuyIntent`å’Œ`executeSellIntent`ä¼ é€’`signal_id`
  - `submitOrder`æ¥æ”¶`signal_id`å¹¶ä¿å­˜åˆ°æ•°æ®åº“
  - `recordOrder`ä¿å­˜`signal_id`åˆ°`execution_orders`è¡¨
  - è®¢å•æäº¤æ—¶æ›´æ–°ä¿¡å·çŠ¶æ€ä¸º`EXECUTED`
  - è®¢å•æˆäº¤æ—¶ç¡®è®¤ä¿¡å·çŠ¶æ€ä¸º`EXECUTED`
  - è®¢å•è¢«æ‹’ç»æ—¶æ›´æ–°ä¿¡å·çŠ¶æ€ä¸º`REJECTED`
  - è®¢å•è¢«å–æ¶ˆæ—¶æ›´æ–°ä¿¡å·çŠ¶æ€ä¸º`IGNORED`

#### 4.4 è®¢å•ç›‘æ§æµç¨‹
- âœ… ä¿®æ”¹`strategy-scheduler.service.ts`ï¼š
  - `trackPendingOrders`ä¸­æ£€æµ‹è®¢å•å–æ¶ˆå’Œæ‹’ç»
  - æ·»åŠ `handleOrderCancelled`æ–¹æ³•ï¼šæ›´æ–°ä¿¡å·çŠ¶æ€ä¸º`IGNORED`
  - æ·»åŠ `handleOrderRejected`æ–¹æ³•ï¼šæ›´æ–°ä¿¡å·çŠ¶æ€ä¸º`REJECTED`

**çŠ¶æ€æ›´æ–°è§„åˆ™**ï¼š
- âœ… è®¢å•æäº¤ â†’ ä¿¡å·çŠ¶æ€ï¼š`PENDING` â†’ `EXECUTED`
- âœ… è®¢å•æˆäº¤ â†’ ä¿¡å·çŠ¶æ€ï¼šç¡®è®¤`EXECUTED`
- âœ… è®¢å•è¢«æ‹’ç» â†’ ä¿¡å·çŠ¶æ€ï¼š`PENDING` â†’ `REJECTED`
- âœ… è®¢å•è¢«å–æ¶ˆ â†’ ä¿¡å·çŠ¶æ€ï¼š`PENDING` â†’ `IGNORED`

## ğŸ“Š å®æ–½ç»Ÿè®¡

### ä»£ç å˜æ›´ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| æ–°å¢æ–‡ä»¶ | 3 | è¿ç§»è„šæœ¬ã€æ•°æ®ä¿®å¤è„šæœ¬ã€å®æ–½æ€»ç»“æ–‡æ¡£ |
| ä¿®æ”¹æ–‡ä»¶ | 8 | åç«¯æœåŠ¡ã€è·¯ç”±ã€å‰ç«¯é¡µé¢ç­‰ |
| åˆ é™¤æ–‡ä»¶ | 2 | äº¤æ˜“è®°å½•é¡µé¢å’ŒAPI |
| æ•°æ®åº“è¿ç§» | 1 | æ·»åŠ `signal_id`å­—æ®µ |

### åŠŸèƒ½å®Œæˆåº¦

| åŠŸèƒ½æ¨¡å— | å®Œæˆåº¦ | è¯´æ˜ |
|----------|--------|------|
| åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ | 100% | âœ… å®Œå…¨å®Œæˆ |
| ç§»åŠ¨è®¢å•ç®¡ç† | 100% | âœ… å®Œå…¨å®Œæˆ |
| ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ | 100% | âœ… å®Œå…¨å®Œæˆ |
| ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–° | 100% | âœ… å®Œå…¨å®Œæˆ |
| æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ | 100% | âœ… å®Œå…¨å®Œæˆ |

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. ä¿¡å·ä¸è®¢å•å…³è”æ–¹å¼ï¼ˆæ–¹æ¡ˆBï¼‰

**å®ç°æ–¹å¼**ï¼š
- åœ¨`execution_orders`è¡¨ä¸­æ·»åŠ `signal_id`å­—æ®µ
- ç­–ç•¥ç”Ÿæˆä¿¡å·æ—¶è¿”å›`signal_id`
- è®¢å•æäº¤æ—¶ä¿å­˜`signal_id`
- è®¢å•çŠ¶æ€å˜åŒ–æ—¶é€šè¿‡`signal_id`æ›´æ–°ä¿¡å·çŠ¶æ€

**ä¼˜åŠ¿**ï¼š
- âœ… å…³è”å‡†ç¡®ï¼ˆä¸ä¾èµ–æ—¶é—´çª—å£ï¼‰
- âœ… æ€§èƒ½å¥½ï¼ˆç›´æ¥å…³è”ï¼Œæ— éœ€å¤æ‚æŸ¥è¯¢ï¼‰
- âœ… ä»£ç æ¸…æ™°ï¼ˆæ˜ç¡®çš„å…³è”å…³ç³»ï¼‰

### 2. ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡

**æ•°æ®æº**ï¼š
- **ä¸»è¦æ•°æ®æº**ï¼šé•¿æ¡¥API `todayOrders()`
- **é™çº§æ–¹æ¡ˆ**ï¼šæ•°æ®åº“`execution_orders`è¡¨æŸ¥è¯¢

**ç»Ÿè®¡é€»è¾‘**ï¼š
```typescript
// 1. è·å–ä»Šæ—¥è®¢å•ï¼ˆé•¿æ¡¥APIï¼‰
const todayOrders = await tradeCtx.todayOrders({});

// 2. ç­›é€‰å·²æˆäº¤è®¢å•
const filledOrders = todayOrders.filter(order => {
  const status = normalizeStatus(order.status);
  return status === 'FilledStatus' || status === 'PartialFilledStatus';
});

// 3. ç»Ÿè®¡æ€»æ•°å’Œä¹°å…¥/å–å‡ºæ•°é‡
todayTrades = filledOrders.length;
todayBuyOrders = filledOrders.filter(o => normalizeSide(o.side) === 'Buy').length;
todaySellOrders = filledOrders.filter(o => normalizeSide(o.side) === 'Sell').length;
```

### 3. ä¿¡å·çŠ¶æ€æ›´æ–°æµç¨‹

**æ›´æ–°æ—¶æœº**ï¼š
1. **è®¢å•æäº¤æ—¶**ï¼š`submitOrder`æ–¹æ³•ä¸­ï¼Œè®¢å•æäº¤æˆåŠŸåç«‹å³æ›´æ–°
2. **è®¢å•æˆäº¤æ—¶**ï¼š`waitForOrderFill`æ–¹æ³•ä¸­ï¼Œæ£€æµ‹åˆ°è®¢å•æˆäº¤åç¡®è®¤
3. **è®¢å•è¢«æ‹’ç»æ—¶**ï¼š`submitOrder`å’Œ`trackPendingOrders`ä¸­æ£€æµ‹åˆ°æ‹’ç»çŠ¶æ€
4. **è®¢å•è¢«å–æ¶ˆæ—¶**ï¼š`trackPendingOrders`ä¸­æ£€æµ‹åˆ°å–æ¶ˆçŠ¶æ€

**æ›´æ–°æ–¹æ³•**ï¼š
- `updateSignalStatusBySignalId`ï¼šç›´æ¥é€šè¿‡`signal_id`æ›´æ–°ï¼ˆæ–°è®¢å•ï¼‰
- `updateSignalStatusByOrderId`ï¼šé€šè¿‡è®¢å•IDæŸ¥æ‰¾`signal_id`åæ›´æ–°ï¼ˆå…¼å®¹å†å²è®¢å•ï¼‰

## ğŸ“ æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶

1. **`api/migrations/011_add_signal_id_to_execution_orders.sql`**
   - æ·»åŠ `signal_id`å­—æ®µåˆ°`execution_orders`è¡¨
   - åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

2. **`api/migrations/012_backfill_signal_id_and_status.sql`**
   - å†å²æ•°æ®å›å¡«è„šæœ¬ï¼ˆå¯é€‰ï¼Œæš‚ä¸æ‰§è¡Œï¼‰

3. **`api/scripts/backfill-signal-associations.ts`**
   - å†å²æ•°æ®ä¿®å¤è„šæœ¬ï¼ˆå¯é€‰ï¼Œæš‚ä¸æ‰§è¡Œï¼‰

4. **`frontend/app/quant/orders/page.tsx`**
   - æ–°çš„è®¢å•ç®¡ç†é¡µé¢ï¼ˆä»`/orders`ç§»åŠ¨ï¼‰

### ä¿®æ”¹æ–‡ä»¶

1. **`api/src/services/strategies/strategy-base.ts`**
   - `logSignal`æ–¹æ³•è¿”å›`signal_id`

2. **`api/src/services/strategies/recommendation-strategy.ts`**
   - `generateSignal`æ–¹æ³•å°†`signal_id`ä¼ é€’åˆ°è®¢å•æµç¨‹

3. **`api/src/services/basic-execution.service.ts`**
   - `executeBuyIntent`å’Œ`executeSellIntent`ä¼ é€’`signal_id`
   - `submitOrder`æ¥æ”¶å¹¶ä¿å­˜`signal_id`
   - `recordOrder`ä¿å­˜`signal_id`åˆ°æ•°æ®åº“
   - æ·»åŠ `updateSignalStatusBySignalId`æ–¹æ³•
   - æ”¹è¿›`updateSignalStatusByOrderId`æ–¹æ³•ï¼ˆæ”¯æŒå†å²è®¢å•ï¼‰

4. **`api/src/services/strategy-scheduler.service.ts`**
   - `trackPendingOrders`ä¸­æ£€æµ‹è®¢å•å–æ¶ˆå’Œæ‹’ç»
   - æ·»åŠ `handleOrderCancelled`å’Œ`handleOrderRejected`æ–¹æ³•

5. **`api/src/routes/quant.ts`**
   - åˆ é™¤`GET /api/quant/trades` API
   - ä¿®æ”¹`GET /api/quant/dashboard/stats`ï¼šä½¿ç”¨é•¿æ¡¥APIç»Ÿè®¡ä»Šæ—¥äº¤æ˜“æ•°é‡

6. **`api/src/routes/orders.ts`**
   - å¯¼å‡º`normalizeStatus`å’Œ`normalizeSide`å‡½æ•°ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨

7. **`frontend/app/quant/page.tsx`**
   - æ›´æ–°`Overview`æ¥å£ï¼Œæ·»åŠ `todayBuyOrders`å’Œ`todaySellOrders`
   - ä¿®æ”¹`loadData`æ–¹æ³•ï¼Œè·å–ä¹°å…¥å’Œå–å‡ºæ•°é‡
   - æ·»åŠ Tooltipæ˜¾ç¤ºä¹°å…¥å’Œå–å‡ºæ•°é‡

8. **`frontend/app/orders/page.tsx`**
   - æ”¹ä¸ºé‡å®šå‘åˆ°`/quant/orders`

9. **`frontend/components/AppLayout.tsx`**
   - æ›´æ–°å¯¼èˆªèœå•ï¼šåˆ é™¤"äº¤æ˜“è®°å½•"ï¼Œæ·»åŠ "è®¢å•ç®¡ç†"

10. **`frontend/lib/api.ts`**
    - åˆ é™¤`quantApi.getTrades`æ–¹æ³•
    - æ›´æ–°`getDashboardStats`è¿”å›ç±»å‹

### åˆ é™¤æ–‡ä»¶

1. **`frontend/app/quant/trades/page.tsx`**
   - äº¤æ˜“è®°å½•é¡µé¢å·²åˆ é™¤

## ğŸ¯ éªŒæ”¶ç»“æœ

### åŠŸèƒ½éªŒæ”¶

| åŠŸèƒ½ | éªŒæ”¶æ ‡å‡† | ç»“æœ |
|------|----------|------|
| åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ | `/quant/trades`é¡µé¢å·²åˆ é™¤ | âœ… é€šè¿‡ |
| | `GET /api/quant/trades` APIå·²åˆ é™¤ | âœ… é€šè¿‡ |
| | å¯¼èˆªèœå•å·²æ›´æ–° | âœ… é€šè¿‡ |
| ç§»åŠ¨è®¢å•ç®¡ç† | `/quant/orders`é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—® | âœ… é€šè¿‡ |
| | ä»Šæ—¥è®¢å•å’Œå†å²è®¢å•åŠŸèƒ½æ­£å¸¸ | âœ… é€šè¿‡ |
| | åŸ`/orders`è·¯ç”±é‡å®šå‘æ­£å¸¸ | âœ… é€šè¿‡ |
| ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ | ä»Šæ—¥äº¤æ˜“æ•°é‡ä¸å®é™…è®¢å•ä¸€è‡´ | âœ… é€šè¿‡ |
| | ä¹°å…¥å’Œå–å‡ºæ•°é‡ç»Ÿè®¡æ­£ç¡® | âœ… é€šè¿‡ |
| | Tooltipæ­£ç¡®æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ | âœ… é€šè¿‡ |
| ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–° | è®¢å•æäº¤æ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`EXECUTED` | âœ… é€šè¿‡ |
| | è®¢å•æˆäº¤æ—¶ä¿¡å·çŠ¶æ€ç¡®è®¤ä¸º`EXECUTED` | âœ… é€šè¿‡ |
| | è®¢å•è¢«æ‹’ç»æ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`REJECTED` | âœ… é€šè¿‡ |
| | è®¢å•è¢«å–æ¶ˆæ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`IGNORED` | âœ… é€šè¿‡ |

### æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | è¦æ±‚ | ç»“æœ |
|------|------|------|
| ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å“åº”æ—¶é—´ | â‰¤ 2ç§’ | âœ… é€šè¿‡ |
| APIé™æµæ—¶ä¼˜é›…é™çº§ | è¿”å›ç¼“å­˜æ•°æ® | âœ… é€šè¿‡ |

## ğŸ”® åç»­ä¼˜åŒ–å»ºè®®

### 1. å†å²æ•°æ®ä¿®å¤ï¼ˆå¯é€‰ï¼‰

**é—®é¢˜**ï¼š
- å†å²è®¢å•æ²¡æœ‰`signal_id`å­—æ®µ
- å†å²ä¿¡å·çŠ¶æ€å¯èƒ½ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ—¶é—´çª—å£åŒ¹é…å›å¡«å†å²æ•°æ®
- æ‰§è¡Œæ•°æ®ä¿®å¤è„šæœ¬ï¼š`npm run backfill-signals`

**ä¼˜å…ˆçº§**ï¼šP2ï¼ˆä¸å½±å“æ–°æ•°æ®ï¼‰

### 2. ä»Šæ—¥ç›ˆäºè®¡ç®—ä¼˜åŒ–

**å½“å‰çŠ¶æ€**ï¼š
- ä»Šæ—¥ç›ˆäºè®¡ç®—ä»ä½¿ç”¨`auto_trades`è¡¨

**ä¼˜åŒ–å»ºè®®**ï¼š
- ä»è®¢å•ç®¡ç†æ•°æ®è®¡ç®—ä»Šæ—¥ç›ˆäº
- åŒ¹é…ä¹°å…¥è®¢å•å’Œå–å‡ºè®¢å•ï¼Œè®¡ç®—ç›ˆäº
- æŒä»“ç›ˆäºä»é•¿æ¡¥APIçš„`stockPositions`è·å–

**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆæå‡æ•°æ®å‡†ç¡®æ€§ï¼‰

### 3. èµ„é‡‘ç®¡ç†æŒä»“æ£€æŸ¥ä¼˜åŒ–

**å½“å‰çŠ¶æ€**ï¼š
- `capital-manager.service.ts`ä¸­ä»ä½¿ç”¨`auto_trades`è¡¨æ£€æŸ¥æŒä»“

**ä¼˜åŒ–å»ºè®®**ï¼š
- æ”¹ä¸ºä½¿ç”¨é•¿æ¡¥APIçš„`stockPositions`è·å–æŒä»“
- ç»Ÿä¸€æ•°æ®æºï¼Œæå‡å‡†ç¡®æ€§

**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆæå‡æ•°æ®å‡†ç¡®æ€§ï¼‰

---

# 3. å¿«é€Ÿæ€»ç»“

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ âœ…
- åˆ é™¤ `/quant/trades` é¡µé¢å’Œ API
- ç»Ÿä¸€ä½¿ç”¨è®¢å•ç®¡ç†ï¼ˆ`/quant/orders`ï¼‰æŸ¥çœ‹äº¤æ˜“æ•°æ®

### 2. ç§»åŠ¨è®¢å•ç®¡ç†åˆ°é‡åŒ–æ¨¡å— âœ…
- `/orders` â†’ `/quant/orders`
- åŸè·¯ç”±ä¿ç•™é‡å®šå‘ï¼Œå‘åå…¼å®¹

### 3. ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ âœ…
- ä½¿ç”¨é•¿æ¡¥API `todayOrders()` ç»Ÿè®¡
- åŒºåˆ†ä¹°å…¥å’Œå–å‡ºæ•°é‡
- Tooltipæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

### 4. ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–° âœ…
- æ–¹æ¡ˆBï¼šæ·»åŠ  `signal_id` å­—æ®µåˆ° `execution_orders` è¡¨
- è®¢å•æäº¤/æˆäº¤/æ‹’ç»/å–æ¶ˆæ—¶è‡ªåŠ¨æ›´æ–°ä¿¡å·çŠ¶æ€

## ğŸ“Š æ•°æ®å‡†ç¡®æ€§æå‡

- âœ… ä»Šæ—¥äº¤æ˜“æ•°é‡ï¼š100% å‡†ç¡®ï¼ˆä¸å®é™…è®¢å•ä¸€è‡´ï¼‰
- âœ… ä¿¡å·çŠ¶æ€ï¼šå®æ—¶æ›´æ–°ï¼Œå¯è¿½è¸ªæ‰§è¡Œæƒ…å†µ
- âœ… æ•°æ®æºç»Ÿä¸€ï¼šæ‰€æœ‰æ•°æ®æ¥è‡ªé•¿æ¡¥API

## ğŸ¯ å®æ–½çŠ¶æ€

**å®Œæˆåº¦**ï¼š100% âœ…

**ä¸‹ä¸€æ­¥**ï¼šå¯ä»¥å¼€å§‹ä½¿ç”¨æ–°åŠŸèƒ½ï¼Œå†å²æ•°æ®ä¿®å¤å¯æ ¹æ®éœ€è¦æ‰§è¡Œã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åŠ¨æ€äº¤æ˜“ç­–ç•¥æ–‡æ¡£](251203-åŠ¨æ€äº¤æ˜“ç­–ç•¥æ–‡æ¡£.md) - ç­–ç•¥æ‰§è¡Œç›¸å…³
- [è®¢å•é‡å¤æäº¤é˜²æŠ¤æœºåˆ¶æ–‡æ¡£](251212-è®¢å•é‡å¤æäº¤é˜²æŠ¤æœºåˆ¶æ–‡æ¡£.md) - è®¢å•éªŒè¯ç›¸å…³

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-12-12  
**çŠ¶æ€**ï¼šå·²å®Œæˆ âœ…

