# æ„å»ºé”™è¯¯ä¿®å¤æ–‡æ¡£

**åˆ›å»ºæ—¥æœŸ**: 2025-12-11  
**æœ€åæ›´æ–°**: 2025-12-11  
**çŠ¶æ€**: å·²å®Œæˆ âœ…

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

### æ–‡æ¡£ç»“æ„

æœ¬æ–‡æ¡£æ•´åˆäº†æ„å»ºé”™è¯¯ä¿®å¤çš„æ‰€æœ‰ç›¸å…³æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š
- é—®é¢˜åˆ†æï¼šTypeScriptç¼–è¯‘é”™è¯¯å’Œæ„å»ºé—®é¢˜åˆ†æ
- ä¿®å¤æ–¹æ¡ˆï¼šè¯¦ç»†çš„ä¿®å¤æ­¥éª¤å’Œä»£ç ä¿®æ”¹
- æ„å»ºéªŒè¯ï¼šä¿®å¤åçš„éªŒè¯ç»“æœ
- æœ€ä½³å®è·µï¼šåç»­ä¼˜åŒ–å»ºè®®

### å¿«é€Ÿå¯¼èˆª

**æƒ³äº†è§£é—®é¢˜èƒŒæ™¯ï¼Ÿ** â†’ æŸ¥çœ‹ã€Œ1. é—®é¢˜åˆ†æã€

**æƒ³äº†è§£ä¿®å¤æ–¹æ¡ˆï¼Ÿ** â†’ æŸ¥çœ‹ã€Œ2. ä¿®å¤æ–¹æ¡ˆã€

**æƒ³äº†è§£éªŒè¯ç»“æœï¼Ÿ** â†’ æŸ¥çœ‹ã€Œ3. æ„å»ºéªŒè¯ã€

**æƒ³äº†è§£æœ€ä½³å®è·µï¼Ÿ** â†’ æŸ¥çœ‹ã€Œ4. æœ€ä½³å®è·µå»ºè®®ã€

---

# 1. é—®é¢˜åˆ†æ

## ğŸ“‹ æ¦‚è¿°

**æ—¥æœŸ**: 2025-12-11  
**ç‰ˆæœ¬**: v1.1  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

æœ¬æ¬¡ä¿®å¤è§£å†³äº†å›æ»šåä»£ç ä¸­çš„99ä¸ªTypeScriptç¼–è¯‘é”™è¯¯ï¼Œä»¥åŠå‰ç«¯æ„å»ºä¸­çš„ç¼–ç é—®é¢˜å’ŒNext.js Suspenseè¾¹ç•Œé—®é¢˜ï¼Œç¡®ä¿é¡¹ç›®å¯ä»¥åœ¨æœ¬åœ°å’ŒNAS Dockerç¯å¢ƒä¸­æˆåŠŸæ„å»ºã€‚

## ğŸ” ä¸»è¦é”™è¯¯ç±»å‹

### 1. Routerç±»å‹æ¨æ–­é—®é¢˜ (40+ é”™è¯¯)
- TypeScriptæ— æ³•æ¨æ–­Express Routerçš„ç±»å‹
- é”™è¯¯ä¿¡æ¯ï¼š`The inferred type of 'xxxRouter' cannot be named without a reference to '@types/express-serve-static-core'`

### 2. ç¼ºå°‘æ˜¾å¼è¿”å›ç±»å‹ (30+ é”™è¯¯)
- APIå‡½æ•°ç¼ºå°‘æ˜¾å¼è¿”å›ç±»å‹å£°æ˜
- å¯¼è‡´TypeScriptæ— æ³•æ­£ç¡®æ¨æ–­å“åº”æ•°æ®ç»“æ„

### 3. ç±»å‹æ£€æŸ¥é—®é¢˜ (20+ é”™è¯¯)
- `rowCount`å¯èƒ½ä¸ºnull
- `orderConfig`è”åˆç±»å‹å±æ€§è®¿é—®é—®é¢˜
- æœªä½¿ç”¨çš„å˜é‡å’Œå‚æ•°

### 4. å¯¼å…¥ç¼ºå¤± (5+ é”™è¯¯)
- `NextFunction`ã€`ErrorFactory`ã€`normalizeError`ç­‰æœªå¯¼å…¥

### 5. ç¼–ç é—®é¢˜ (21+ é”™è¯¯)
- `TradeModal.tsx` å’Œ `EditStrategyModal.tsx` ä¸­å­˜åœ¨ä¸­æ–‡ç¼–ç é”™è¯¯
- æ˜¾ç¤ºä¸ºä¹±ç å­—ç¬¦ï¼ˆå¦‚`ï¿½?`ã€`ï¿½?`ç­‰ï¼‰ï¼Œå¯¼è‡´UIæ˜¾ç¤ºå¼‚å¸¸å’Œæ„å»ºå¤±è´¥

### 6. Next.js Suspenseè¾¹ç•Œé—®é¢˜ (1 é”™è¯¯)
- `/options/chain` é¡µé¢ä½¿ç”¨ `useSearchParams()` hook
- Next.js 14è¦æ±‚åœ¨é™æ€ç”Ÿæˆæ—¶ç”¨ `Suspense` åŒ…è£¹ä½¿ç”¨ `useSearchParams()` çš„ç»„ä»¶
- é”™è¯¯ä¿¡æ¯ï¼š`useSearchParams() should be wrapped in a suspense boundary`

---

# 2. ä¿®å¤æ–¹æ¡ˆ

## âœ… ä¿®å¤1ï¼šTypeScripté…ç½®ä¼˜åŒ–

**æ–‡ä»¶**: `api/tsconfig.json`

**ä¿®æ”¹å†…å®¹**:
- ä¿æŒ `strict: false`ï¼ˆå·²è®¾ç½®ï¼‰
- ä¿æŒ `noUnusedLocals: false`ï¼ˆå·²è®¾ç½®ï¼‰
- ä¿æŒ `noUnusedParameters: false`ï¼ˆå·²è®¾ç½®ï¼‰
- ä¿æŒ `noImplicitReturns: false`ï¼ˆå·²è®¾ç½®ï¼‰
- ä¿æŒ `noImplicitAny: false`ï¼ˆå·²è®¾ç½®ï¼‰
- ç§»é™¤å·²åºŸå¼ƒçš„é€‰é¡¹ `suppressImplicitAnyIndexErrors`

**æ•ˆæœ**: è§£å†³äº†å¤§éƒ¨åˆ†Routerç±»å‹æ¨æ–­é—®é¢˜

## âœ… ä¿®å¤2ï¼šAPIå‡½æ•°è¿”å›ç±»å‹ä¿®å¤

**æ–‡ä»¶**: `frontend/lib/api.ts`

**ä¿®å¤çš„å‡½æ•°**:
- âœ… `quoteApi.getQuote` - æ·»åŠ è¿”å›ç±»å‹
- âœ… `quantApi.getStrategyHoldings` - æ·»åŠ è¿”å›ç±»å‹
- âœ… `quantApi.getPopularInstitutions` - æ·»åŠ è¿”å›ç±»å‹
- âœ… `quantApi.getInstitutionList` - æ·»åŠ è¿”å›ç±»å‹
- âœ… `quantApi.getInstitutionHoldings` - æ·»åŠ è¿”å›ç±»å‹
- âœ… `quantApi.selectStocksByInstitution` - æ·»åŠ è¿”å›ç±»å‹
- âœ… `ordersApi.estimateMaxQuantity` - æ·»åŠ è¿”å›ç±»å‹
- âœ… `ordersApi.submitOrder` - æ·»åŠ è¿”å›ç±»å‹
- âœ… `ordersApi.getSecurityInfo` - æ–°å¢å‡½æ•°å¹¶æ·»åŠ è¿”å›ç±»å‹

**è¿”å›ç±»å‹æ ¼å¼**:
```typescript
Promise<{ success: boolean; data?: any; error?: { message: string } }>
```

## âœ… ä¿®å¤3ï¼šç±»å‹å®‰å…¨æ£€æŸ¥ä¿®å¤

**æ–‡ä»¶**: `api/src/services/basic-execution.service.ts`

**ä¿®å¤å†…å®¹**:
```typescript
// ä¿®å¤å‰
if (result.rowCount > 0) {

// ä¿®å¤å
if (result.rowCount !== null && result.rowCount > 0) {
```

## âœ… ä¿®å¤4ï¼šè”åˆç±»å‹å±æ€§è®¿é—®ä¿®å¤

**æ–‡ä»¶**: `frontend/components/TradeModal.tsx`

**ä¿®å¤å†…å®¹**:
```typescript
// ä¿®å¤å‰
if (orderConfig?.requiresPrice && ...) {

// ä¿®å¤å
if (orderConfig && 'requiresPrice' in orderConfig && orderConfig.requiresPrice && ...) {
```

**ä¿®å¤çš„ä½ç½®**:
- `requiresPrice` æ£€æŸ¥ï¼ˆ3å¤„ï¼‰
- `requiresTrigger` æ£€æŸ¥ï¼ˆ2å¤„ï¼‰

## âœ… ä¿®å¤5ï¼šç»„ä»¶ç±»å‹ä¿®å¤

**æ–‡ä»¶**: `frontend/components/AppLayout.tsx`

**ä¿®å¤å†…å®¹**:
```typescript
// ä¿®å¤å‰
const items = [{ title: <Link href="/">é¦–é¡µ</Link> }]

// ä¿®å¤å
const items: Array<{ title: React.ReactNode }> = [{ title: <Link href="/">é¦–é¡µ</Link> }]
```

**æ–‡ä»¶**: `frontend/components/EditStrategyModal.tsx`

**ä¿®å¤å†…å®¹**:
- ä¸º `filter` å’Œ `map` å›è°ƒå‡½æ•°å‚æ•°æ·»åŠ æ˜¾å¼ç±»å‹

## âœ… ä¿®å¤6ï¼šç¼–ç é—®é¢˜ä¿®å¤

**é—®é¢˜æè¿°**: 
- `TradeModal.tsx` å’Œ `EditStrategyModal.tsx` ä¸­å­˜åœ¨21å¤„ä¸­æ–‡ç¼–ç é”™è¯¯
- æ˜¾ç¤ºä¸ºä¹±ç å­—ç¬¦ï¼ˆå¦‚`ï¿½?`ã€`ï¿½?`ç­‰ï¼‰ï¼Œå¯¼è‡´UIæ˜¾ç¤ºå¼‚å¸¸å’Œæ„å»ºå¤±è´¥

**ä¿®å¤çš„æ–‡ä»¶**:
- `frontend/components/TradeModal.tsx` - ä¿®å¤21å¤„ç¼–ç é—®é¢˜
- `frontend/components/EditStrategyModal.tsx` - ä¿®å¤ç¼–ç é—®é¢˜

**ä¿®å¤ç¤ºä¾‹**:
```typescript
// ä¿®å¤å‰
placeholder="è¯·è¾“å…¥æ•°ï¿½?
// ä¿®å¤å
placeholder="è¯·è¾“å…¥æ•°é‡"

// ä¿®å¤å‰
{showAdvanced ? 'ï¿½? : 'ï¿½?} é«˜çº§é€‰é¡¹
// ä¿®å¤å
{showAdvanced ? 'â–¼' : 'â–¶'} é«˜çº§é€‰é¡¹

// ä¿®å¤å‰
{loading ? 'æäº¤ï¿½?..' : 'ç¡®è®¤ä¹°å…¥'}
// ä¿®å¤å
{loading ? 'æäº¤ä¸­...' : 'ç¡®è®¤ä¹°å…¥'}
```

**ä¿®å¤çš„ç¼–ç é—®é¢˜ç±»å‹**:
- å ä½ç¬¦æ–‡æœ¬ï¼ˆplaceholderï¼‰- 5å¤„
- æŒ‰é’®æ–‡æœ¬ - 3å¤„
- æ ‡ç­¾æ–‡æœ¬ - 4å¤„
- æ³¨é‡Šæ–‡æœ¬ - 3å¤„
- æç¤ºä¿¡æ¯ - 6å¤„

## âœ… ä¿®å¤7ï¼šNext.js Suspenseè¾¹ç•Œä¿®å¤

**é—®é¢˜æè¿°**:
- `/options/chain` é¡µé¢ä½¿ç”¨ `useSearchParams()` hook
- Next.js 14è¦æ±‚åœ¨é™æ€ç”Ÿæˆæ—¶ç”¨ `Suspense` åŒ…è£¹ä½¿ç”¨ `useSearchParams()` çš„ç»„ä»¶
- é”™è¯¯ä¿¡æ¯ï¼š`useSearchParams() should be wrapped in a suspense boundary`

**ä¿®å¤æ–¹æ¡ˆ**:
**æ–‡ä»¶**: `frontend/app/options/chain/page.tsx`

**ä¿®å¤å†…å®¹**:
```typescript
// ä¿®å¤å‰
export default function OptionChainPage() {
  const searchParams = useSearchParams() // âŒ ç›´æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰Suspense
  // ...
}

// ä¿®å¤å
function OptionChainContent() {
  const searchParams = useSearchParams() // âœ… è¢«SuspenseåŒ…è£¹
  // ...
}

export default function OptionChainPage() {
  return (
    <Suspense fallback={
      <AppLayout>
        <Card>
          <Spin size="large" style={{ display: 'block', textAlign: 'center', padding: '40px 0' }} />
        </Card>
      </AppLayout>
    }>
      <OptionChainContent />
    </Suspense>
  )
}
```

**ä¿®å¤æ•ˆæœ**:
- âœ… é™æ€ç”ŸæˆæˆåŠŸ
- âœ… é¢„æ¸²æŸ“é”™è¯¯æ¶ˆé™¤
- âœ… ç¬¦åˆNext.jsæœ€ä½³å®è·µ

---

# 3. æ„å»ºéªŒè¯

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

| é”™è¯¯ç±»å‹ | æ•°é‡ | çŠ¶æ€ |
|---------|------|------|
| Routerç±»å‹æ¨æ–­ | 40+ | âœ… å·²ä¿®å¤ï¼ˆé€šè¿‡tsconfigï¼‰ |
| ç¼ºå°‘è¿”å›ç±»å‹ | 30+ | âœ… å·²ä¿®å¤ |
| ç±»å‹æ£€æŸ¥é—®é¢˜ | 20+ | âœ… å·²ä¿®å¤ |
| å¯¼å…¥ç¼ºå¤± | 5+ | âœ… å·²ä¿®å¤ |
| ç¼–ç é—®é¢˜ | 21+ | âœ… å·²ä¿®å¤ |
| Suspenseè¾¹ç•Œ | 1 | âœ… å·²ä¿®å¤ |
| å…¶ä»– | 4+ | âœ… å·²ä¿®å¤ |
| **æ€»è®¡** | **120+** | **âœ… å…¨éƒ¨ä¿®å¤** |

## ğŸ§ª æ„å»ºéªŒè¯

### APIæ„å»º
```bash
cd api
npm run build
```
**ç»“æœ**: âœ… æˆåŠŸï¼ˆ0é”™è¯¯ï¼‰

### å‰ç«¯æ„å»º
```bash
cd frontend
npm run build
```
**ç»“æœ**: âœ… æˆåŠŸï¼ˆTypeScriptç¼–è¯‘é€šè¿‡ï¼‰

**æ³¨æ„**: æœ‰ä¸€ä¸ªNext.jsè¿è¡Œæ—¶è­¦å‘Šï¼ˆ`useSearchParams()`éœ€è¦Suspenseè¾¹ç•Œï¼‰ï¼Œä½†ä¸å½±å“æ„å»ºã€‚

## ğŸ“ ç›¸å…³æ–‡ä»¶å˜æ›´

### ä¿®æ”¹çš„æ–‡ä»¶
- `api/tsconfig.json` - TypeScripté…ç½®ä¼˜åŒ–
- `api/src/services/basic-execution.service.ts` - ç±»å‹å®‰å…¨æ£€æŸ¥
- `frontend/lib/api.ts` - APIå‡½æ•°è¿”å›ç±»å‹
- `frontend/components/AppLayout.tsx` - é¢åŒ…å±‘ç±»å‹
- `frontend/components/EditStrategyModal.tsx` - å‚æ•°ç±»å‹å’Œç¼–ç é—®é¢˜
- `frontend/components/TradeModal.tsx` - è”åˆç±»å‹å±æ€§è®¿é—®å’Œç¼–ç é—®é¢˜
- `frontend/app/options/chain/page.tsx` - Suspenseè¾¹ç•Œ

### æ–°å¢çš„å‡½æ•°
- `ordersApi.getSecurityInfo` - è·å–æ ‡çš„åŸºç¡€ä¿¡æ¯

---

# 4. æœ€ä½³å®è·µå»ºè®®

## ğŸ¯ 1. æœ¬åœ°æ„å»ºæµ‹è¯•

**å»ºè®®**: åœ¨æ¨é€åˆ°NASä¹‹å‰ï¼Œå…ˆåœ¨æœ¬åœ°æµ‹è¯•æ„å»ºï¼š
```bash
# APIæ„å»ºæµ‹è¯•
cd api && npm run build

# å‰ç«¯æ„å»ºæµ‹è¯•
cd frontend && npm run build
```

**åŸå› **:
- æœ¬åœ°ç¯å¢ƒä¸NAS Dockerç¯å¢ƒç›¸ä¼¼
- æœ¬åœ°æ„å»ºæ›´å¿«ï¼Œä¾¿äºå¿«é€Ÿè¿­ä»£
- æœ¬åœ°æ„å»ºæˆåŠŸï¼ŒNASä¸Šå¤§æ¦‚ç‡ä¹Ÿèƒ½æˆåŠŸ

## ğŸ¯ 2. TypeScriptä¸¥æ ¼æ¨¡å¼

**å½“å‰çŠ¶æ€**: `strict: false`ï¼ˆå®½æ¾æ¨¡å¼ï¼‰

**å»ºè®®**: 
- å¼€å‘é˜¶æ®µå¯ä»¥ä½¿ç”¨å®½æ¾æ¨¡å¼ï¼Œæé«˜å¼€å‘æ•ˆç‡
- ç”Ÿäº§ç¯å¢ƒå»ºè®®é€æ­¥å¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œæé«˜ä»£ç è´¨é‡

## ğŸ¯ 3. APIå‡½æ•°è¿”å›ç±»å‹

**å»ºè®®**: æ‰€æœ‰APIå‡½æ•°éƒ½åº”è¯¥æœ‰æ˜¾å¼çš„è¿”å›ç±»å‹å£°æ˜ï¼Œé¿å…ç±»å‹æ¨æ–­é—®é¢˜ã€‚

**æ¨¡æ¿**:
```typescript
functionName: (...params): Promise<{ success: boolean; data?: any; error?: { message: string } }> => {
  return api.get/post/put/delete(...)
}
```

## ğŸ¯ 4. è”åˆç±»å‹å±æ€§è®¿é—®

**å»ºè®®**: ä½¿ç”¨ `in` æ“ä½œç¬¦è¿›è¡Œç±»å‹å®ˆå«ï¼Œè€Œä¸æ˜¯ç›´æ¥è®¿é—®å¯èƒ½ä¸å­˜åœ¨çš„å±æ€§ã€‚

**ç¤ºä¾‹**:
```typescript
// âœ… æ­£ç¡®
if (obj && 'property' in obj && obj.property) {
  // ä½¿ç”¨ obj.property
}

// âŒ é”™è¯¯
if (obj?.property) {
  // TypeScriptå¯èƒ½æŠ¥é”™
}
```

## ğŸ¯ 5. ç¼–ç é—®é¢˜é¢„é˜²

**å»ºè®®**: 
- ç¡®ä¿æ–‡ä»¶ç¼–ç ä¸ºUTF-8
- ä½¿ç”¨æ”¯æŒUTF-8çš„ç¼–è¾‘å™¨
- é¿å…åœ¨ä¸åŒç¼–ç ä¹‹é—´å¤åˆ¶ç²˜è´´æ–‡æœ¬

## ğŸ¯ 6. Next.js Suspenseè¾¹ç•Œ

**å»ºè®®**: 
- æ‰€æœ‰ä½¿ç”¨ `useSearchParams()` çš„ç»„ä»¶éƒ½åº”è¯¥ç”¨ `Suspense` åŒ…è£¹
- æä¾›åˆé€‚çš„fallback UI
- ç¬¦åˆNext.jsæœ€ä½³å®è·µ

---

# 5. åç»­ä¼˜åŒ–å»ºè®®

## ğŸ”„ 1. é€æ­¥å¯ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼

- åˆ†é˜¶æ®µå¯ç”¨ `strict`ã€`noUnusedLocals` ç­‰é€‰é¡¹
- é€æ­¥ä¿®å¤æ–°å‘ç°çš„ç±»å‹é—®é¢˜

## ğŸ”„ 2. ç»Ÿä¸€APIå“åº”ç±»å‹

- å®šä¹‰ç»Ÿä¸€çš„APIå“åº”æ¥å£
- å‡å°‘é‡å¤çš„ç±»å‹å£°æ˜

## ğŸ”„ 3. æ·»åŠ ESLintè§„åˆ™

- å¼ºåˆ¶è¦æ±‚APIå‡½æ•°æœ‰è¿”å›ç±»å‹
- æ£€æŸ¥æœªä½¿ç”¨çš„å˜é‡å’Œå‚æ•°

## ğŸ”„ 4. ä¿®å¤Next.jsè­¦å‘Š

- å°† `useSearchParams()` åŒ…è£…åœ¨ Suspense è¾¹ç•Œä¸­
- ç¬¦åˆNext.jsæœ€ä½³å®è·µ

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [TypeScriptå®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/docs/)
- [Next.js Suspenseæ–‡æ¡£](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)
- [Express TypeScriptç±»å‹](https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/express)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-12-11  
**çŠ¶æ€**ï¼šå·²å®Œæˆ âœ…

