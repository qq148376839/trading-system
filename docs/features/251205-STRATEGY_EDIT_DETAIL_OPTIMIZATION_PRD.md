# 策略编辑和详情页面优化 - 产品需求文档（PRD）

## 📋 文档信息
- **文档版本**：v1.0
- **创建时间**：2025-12-08
- **最后更新**：2025-12-08
- **文档作者**：AI Product Manager
- **审核状态**：待审核

---

## 1. 背景与目标

### 1.1 业务背景

在2025-12-08的优化中，我们完成了策略创建页面的UI优化，包括：
- ✅ 策略类型UI优化（移除下拉框，改为说明卡片）
- ✅ 按钮位置优化（固定在模态框底部）
- ✅ 机构选股功能增强（支持全部机构列表）
- ✅ 策略配置说明优化（添加详细说明和推荐值）

但是，**策略编辑页面**和**策略详情页面**还没有应用这些优化，存在以下问题：

1. **编辑页面**：
   - 编辑模态框布局与创建页面不一致
   - 不支持机构选股功能（只能手动输入）
   - 缺少策略类型说明卡片
   - 按钮位置需要滚动才能看到

2. **详情页面**：
   - 配置信息使用JSON格式显示，不够友好
   - 策略实例信息太少，缺少关键数据（持仓价格、盈亏、入场时间等）
   - 缺少策略性能统计（收益率、交易次数、胜率等）
   - 缺少策略运行日志或信号历史
   - 状态显示不够直观（英文状态码）
   - 缺少资金使用情况展示

### 1.2 用户痛点

**痛点1：编辑页面体验不一致**
- 用户创建策略时体验良好，但编辑时发现界面不一致
- 编辑时无法使用机构选股功能，只能手动输入
- 编辑页面缺少策略类型说明，用户可能忘记策略类型含义

**痛点2：详情页面信息不足**
- 用户无法快速了解策略运行情况
- 配置信息以JSON格式显示，不够直观
- 策略实例信息太少，无法判断策略表现
- 缺少关键指标（收益率、交易次数、盈亏情况）

**痛点3：操作不便**
- 编辑模态框按钮需要滚动才能看到
- 详情页面缺少快速操作入口（如查看交易记录、查看信号日志）
- 策略实例表格信息太少，需要点击才能查看详情

### 1.3 业务目标

- **主要目标**：统一策略管理页面的用户体验，提升策略管理效率
- **成功指标**：
  - 编辑页面与创建页面UI一致性 ≥ 95%
  - 详情页面信息完整度提升 ≥ 80%
  - 用户查看策略详情时间从平均30秒降低到10秒以内
  - 用户满意度 ≥ 4.5/5.0

### 1.4 项目范围

- **包含范围**：
  - 编辑页面UI优化（与创建页面保持一致）
  - 编辑页面支持机构选股功能
  - 详情页面配置信息友好化展示
  - 详情页面策略实例信息增强
  - 详情页面添加策略性能统计
  - 详情页面添加快速操作入口
- **不包含范围**：
  - 策略回测功能（已有独立页面）
  - 策略信号详情页面（后续迭代）
  - 策略实例详情页面（后续迭代）

---

## 2. 用户与场景

### 2.1 目标用户

- **主要用户**：量化交易者、策略管理者
- **用户特征**：
  - 需要频繁查看和编辑策略
  - 需要快速了解策略运行情况
  - 需要对比不同策略的表现

### 2.2 使用场景

**场景1：编辑策略配置**
- **用户**：量化交易者
- **时间**：策略运行前或运行中需要调整
- **行为**：点击"编辑"按钮，修改策略参数或股票池
- **目标**：快速修改策略配置，保持与创建页面一致的体验

**场景2：查看策略详情**
- **用户**：策略管理者
- **时间**：每日复盘或策略评估时
- **行为**：点击"详情"查看策略运行情况
- **目标**：快速了解策略表现，判断是否需要调整

**场景3：监控策略实例**
- **用户**：量化交易者
- **时间**：策略运行中
- **行为**：查看策略实例表格，了解每个标的的持仓情况
- **目标**：快速了解持仓状态、盈亏情况，判断是否需要干预

### 2.3 用户故事

- As a 量化交易者, I want 编辑策略时使用与创建页面一致的界面, So that 我可以快速熟悉和操作
- As a 策略管理者, I want 在详情页面看到策略的关键指标, So that 我可以快速评估策略表现
- As a 量化交易者, I want 在详情页面看到每个标的的持仓详情, So that 我可以了解策略运行情况

---

## 3. 功能需求

### 3.1 功能概览

| 功能模块 | 优先级 | 说明 |
|---------|--------|------|
| 编辑页面UI统一 | P0 | 与创建页面保持一致 |
| 编辑页面机构选股 | P1 | 支持机构选股功能 |
| 详情页面配置友好化 | P0 | 配置信息结构化展示 |
| 详情页面实例信息增强 | P0 | 添加持仓价格、盈亏等关键信息 |
| 详情页面性能统计 | P1 | 添加收益率、交易次数等指标 |
| 详情页面快速操作 | P1 | 添加查看交易记录、信号日志等入口 |

### 3.2 功能详细说明

#### 功能1：编辑页面UI统一

**优先级**：P0

**功能描述**：
编辑页面模态框布局与创建页面保持一致，包括：
- 使用flex布局，按钮固定在底部
- 添加策略类型说明卡片
- 添加策略配置说明卡片
- 布局顺序与创建页面一致

**交互流程**：
1. 用户点击"编辑"按钮
2. 打开编辑模态框
3. 显示策略类型说明卡片（只读）
4. 显示策略配置说明卡片
5. 表单内容可滚动
6. 按钮固定在底部，始终可见

**UI布局**：
```
┌─────────────────────────────┐
│ 编辑策略                      │ ← 固定顶部
├─────────────────────────────┤
│ 策略名称: [输入框]            │
│ 资金分配: [下拉框▼]          │
│ 股票池: [配置区域]            │
│                              │
│ ┌─────────────────────────┐ │
│ │ ✓ 推荐策略 V1 (只读)     │ │ ← 说明卡片
│ │ 策略类型创建后不可修改    │ │
│ └─────────────────────────┘ │
│                              │
│ 策略参数配置                  │
│ ┌─────────────────────────┐ │
│ │ 💡 参数说明：            │ │ ← 说明卡片
│ │ • ATR周期：...          │ │
│ │ • ATR倍数：...          │ │
│ │ • 风险收益比：...        │ │
│ └─────────────────────────┘ │
│ [ATR周期] [ATR倍数] [风险收益比] │
└─────────────────────────────┘
├─────────────────────────────┤
│              [取消] [保存]    │ ← 固定底部
└─────────────────────────────┘
```

**验收标准**：
- [ ] 编辑模态框布局与创建页面一致
- [ ] 按钮固定在底部，无需滚动即可看到
- [ ] 策略类型说明卡片正常显示（只读）
- [ ] 策略配置说明卡片正常显示

---

#### 功能2：编辑页面机构选股支持

**优先级**：P1

**功能描述**：
编辑页面支持机构选股功能，与创建页面保持一致。

**交互流程**：
1. 用户选择股票池模式（手动输入 / 机构选股）
2. 如果选择机构选股，显示机构选择界面
3. 用户选择机构，查看持仓列表
4. 用户选择股票，预览资金分配
5. 用户确认，更新股票池

**功能要求**：
- 支持切换股票池模式
- 支持机构选股（热门机构/全部机构）
- 支持资金分配预览
- 支持与现有股票池合并（可选）

**边界条件**：
- 如果策略正在运行，不允许修改股票池（提示用户先停止策略）
- 如果策略有持仓，提示用户修改股票池可能影响运行

**验收标准**：
- [ ] 编辑页面支持机构选股功能
- [ ] 机构选择界面与创建页面一致
- [ ] 资金分配预览正常显示
- [ ] 修改股票池时提示风险（如果策略正在运行）

---

#### 功能3：详情页面配置友好化展示

**优先级**：P0

**功能描述**：
将详情页面的JSON格式配置信息改为结构化、友好的展示方式。

**当前问题**：
```json
// 标的池配置（JSON格式）
{
  "mode": "STATIC",
  "symbols": ["AAPL.US", "TSLA.US", "MSFT.US"]
}

// 策略配置（JSON格式）
{
  "atrPeriod": 14,
  "atrMultiplier": 2.0,
  "riskRewardRatio": 1.5
}
```

**优化后展示**：
```
┌─────────────────────────────────┐
│ 标的池配置                       │
├─────────────────────────────────┤
│ 模式：静态列表                   │
│ 股票数量：3只                    │
│ 股票列表：                       │
│   • AAPL.US                     │
│   • TSLA.US                     │
│   • MSFT.US                     │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ 策略参数配置                     │
├─────────────────────────────────┤
│ ATR周期：14天                    │
│ ATR倍数：2.0                     │
│ 风险收益比：1.5                  │
│                                  │
│ 💡 说明：                        │
│ • ATR周期：计算平均真实波幅的周期 │
│ • ATR倍数：用于计算止损距离的倍数 │
│ • 风险收益比：止盈与止损的比例   │
└─────────────────────────────────┘
```

**功能要求**：
- 标的池配置：显示模式、股票数量、股票列表（可点击查看详情）
- 策略配置：显示参数值和说明
- 支持展开/收起（如果配置项较多）

**验收标准**：
- [ ] 配置信息不再使用JSON格式显示
- [ ] 标的池配置结构化展示
- [ ] 策略配置结构化展示
- [ ] 配置信息清晰易懂

---

#### 功能4：详情页面策略实例信息增强

**优先级**：P0

**功能描述**：
增强策略实例表格，添加关键信息：
- 持仓价格（入场价）
- 当前价格
- 盈亏金额和百分比
- 持仓数量
- 持仓市值
- 入场时间
- 持仓时长
- 止损价/止盈价（如果已设置）

**当前表格**：
```
| 标的      | 状态     | 最后更新        |
|-----------|----------|----------------|
| AAPL.US  | HOLDING  | 2025-12-08 ... |
```

**优化后表格**：
```
| 标的      | 状态     | 持仓价格 | 当前价格 | 盈亏    | 数量 | 市值      | 入场时间        | 持仓时长 |
|-----------|----------|----------|----------|---------|-----|-----------|----------------|----------|
| AAPL.US  | HOLDING  | 175.50   | 180.20   | +4.70   | 10  | $1,802.00 | 2025-12-05 ... | 3天      |
|           |          |          |          | (+2.68%)|     |           |                |          |
```

**功能要求**：
- 显示持仓价格（从context中获取entryPrice）
- 显示当前价格（实时查询或缓存）
- 计算并显示盈亏金额和百分比
- 显示持仓数量（从context中获取quantity）
- 显示持仓市值（当前价格 × 数量）
- 显示入场时间（从context中获取entryTime）
- 计算持仓时长（当前时间 - 入场时间）
- 显示止损价/止盈价（从context中获取stopLoss/takeProfit）
- 盈亏金额用颜色区分（盈利绿色，亏损红色）

**数据来源**：
- `instance.context` 包含：
  - `entryPrice` - 入场价
  - `quantity` - 持仓数量
  - `entryTime` - 入场时间
  - `stopLoss` - 止损价
  - `takeProfit` - 止盈价
- 当前价格：需要调用行情API获取

**边界条件**：
- 如果context中没有entryPrice，显示"-"
- 如果当前价格获取失败，显示"加载中..."
- 如果持仓时长为负数，显示"-"

**验收标准**：
- [ ] 策略实例表格显示所有关键信息
- [ ] 盈亏金额和百分比正确计算
- [ ] 持仓时长正确计算
- [ ] 盈亏金额用颜色区分
- [ ] 数据加载失败时显示友好提示

---

#### 功能5：详情页面策略性能统计

**优先级**：P1

**功能描述**：
在详情页面添加策略性能统计卡片，显示关键指标。

**统计指标**：
- **运行时长**：策略运行总时长
- **交易次数**：买入次数、卖出次数
- **持仓数量**：当前持仓标的数量
- **总盈亏**：累计盈亏金额和百分比
- **胜率**：盈利交易次数 / 总交易次数
- **平均持仓时长**：平均每个标的的持仓时长
- **资金使用率**：已使用资金 / 分配资金

**展示方式**：
```
┌─────────────────────────────────┐
│ 策略性能统计                     │
├─────────────────────────────────┤
│ ┌─────────┐ ┌─────────┐ ┌──────┐│
│ │运行时长  │ │交易次数  │ │持仓数 ││
│ │ 15天    │ │ 23次    │ │ 8只  ││
│ └─────────┘ └─────────┘ └──────┘│
│                                  │
│ ┌─────────┐ ┌─────────┐ ┌──────┐│
│ │总盈亏    │ │胜率     │ │资金使用││
│ │+$1,234  │ │ 65.2%   │ │ 78%  ││
│ │(+5.2%)  │ │         │ │      ││
│ └─────────┘ └─────────┘ └──────┘│
└─────────────────────────────────┘
```

**数据来源**：
- 运行时长：策略启动时间 - 当前时间（或停止时间）
- 交易次数：从交易记录API获取
- 持仓数量：策略实例数量
- 总盈亏：从交易记录计算
- 胜率：从交易记录计算
- 平均持仓时长：从策略实例计算
- 资金使用率：从资金管理API获取

**验收标准**：
- [ ] 性能统计卡片正常显示
- [ ] 所有指标正确计算
- [ ] 数据加载失败时显示友好提示
- [ ] 指标更新及时（实时或定时刷新）

---

#### 功能6：详情页面快速操作入口

**优先级**：P1

**功能描述**：
在详情页面添加快速操作入口，方便用户快速访问相关功能。

**操作入口**：
1. **查看交易记录**：跳转到 `/quant/trades?strategyId={id}`
2. **查看信号日志**：跳转到 `/quant/signals?strategyId={id}`
3. **查看资金使用**：显示资金使用详情（模态框或跳转）
4. **导出策略配置**：导出策略配置为JSON文件
5. **复制策略**：复制当前策略创建新策略

**展示方式**：
```
┌─────────────────────────────────┐
│ 快速操作                         │
├─────────────────────────────────┤
│ [查看交易记录] [查看信号日志]    │
│ [查看资金使用] [导出配置] [复制] │
└─────────────────────────────────┘
```

**功能要求**：
- 操作按钮清晰可见
- 支持跳转到相关页面
- 支持模态框展示（资金使用详情）
- 支持文件下载（导出配置）

**验收标准**：
- [ ] 快速操作入口正常显示
- [ ] 所有操作按钮功能正常
- [ ] 跳转页面正确传递参数
- [ ] 导出功能正常

---

#### 功能7：详情页面状态显示优化

**优先级**：P0

**功能描述**：
优化状态显示，使用中文和图标，更直观。

**当前状态显示**：
```
状态: RUNNING
状态: STOPPED
状态: ERROR
```

**优化后显示**：
```
状态: 🟢 运行中
状态: ⚪ 已停止
状态: 🔴 错误
状态: 🟡 已暂停
```

**功能要求**：
- 状态使用中文显示
- 状态使用图标区分
- 状态使用颜色区分（绿色=运行中，灰色=已停止，红色=错误，黄色=已暂停）

**验收标准**：
- [ ] 状态使用中文显示
- [ ] 状态使用图标和颜色区分
- [ ] 状态显示清晰直观

---

#### 功能8：详情页面资金使用情况展示

**优先级**：P1

**功能描述**：
在详情页面添加资金使用情况卡片，显示：
- 分配资金总额
- 已使用资金
- 可用资金
- 资金使用率
- 资金使用趋势图（可选）

**展示方式**：
```
┌─────────────────────────────────┐
│ 资金使用情况                     │
├─────────────────────────────────┤
│ 分配资金：$10,000.00             │
│ 已使用：  $7,800.00              │
│ 可用：    $2,200.00              │
│ 使用率：  78%                    │
│                                  │
│ [查看详细使用情况]               │
└─────────────────────────────────┘
```

**数据来源**：
- 调用 `GET /api/quant/capital/usage` API
- 获取策略的资金使用情况

**验收标准**：
- [ ] 资金使用情况正常显示
- [ ] 数据正确计算
- [ ] 支持查看详细使用情况

---

## 4. 非功能需求

### 4.1 性能要求
- **页面加载时间**：详情页面加载时间 ≤ 2秒
- **数据刷新**：策略实例数据每30秒自动刷新
- **API调用**：批量获取当前价格，减少API调用次数

### 4.2 安全要求
- 编辑策略时验证用户权限
- 删除策略时二次确认
- 修改运行中策略时提示风险

### 4.3 兼容性要求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 支持移动端浏览器（响应式设计）

---

## 5. 技术方案

### 5.1 前端实现

**编辑页面优化**：
- 复用创建页面的组件和布局
- 添加机构选股组件支持
- 统一模态框布局

**详情页面优化**：
- 新增配置信息展示组件
- 增强策略实例表格组件
- 新增性能统计组件
- 新增快速操作组件

**数据获取**：
- 策略详情：`GET /api/quant/strategies/:id`
- 策略实例：`GET /api/quant/strategies/:id/instances`
- 交易记录：`GET /api/quant/trades?strategyId={id}`
- 资金使用：`GET /api/quant/capital/usage`
- 实时价格：`GET /api/quote?symbols={symbols}`

### 5.2 后端支持（如需要）

**新增API**（如需要）：
- `GET /api/quant/strategies/:id/performance` - 获取策略性能统计
- `GET /api/quant/strategies/:id/capital-usage` - 获取策略资金使用情况

**数据计算**：
- 性能统计：从交易记录和策略实例计算
- 资金使用：从资金管理服务获取

---

## 6. 风险评估

### 6.1 技术风险

**风险1：实时价格获取可能影响性能**
- **影响**：中（可能增加API调用次数）
- **应对**：
  - 批量获取价格（一次请求多个标的）
  - 使用缓存（价格数据缓存30秒）
  - 异步加载（先显示其他信息，价格后加载）

**风险2：性能统计计算可能耗时**
- **影响**：低（计算量不大）
- **应对**：
  - 后端预计算并缓存
  - 前端异步加载

### 6.2 业务风险

**风险1：编辑策略时修改股票池可能影响运行**
- **影响**：中（可能影响策略运行）
- **应对**：
  - 运行中的策略不允许修改股票池
  - 修改前提示用户风险
  - 提供"停止策略后再编辑"的引导

---

## 7. 迭代计划

### 7.1 MVP范围（V1.0）

**核心功能**：
- ✅ 编辑页面UI统一（与创建页面保持一致）
- ✅ 详情页面配置友好化展示
- ✅ 详情页面策略实例信息增强（添加持仓价格、盈亏等）
- ✅ 详情页面状态显示优化（中文+图标）

**不包含功能**：
- ❌ 编辑页面机构选股（V1.1）
- ❌ 详情页面性能统计（V1.1）
- ❌ 详情页面快速操作入口（V1.1）
- ❌ 详情页面资金使用情况（V1.1）

### 7.2 后续迭代

**V1.1（预计1周后）**：
- 编辑页面机构选股支持
- 详情页面性能统计
- 详情页面快速操作入口
- 详情页面资金使用情况

**V1.2（预计2周后）**：
- 策略实例详情页面（点击实例查看详情）
- 策略运行日志实时展示
- 策略性能趋势图

---

## 8. UI设计

### 8.1 编辑页面布局

参考创建页面的布局，保持一致：
- 顶部：标题栏（固定）
- 中间：表单内容（可滚动）
- 底部：按钮栏（固定）

### 8.2 详情页面布局

```
┌─────────────────────────────────────────┐
│ [返回] [启动] [停止] [编辑] [删除]        │ ← 操作栏
├─────────────────────────────────────────┤
│ 策略名称：ARK投资策略                     │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 基本信息                             │ │
│ │ • 策略ID：5                          │ │
│ │ • 策略类型：推荐策略 V1               │ │
│ │ • 状态：🟢 运行中                     │ │
│ │ • 资金分配：另外30                    │ │
│ │ • 创建时间：2025-12-05 10:00:00      │ │
│ │ • 更新时间：2025-12-08 15:00:00      │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 策略性能统计                         │ │
│ │ [运行时长] [交易次数] [持仓数量]     │ │
│ │ [总盈亏]   [胜率]     [资金使用率]  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 标的池配置                           │ │
│ │ 模式：静态列表                       │ │
│ │ 股票数量：11只                       │ │
│ │ 股票列表：[可展开/收起]              │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 策略参数配置                         │ │
│ │ ATR周期：14天                        │ │
│ │ ATR倍数：2.0                         │ │
│ │ 风险收益比：1.5                      │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 资金使用情况                         │ │
│ │ 分配资金：$21,293.98                 │ │
│ │ 已使用：  $16,600.18                 │ │
│ │ 可用：    $4,693.80                  │ │
│ │ 使用率：  78%                        │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 快速操作                             │ │
│ │ [查看交易记录] [查看信号日志]        │ │
│ │ [查看资金使用] [导出配置] [复制策略] │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 策略实例 (11)                        │ │
│ │ [表格：标的、状态、持仓价格、当前价格│ │
│ │  盈亏、数量、市值、入场时间、持仓时长]│ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

---

## 9. 验收标准

### 9.1 编辑页面验收

- [ ] 编辑模态框布局与创建页面一致
- [ ] 按钮固定在底部，无需滚动即可看到
- [ ] 策略类型说明卡片正常显示（只读）
- [ ] 策略配置说明卡片正常显示
- [ ] 表单验证正常
- [ ] 保存功能正常

### 9.2 详情页面验收

- [ ] 配置信息不再使用JSON格式显示
- [ ] 策略实例表格显示所有关键信息
- [ ] 盈亏金额和百分比正确计算
- [ ] 状态使用中文和图标显示
- [ ] 页面加载时间 ≤ 2秒
- [ ] 数据刷新正常（每30秒）

---

## 10. 后续优化建议

### V1.1 功能增强

1. **编辑页面机构选股**
   - 支持机构选股功能
   - 支持与现有股票池合并

2. **详情页面性能统计**
   - 添加性能统计卡片
   - 添加性能趋势图

3. **详情页面快速操作**
   - 添加快速操作入口
   - 支持导出和复制策略

### V1.2 功能扩展

1. **策略实例详情**
   - 点击实例查看详情
   - 显示交易历史
   - 显示信号历史

2. **实时监控**
   - 策略运行日志实时展示
   - 策略状态实时更新

---

## 📚 相关文档

- [策略创建UI优化](251208-STRATEGY_CREATION_UI_OPTIMIZATION.md)
- [机构选股功能PRD](251205-INSTITUTION_STOCK_SELECTOR_PRD.md)
- [机构选股功能实施总结](251208-INSTITUTION_STOCK_SELECTOR_IMPLEMENTATION.md)

---

**文档版本**：v1.0  
**创建时间**：2025-12-08  
**最后更新**：2025-12-08  
**审核状态**：待审核

