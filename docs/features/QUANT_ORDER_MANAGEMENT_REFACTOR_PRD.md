# é‡åŒ–äº¤æ˜“è®¢å•ç®¡ç†é‡æ„ - äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆPRDï¼‰

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1
- **åˆ›å»ºæ—¶é—´**ï¼š2025-12-10
- **æœ€åæ›´æ–°**ï¼š2025-12-11
- **æ–‡æ¡£ä½œè€…**ï¼šAI Product Manager
- **å®¡æ ¸çŠ¶æ€**ï¼šå·²å®æ–½ âœ…

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 ä¸šåŠ¡èƒŒæ™¯

å½“å‰é‡åŒ–äº¤æ˜“ç³»ç»Ÿå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **æ•°æ®æºä¸ç»Ÿä¸€**ï¼š
   - äº¤æ˜“è®°å½•ï¼ˆ`auto_trades`è¡¨ï¼‰ä¸è®¢å•ç®¡ç†ï¼ˆé•¿æ¡¥APIï¼‰æ•°æ®ä¸ä¸€è‡´
   - ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ä¸å‡†ç¡®ï¼ˆä»`execution_orders`è¡¨ç»Ÿè®¡ï¼Œå¯èƒ½é—æ¼æˆ–é‡å¤ï¼‰
   - å†å²ç›ˆäºæ•°æ®ä¸å‡†ç¡®ï¼Œæ— æ³•ä¸çœŸå®è®¢å•å…³è”

2. **åŠŸèƒ½å†—ä½™**ï¼š
   - äº¤æ˜“è®°å½•é¡µé¢ï¼ˆ`/quant/trades`ï¼‰åŠŸèƒ½ä¸è®¢å•ç®¡ç†é‡å¤
   - `auto_trades`è¡¨çš„æ•°æ®æ¥æºä¸å‡†ç¡®ï¼Œæ— æ³•ä½œä¸ºå¯ä¿¡æ•°æ®æº

3. **ä¿¡å·æ—¥å¿—çŠ¶æ€æœªæ›´æ–°**ï¼š
   - æ‰€æœ‰ä¿¡å·çŠ¶æ€éƒ½æ˜¯"å¾…å¤„ç†"ï¼Œæœªä¸è®¢å•çŠ¶æ€å…³è”
   - æ— æ³•è¿½è¸ªä¿¡å·çš„æ‰§è¡Œæƒ…å†µ

### 1.2 ç”¨æˆ·ç—›ç‚¹

- **æ•°æ®ä¸å‡†ç¡®**ï¼šä»Šæ—¥äº¤æ˜“æ•°é‡ä¸å®é™…ä¸ç¬¦ï¼ˆ27ç¬”è®¢å•åªæ˜¾ç¤º6ç¬”ï¼‰
- **åŠŸèƒ½é‡å¤**ï¼šäº¤æ˜“è®°å½•å’Œè®¢å•ç®¡ç†åŠŸèƒ½é‡å¤ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬
- **çŠ¶æ€ä¸æ¸…æ™°**ï¼šæ— æ³•çŸ¥é“ä¿¡å·æ˜¯å¦å·²æ‰§è¡Œã€å·²æˆäº¤

### 1.3 ä¸šåŠ¡ç›®æ ‡

- **ä¸»è¦ç›®æ ‡**ï¼š
  - ç»Ÿä¸€æ•°æ®æºï¼šæ‰€æœ‰äº¤æ˜“æ•°æ®æ¥è‡ªé•¿æ¡¥APIï¼ˆçœŸå®æœ‰æ•ˆï¼‰
  - ç®€åŒ–åŠŸèƒ½ï¼šåˆ é™¤å†—ä½™çš„äº¤æ˜“è®°å½•åŠŸèƒ½
  - æå‡å‡†ç¡®æ€§ï¼šä»Šæ—¥äº¤æ˜“æ•°é‡ã€ç›ˆäºç»Ÿè®¡åŸºäºçœŸå®è®¢å•æ•°æ®
  - å®Œå–„è¿½è¸ªï¼šä¿¡å·æ—¥å¿—çŠ¶æ€ä¸è®¢å•çŠ¶æ€å®æ—¶å…³è”

- **æˆåŠŸæŒ‡æ ‡**ï¼š
  - ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å‡†ç¡®ç‡ 100%ï¼ˆä¸å®é™…è®¢å•ä¸€è‡´ï¼‰
  - ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°åŠæ—¶ç‡ â‰¥ 95%
  - ç”¨æˆ·æ»¡æ„åº¦æå‡ï¼ˆæ•°æ®å‡†ç¡®æ€§æå‡ï¼‰

### 1.4 é¡¹ç›®èŒƒå›´

- **åŒ…å«èŒƒå›´**ï¼š
  - åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ï¼ˆ`/quant/trades`é¡µé¢å’ŒAPIï¼‰
  - å°†è®¢å•ç®¡ç†ç§»åŠ¨åˆ°é‡åŒ–äº¤æ˜“æ¨¡å—ï¼ˆ`/quant/orders`ï¼‰
  - ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡é€»è¾‘ï¼ˆä½¿ç”¨è®¢å•ç®¡ç†çš„ä»Šæ—¥è®¢å•ï¼‰
  - ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°é€»è¾‘ï¼ˆè®¢å•æäº¤å’Œæˆäº¤æ—¶æ›´æ–°ï¼‰
  - ä»Šæ—¥äº¤æ˜“æ•°é‡æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ï¼ˆtooltipï¼‰

- **ä¸åŒ…å«èŒƒå›´**ï¼š
  - `auto_trades`è¡¨çš„åˆ é™¤ï¼ˆä¿ç•™ç”¨äºå…¼å®¹ï¼Œä½†ä¸å†ä½œä¸ºä¸»è¦æ•°æ®æºï¼‰
  - å†å²æ•°æ®è¿ç§»ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼Œæ–°æ•°æ®ä¸å†å†™å…¥ï¼‰
  - å›æµ‹åŠŸèƒ½çš„æ•°æ®æºä¿®æ”¹ï¼ˆå›æµ‹åŠŸèƒ½ç»§ç»­ä½¿ç”¨`auto_trades`è¡¨ï¼‰
  - ä»Šæ—¥ç›ˆäºè®¡ç®—çš„ä¿®æ”¹ï¼ˆä»Šæ—¥ç›ˆäºè®¡ç®—ç»§ç»­ä½¿ç”¨`auto_trades`è¡¨ï¼Œä½†å¯ä»¥åç»­ä¼˜åŒ–ï¼‰
  - èµ„é‡‘ç®¡ç†ä¸­çš„æŒä»“æ£€æŸ¥é€»è¾‘ä¿®æ”¹ï¼ˆ`capital-manager.service.ts`ä¸­çš„`auto_trades`æŸ¥è¯¢å¯ä»¥åç»­ä¼˜åŒ–ï¼‰

---

## 2. ç”¨æˆ·ä¸åœºæ™¯

### 2.1 ç›®æ ‡ç”¨æˆ·

- **ä¸»è¦ç”¨æˆ·**ï¼šé‡åŒ–äº¤æ˜“ç­–ç•¥ç®¡ç†å‘˜ã€äº¤æ˜“å‘˜
- **ç”¨æˆ·ç‰¹å¾**ï¼šéœ€è¦å‡†ç¡®äº†è§£äº¤æ˜“æƒ…å†µï¼Œè¿½è¸ªä¿¡å·æ‰§è¡ŒçŠ¶æ€

### 2.2 ä½¿ç”¨åœºæ™¯

**åœºæ™¯1ï¼šæŸ¥çœ‹ä»Šæ—¥äº¤æ˜“ç»Ÿè®¡**
- **ç”¨æˆ·**ï¼šç­–ç•¥ç®¡ç†å‘˜
- **æ—¶é—´**ï¼šäº¤æ˜“æ—¥ä¸Šåˆ
- **åœ°ç‚¹**ï¼šåŠå…¬å®¤
- **è¡Œä¸º**ï¼šæ‰“å¼€é‡åŒ–äº¤æ˜“é¦–é¡µï¼ŒæŸ¥çœ‹ä»Šæ—¥äº¤æ˜“æ•°é‡
- **ç›®æ ‡**ï¼šå¿«é€Ÿäº†è§£ä»Šæ—¥äº¤æ˜“æƒ…å†µï¼ˆæ€»æ•°é‡ã€ä¹°å…¥/å–å‡ºæ•°é‡ï¼‰

**åœºæ™¯2ï¼šæŸ¥çœ‹è®¢å•è¯¦æƒ…**
- **ç”¨æˆ·**ï¼šäº¤æ˜“å‘˜
- **æ—¶é—´**ï¼šäº¤æ˜“ä¸­
- **åœ°ç‚¹**ï¼šåŠå…¬å®¤
- **è¡Œä¸º**ï¼šåœ¨é‡åŒ–äº¤æ˜“æ¨¡å—ä¸­æŸ¥çœ‹ä»Šæ—¥è®¢å•å’Œå†å²è®¢å•
- **ç›®æ ‡**ï¼šæŸ¥çœ‹è®¢å•è¯¦æƒ…ã€çŠ¶æ€ã€æˆäº¤ä»·æ ¼ç­‰

**åœºæ™¯3ï¼šè¿½è¸ªä¿¡å·æ‰§è¡ŒçŠ¶æ€**
- **ç”¨æˆ·**ï¼šç­–ç•¥ç®¡ç†å‘˜
- **æ—¶é—´**ï¼šç­–ç•¥å¤ç›˜æ—¶
- **åœ°ç‚¹**ï¼šåŠå…¬å®¤
- **è¡Œä¸º**ï¼šæŸ¥çœ‹ä¿¡å·æ—¥å¿—ï¼Œäº†è§£ä¿¡å·æ˜¯å¦å·²æ‰§è¡Œã€å·²æˆäº¤
- **ç›®æ ‡**ï¼šè¯„ä¼°ä¿¡å·è´¨é‡ï¼Œä¼˜åŒ–ç­–ç•¥å‚æ•°

### 2.3 ç”¨æˆ·æ•…äº‹

- As a ç­–ç•¥ç®¡ç†å‘˜, I want æŸ¥çœ‹å‡†ç¡®çš„ä»Šæ—¥äº¤æ˜“æ•°é‡, So that æˆ‘å¯ä»¥å¿«é€Ÿäº†è§£äº¤æ˜“æƒ…å†µ
- As a äº¤æ˜“å‘˜, I want åœ¨é‡åŒ–äº¤æ˜“æ¨¡å—ä¸­æŸ¥çœ‹è®¢å•, So that æˆ‘ä¸éœ€è¦åœ¨ä¸åŒæ¨¡å—é—´åˆ‡æ¢
- As a ç­–ç•¥ç®¡ç†å‘˜, I want ä¿¡å·æ—¥å¿—çŠ¶æ€å®æ—¶æ›´æ–°, So that æˆ‘å¯ä»¥è¿½è¸ªä¿¡å·çš„æ‰§è¡Œæƒ…å†µ

---

## 3. åŠŸèƒ½éœ€æ±‚

### 3.1 åŠŸèƒ½æ¦‚è§ˆ

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ | P0 | åˆ é™¤`/quant/trades`é¡µé¢å’ŒAPI |
| ç§»åŠ¨è®¢å•ç®¡ç†åˆ°é‡åŒ–æ¨¡å— | P0 | å°†`/orders`ç§»åŠ¨åˆ°`/quant/orders` |
| ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ | P0 | ä½¿ç”¨è®¢å•ç®¡ç†çš„ä»Šæ—¥è®¢å•æ•°é‡ |
| ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–° | P0 | è®¢å•æäº¤å’Œæˆäº¤æ—¶æ›´æ–°ä¿¡å·çŠ¶æ€ |
| æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ | P1 | åœ¨tooltipä¸­æ˜¾ç¤ºä¹°å…¥å’Œå–å‡ºæ•°é‡ |

### 3.2 åŠŸèƒ½è¯¦ç»†è¯´æ˜

#### åŠŸèƒ½1ï¼šåˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½
**ä¼˜å…ˆçº§**ï¼šP0

**åŠŸèƒ½æè¿°**ï¼š
åˆ é™¤å†—ä½™çš„äº¤æ˜“è®°å½•åŠŸèƒ½ï¼Œç»Ÿä¸€ä½¿ç”¨è®¢å•ç®¡ç†çš„æ•°æ®æºã€‚

**äº¤äº’æµç¨‹**ï¼š
1. åˆ é™¤å‰ç«¯é¡µé¢ï¼š`frontend/app/quant/trades/page.tsx`
2. åˆ é™¤åç«¯APIï¼š`api/src/routes/quant.ts`ä¸­çš„`GET /api/quant/trades`
3. åˆ é™¤å¯¼èˆªèœå•ä¸­çš„"äº¤æ˜“è®°å½•"å…¥å£
4. æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Š

**è¾“å…¥è¾“å‡º**ï¼š
- **è¾“å…¥**ï¼šæ— 
- **è¾“å‡º**ï¼šåŠŸèƒ½å·²åˆ é™¤ï¼Œç›¸å…³ä»£ç å·²ç§»é™¤

**è¾¹ç•Œæ¡ä»¶**ï¼š
- ä¿ç•™`auto_trades`è¡¨ï¼ˆç”¨äºå…¼å®¹ï¼Œä½†ä¸å†å†™å…¥æ–°æ•°æ®ï¼‰
- ä¿ç•™`basic-execution.service.ts`ä¸­çš„`recordTrade`æ–¹æ³•ï¼ˆç”¨äºå…¼å®¹ï¼Œä½†å¯ä»¥æ ‡è®°ä¸ºdeprecatedï¼‰
- **æ³¨æ„**ï¼š`capital-manager.service.ts`ä¸­ä»ä½¿ç”¨`auto_trades`è¡¨æ£€æŸ¥æŒä»“ï¼ˆç¬¬400è¡Œï¼‰ï¼Œè¿™éƒ¨åˆ†é€»è¾‘å¯ä»¥åç»­ä¼˜åŒ–ï¼Œä½†ä¸å½±å“æœ¬æ¬¡é‡æ„

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] `/quant/trades`é¡µé¢å·²åˆ é™¤ âœ…
- [x] `GET /api/quant/trades` APIå·²åˆ é™¤ âœ…
- [x] å¯¼èˆªèœå•ä¸­"äº¤æ˜“è®°å½•"å…¥å£å·²åˆ é™¤ï¼Œæ”¹ä¸º"è®¢å•ç®¡ç†" âœ…
- [x] ç›¸å…³æ–‡æ¡£å·²æ›´æ–° âœ…

---

#### åŠŸèƒ½2ï¼šç§»åŠ¨è®¢å•ç®¡ç†åˆ°é‡åŒ–æ¨¡å—
**ä¼˜å…ˆçº§**ï¼šP0

**åŠŸèƒ½æè¿°**ï¼š
å°†è®¢å•ç®¡ç†é¡µé¢ä»`/orders`ç§»åŠ¨åˆ°`/quant/orders`ï¼Œæ•´åˆåˆ°é‡åŒ–äº¤æ˜“æ¨¡å—ä¸­ã€‚

**äº¤äº’æµç¨‹**ï¼š
1. å¤åˆ¶`frontend/app/orders/page.tsx`åˆ°`frontend/app/quant/orders/page.tsx`
2. æ›´æ–°è·¯ç”±å’Œå¯¼èˆªèœå•
3. åˆ é™¤åŸ`/orders`é¡µé¢ï¼ˆæˆ–ä¿ç•™é‡å®šå‘ï¼‰
4. æ›´æ–°APIè°ƒç”¨è·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰

**è¾“å…¥è¾“å‡º**ï¼š
- **è¾“å…¥**ï¼šè®¢å•ç®¡ç†é¡µé¢ä»£ç 
- **è¾“å‡º**ï¼šæ–°çš„`/quant/orders`é¡µé¢

**è¾¹ç•Œæ¡ä»¶**ï¼š
- ä¿ç•™åŸ`/orders`è·¯ç”±ï¼Œé‡å®šå‘åˆ°`/quant/orders`ï¼ˆå‘åå…¼å®¹ï¼‰
- è®¢å•ç®¡ç†APIè·¯å¾„ä¸å˜ï¼ˆ`/api/orders/*`ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] `/quant/orders`é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—® âœ…
- [x] ä»Šæ—¥è®¢å•å’Œå†å²è®¢å•åŠŸèƒ½æ­£å¸¸ âœ…
- [x] åŸ`/orders`è·¯ç”±é‡å®šå‘åˆ°`/quant/orders` âœ…
- [x] å¯¼èˆªèœå•å·²æ›´æ–° âœ…

---

#### åŠŸèƒ½3ï¼šä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡
**ä¼˜å…ˆçº§**ï¼šP0

**åŠŸèƒ½æè¿°**ï¼š
ä¿®æ”¹Dashboardç»Ÿè®¡APIï¼Œä½¿ç”¨è®¢å•ç®¡ç†çš„ä»Šæ—¥è®¢å•æ•°é‡ï¼ˆæ¥è‡ªé•¿æ¡¥APIï¼‰ï¼Œè€Œä¸æ˜¯`execution_orders`è¡¨ã€‚

**äº¤äº’æµç¨‹**ï¼š
1. ä¿®æ”¹`GET /api/quant/dashboard/stats` API
2. ä½¿ç”¨`tradeCtx.todayOrders()`è·å–ä»Šæ—¥è®¢å•
3. ç»Ÿè®¡å·²æˆäº¤è®¢å•æ•°é‡ï¼ˆ`FilledStatus`å’Œ`PartialFilledStatus`ï¼‰
4. åŒºåˆ†ä¹°å…¥å’Œå–å‡ºè®¢å•æ•°é‡
5. å‰ç«¯æ˜¾ç¤ºæ€»æ•°é‡ï¼Œtooltipæ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡

**è¾“å…¥è¾“å‡º**ï¼š
- **è¾“å…¥**ï¼šé•¿æ¡¥APIä»Šæ—¥è®¢å•æ•°æ®
- **è¾“å‡º**ï¼š
  ```json
  {
    "todayTrades": 27,
    "todayBuyOrders": 15,
    "todaySellOrders": 12
  }
  ```

**ç»Ÿè®¡é€»è¾‘**ï¼š
```typescript
// 1. è·å–ä»Šæ—¥è®¢å•ï¼ˆä»é•¿æ¡¥APIï¼‰
const tradeCtx = await getTradeContext();
const todayOrders = await tradeCtx.todayOrders({});

// 2. ç­›é€‰å·²æˆäº¤è®¢å•
const filledOrders = todayOrders.filter(order => {
  const status = normalizeStatus(order.status);
  return status === 'FilledStatus' || status === 'PartialFilledStatus';
});

// 3. ç»Ÿè®¡æ€»æ•°é‡
const todayTrades = filledOrders.length;

// 4. åŒºåˆ†ä¹°å…¥å’Œå–å‡º
const todayBuyOrders = filledOrders.filter(order => 
  normalizeSide(order.side) === 'Buy'
).length;
const todaySellOrders = filledOrders.filter(order => 
  normalizeSide(order.side) === 'Sell'
).length;
```

**è¾¹ç•Œæ¡ä»¶**ï¼š
- APIé™æµï¼šè®°å½•è­¦å‘Šæ—¥å¿—ï¼Œè¿”å›ç¼“å­˜æ•°æ®æˆ–0
- æ— è®¢å•ï¼šè¿”å›0
- è®¢å•çŠ¶æ€å¼‚å¸¸ï¼šè®°å½•è­¦å‘Šæ—¥å¿—ï¼Œè·³è¿‡è¯¥è®¢å•

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å‡†ç¡®ï¼ˆä¸å®é™…è®¢å•ä¸€è‡´ï¼‰ âœ…
- [x] ä¹°å…¥å’Œå–å‡ºæ•°é‡ç»Ÿè®¡æ­£ç¡® âœ…
- [x] å‰ç«¯tooltipæ­£ç¡®æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ âœ…
- [x] APIé™æµæ—¶ä¼˜é›…é™çº§ï¼ˆä½¿ç”¨æ•°æ®åº“é™çº§æ–¹æ¡ˆï¼‰ âœ…

---

#### åŠŸèƒ½4ï¼šä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°
**ä¼˜å…ˆçº§**ï¼šP0

**åŠŸèƒ½æè¿°**ï¼š
ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œåœ¨è®¢å•æäº¤å’Œæˆäº¤æ—¶è‡ªåŠ¨æ›´æ–°ä¿¡å·çŠ¶æ€ã€‚

**äº¤äº’æµç¨‹**ï¼š
1. è®¢å•æäº¤æ—¶ï¼šæ›´æ–°ä¿¡å·çŠ¶æ€ä¸º`EXECUTED`ï¼ˆå¦‚æœè®¢å•æäº¤æˆåŠŸï¼‰
2. è®¢å•æˆäº¤æ—¶ï¼šç¡®è®¤ä¿¡å·çŠ¶æ€ä¸º`EXECUTED`ï¼ˆå¦‚æœçŠ¶æ€ä¸æ˜¯å·²æ‰§è¡Œï¼‰
3. è®¢å•è¢«æ‹’ç»æ—¶ï¼šæ›´æ–°ä¿¡å·çŠ¶æ€ä¸º`REJECTED`
4. è®¢å•è¢«å–æ¶ˆæ—¶ï¼šæ›´æ–°ä¿¡å·çŠ¶æ€ä¸º`IGNORED`

**çŠ¶æ€æ˜ å°„è§„åˆ™**ï¼š
- `PENDING` â†’ å¾…å¤„ç†ï¼ˆä¿¡å·ç”Ÿæˆï¼Œæœªæäº¤è®¢å•ï¼‰
- `EXECUTED` â†’ å·²æ‰§è¡Œï¼ˆè®¢å•å·²æäº¤æˆ–å·²æˆäº¤ï¼‰
- `REJECTED` â†’ å·²æ‹’ç»ï¼ˆè®¢å•è¢«æ‹’ç»ï¼‰
- `IGNORED` â†’ å·²å¿½ç•¥ï¼ˆè®¢å•è¢«å–æ¶ˆæˆ–å…¶ä»–æƒ…å†µï¼‰

**è¾“å…¥è¾“å‡º**ï¼š
- **è¾“å…¥**ï¼šè®¢å•çŠ¶æ€å˜åŒ–äº‹ä»¶
- **è¾“å‡º**ï¼šä¿¡å·çŠ¶æ€å·²æ›´æ–°

**æ›´æ–°é€»è¾‘**ï¼š
```typescript
// 1. è®¢å•æäº¤æ—¶ï¼ˆbasic-execution.service.tsï¼‰
async submitOrder(...) {
  // ... æäº¤è®¢å•é€»è¾‘
  
  // å¦‚æœè®¢å•æäº¤æˆåŠŸï¼Œæ›´æ–°ä¿¡å·çŠ¶æ€
  if (orderId && normalizedStatus !== 'RejectedStatus') {
    await this.updateSignalStatusByOrderId(orderId, 'EXECUTED');
  } else if (normalizedStatus === 'RejectedStatus') {
    await this.updateSignalStatusByOrderId(orderId, 'REJECTED');
  }
}

// 2. è®¢å•æˆäº¤æ—¶ï¼ˆstrategy-scheduler.service.tsï¼‰
async trackPendingOrders(...) {
  // ... è®¢å•è¿½è¸ªé€»è¾‘
  
  // å¦‚æœè®¢å•å·²æˆäº¤ï¼Œæ›´æ–°ä¿¡å·çŠ¶æ€
  if (status === 'FilledStatus' || status === 'PartialFilledStatus') {
    await this.updateSignalStatusByOrderId(orderId, 'EXECUTED');
  }
  
  // å¦‚æœè®¢å•è¢«å–æ¶ˆï¼Œæ›´æ–°ä¿¡å·çŠ¶æ€
  if (status === 'CanceledStatus' || status === 'PendingCancelStatus') {
    await this.updateSignalStatusByOrderId(orderId, 'IGNORED');
  }
}

// 3. è®¢å•è¢«æ‹’ç»æ—¶ï¼ˆstrategy-scheduler.service.tsï¼‰
if (status === 'RejectedStatus') {
  await this.updateSignalStatusByOrderId(orderId, 'REJECTED');
}
```

**é‡è¦è¯´æ˜**ï¼š
- ä¿¡å·çŠ¶æ€æ›´æ–°éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹è°ƒç”¨ï¼š
  1. `basic-execution.service.ts`çš„`submitOrder`æ–¹æ³•ï¼ˆè®¢å•æäº¤æ—¶ï¼‰
  2. `strategy-scheduler.service.ts`çš„`trackPendingOrders`æ–¹æ³•ï¼ˆè®¢å•çŠ¶æ€å˜åŒ–æ—¶ï¼‰
  3. è®¢å•å–æ¶ˆã€æ‹’ç»ç­‰åœºæ™¯

**è¾¹ç•Œæ¡ä»¶**ï¼š
- ä¿¡å·ä¸å­˜åœ¨ï¼šè®°å½•è­¦å‘Šæ—¥å¿—ï¼Œè·³è¿‡æ›´æ–°
- è®¢å•IDä¸åŒ¹é…ï¼šè®°å½•è­¦å‘Šæ—¥å¿—ï¼Œè·³è¿‡æ›´æ–°
- çŠ¶æ€å·²æ˜¯æœ€æ–°ï¼šè·³è¿‡æ›´æ–°ï¼ˆé¿å…é‡å¤æ›´æ–°ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] è®¢å•æäº¤æ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`EXECUTED` âœ…
- [x] è®¢å•æˆäº¤æ—¶ä¿¡å·çŠ¶æ€ç¡®è®¤ä¸º`EXECUTED` âœ…
- [x] è®¢å•è¢«æ‹’ç»æ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`REJECTED` âœ…
- [x] è®¢å•è¢«å–æ¶ˆæ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`IGNORED` âœ…
- [x] ä¿¡å·æ—¥å¿—é¡µé¢æ­£ç¡®æ˜¾ç¤ºçŠ¶æ€ âœ…

---

#### åŠŸèƒ½5ï¼šæ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡ï¼ˆTooltipï¼‰
**ä¼˜å…ˆçº§**ï¼šP1

**åŠŸèƒ½æè¿°**ï¼š
åœ¨é‡åŒ–äº¤æ˜“é¦–é¡µçš„ä»Šæ—¥äº¤æ˜“æ•°é‡ä¸Šæ·»åŠ tooltipï¼Œæ˜¾ç¤ºä¹°å…¥å’Œå–å‡ºè®¢å•æ•°é‡ã€‚

**äº¤äº’æµç¨‹**ï¼š
1. ç”¨æˆ·é¼ æ ‡æ‚¬åœåœ¨"ä»Šæ—¥äº¤æ˜“"æ•°é‡ä¸Š
2. æ˜¾ç¤ºtooltipï¼Œå†…å®¹ï¼š
   ```
   æ€»äº¤æ˜“ï¼š27ç¬”
   ä¹°å…¥ï¼š15ç¬”
   å–å‡ºï¼š12ç¬”
   ```

**è¾“å…¥è¾“å‡º**ï¼š
- **è¾“å…¥**ï¼šä»Šæ—¥äº¤æ˜“ç»Ÿè®¡æ•°æ®ï¼ˆåŒ…å«ä¹°å…¥/å–å‡ºæ•°é‡ï¼‰
- **è¾“å‡º**ï¼šTooltipæ˜¾ç¤º

**UIè®¾è®¡**ï¼š
```tsx
<Tooltip title={
  <div>
    <div>æ€»äº¤æ˜“ï¼š{todayTrades}ç¬”</div>
    <div>ä¹°å…¥ï¼š{todayBuyOrders}ç¬”</div>
    <div>å–å‡ºï¼š{todaySellOrders}ç¬”</div>
  </div>
}>
  <span>{todayTrades}</span>
</Tooltip>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [x] Tooltipæ­£ç¡®æ˜¾ç¤ºæ€»äº¤æ˜“ã€ä¹°å…¥ã€å–å‡ºæ•°é‡ âœ…
- [x] Tooltipæ ·å¼ç¾è§‚ï¼Œä¿¡æ¯æ¸…æ™° âœ…
- [x] ç§»åŠ¨ç«¯æ”¯æŒï¼ˆç‚¹å‡»æ˜¾ç¤ºï¼‰ âœ…

---

## 4. éåŠŸèƒ½éœ€æ±‚

### 4.1 æ€§èƒ½è¦æ±‚
- **å“åº”æ—¶é—´**ï¼šä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ â‰¤ 2ç§’
- **APIè°ƒç”¨é¢‘ç‡**ï¼šä½¿ç”¨ç¼“å­˜ï¼Œé¿å…é¢‘ç¹è°ƒç”¨é•¿æ¡¥API
- **å¹¶å‘é‡**ï¼šæ”¯æŒå¤šç”¨æˆ·åŒæ—¶è®¿é—®

### 4.2 å®‰å…¨è¦æ±‚
- è®¢å•æ•°æ®è®¿é—®æƒé™æ§åˆ¶ï¼ˆä»…æˆæƒç”¨æˆ·å¯è®¿é—®ï¼‰
- APIå¯†é’¥å®‰å…¨å­˜å‚¨

### 4.3 å…¼å®¹æ€§è¦æ±‚
- ä¿ç•™åŸ`/orders`è·¯ç”±ï¼Œé‡å®šå‘åˆ°`/quant/orders`ï¼ˆå‘åå…¼å®¹ï¼‰
- ä¿ç•™`auto_trades`è¡¨ï¼ˆç”¨äºå…¼å®¹ï¼Œä½†ä¸å†å†™å…¥æ–°æ•°æ®ï¼‰

---

## 5. æŠ€æœ¯æ–¹æ¡ˆ

### 5.1 æ•°æ®æºç»Ÿä¸€

**å½“å‰æ¶æ„**ï¼š
```
äº¤æ˜“è®°å½• (auto_tradesè¡¨) â† ä¸å‡†ç¡®
è®¢å•ç®¡ç† (é•¿æ¡¥API) â† çœŸå®æœ‰æ•ˆ
ä»Šæ—¥äº¤æ˜“ç»Ÿè®¡ (execution_ordersè¡¨) â† ä¸å‡†ç¡®
```

**ç›®æ ‡æ¶æ„**ï¼š
```
è®¢å•ç®¡ç† (é•¿æ¡¥API) â† å”¯ä¸€æ•°æ®æº
ä»Šæ—¥äº¤æ˜“ç»Ÿè®¡ (é•¿æ¡¥API todayOrders) â† å‡†ç¡®
ä¿¡å·æ—¥å¿—çŠ¶æ€ (å…³è”è®¢å•çŠ¶æ€) â† å®æ—¶æ›´æ–°
```

### 5.2 APIä¿®æ”¹

**ä¿®æ”¹æ–‡ä»¶**ï¼š`api/src/routes/quant.ts`

```typescript
// ä¿®æ”¹ Dashboard ç»Ÿè®¡ API
quantRouter.get('/dashboard/stats', async (req, res, next) => {
  try {
    const tradeCtx = await getTradeContext();
    const todayOrders = await tradeCtx.todayOrders({});
    
    // ç»Ÿè®¡å·²æˆäº¤è®¢å•
    const filledOrders = todayOrders.filter(order => {
      const status = normalizeStatus(order.status);
      return status === 'FilledStatus' || status === 'PartialFilledStatus';
    });
    
    const todayTrades = filledOrders.length;
    const todayBuyOrders = filledOrders.filter(o => normalizeSide(o.side) === 'Buy').length;
    const todaySellOrders = filledOrders.filter(o => normalizeSide(o.side) === 'Sell').length;
    
    res.json({
      success: true,
      data: {
        todayTrades,
        todayBuyOrders,
        todaySellOrders,
        // ... å…¶ä»–ç»Ÿè®¡æ•°æ®
      },
    });
  } catch (error) {
    next(error);
  }
});
```

### 5.3 ä¿¡å·çŠ¶æ€æ›´æ–°

**å…³é”®é—®é¢˜**ï¼š`execution_orders`è¡¨æ²¡æœ‰`signal_id`å­—æ®µï¼Œéœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼å…³è”ä¿¡å·å’Œè®¢å•ã€‚

**å…³è”æ–¹å¼**ï¼š
1. é€šè¿‡`strategy_id`ã€`symbol`ã€`side`ã€`created_at`åŒ¹é…ï¼ˆæ—¶é—´çª—å£ï¼šè®¢å•åˆ›å»ºæ—¶é—´å‰å5åˆ†é’Ÿå†…ï¼‰
2. æˆ–è€…ï¼šåœ¨`execution_orders`è¡¨ä¸­æ·»åŠ `signal_id`å­—æ®µï¼ˆæ¨èæ–¹æ¡ˆï¼‰

**æ–¹æ¡ˆAï¼šé€šè¿‡æ—¶é—´çª—å£åŒ¹é…ï¼ˆæ— éœ€æ•°æ®åº“å˜æ›´ï¼‰**

**ä¿®æ”¹æ–‡ä»¶**ï¼š`api/src/services/basic-execution.service.ts`

```typescript
// æ·»åŠ æ–¹æ³•ï¼šæ ¹æ®è®¢å•IDæ›´æ–°ä¿¡å·çŠ¶æ€
private async updateSignalStatusByOrderId(
  orderId: string,
  status: 'EXECUTED' | 'REJECTED' | 'IGNORED'
): Promise<void> {
  try {
    // 1. è·å–è®¢å•ä¿¡æ¯
    const orderResult = await pool.query(
      `SELECT strategy_id, symbol, side, created_at 
       FROM execution_orders 
       WHERE order_id = $1`,
      [orderId]
    );
    
    if (orderResult.rows.length === 0) {
      logger.warn(`æœªæ‰¾åˆ°è®¢å• ${orderId}`);
      return;
    }
    
    const order = orderResult.rows[0];
    const orderTime = new Date(order.created_at);
    const timeWindowStart = new Date(orderTime.getTime() - 5 * 60 * 1000); // 5åˆ†é’Ÿå‰
    const timeWindowEnd = new Date(orderTime.getTime() + 5 * 60 * 1000); // 5åˆ†é’Ÿå
    
    // 2. æŸ¥æ‰¾åŒ¹é…çš„ä¿¡å·ï¼ˆé€šè¿‡strategy_idã€symbolã€sideã€æ—¶é—´çª—å£ï¼‰
    const signalResult = await pool.query(
      `UPDATE strategy_signals 
       SET status = $1 
       WHERE strategy_id = $2 
         AND symbol = $3 
         AND signal_type = $4
         AND created_at >= $5 
         AND created_at <= $6
         AND status = 'PENDING'
       RETURNING id`,
      [
        status,
        order.strategy_id,
        order.symbol,
        order.side === 'BUY' || order.side === 1 ? 'BUY' : 'SELL',
        timeWindowStart,
        timeWindowEnd,
      ]
    );
    
    if (signalResult.rowCount === 0) {
      logger.warn(`æœªæ‰¾åˆ°è®¢å• ${orderId} å…³è”çš„ä¿¡å· (strategy_id=${order.strategy_id}, symbol=${order.symbol}, side=${order.side})`);
    } else {
      logger.debug(`è®¢å• ${orderId} å…³è”çš„ä¿¡å·å·²æ›´æ–°: ${signalResult.rows.map(r => r.id).join(',')}`);
    }
  } catch (error) {
    logger.error(`æ›´æ–°ä¿¡å·çŠ¶æ€å¤±è´¥ (è®¢å•: ${orderId}):`, error);
  }
}
```

**æ–¹æ¡ˆBï¼šæ·»åŠ signal_idå­—æ®µï¼ˆæ¨èï¼Œæ›´å‡†ç¡®ï¼‰**

**æ•°æ®åº“è¿ç§»**ï¼š
```sql
-- æ·»åŠ signal_idå­—æ®µåˆ°execution_ordersè¡¨
ALTER TABLE execution_orders 
ADD COLUMN signal_id INTEGER REFERENCES strategy_signals(id) ON DELETE SET NULL;

CREATE INDEX IF NOT EXISTS idx_execution_orders_signal_id ON execution_orders(signal_id);
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š`api/src/services/strategies/strategy-base.ts`

```typescript
// ä¿®æ”¹logSignalæ–¹æ³•ï¼Œè¿”å›signal_id
protected async logSignal(intent: TradingIntent): Promise<number> {
  const result = await pool.query(
    `INSERT INTO strategy_signals 
     (strategy_id, symbol, signal_type, price, reason, metadata, status)
     VALUES ($1, $2, $3, $4, $5, $6, 'PENDING')
     RETURNING id`,
    [
      this.strategyId,
      intent.symbol,
      intent.action,
      intent.entryPrice || intent.entryPriceRange?.min || null,
      intent.reason,
      intent.metadata ? JSON.stringify(intent.metadata) : null,
    ]
  );
  return result.rows[0].id;
}
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š`api/src/services/strategies/recommendation-strategy.ts`

```typescript
// ä¿®æ”¹generateSignalæ–¹æ³•ï¼Œè¿”å›signal_id
async generateSignal(symbol: string, _marketData?: any): Promise<TradingIntent | null> {
  try {
    // ... ç”Ÿæˆintentçš„é€»è¾‘ ...
    
    // è®°å½•ä¿¡å·åˆ°æ•°æ®åº“ï¼Œè·å–signal_id
    const signalId = await this.logSignal(intent);
    
    // å°†signal_idæ·»åŠ åˆ°intentçš„metadataä¸­ï¼Œä¼ é€’ç»™è®¢å•æäº¤æµç¨‹
    intent.metadata = {
      ...intent.metadata,
      signalId,  // æ–°å¢ï¼šä¿¡å·ID
    };
    
    return intent;
  } catch (error: any) {
    // ... é”™è¯¯å¤„ç† ...
  }
}
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š`api/src/services/basic-execution.service.ts`

```typescript
// ä¿®æ”¹executeBuyIntentå’ŒexecuteSellIntentæ–¹æ³•ï¼Œä¼ é€’signal_id
async executeBuyIntent(
  intent: TradingIntent,
  strategyId: number
): Promise<ExecutionResult> {
  // ... ç°æœ‰é€»è¾‘ ...
  
  // ä»intent.metadataä¸­è·å–signal_id
  const signalId = (intent.metadata as any)?.signalId;
  
  try {
    return await this.submitOrder(
      intent.symbol,
      'BUY',
      intent.quantity,
      intent.entryPrice,
      strategyId,
      signalId  // æ–°å¢å‚æ•°
    );
  } catch (error: any) {
    // ... é”™è¯¯å¤„ç† ...
  }
}

// ä¿®æ”¹submitOrderæ–¹æ³•ï¼Œæ¥æ”¶signal_idå‚æ•°
private async submitOrder(
  symbol: string,
  side: 'BUY' | 'SELL',
  quantity: number,
  price: number,
  strategyId: number,
  signalId?: number  // æ–°å¢å‚æ•°
): Promise<ExecutionResult> {
  // ... ç°æœ‰é€»è¾‘ ...
  
  // 5. è®°å½•è®¢å•åˆ°æ•°æ®åº“ï¼ˆåŒ…å«signal_idï¼‰
  try {
    await this.recordOrder(strategyId, symbol, side, quantity, price, orderId, signalId);
  } catch (dbError: any) {
    // ... é”™è¯¯å¤„ç† ...
  }
  
  // ... åç»­é€»è¾‘ ...
}

// ä¿®æ”¹recordOrderæ–¹æ³•ï¼Œæ¥æ”¶signal_idå‚æ•°
private async recordOrder(
  strategyId: number,
  symbol: string,
  side: string,
  quantity: number,
  price: number,
  orderId: string,
  signalId?: number  // æ–°å¢å‚æ•°
): Promise<void> {
  await pool.query(
    `INSERT INTO execution_orders 
     (strategy_id, symbol, order_id, side, quantity, price, current_status, execution_stage, signal_id)
     VALUES ($1, $2, $3, $4, $5, $6, 'SUBMITTED', 1, $7)`,
    [strategyId, symbol, orderId, side, quantity, price, signalId || null]
  );
}

// æ·»åŠ æ–¹æ³•ï¼šæ ¹æ®è®¢å•IDæ›´æ–°ä¿¡å·çŠ¶æ€
private async updateSignalStatusByOrderId(
  orderId: string,
  status: 'EXECUTED' | 'REJECTED' | 'IGNORED'
): Promise<void> {
  try {
    const signalResult = await pool.query(
      `UPDATE strategy_signals 
       SET status = $1 
       WHERE id IN (
         SELECT signal_id FROM execution_orders 
         WHERE order_id = $2 AND signal_id IS NOT NULL
       )`,
      [status, orderId]
    );
    
    if (signalResult.rowCount === 0) {
      logger.warn(`æœªæ‰¾åˆ°è®¢å• ${orderId} å…³è”çš„ä¿¡å·`);
    }
  } catch (error) {
    logger.error(`æ›´æ–°ä¿¡å·çŠ¶æ€å¤±è´¥ (è®¢å•: ${orderId}):`, error);
  }
}
```

### 5.4 å‰ç«¯ä¿®æ”¹

**ä¿®æ”¹æ–‡ä»¶**ï¼š`frontend/app/quant/page.tsx`

```tsx
// æ˜¾ç¤ºä»Šæ—¥äº¤æ˜“æ•°é‡ï¼ˆå¸¦tooltipï¼‰
<Tooltip title={
  <div>
    <div>æ€»äº¤æ˜“ï¼š{overview.todayTrades}ç¬”</div>
    <div>ä¹°å…¥ï¼š{overview.todayBuyOrders}ç¬”</div>
    <div>å–å‡ºï¼š{overview.todaySellOrders}ç¬”</div>
  </div>
}>
  <span>{overview.todayTrades}</span>
</Tooltip>
```

---

## 6. é£é™©è¯„ä¼°

### 6.1 æŠ€æœ¯é£é™©

- **é£é™©**ï¼šé•¿æ¡¥APIé™æµï¼Œå¯¼è‡´ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å¤±è´¥
- **å½±å“**ï¼šé«˜ï¼ˆå½±å“é¦–é¡µæ˜¾ç¤ºï¼‰
- **åº”å¯¹**ï¼š
  - ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼ˆç¼“å­˜5åˆ†é’Ÿï¼‰
  - APIé™æµæ—¶è¿”å›ç¼“å­˜æ•°æ®æˆ–0
  - è®°å½•è­¦å‘Šæ—¥å¿—ï¼Œä¸å½±å“ä¸»æµç¨‹

### 6.2 ä¸šåŠ¡é£é™©

- **é£é™©**ï¼šåˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½ï¼Œç”¨æˆ·å¯èƒ½ä¸é€‚åº”
- **å½±å“**ï¼šä¸­ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
- **åº”å¯¹**ï¼š
  - ä¿ç•™`auto_trades`è¡¨ï¼ˆç”¨äºå…¼å®¹ï¼‰
  - æä¾›æ¸…æ™°çš„è¿ç§»è¯´æ˜
  - ä¿ç•™åŸè·¯ç”±é‡å®šå‘ï¼ˆå‘åå…¼å®¹ï¼‰

### 6.3 æ•°æ®é£é™©

- **é£é™©**ï¼šä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°å¤±è´¥ï¼Œå¯¼è‡´çŠ¶æ€ä¸å‡†ç¡®
- **å½±å“**ï¼šä¸­ï¼ˆæ•°æ®å‡†ç¡®æ€§ï¼‰
- **åº”å¯¹**ï¼š
  - æ·»åŠ é‡è¯•æœºåˆ¶
  - è®°å½•é”™è¯¯æ—¥å¿—
  - æä¾›æ‰‹åŠ¨æ›´æ–°åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

---

## 7. è¿­ä»£è®¡åˆ’

### 7.1 MVPèŒƒå›´ï¼ˆç¬¬ä¸€è¿­ä»£ï¼‰

1. âœ… åˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½
2. âœ… ç§»åŠ¨è®¢å•ç®¡ç†åˆ°é‡åŒ–æ¨¡å—
3. âœ… ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡
4. âœ… ä¿®å¤ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°

### 7.2 åç»­è¿­ä»£

- **V1.1**ï¼šä¼˜åŒ–ä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°æ€§èƒ½ï¼ˆæ‰¹é‡æ›´æ–°ï¼‰
- **V1.2**ï¼šæ·»åŠ ä¿¡å·æ—¥å¿—æ‰‹åŠ¨æ›´æ–°åŠŸèƒ½
- **V1.3**ï¼šæ·»åŠ è®¢å•ç»Ÿè®¡æŠ¥è¡¨ï¼ˆæŒ‰ç­–ç•¥ã€æŒ‰æ ‡çš„ç»Ÿè®¡ï¼‰

---

## 8. é™„å½•

### 8.1 ç›¸å…³æ–‡ä»¶æ¸…å•

**éœ€è¦åˆ é™¤çš„æ–‡ä»¶**ï¼š
- `frontend/app/quant/trades/page.tsx`
- `frontend/lib/api.ts`ä¸­çš„`quantApi.getTrades`æ–¹æ³•ï¼ˆå¯é€‰ï¼‰

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- `api/src/routes/quant.ts` - åˆ é™¤`GET /api/quant/trades`ï¼Œä¿®æ”¹`GET /api/quant/dashboard/stats`
- `api/src/services/basic-execution.service.ts` - æ·»åŠ ä¿¡å·çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œä¿®æ”¹`recordOrder`ã€`submitOrder`ã€`executeBuyIntent`ã€`executeSellIntent`æ–¹æ³•ï¼ˆå¦‚æœé‡‡ç”¨æ–¹æ¡ˆBï¼‰
- `api/src/services/strategy-scheduler.service.ts` - æ·»åŠ ä¿¡å·çŠ¶æ€æ›´æ–°é€»è¾‘ï¼ˆè®¢å•æˆäº¤ã€å–æ¶ˆã€æ‹’ç»æ—¶ï¼‰
- `api/src/services/strategies/strategy-base.ts` - ä¿®æ”¹`logSignal`æ–¹æ³•è¿”å›signal_idï¼ˆå¦‚æœé‡‡ç”¨æ–¹æ¡ˆBï¼‰
- `api/src/services/strategies/recommendation-strategy.ts` - ä¿®æ”¹`generateSignal`æ–¹æ³•ï¼Œå°†signal_idæ·»åŠ åˆ°intent.metadataï¼ˆå¦‚æœé‡‡ç”¨æ–¹æ¡ˆBï¼‰
- `frontend/app/quant/page.tsx` - ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡æ˜¾ç¤º
- `frontend/components/AppLayout.tsx` - æ›´æ–°å¯¼èˆªèœå•

**éœ€è¦æ–°å¢çš„æ–‡ä»¶**ï¼š
- `frontend/app/quant/orders/page.tsx` - ä»`frontend/app/orders/page.tsx`å¤åˆ¶

### 8.2 æ•°æ®åº“å˜æ›´

**å¯é€‰æ•°æ®åº“å˜æ›´**ï¼ˆå¦‚æœé‡‡ç”¨æ–¹æ¡ˆBï¼‰ï¼š
- æ·»åŠ `signal_id`å­—æ®µåˆ°`execution_orders`è¡¨ï¼š
  ```sql
  ALTER TABLE execution_orders 
  ADD COLUMN signal_id INTEGER REFERENCES strategy_signals(id) ON DELETE SET NULL;
  
  CREATE INDEX IF NOT EXISTS idx_execution_orders_signal_id ON execution_orders(signal_id);
  ```

**æ— éœ€æ•°æ®åº“å˜æ›´**ï¼ˆå¦‚æœé‡‡ç”¨æ–¹æ¡ˆAï¼‰ï¼š
- ä¿ç•™`auto_trades`è¡¨ï¼ˆç”¨äºå…¼å®¹ï¼‰
- ä¿ç•™`strategy_signals`è¡¨ï¼ˆä¿¡å·æ—¥å¿—ï¼‰
- ä¿ç•™`execution_orders`è¡¨ï¼ˆè®¢å•è¿½è¸ªï¼‰

### 8.3 APIå˜æ›´

**åˆ é™¤çš„API**ï¼š
- `GET /api/quant/trades` - åˆ é™¤

**ä¿®æ”¹çš„API**ï¼š
- `GET /api/quant/dashboard/stats` - ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡é€»è¾‘ï¼ˆä½¿ç”¨é•¿æ¡¥APIçš„`todayOrders`ï¼‰

**æ–°å¢çš„API**ï¼š
- æ— 

### 8.4 æ•°æ®æºå˜æ›´å½±å“åˆ†æ

**å—å½±å“çš„åŠŸèƒ½**ï¼š
1. âœ… **ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡** - å·²ä¿®æ”¹ä¸ºä½¿ç”¨é•¿æ¡¥API
2. âš ï¸ **ä»Šæ—¥ç›ˆäºè®¡ç®—** - å½“å‰ä»ä½¿ç”¨`auto_trades`è¡¨ï¼Œå¯ä»¥åç»­ä¼˜åŒ–
3. âš ï¸ **èµ„é‡‘ç®¡ç†æŒä»“æ£€æŸ¥** - `capital-manager.service.ts`ä»ä½¿ç”¨`auto_trades`è¡¨ï¼Œå¯ä»¥åç»­ä¼˜åŒ–
4. âœ… **äº¤æ˜“è®°å½•é¡µé¢** - å·²åˆ é™¤ï¼Œæ”¹ç”¨è®¢å•ç®¡ç†

**åç»­ä¼˜åŒ–å»ºè®®**ï¼š
- **ä»Šæ—¥ç›ˆäºè®¡ç®—ä¼˜åŒ–**ï¼š
  - å½“å‰ï¼šä½¿ç”¨`auto_trades`è¡¨è®¡ç®—ä»Šæ—¥å·²å¹³ä»“äº¤æ˜“ç›ˆäº
  - ä¼˜åŒ–æ–¹æ¡ˆï¼šä»è®¢å•ç®¡ç†æ•°æ®è®¡ç®—
    - è·å–ä»Šæ—¥æ‰€æœ‰å·²æˆäº¤è®¢å•ï¼ˆä¹°å…¥å’Œå–å‡ºï¼‰
    - åŒ¹é…ä¹°å…¥è®¢å•å’Œå–å‡ºè®¢å•ï¼ˆæŒ‰æ ‡çš„ã€ç­–ç•¥ï¼‰
    - è®¡ç®—ç›ˆäº = (å–å‡ºä»· - ä¹°å…¥ä»·) Ã— æ•°é‡ - æ‰‹ç»­è´¹
    - æŒä»“ç›ˆäºï¼šä»é•¿æ¡¥APIçš„`stockPositions`è·å–ï¼ˆå½“å‰å·²å®ç°ï¼‰
- **èµ„é‡‘ç®¡ç†æŒä»“æ£€æŸ¥ä¼˜åŒ–**ï¼š
  - å½“å‰ï¼šä½¿ç”¨`auto_trades`è¡¨æ£€æŸ¥æŒä»“
  - ä¼˜åŒ–æ–¹æ¡ˆï¼šä»é•¿æ¡¥APIçš„`stockPositions`è·å–æŒä»“æ•°æ®

### 8.5 ä¸ç°æœ‰æ–‡æ¡£çš„å…³è”

**å…³è”æ–‡æ¡£**ï¼š
- `QUANT_TRADING_BUGFIX_PRD.md` - é‡åŒ–äº¤æ˜“ç³»ç»Ÿé—®é¢˜ä¿®å¤PRD
  - è¯¥æ–‡æ¡£ä¸­çš„"ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡ä¿®å¤"åŠŸèƒ½ä¸æœ¬PRDçš„"ä¿®æ”¹ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡"åŠŸèƒ½é‡å 
  - æœ¬PRDé‡‡ç”¨æ›´å½»åº•çš„æ–¹æ¡ˆï¼šç›´æ¥ä½¿ç”¨è®¢å•ç®¡ç†æ•°æ®ï¼Œè€Œä¸æ˜¯`execution_orders`è¡¨
  - å»ºè®®ï¼šä»¥æœ¬PRDä¸ºå‡†ï¼Œæ›´æ–°`QUANT_TRADING_BUGFIX_PRD.md`ä¸­çš„ç›¸å…³éƒ¨åˆ†

**å†²çªè§£å†³**ï¼š
- `QUANT_TRADING_BUGFIX_PRD.md`ä¸­å»ºè®®ä½¿ç”¨`execution_orders`è¡¨ç»Ÿè®¡ä»Šæ—¥äº¤æ˜“æ•°é‡
- æœ¬PRDå»ºè®®ä½¿ç”¨é•¿æ¡¥APIçš„`todayOrders`ç»Ÿè®¡ï¼ˆæ›´å‡†ç¡®ï¼‰
- **å†³ç­–**ï¼šé‡‡ç”¨æœ¬PRDçš„æ–¹æ¡ˆï¼ˆä½¿ç”¨é•¿æ¡¥APIï¼‰

### 8.6 å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|----------|--------|
| v1.0 | 2025-12-10 | åˆå§‹ç‰ˆæœ¬ | AI Product Manager |
| v1.1 | 2025-12-10 | è¡¥å……ä¿¡å·å…³è”æ–¹å¼è¯´æ˜ã€æ•°æ®æºå˜æ›´å½±å“åˆ†æ | AI Product Manager |

---

## 9. å…³é”®é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 9.1 ä¿¡å·ä¸è®¢å•çš„å…³è”æ–¹å¼

**é—®é¢˜**ï¼š`execution_orders`è¡¨æ²¡æœ‰`signal_id`å­—æ®µï¼Œå¦‚ä½•å…³è”ä¿¡å·å’Œè®¢å•ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **æ–¹æ¡ˆAï¼ˆæ— éœ€æ•°æ®åº“å˜æ›´ï¼‰**ï¼šé€šè¿‡`strategy_id`ã€`symbol`ã€`side`ã€`created_at`æ—¶é—´çª—å£åŒ¹é…ï¼ˆ5åˆ†é’Ÿå†…ï¼‰
- **æ–¹æ¡ˆBï¼ˆæ¨èï¼‰**ï¼šåœ¨`execution_orders`è¡¨ä¸­æ·»åŠ `signal_id`å­—æ®µï¼Œä¿®æ”¹`logSignal`æ–¹æ³•è¿”å›signal_id

**æ¨èé‡‡ç”¨æ–¹æ¡ˆB**ï¼Œå› ä¸ºï¼š
- å…³è”æ›´å‡†ç¡®ï¼ˆä¸ä¾èµ–æ—¶é—´çª—å£ï¼‰
- æ€§èƒ½æ›´å¥½ï¼ˆç›´æ¥å…³è”ï¼Œæ— éœ€å¤æ‚æŸ¥è¯¢ï¼‰
- ä»£ç æ›´æ¸…æ™°ï¼ˆæ˜ç¡®çš„å…³è”å…³ç³»ï¼‰

### 9.2 ä»Šæ—¥ç›ˆäºè®¡ç®—çš„ä¿ç•™

**é—®é¢˜**ï¼šä»Šæ—¥ç›ˆäºè®¡ç®—ä»ä½¿ç”¨`auto_trades`è¡¨ï¼Œæ˜¯å¦ä¹Ÿéœ€è¦ä¿®æ”¹ï¼Ÿ

**å†³ç­–**ï¼š**æœ¬æ¬¡ä¸ä¿®æ”¹**ï¼ŒåŸå› ï¼š
- ä»Šæ—¥ç›ˆäºè®¡ç®—æ¶‰åŠå·²å¹³ä»“äº¤æ˜“ç›ˆäºå’ŒæŒä»“ç›ˆäº
- å·²å¹³ä»“äº¤æ˜“ç›ˆäºéœ€è¦è®¡ç®—ä¹°å…¥ä»·å’Œå–å‡ºä»·çš„å·®å€¼
- ä»è®¢å•æ•°æ®è®¡ç®—ç›ˆäºéœ€è¦åŒ¹é…ä¹°å…¥è®¢å•å’Œå–å‡ºè®¢å•ï¼Œé€»è¾‘å¤æ‚
- å¯ä»¥åç»­ä¼˜åŒ–ï¼Œä½†ä¸å½±å“æœ¬æ¬¡é‡æ„çš„æ ¸å¿ƒç›®æ ‡

**åç»­ä¼˜åŒ–å»ºè®®**ï¼š
- ä»è®¢å•ç®¡ç†æ•°æ®è®¡ç®—ä»Šæ—¥ç›ˆäºï¼š
  - ä¹°å…¥è®¢å•ï¼šè®°å½•ä¹°å…¥ä»·å’Œæ•°é‡
  - å–å‡ºè®¢å•ï¼šåŒ¹é…å¯¹åº”çš„ä¹°å…¥è®¢å•ï¼Œè®¡ç®—ç›ˆäº
  - æŒä»“ç›ˆäºï¼šä»é•¿æ¡¥APIçš„`stockPositions`è·å–

### 9.3 èµ„é‡‘ç®¡ç†ä¸­çš„æŒä»“æ£€æŸ¥

**é—®é¢˜**ï¼š`capital-manager.service.ts`ä¸­ä»ä½¿ç”¨`auto_trades`è¡¨æ£€æŸ¥æŒä»“ï¼Œæ˜¯å¦éœ€è¦ä¿®æ”¹ï¼Ÿ

**å†³ç­–**ï¼š**æœ¬æ¬¡ä¸ä¿®æ”¹**ï¼ŒåŸå› ï¼š
- èµ„é‡‘ç®¡ç†ä¸­çš„æŒä»“æ£€æŸ¥ç”¨äºè®¡ç®—èµ„é‡‘ä½¿ç”¨ç‡
- å½“å‰é€»è¾‘å¯ä»¥æ­£å¸¸å·¥ä½œï¼ˆè™½ç„¶æ•°æ®æºä¸ç»Ÿä¸€ï¼‰
- å¯ä»¥åç»­ä¼˜åŒ–ï¼Œä½†ä¸å½±å“æœ¬æ¬¡é‡æ„çš„æ ¸å¿ƒç›®æ ‡

**åç»­ä¼˜åŒ–å»ºè®®**ï¼š
- æ”¹ä¸ºä½¿ç”¨é•¿æ¡¥APIçš„`stockPositions`è·å–æŒä»“
- æˆ–è€…ä»è®¢å•ç®¡ç†æ•°æ®è®¡ç®—æŒä»“ï¼ˆä¹°å…¥è®¢å• - å–å‡ºè®¢å•ï¼‰

### 9.4 ä¸QUANT_TRADING_BUGFIX_PRD.mdçš„å†²çª

**å†²çªç‚¹**ï¼š
- `QUANT_TRADING_BUGFIX_PRD.md`ä¸­å»ºè®®ä½¿ç”¨`execution_orders`è¡¨ç»Ÿè®¡ä»Šæ—¥äº¤æ˜“æ•°é‡
- æœ¬PRDå»ºè®®ä½¿ç”¨é•¿æ¡¥APIçš„`todayOrders`ç»Ÿè®¡

**å†³ç­–**ï¼š**é‡‡ç”¨æœ¬PRDçš„æ–¹æ¡ˆ**ï¼ˆä½¿ç”¨é•¿æ¡¥APIï¼‰ï¼ŒåŸå› ï¼š
- é•¿æ¡¥APIçš„æ•°æ®æ˜¯çœŸå®æœ‰æ•ˆçš„ï¼Œä¸è®¢å•ç®¡ç†æ•°æ®æºä¸€è‡´
- `execution_orders`è¡¨å¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜
- ç»Ÿä¸€æ•°æ®æºï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬

**å»ºè®®**ï¼šæ›´æ–°`QUANT_TRADING_BUGFIX_PRD.md`ä¸­çš„ç›¸å…³éƒ¨åˆ†ï¼Œæ ‡æ³¨å·²ç”±æœ¬PRDè¦†ç›–ã€‚

---

## 10. éªŒæ”¶æµ‹è¯•ç”¨ä¾‹

### 9.1 åŠŸèƒ½æµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹1ï¼šåˆ é™¤äº¤æ˜“è®°å½•åŠŸèƒ½**
- [ ] `/quant/trades`é¡µé¢è¿”å›404æˆ–é‡å®šå‘
- [ ] `GET /api/quant/trades` APIè¿”å›404
- [ ] å¯¼èˆªèœå•ä¸­"äº¤æ˜“è®°å½•"å…¥å£å·²åˆ é™¤

**æµ‹è¯•ç”¨ä¾‹2ï¼šè®¢å•ç®¡ç†ç§»åŠ¨**
- [ ] `/quant/orders`é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] ä»Šæ—¥è®¢å•å’Œå†å²è®¢å•åŠŸèƒ½æ­£å¸¸
- [ ] åŸ`/orders`è·¯ç”±é‡å®šå‘åˆ°`/quant/orders`

**æµ‹è¯•ç”¨ä¾‹3ï¼šä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡**
- [ ] ä»Šæ—¥äº¤æ˜“æ•°é‡ä¸å®é™…è®¢å•ä¸€è‡´
- [ ] ä¹°å…¥å’Œå–å‡ºæ•°é‡ç»Ÿè®¡æ­£ç¡®
- [ ] Tooltipæ­£ç¡®æ˜¾ç¤ºä¹°å…¥/å–å‡ºæ•°é‡

**æµ‹è¯•ç”¨ä¾‹4ï¼šä¿¡å·æ—¥å¿—çŠ¶æ€æ›´æ–°**
- [ ] è®¢å•æäº¤æ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`EXECUTED`
- [ ] è®¢å•æˆäº¤æ—¶ä¿¡å·çŠ¶æ€ç¡®è®¤ä¸º`EXECUTED`
- [ ] è®¢å•è¢«æ‹’ç»æ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`REJECTED`
- [ ] è®¢å•è¢«å–æ¶ˆæ—¶ä¿¡å·çŠ¶æ€æ›´æ–°ä¸º`IGNORED`

### 9.2 æ€§èƒ½æµ‹è¯•

- [ ] ä»Šæ—¥äº¤æ˜“æ•°é‡ç»Ÿè®¡å“åº”æ—¶é—´ â‰¤ 2ç§’
- [ ] APIé™æµæ—¶ä¼˜é›…é™çº§ï¼ˆè¿”å›ç¼“å­˜æ•°æ®ï¼‰

### 9.3 å…¼å®¹æ€§æµ‹è¯•

- [ ] åŸ`/orders`è·¯ç”±é‡å®šå‘æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯æ˜¾ç¤ºæ­£å¸¸

---

**æ–‡æ¡£ç»“æŸ**

