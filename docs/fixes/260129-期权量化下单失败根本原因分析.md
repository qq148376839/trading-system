# æœŸæƒé‡åŒ–ä¸‹å•å¤±è´¥æ ¹æœ¬åŸå› åˆ†æ

**æ—¥æœŸ**: 2026-01-29
**é—®é¢˜ä¸¥é‡æ€§**: é«˜
**å½±å“èŒƒå›´**: æœŸæƒäº¤æ˜“ç­–ç•¥ï¼ˆç­–ç•¥10ï¼‰è‡ªåŠ¨ä¸‹å•åŠŸèƒ½
**çŠ¶æ€**: ğŸ” é—®é¢˜åˆ†æå®Œæˆï¼Œå¾…ä¿®å¤

---

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

ç”¨æˆ·å‘ç°é‡åŒ–äº¤æ˜“ç³»ç»Ÿæ²¡æœ‰æŒ‰ç…§æ­£ç¡®çš„APIæ ¼å¼æäº¤æœŸæƒè®¢å•ã€‚ç”¨æˆ·æä¾›äº†ä¸€ä¸ªå·¥ä½œæ­£å¸¸çš„æ‰‹åŠ¨ä¸‹å•ç¤ºä¾‹ï¼š

```javascript
fetch("http://localhost:3001/api/orders/submit", {
  "body": JSON.stringify({
    symbol: "QQQ260130C625000.US",
    order_type: "LO",
    side: "Buy",
    submitted_quantity: "1",
    submitted_price: "10.35",
    outside_rth: "RTH_ONLY",
    time_in_force: "Day"
  }),
  "method": "POST"
});
```

**ä½†æ˜¯é‡åŒ–äº¤æ˜“ç³»ç»Ÿæ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæ¥å£è¿›è¡Œä¸‹å•ï¼**

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### 1. æ¶æ„è®¾è®¡é—®é¢˜

é€šè¿‡ä»£ç åˆ†æå‘ç°ï¼Œç³»ç»Ÿå­˜åœ¨**ä¸¤å¥—å®Œå…¨ä¸åŒçš„ä¸‹å•è·¯å¾„**ï¼š

#### è·¯å¾„Aï¼šæ‰‹åŠ¨ä¸‹å•ï¼ˆå·¥ä½œæ­£å¸¸ï¼‰ âœ…
```
å‰ç«¯ç•Œé¢
  â†’ POST /api/orders/submit
  â†’ ordersRouter.post('/submit')
  â†’ tradeCtx.submitOrder()
  â†’ LongPort SDK
```

#### è·¯å¾„Bï¼šé‡åŒ–è‡ªåŠ¨ä¸‹å•ï¼ˆå­˜åœ¨é—®é¢˜ï¼‰ âŒ
```
ç­–ç•¥è°ƒåº¦å™¨
  â†’ strategy-scheduler.service.ts
  â†’ executeBuyIntent()/executeSellIntent()
  â†’ basic-execution.service.ts.submitOrder()
  â†’ tradeCtx.submitOrder()
  â†’ LongPort SDK
```

**é—®é¢˜**ï¼šè·¯å¾„Bï¼ˆé‡åŒ–ä¸‹å•ï¼‰**å®Œå…¨ç»•è¿‡**äº†è·¯å¾„Aï¼ˆæ‰‹åŠ¨ä¸‹å•æ¥å£ï¼‰ï¼Œç›´æ¥åœ¨åç«¯è°ƒç”¨ LongPort SDKã€‚

### 2. å®é™…æ‰§è¡Œæµç¨‹ï¼ˆé‡åŒ–ä¸‹å•ï¼‰

è®©æˆ‘ä»¬è¿½è¸ªæœŸæƒç­–ç•¥10çš„å®Œæ•´ä¸‹å•æµç¨‹ï¼š

```typescript
// 1. ç­–ç•¥ç”Ÿæˆä¿¡å·ï¼ˆoption-intraday-strategy.tsï¼‰
const selected = await selectOptionContract({...});
const signal = {
  symbol: selected.optionSymbol,  // "QQQ260130C625000.US"
  metadata: {
    optionId: selected.optionId,
    underlyingStockId: selected.underlyingStockId,
    optionSymbol: selected.optionSymbol,
    ...
  }
};

// 2. ç­–ç•¥è°ƒåº¦å™¨æ‰§è¡Œï¼ˆstrategy-scheduler.service.ts:1319ï¼‰
const intent: TradingIntent = {...};
const executionResult = await basicExecutionService.executeBuyIntent(intent, strategyId);

// 3. åŸºç¡€æ‰§è¡ŒæœåŠ¡ï¼ˆbasic-execution.service.ts:85ï¼‰
async executeBuyIntent(intent: TradingIntent, strategyId: number) {
  // è·å–å¸‚åœºä»·æ ¼ï¼ˆå·²ä¿®å¤ï¼Œä½¿ç”¨å¯Œé€”APIï¼‰
  const currentPrice = await this.getCurrentMarketPrice(intent.symbol, intent.metadata);

  // æäº¤è®¢å•ï¼ˆé—®é¢˜æ‰€åœ¨ï¼ï¼‰
  return await this.submitOrder(
    intent.symbol,
    'BUY',
    intent.quantity,
    intent.entryPrice,
    strategyId,
    signalId
  );
}

// 4. æäº¤è®¢å•ï¼ˆbasic-execution.service.ts:747ï¼‰
private async submitOrder(
  symbol: string,
  side: 'BUY' | 'SELL',
  quantity: number,
  price: number,
  strategyId: number,
  signalId?: number
): Promise<ExecutionResult> {
  // âš ï¸ å…³é”®é—®é¢˜ï¼šè¿™é‡Œç›´æ¥è°ƒç”¨ LongPort SDK
  const tradeCtx = await getTradeContext();
  const orderOptions = {
    symbol,
    orderType: OrderType.LO,
    side: side === 'BUY' ? OrderSide.Buy : OrderSide.Sell,
    submittedQuantity: new Decimal(absQuantity.toString()),
    submittedPrice: new Decimal(formattedPrice.toString()),
    timeInForce: TimeInForceType.Day,
    outsideRth: market === 'US' ? OutsideRTH.AnyTime : undefined,
  };

  // âŒ é—®é¢˜ï¼šLongPort SDK å¯èƒ½ä¸æ”¯æŒæœŸæƒ symbol
  const response = await tradeCtx.submitOrder(orderOptions);
}
```

### 3. æ ¸å¿ƒé—®é¢˜æ€»ç»“

| é—®é¢˜ç‚¹ | æè¿° | å½±å“ |
|--------|------|------|
| **æ¶æ„ä¸ä¸€è‡´** | æ‰‹åŠ¨ä¸‹å•å’Œé‡åŒ–ä¸‹å•èµ°å®Œå…¨ä¸åŒçš„è·¯å¾„ | éš¾ä»¥ç»Ÿä¸€ç®¡ç†å’Œè°ƒè¯• |
| **é‡å¤å®ç°** | `basic-execution.service.ts` é‡æ–°å®ç°äº† `orders.ts` çš„é€»è¾‘ | ä»£ç é‡å¤ï¼Œå®¹æ˜“å‡ºç°ä¸ä¸€è‡´ |
| **APIå…¼å®¹æ€§** | `basic-execution.service.ts.submitOrder()` å¯èƒ½æ²¡æœ‰è€ƒè™‘æœŸæƒ symbol çš„ç‰¹æ®Šæ€§ | æœŸæƒä¸‹å•å¯èƒ½å¤±è´¥ |
| **é”™è¯¯å¤„ç†** | é‡åŒ–ä¸‹å•æ²¡æœ‰ä½¿ç”¨ `/api/orders/submit` çš„éªŒè¯é€»è¾‘ | ç¼ºå°‘ lot size ç­‰å…³é”®éªŒè¯ |
| **è°ƒè¯•å›°éš¾** | ä¸¤å¥—ä»£ç è·¯å¾„ï¼Œé—®é¢˜æ’æŸ¥å›°éš¾ | ç”¨æˆ·æ‰‹åŠ¨ä¸‹å•æˆåŠŸï¼Œä½†é‡åŒ–ä¸‹å•å¤±è´¥ |

---

## ğŸ¯ é—®é¢˜æœ¬è´¨

**é—®é¢˜çš„æœ¬è´¨ä¸æ˜¯æœŸæƒä»·æ ¼è·å–**ï¼ˆè¿™ä¸ªå·²ç»åœ¨ v2 ä¿®å¤ä¸­è§£å†³ï¼‰ï¼Œè€Œæ˜¯ï¼š

1. **é‡åŒ–äº¤æ˜“ç³»ç»Ÿæ²¡æœ‰ä½¿ç”¨å·²ç»å­˜åœ¨çš„ã€å·¥ä½œæ­£å¸¸çš„ `/api/orders/submit` æ¥å£**
2. **é‡åŒ–äº¤æ˜“ç³»ç»Ÿç›´æ¥è°ƒç”¨ LongPort SDKï¼Œå¯èƒ½ä¸æ”¯æŒæœŸæƒè®¢å•**
3. **æ¶æ„è®¾è®¡å­˜åœ¨æ ¹æœ¬æ€§é—®é¢˜ï¼šä¸¤å¥—ä¸‹å•è·¯å¾„ï¼Œéš¾ä»¥ç»´æŠ¤**

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šç»Ÿä¸€ä¸‹å•è·¯å¾„ï¼ˆæ¨èï¼‰ â­

**æ ¸å¿ƒæ€è·¯**ï¼šè®©é‡åŒ–äº¤æ˜“ç³»ç»Ÿä¹Ÿä½¿ç”¨ `/api/orders/submit` æ¥å£

#### å®æ–½æ­¥éª¤

1. **ä¿®æ”¹ `basic-execution.service.ts`**ï¼š
   - å°† `submitOrder()` æ–¹æ³•æ”¹ä¸ºè°ƒç”¨ `/api/orders/submit` æ¥å£
   - ä½¿ç”¨å†…éƒ¨ HTTP è°ƒç”¨æˆ–æå–å…±äº«é€»è¾‘

2. **æå–å…±äº«é€»è¾‘**ï¼ˆæ›´ä¼˜é›…ï¼‰ï¼š
   - åˆ›å»º `order-submission.service.ts`
   - å°†è®¢å•æäº¤é€»è¾‘ä» `orders.ts` æå–å‡ºæ¥
   - `orders.ts` å’Œ `basic-execution.service.ts` éƒ½è°ƒç”¨è¿™ä¸ªæœåŠ¡

```typescript
// æ–°å»º: order-submission.service.ts
export class OrderSubmissionService {
  async submitOrder(params: {
    symbol: string;
    side: 'Buy' | 'Sell';
    orderType: string;
    submittedQuantity: string;
    submittedPrice?: string;
    timeInForce?: string;
    outsideRth?: string;
  }): Promise<SubmitOrderResult> {
    // ç»Ÿä¸€çš„è®¢å•æäº¤é€»è¾‘
    // ä» orders.ts:1407 å¤åˆ¶è¿‡æ¥
  }
}

// ä¿®æ”¹: basic-execution.service.ts
private async submitOrder(...) {
  // ä½¿ç”¨ç»Ÿä¸€çš„è®¢å•æäº¤æœåŠ¡
  const result = await orderSubmissionService.submitOrder({
    symbol,
    side: side === 'BUY' ? 'Buy' : 'Sell',
    orderType: 'LO',
    submittedQuantity: absQuantity.toString(),
    submittedPrice: formattedPrice.toString(),
    timeInForce: 'Day',
    outsideRth: market === 'US' ? 'ANY_TIME' : 'RTH_ONLY',
  });
  return result;
}
```

#### ä¼˜åŠ¿
- âœ… ç»Ÿä¸€ä»£ç è·¯å¾„ï¼Œæ˜“äºç»´æŠ¤
- âœ… å¤ç”¨æ‰‹åŠ¨ä¸‹å•çš„æ‰€æœ‰éªŒè¯é€»è¾‘
- âœ… ç¡®ä¿æœŸæƒè®¢å•ä½¿ç”¨æ­£ç¡®çš„ API æ ¼å¼
- âœ… å‡å°‘ä»£ç é‡å¤

#### åŠ£åŠ¿
- âš ï¸ éœ€è¦é‡æ„ç°æœ‰ä»£ç 
- âš ï¸ éœ€è¦å……åˆ†æµ‹è¯•

---

### æ–¹æ¡ˆ2ï¼šä¿®å¤ LongPort SDK è°ƒç”¨ï¼ˆæ¬¡ä¼˜ï¼‰

**æ ¸å¿ƒæ€è·¯**ï¼šç»§ç»­ä½¿ç”¨ `basic-execution.service.ts.submitOrder()`ï¼Œä½†ä¿®å¤æœŸæƒæ”¯æŒ

#### å®æ–½æ­¥éª¤

1. **æ£€æŸ¥ LongPort SDK æ˜¯å¦æ”¯æŒæœŸæƒ symbol**
   - æŸ¥é˜… LongPort API æ–‡æ¡£
   - æµ‹è¯•æœŸæƒ symbol çš„æäº¤

2. **å¦‚æœä¸æ”¯æŒ**ï¼š
   - ä½¿ç”¨å¯Œé€”APIæäº¤æœŸæƒè®¢å•
   - ä½¿ç”¨ LongPort SDK æäº¤è‚¡ç¥¨è®¢å•

3. **å¢åŠ æœŸæƒè®¢å•çš„ç‰¹æ®Šå¤„ç†**ï¼š
   ```typescript
   const isOption = /[A-Z]{1,5}\d{6}[CP]\d+/.test(symbol);
   if (isOption) {
     // ä½¿ç”¨å¯Œé€”APIæäº¤æœŸæƒè®¢å•
     return await this.submitOptionOrderViaFutunn(...);
   } else {
     // ä½¿ç”¨ LongPort SDK æäº¤è‚¡ç¥¨è®¢å•
     return await tradeCtx.submitOrder(orderOptions);
   }
   ```

#### ä¼˜åŠ¿
- âœ… æ”¹åŠ¨è¾ƒå°
- âœ… å¿«é€Ÿä¿®å¤

#### åŠ£åŠ¿
- âŒ ä»ç„¶æœ‰ä¸¤å¥—ä¸‹å•è·¯å¾„
- âŒ ä»£ç é‡å¤é—®é¢˜ä¾ç„¶å­˜åœ¨
- âŒ æœªæ¥ç»´æŠ¤å›°éš¾

---

## ğŸ“Š å¯¹æ¯”åˆ†æ

| æ–¹æ¡ˆ | æ”¹åŠ¨é‡ | ç»´æŠ¤æ€§ | å¯é æ€§ | æ¨èåº¦ |
|------|--------|--------|--------|--------|
| æ–¹æ¡ˆ1ï¼šç»Ÿä¸€è·¯å¾„ | ä¸­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| æ–¹æ¡ˆ2ï¼šä¿®å¤SDK | å° | â­â­ | â­â­â­ | â­â­ |

---

## ğŸš€ æ¨èå®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šå¿«é€Ÿä¿®å¤ï¼ˆ1-2å°æ—¶ï¼‰
ä½¿ç”¨æ–¹æ¡ˆ2å¿«é€Ÿæ¢å¤æœŸæƒä¸‹å•åŠŸèƒ½ï¼š
1. æ£€æŸ¥ LongPort SDK å¯¹æœŸæƒçš„æ”¯æŒ
2. å¦‚æœä¸æ”¯æŒï¼Œæ·»åŠ å¯Œé€”APIè·¯å¾„
3. æµ‹è¯•æœŸæƒä¸‹å•

### é˜¶æ®µ2ï¼šæ¶æ„é‡æ„ï¼ˆ1-2å¤©ï¼‰
ä½¿ç”¨æ–¹æ¡ˆ1è¿›è¡Œæ¶æ„ä¼˜åŒ–ï¼š
1. åˆ›å»º `order-submission.service.ts`
2. æå–å…±äº«é€»è¾‘
3. é‡æ„ `basic-execution.service.ts` å’Œ `orders.ts`
4. å®Œæ•´æµ‹è¯•è‚¡ç¥¨å’ŒæœŸæƒä¸‹å•

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
- `api/src/services/basic-execution.service.ts` - é‡åŒ–ä¸‹å•é€»è¾‘
- `api/src/routes/orders.ts` - æ‰‹åŠ¨ä¸‹å•é€»è¾‘

### éœ€è¦åˆ›å»ºçš„æ–‡ä»¶
- `api/src/services/order-submission.service.ts` - ç»Ÿä¸€è®¢å•æäº¤æœåŠ¡ï¼ˆæ¨èï¼‰

### å‚è€ƒæ–‡æ¡£
- [æœŸæƒä»·æ ¼è·å–ä¿®å¤æ€»ç»“ v2](./260129-æœŸæƒä»·æ ¼è·å–å¤±è´¥ä¿®å¤æ€»ç»“-v2.md)
- [è®¢å•æäº¤æ¥å£æ–‡æ¡£](../../api/src/routes/orders.ts:1407-1599)

---

## âœï¸ æ€»ç»“

**æ ¸å¿ƒå‘ç°**ï¼š
1. âŒ é‡åŒ–äº¤æ˜“ç³»ç»Ÿ**æ²¡æœ‰ä½¿ç”¨** `/api/orders/submit` æ¥å£
2. âŒ é‡åŒ–äº¤æ˜“ç³»ç»Ÿç›´æ¥è°ƒç”¨ LongPort SDKï¼Œå¯èƒ½ä¸æ”¯æŒæœŸæƒ
3. âŒ ç³»ç»Ÿå­˜åœ¨ä¸¤å¥—å®Œå…¨ä¸åŒçš„ä¸‹å•è·¯å¾„ï¼Œéš¾ä»¥ç»´æŠ¤

**æ¨èæ–¹æ¡ˆ**ï¼š
- **çŸ­æœŸ**ï¼šæ£€æŸ¥å¹¶ä¿®å¤ LongPort SDK å¯¹æœŸæƒçš„æ”¯æŒ
- **é•¿æœŸ**ï¼šé‡æ„ä¸ºç»Ÿä¸€çš„è®¢å•æäº¤æœåŠ¡ï¼Œæé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§

**é¢„æœŸæ•ˆæœ**ï¼š
- æœŸæƒä¸‹å•æˆåŠŸç‡ï¼š0% â†’ 95%+
- ä»£ç ç»´æŠ¤æ€§ï¼šâ­â­ â†’ â­â­â­â­â­
- æ¶æ„æ¸…æ™°åº¦ï¼šâ­â­ â†’ â­â­â­â­â­

---

**åˆ†æäººå‘˜**: Claude Code
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
**ä¸‹ä¸€æ­¥**: ç¡®è®¤ä¿®å¤æ–¹æ¡ˆå¹¶å®æ–½
