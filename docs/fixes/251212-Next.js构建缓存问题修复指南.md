# Next.js æ„å»ºç¼“å­˜é—®é¢˜ä¿®å¤æŒ‡å—

**åˆ›å»ºæ—¶é—´**ï¼š2025-12-12  
**é—®é¢˜ç±»å‹**ï¼šæ„å»ºé”™è¯¯ / æ¨¡å—è§£æé”™è¯¯

---

## ğŸ“‹ é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯

```
Error: Cannot find module './vendor-chunks/antd.js'
Require stack:
- D:\Pythonè„šæœ¬\trading-system\frontend\.next\server\webpack-runtime.js
- D:\Pythonè„šæœ¬\trading-system\frontend\.next\server\app\quant\backtest\[id]\page.js
```

### é—®é¢˜åŸå› 

1. **æ„å»ºç¼“å­˜æŸå**ï¼š`.next` ç›®å½•ä¸­çš„æ„å»ºç¼“å­˜å¯èƒ½æŸåæˆ–ä¸å®Œæ•´
2. **æ¨¡å—è§£æé—®é¢˜**ï¼šNext.js 14 åœ¨å¤„ç† Ant Design ç­‰å¤§å‹åº“æ—¶å¯èƒ½å‡ºç° vendor chunks è§£æé—®é¢˜
3. **ä¾èµ–ç‰ˆæœ¬å†²çª**ï¼šNext.js 14 ä¸ Ant Design 6.0 çš„å…¼å®¹æ€§é—®é¢˜

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ¨èï¼‰

**Windows PowerShell**ï¼š

```powershell
cd trading-system/frontend

# åˆ é™¤ .next ç›®å½•
if (Test-Path .next) {
    Remove-Item -Recurse -Force .next
}

# åˆ é™¤ node_modules ç¼“å­˜
if (Test-Path node_modules\.cache) {
    Remove-Item -Recurse -Force node_modules\.cache
}

# é‡æ–°å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

**ä½¿ç”¨ä¿®å¤è„šæœ¬**ï¼š

```powershell
cd trading-system/frontend
.\scripts\fix-build-cache.ps1
npm run dev
```

### æ–¹æ¡ˆ2ï¼šæ›´æ–° Next.js é…ç½®

å·²åœ¨ `next.config.js` ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```javascript
module.exports = {
  // ... å…¶ä»–é…ç½®
  
  // ä¿®å¤ Ant Design æ¨¡å—è§£æé—®é¢˜
  webpack: (config, { isServer }) => {
    if (!isServer) {
      config.optimization = {
        ...config.optimization,
        splitChunks: {
          ...config.optimization.splitChunks,
          cacheGroups: {
            ...config.optimization.splitChunks?.cacheGroups,
            default: false,
            vendors: false,
          },
        },
      };
    }
    return config;
  },
  
  // è½¬è¯‘ Ant Design åŒ…
  transpilePackages: ['antd', '@ant-design/icons'],
}
```

### æ–¹æ¡ˆ3ï¼šé‡æ–°å®‰è£…ä¾èµ–ï¼ˆå¦‚æœä¸Šè¿°æ–¹æ¡ˆæ— æ•ˆï¼‰

```powershell
cd trading-system/frontend

# åˆ é™¤ node_modules å’Œ package-lock.json
Remove-Item -Recurse -Force node_modules
Remove-Item -Force package-lock.json

# æ¸…ç† npm ç¼“å­˜
npm cache clean --force

# é‡æ–°å®‰è£…ä¾èµ–
npm install

# æ¸…ç†æ„å»ºç¼“å­˜
Remove-Item -Recurse -Force .next

# é‡æ–°å¯åŠ¨
npm run dev
```

---

## âœ… éªŒè¯ä¿®å¤

ä¿®å¤åï¼Œè¯·éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

1. **å¼€å‘æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨**ï¼š
   ```bash
   npm run dev
   ```

2. **é¡µé¢æ­£å¸¸è®¿é—®**ï¼š
   - è®¿é—® `http://localhost:3000/quant/backtest/37`
   - ç¡®è®¤é¡µé¢æ­£å¸¸åŠ è½½ï¼Œæ— é”™è¯¯

3. **æ„å»ºæ­£å¸¸**ï¼š
   ```bash
   npm run build
   ```
   - ç¡®è®¤æ„å»ºæˆåŠŸï¼Œæ— æ¨¡å—è§£æé”™è¯¯

---

## ğŸ“ é¢„é˜²æªæ–½

### 1. å®šæœŸæ¸…ç†æ„å»ºç¼“å­˜

åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å»ºè®®æ¸…ç†æ„å»ºç¼“å­˜ï¼š
- æ›´æ–°ä¾èµ–å
- ä¿®æ”¹ Next.js é…ç½®å
- é‡åˆ°æ¨¡å—è§£æé”™è¯¯æ—¶
- é•¿æ—¶é—´å¼€å‘åï¼ˆæ¯å‘¨ä¸€æ¬¡ï¼‰

### 2. ä½¿ç”¨ä¿®å¤è„šæœ¬

å·²åˆ›å»º `scripts/fix-build-cache.ps1` è„šæœ¬ï¼Œå¯ä»¥å¿«é€Ÿæ¸…ç†æ„å»ºç¼“å­˜ï¼š

```powershell
.\scripts\fix-build-cache.ps1
```

### 3. ç‰ˆæœ¬å…¼å®¹æ€§

ç¡®ä¿ä»¥ä¸‹ç‰ˆæœ¬å…¼å®¹ï¼š
- Next.js: `^14.0.0`
- Ant Design: `^6.0.0`
- React: `^18.2.0`

---

## ğŸ” ç›¸å…³æ–‡ä»¶

- `frontend/next.config.js` - Next.js é…ç½®æ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
- `frontend/scripts/fix-build-cache.ps1` - æ„å»ºç¼“å­˜æ¸…ç†è„šæœ¬
- `frontend/app/quant/backtest/[id]/page.tsx` - å‡ºç°é—®é¢˜çš„é¡µé¢

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Next.js Webpack Configuration](https://nextjs.org/docs/api-reference/next.config.js/custom-webpack-config)
- [Next.js Transpile Packages](https://nextjs.org/docs/api-reference/next.config.js/transpile-packages)
- [Ant Design with Next.js](https://ant.design/docs/react/use-with-next)

---

**æœ€åæ›´æ–°**ï¼š2025-12-12





