# æœŸæƒç­–ç•¥å®Œæ•´è¯Šæ–­ä¸ä¿®å¤æ–¹æ¡ˆ

**æ—¥æœŸ**: 2026-01-28
**ä½œè€…**: Claude Code
**çŠ¶æ€**: âœ… è¯Šæ–­å®Œæˆï¼Œå¾…å®æ–½ä¿®å¤

---

## ğŸ“‹ ç›®å½•

1. [ç°çŠ¶åˆ†æ](#ç°çŠ¶åˆ†æ)
2. [å‘ç°çš„10ä¸ªå…³é”®é—®é¢˜](#å‘ç°çš„10ä¸ªå…³é”®é—®é¢˜)
3. [æ–°å¢éœ€æ±‚ï¼šæœŸæƒè¯¦æƒ…æ¥å£é›†æˆ](#æ–°å¢éœ€æ±‚æœŸæƒè¯¦æƒ…æ¥å£é›†æˆ)
4. [å®Œæ•´ä¿®å¤æ–¹æ¡ˆ](#å®Œæ•´ä¿®å¤æ–¹æ¡ˆ)
5. [å®æ–½æ­¥éª¤](#å®æ–½æ­¥éª¤)
6. [æµ‹è¯•è®¡åˆ’](#æµ‹è¯•è®¡åˆ’)
7. [é…ç½®ç¤ºä¾‹](#é…ç½®ç¤ºä¾‹)

---

## ç°çŠ¶åˆ†æ

### å·²å®ç°çš„åŠŸèƒ½

å½“å‰ç³»ç»Ÿå·²ç»å®ç°äº†å®Œæ•´çš„æœŸæƒæ—¥å†…ç­–ç•¥æ¡†æ¶ï¼š

#### æ ¸å¿ƒæœåŠ¡æ¨¡å—ï¼ˆ9ä¸ªæ–‡ä»¶ï¼‰
```
api/src/services/
â”œâ”€â”€ options-fee.service.ts              # æœŸæƒè´¹ç”¨è®¡ç®—ï¼ˆä½£é‡‘+å¹³å°è´¹ï¼‰
â”œâ”€â”€ options-contract-selector.service.ts # æ™ºèƒ½åˆçº¦é€‰æ‹©ï¼ˆ0DTE/NEARESTï¼‰
â”œâ”€â”€ strategies/option-intraday-strategy.ts # æœŸæƒæ—¥å†…ç­–ç•¥å®ç°
â”œâ”€â”€ market-session.service.ts           # å¸‚åœºæ—¶æ®µç®¡ç†ï¼ˆæ”¶ç›˜å‰æ§åˆ¶ï¼‰
â”œâ”€â”€ futunn-option-chain.service.ts      # å¯Œé€”æœŸæƒé“¾API
â”œâ”€â”€ futunn-option-quote.service.ts      # å¯Œé€”æœŸæƒè¡Œæƒ…API
â””â”€â”€ strategy-scheduler.service.ts       # ç­–ç•¥è°ƒåº¦å™¨ï¼ˆæ ¸å¿ƒï¼‰

api/src/utils/
â”œâ”€â”€ options-symbol.ts                   # æœŸæƒç¬¦å·è§„èŒƒåŒ–
â””â”€â”€ longport-rate-limiter.ts            # APIé™æµ+é‡è¯•
```

#### åŠŸèƒ½ç‰¹æ€§
âœ… **åˆçº¦é€‰æ‹©**ï¼š
- æ”¯æŒ 0DTEï¼ˆå½“æ—¥åˆ°æœŸï¼‰å’Œ NEARESTï¼ˆæœ€è¿‘åˆ°æœŸï¼‰æ¨¡å¼
- æ”¯æŒæµåŠ¨æ€§è¿‡æ»¤ï¼ˆæŒä»“é‡ã€ä¹°å–ä»·å·®ï¼‰
- æ”¯æŒ Greeks è¿‡æ»¤ï¼ˆDeltaã€Thetaï¼‰
- ATM é™„è¿‘å€™é€‰è¡Œæƒä»·æ™ºèƒ½é€‰æ‹©

âœ… **é£é™©æ§åˆ¶**ï¼š
- æ”¶ç›˜å‰ N åˆ†é’Ÿï¼ˆé»˜è®¤60åˆ†é’Ÿï¼‰ç¦æ­¢å¼€ä»“
- æ”¶ç›˜å‰ 30 åˆ†é’Ÿå¼ºåˆ¶å¹³ä»“ï¼ˆé¿å…æ—¶é—´ä»·å€¼æŸå¤±ï¼‰
- èµ„é‡‘åˆ†é…ç‹¬ç«‹è®¡ç®—ï¼ˆpremium Ã— multiplier Ã— contracts + feesï¼‰

âœ… **è´¹ç”¨è®¡ç®—**ï¼š
- ä½£é‡‘ï¼š0.10 USD/åˆçº¦ï¼Œæœ€ä½ 0.99 USD/å•
- å¹³å°è´¹ï¼š0.30 USD/åˆçº¦
- æ€»æˆæœ¬ = æƒåˆ©é‡‘Ã—ä¹˜æ•°Ã—åˆçº¦æ•° + æ‰‹ç»­è´¹

âœ… **æŒä»“ç›‘æ§**ï¼š
- æœŸæƒå‰ç¼€åŒ¹é…è¯†åˆ«æŒä»“
- ä»å¯Œé€”è¯¦æƒ…æ¥å£è·å–å®æ—¶ bid/ask/mid
- è®¢å•çŠ¶æ€åŒæ­¥åˆ°æ•°æ®åº“

---

## å‘ç°çš„10ä¸ªå…³é”®é—®é¢˜

### ğŸ”´ Criticalï¼ˆå¿…é¡»ä¿®å¤ï¼‰

#### é—®é¢˜1ï¼šèµ„é‡‘é‡Šæ”¾é€»è¾‘çš„ multiplier ä¾èµ–ä¸ç¨³å®š
**ä½ç½®**: `strategy-scheduler.service.ts:694-711`

**é—®é¢˜æè¿°**ï¼š
```typescript
// å½“å‰ä»£ç 
const multiplier = parseInt(String(ctx?.optionMeta?.multiplier || 100)) || 100;
if (ctx.allocationAmount) {
  releaseAmount = parseFloat(ctx.allocationAmount.toString());
} else if (ctx.entryPrice && ctx.quantity) {
  // Fallback: é‡æ–°è®¡ç®—
  releaseAmount = entryPrice * quantity * multiplier;
}
```

**é£é™©**ï¼š
- å¦‚æœ `allocationAmount` ä¿å­˜å¤±è´¥ï¼Œfallback è®¡ç®—å¯èƒ½ä¸å‡†ç¡®
- multiplier ä½¿ç”¨ä¸¤å±‚é»˜è®¤å€¼ 100ï¼Œå¯èƒ½éšè—é…ç½®é”™è¯¯
- æœŸæƒå®é™… multiplier å¯èƒ½é 100ï¼ˆå¦‚è¿·ä½ æœŸæƒã€éæ ‡å‡†åˆçº¦ï¼‰

**ç—‡çŠ¶**ï¼š
- èµ„é‡‘æ³„æ¼ï¼šé‡Šæ”¾çš„é‡‘é¢å°‘äºå®é™…å ç”¨
- èµ„é‡‘é”å®šï¼šé‡Šæ”¾çš„é‡‘é¢å¤šäºå®é™…å ç”¨
- å¯¼è‡´åç»­ç­–ç•¥æ— æ³•åˆ†é…èµ„é‡‘

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// 1. å¼ºåˆ¶ä¿å­˜ allocationAmountï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
// 2. éªŒè¯ multiplier æ¥æºï¼šoptionMeta å¿…é¡»åŒ…å« multiplier
// 3. æ·»åŠ æ—¥å¿—è®°å½• fallback è®¡ç®—æƒ…å†µ
```

---

#### é—®é¢˜2ï¼šæœŸæƒä»·æ ¼è·å–çš„å¤šå±‚é™çº§é£é™©
**ä½ç½®**: `strategy-scheduler.service.ts:1699-1748`

**é—®é¢˜æè¿°**ï¼š
å½“å‰è·å–æœŸæƒä»·æ ¼æœ‰ä¸‰ä¸ªé™çº§æ–¹æ¡ˆï¼š
1. LongPort SDK `quoteCtx.quote()`
2. æŒä»“ç¼“å­˜ `getCachedPositions()`
3. å¯Œé€”æœŸæƒè¯¦æƒ… `getOptionDetail()`

**é£é™©**ï¼š
- å¦‚æœæ‰€æœ‰ä¸‰ä¸ªæ¥æºéƒ½å¤±è´¥ï¼Œ`currentPrice = 0`ï¼Œå¯¼è‡´æ­¢ç›ˆæ­¢æŸæ— æ³•è§¦å‘
- æœŸæƒè¡Œæƒ…å¯èƒ½è¿‡æ—¶ï¼ˆç‰¹åˆ«æ˜¯ getOptionDetail è°ƒç”¨ä¸é¢‘ç¹ï¼‰
- æ²¡æœ‰è¯¦ç»†çš„å¤±è´¥æ—¥å¿—ï¼Œéš¾ä»¥æ’æŸ¥é—®é¢˜

**ç—‡çŠ¶**ï¼š
- æœŸæƒæŒä»“æ— æ³•æ­¢ç›ˆ/æ­¢æŸ
- å¼ºåˆ¶å¹³ä»“æ—¶ä»·æ ¼ä¸º 0ï¼Œå¯¼è‡´è®¡ç®—é”™è¯¯
- "ç­–ç•¥10æ‰§è¡Œ390æ¬¡ä½†æ— æŒä»“"å¯èƒ½ä¸æ­¤ç›¸å…³

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// 1. å®ç°æœ¬åœ°ä»·æ ¼ç¼“å­˜ï¼ˆ5åˆ†é’ŸTTLï¼‰
// 2. æ·»åŠ è¯¦ç»†çš„å¤±è´¥æ—¥å¿—ï¼ˆè®°å½•æ¯ä¸ªé™çº§æ­¥éª¤ï¼‰
// 3. è€ƒè™‘è®¢é˜…æ¨é€æ›´æ–°è€Œéè½®è¯¢
// 4. æ·»åŠ ä»·æ ¼æœ‰æ•ˆæ€§éªŒè¯ï¼ˆæ£€æŸ¥æ—¶é—´æˆ³ï¼‰
```

---

#### é—®é¢˜3ï¼šæœŸæƒå®ä¾‹çŠ¶æ€æŒä¹…åŒ–çš„èµ„é‡‘è®¡ç®—ä¸ä¸€è‡´
**ä½ç½®**: `strategy-scheduler.service.ts:2272-2283`

**é—®é¢˜æè¿°**ï¼š
```typescript
// æŒä»“çŠ¶æ€ä¿å­˜æ—¶
allocationAmount: entryPrice > 0 ? qty * entryPrice * 100 : undefined,

// ä½†åœ¨ option-intraday-strategy.ts ä¸­
allocationAmountOverride: premium * multiplier * contracts + fees
```

**é£é™©**ï¼š
- å¼€ä»“æ—¶ä½¿ç”¨ `premium * multiplier + fees`ï¼ˆæ­£ç¡®ï¼‰
- æŒä»“çŠ¶æ€ä¿å­˜æ—¶ä½¿ç”¨ `entryPrice * qty * 100`ï¼ˆå¯èƒ½é”™è¯¯ï¼‰
- ä¸¤è€…è®¡ç®—æ–¹å¼ä¸ä¸€è‡´ï¼Œå¯¼è‡´èµ„é‡‘é‡Šæ”¾é”™è¯¯

**å…³é”®å·®å¼‚**ï¼š
- `premium` vs `entryPrice`ï¼šå¯èƒ½æ˜¯ä¸åŒçš„ä»·æ ¼ï¼ˆbid/ask/midï¼‰
- ç¼ºå°‘ `fees`ï¼šæŒä»“çŠ¶æ€æœªåŒ…å«æ‰‹ç»­è´¹
- ç¡¬ç¼–ç  `100`ï¼šæœªä½¿ç”¨ `metadata.optionMeta.multiplier`

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨ metadata.allocationAmountOverrideï¼ˆå·²åŒ…å«å®Œæ•´æˆæœ¬ï¼‰
allocationAmount: intent.metadata?.allocationAmountOverride || (actualPrice * qty * multiplier + fees)
```

---

### âš ï¸ High Priorityï¼ˆé‡è¦æ”¹è¿›ï¼‰

#### é—®é¢˜4ï¼š0DTE æœŸæƒçš„åˆ°æœŸæ—¥æœŸå¤„ç†æ­§ä¹‰
**ä½ç½®**: `options-contract-selector.service.ts:106-110`

**é—®é¢˜æè¿°**ï¼š
```typescript
const todayExpiry = sorted.find((d) => d.leftDay === 0);
const pickedExpiry = params.expirationMode === '0DTE'
  ? (todayExpiry ?? sorted[0])  // å¦‚æœæ²¡æœ‰0DTEï¼Œé™çº§åˆ°æœ€è¿‘çš„
  : sorted[0];
```

**é£é™©**ï¼š
- `leftDay=0` å¯èƒ½è¡¨ç¤ºå·²è¿‡æœŸæœŸæƒï¼ˆéäº¤æ˜“æ—¶é—´ï¼‰
- æ²¡æœ‰æ£€æŸ¥æœŸæƒæ˜¯å¦ä»åœ¨äº¤æ˜“ï¼ˆå¯èƒ½æ˜¯å†å²æ•°æ®ï¼‰
- å¯èƒ½é€‰æ‹©å·²ä¸‹å¸‚çš„æœŸæƒ

**ç—‡çŠ¶**ï¼š
- å¼€ä»“è®¢å•è¢«æ‹’ç»ï¼ˆ"æœŸæƒå·²è¿‡æœŸ"ï¼‰
- é€‰æ‹©äº†é”™è¯¯çš„åˆ°æœŸæ—¥æœŸ

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// 1. æ£€æŸ¥æœŸæƒæ˜¯å¦ä»åœ¨äº¤æ˜“ï¼ˆstrikeDate > now æˆ– leftDay >= 0 ä¸”åœ¨äº¤æ˜“æ—¶é—´å†…ï¼‰
// 2. å¦‚æœ0DTEä¸å¯ç”¨ï¼Œæ˜ç¡®è®°å½•æ—¥å¿—å¹¶é€‰æ‹©NEAREST
// 3. æ·»åŠ åˆ°æœŸæ—¥æœŸéªŒè¯ï¼ˆç¡®ä¿ä¸æ˜¯å†å²æ—¥æœŸï¼‰
```

---

#### é—®é¢˜5ï¼šGreeks æ•°æ®ç¼ºå¤±å¤„ç†ä¸å½“
**ä½ç½®**: `options-contract-selector.service.ts:178-179`

**é—®é¢˜æè¿°**ï¼š
```typescript
const delta = detail.option?.greeks?.hpDelta ?? detail.option?.greeks?.delta ?? 0;
const theta = detail.option?.greeks?.hpTheta ?? detail.option?.greeks?.theta ?? 0;
```

**é£é™©**ï¼š
- ä½¿ç”¨ `0` ä½œä¸º Greeks ç¼ºå¤±çš„é»˜è®¤å€¼
- æ— æ³•åŒºåˆ†"æ•°æ®ä¸å¯ç”¨"å’Œ"å€¼ä¸º 0"
- Delta=0 çš„åƒåœ¾æœŸæƒå¯èƒ½è¢«é€‰ä¸­
- Theta=0 çš„è¿‡æ»¤è¢«ç»•è¿‡

**åæœ**ï¼š
- é€‰æ‹©çš„æœŸæƒé£é™©ç‰¹å¾ä¸ç¬¦åˆé¢„æœŸ
- è¿‡æ»¤å™¨å¤±æ•ˆï¼ˆä¾‹å¦‚ `thetaMaxAbs=0.5` çš„è¿‡æ»¤è¢«ç»•è¿‡ï¼‰

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// 1. åŒºåˆ†"æ•°æ®ä¸å¯ç”¨"ï¼ˆundefined/nullï¼‰å’Œ"å€¼ä¸º0"
// 2. å¦‚æœ Greeks ä¸å¯ç”¨ï¼Œè·³è¿‡è¯¥å€™é€‰åˆçº¦
// 3. è®°å½•è¯¦ç»†æ—¥å¿—ï¼ˆGreeks æ•°æ®ç¼ºå¤±æƒ…å†µï¼‰
```

---

#### é—®é¢˜6ï¼šæœŸæƒæŒä»“åŒæ­¥çš„å‰ç¼€åŒ¹é…å±€é™
**ä½ç½®**: `strategy-scheduler.service.ts:1430-1441`

**é—®é¢˜æè¿°**ï¼š
```typescript
const prefixes = getOptionPrefixesForUnderlying(underlyingSymbol);
if (prefixes.some((p) => posSymbol.startsWith(p))) {
  return true;
}
```

**é£é™©**ï¼š
- ä»…æ£€æŸ¥å‰ç¼€ï¼Œæ²¡æœ‰é¢å¤–éªŒè¯ï¼ˆå¦‚æ—¥æœŸéƒ¨åˆ†ï¼‰
- å¦‚æœæœŸæƒé“¾è¿”å›æ„å¤–çš„ symbol æ ¼å¼ï¼Œä¼šå¯¼è‡´æ¼æ£€
- ä¾‹å¦‚ï¼šAAPL æœŸæƒå¯èƒ½å‡ºç°ä¸åŒçš„å‰ç¼€å˜ä½“

**ç—‡çŠ¶**ï¼š
- "ç­–ç•¥10æ‰§è¡Œ390æ¬¡ä½†æ— æŒä»“"å¯èƒ½ä¸æ­¤ç›¸å…³
- æœŸæƒæŒä»“æ— æ³•è¢«æ­£ç¡®è¯†åˆ«

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// 1. æ·»åŠ é¢å¤–éªŒè¯ï¼ˆæ­£åˆ™åŒ¹é… YYMMDD[CP][0-9]+ æ ¼å¼ï¼‰
// 2. è®°å½•è¯¦ç»†æ—¥å¿—ï¼ˆåŒ¹é…å¤±è´¥çš„ symbolï¼‰
// 3. æ”¯æŒå¤šç§å‰ç¼€å˜ä½“ï¼ˆAAPLã€AAPL7 ç­‰ï¼‰
```

---

### ğŸ“ Enhancementï¼ˆä¼˜åŒ–å»ºè®®ï¼‰

#### é—®é¢˜7ï¼šå¸‚åœºæ—¶æ®µåˆ¤æ–­ä¸ DST çš„äº¤äº’
**ä½ç½®**: `market-session.service.ts`

**é—®é¢˜æè¿°**ï¼š
- ä¾èµ–ç³»ç»Ÿçš„ `Intl.DateTimeFormat` API
- DST åˆ‡æ¢æ—¥æœŸå¯èƒ½å¯¼è‡´æ—¶é—´è®¡ç®—åå·®

**æµ‹è¯•çŠ¶æ€**ï¼š
- âœ… å·²æµ‹è¯• winter time (EST, UTC-5)
- âŒ æœªæµ‹è¯• DST (EDT, UTC-4) åˆ‡æ¢æ—¥æœŸ

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// æ·»åŠ  DST è¾¹ç•Œæ—¥æœŸæµ‹è¯•ï¼ˆ3æœˆç¬¬äºŒä¸ªå‘¨æ—¥ã€11æœˆç¬¬ä¸€ä¸ªå‘¨æ—¥ï¼‰
```

---

#### é—®é¢˜8ï¼šè®¢å•çŠ¶æ€è§„èŒƒåŒ–çš„ä¸å®Œæ•´æ˜ å°„
**ä½ç½®**: `strategy-scheduler.service.ts:1489-1565`

**é—®é¢˜æè¿°**ï¼š
- æœŸæƒè®¢å•çš„çŠ¶æ€ç å¯èƒ½ä¸è‚¡ç¥¨è®¢å•ä¸åŒ
- ä¸åŒ API è¿”å›çš„ status æ ¼å¼ä¸ç»Ÿä¸€ï¼ˆæ•°å­— vs å­—ç¬¦ä¸²ï¼‰

**é£é™©**ï¼š
- æœŸæƒè®¢å•çŠ¶æ€å¯èƒ½æ— æ³•æ­£ç¡®è¯†åˆ«
- ç‰¹æ®ŠçŠ¶æ€ï¼ˆå¦‚è¡Œæƒï¼‰æœªå¤„ç†

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// 1. æ·»åŠ æœŸæƒç‰¹æœ‰çŠ¶æ€æ˜ å°„
// 2. è¡¥å……å•å…ƒæµ‹è¯•è¦†ç›–æ‰€æœ‰çŠ¶æ€ç 
```

---

#### é—®é¢˜9ï¼šå¯Œé€”APIçš„åº“å­˜æœŸæƒæ”¯æŒé™åˆ¶
**ä½ç½®**: `options-contract-selector.service.ts:71-92`

**é—®é¢˜æè¿°**ï¼š
```typescript
const KNOWN_INDEX_STOCK_IDS: Record<string, string> = {
  SPX: '200003',
  // NOTE: ä»…åŒ…å«SPXï¼Œå…¶ä»–æŒ‡æ•°éœ€è¦é€šè¿‡æœç´¢APIç¡®å®š
};
```

**é£é™©**ï¼š
- åªæ”¯æŒå·²çŸ¥çš„æŒ‡æ•° symbol
- å…¶ä»–æŒ‡æ•°ï¼ˆå¦‚ NDXã€NDXP ç­‰ï¼‰ä¾èµ–æœç´¢ APIï¼Œå¢åŠ å»¶è¿Ÿ
- æœç´¢ API è°ƒç”¨é¢‘ç¹å¯èƒ½è§¦å‘é€Ÿç‡é™åˆ¶

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// è¡¥å……å¸¸è§æŒ‡æ•°çš„ stockId æ˜ å°„
const KNOWN_INDEX_STOCK_IDS = {
  SPX: '200003',
  SPXW: '200003',  // SPX Weekly
  XSP: '200003',   // Mini-SPX
  NDX: 'xxxxx',    // NASDAQ-100
  NDXP: 'xxxxx',   // NASDAQ-100 PM
  // ... æ›´å¤š
};
```

---

#### é—®é¢˜10ï¼šæµ‹è¯•è¦†ç›–ä¸è¶³
**å·²æœ‰æµ‹è¯•**ï¼š
- âœ… `options-fee.service.test.ts`ï¼ˆ2ä¸ªç”¨ä¾‹ï¼‰
- âœ… `market-session.service.test.ts`ï¼ˆ2ä¸ªç”¨ä¾‹ï¼‰

**ç¼ºå¤±æµ‹è¯•**ï¼š
- âŒ `option-intraday-strategy.ts` å•å…ƒæµ‹è¯•
- âŒ `options-contract-selector.service.ts` é›†æˆæµ‹è¯•
- âŒ æœŸæƒé€‰æ‹©çš„å¤šç§åœºæ™¯ï¼ˆ0DTE/NEARESTã€CALL/PUTã€æµåŠ¨æ€§è¿‡æ»¤ï¼‰
- âŒ Greeks æ•°æ®ç¼ºå¤±å¤„ç†
- âŒ èµ„é‡‘é‡Šæ”¾è®¡ç®—çš„æœŸæƒç‰¹æ®Šé€»è¾‘

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```typescript
// åˆ›å»ºå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ˆè‡³å°‘50+ç”¨ä¾‹ï¼‰
```

---

## æ–°å¢éœ€æ±‚ï¼šæœŸæƒè¯¦æƒ…æ¥å£é›†æˆ

### éœ€æ±‚èƒŒæ™¯

ç”¨æˆ·æä¾›äº†ä¸€ä¸ªæ–°çš„å¯Œé€”æœŸæƒè¯¦æƒ…æ¥å£ï¼š

```bash
# åŸå§‹æ¥å£
GET https://www.moomoo.com/quote-api/quote-v2/get-stock-quote?stockId=501941252&marketType=2&marketCode=41&spreadCode=81&underlyingStockId=201335&instrumentType=8&subInstrumentType=8002&_=1769407802026
```

**è¿”å›æ•°æ®ç»“æ„**ï¼š
```json
{
  "code": 0,
  "data": {
    "priceNominal": "9.45",
    "priceBid": "9.40",
    "priceAsk": "9.50",
    "volumeBid": "3",
    "volumeAsk": "18",
    "option": {
      "priceStrike": "460.00",
      "contractSize": "100",
      "openInterest": "8786",
      "premium": "4.54%",
      "impliedVolatility": "69.23%",
      "greek": {
        "delta": "396",
        "hpDelta": "0.3963",
        "theta": "-1547",
        "hpTheta": "-1.5474"
      },
      "timeValue": "9.45",
      "multiplier": 100
    },
    "underlyingStockInfo": {
      "price": "449.060",
      "change": "-0.300",
      "changeRatio": "-0.07%"
    }
  }
}
```

### å½“å‰å®ç°çŠ¶æ€

âœ… **å·²æ”¯æŒ**ï¼š
- è¾¹ç¼˜å‡½æ•° `moomooapi.js` å·²ç»æ”¯æŒ `get-stock-quote` æ¥å£
- è·¯å¾„å·²åœ¨ `QUOTE_TOKEN_REQUIRED_PATHS` ä¸­é…ç½®ï¼ˆline 31ï¼‰
- Token å‚æ•°æå–é€»è¾‘å·²å®ç°ï¼ˆline 118-124ï¼‰

âœ… **å·²ä½¿ç”¨**ï¼š
- `futunn-option-chain.service.ts:414` - `getOptionDetail()` æ–¹æ³•
- `futunn-option-chain.service.ts:639` - `getUnderlyingStockQuote()` æ–¹æ³•

### é—®é¢˜è¯Šæ–­

âŒ **å‘ç°çš„é—®é¢˜**ï¼š
1. **å‚æ•°é¡ºåºä¸ä¸€è‡´**ï¼š
   ```typescript
   // è¾¹ç¼˜å‡½æ•° (line 118-124)
   const keys = ['stockId', 'marketType', 'marketCode', 'lotSize', 'spreadCode', 'underlyingStockId', 'instrumentType', 'subInstrumentType', '_'];

   // ä½†ç”¨æˆ·è¯·æ±‚ä¸­ç¼ºå°‘ lotSize å‚æ•°
   // å®é™…é¡ºåºåº”è¯¥æ˜¯ï¼šstockId, marketType, marketCode, spreadCode, underlyingStockId, instrumentType, subInstrumentType, _
   ```

2. **ç¼ºå°‘å¯é€‰å‚æ•°å¤„ç†**ï¼š
   - `lotSize` æ˜¯å¯é€‰å‚æ•°ï¼Œåº”è¯¥åœ¨ä¸å­˜åœ¨æ—¶è·³è¿‡
   - å½“å‰ä»£ç ä¼šå°† `undefined` è½¬ä¸ºå­—ç¬¦ä¸² `"undefined"`

3. **è¿”å›æ•°æ®è§£æä¸å®Œæ•´**ï¼š
   - å½“å‰ `getOptionDetail()` åªè§£æäº†éƒ¨åˆ†å­—æ®µ
   - æ–°å¢çš„ `underlyingStockInfo` æœªè¢«åˆ©ç”¨

### é›†æˆæ–¹æ¡ˆ

#### 1. ä¿®å¤è¾¹ç¼˜å‡½æ•°å‚æ•°æå–é€»è¾‘

**æ–‡ä»¶**: `edge-functions/moomooapi.js`

```javascript
// Line 118-124 ä¿®æ”¹ä¸ºï¼š
} else if (apiPath.includes('get-stock-quote')) {
    // è‚¡ç¥¨è¡Œæƒ…ï¼šæŒ‰å®é™…è¯·æ±‚å‚æ•°é¡ºåºæå–
    // æ³¨æ„ï¼šlotSize æ˜¯å¯é€‰å‚æ•°ï¼Œä¸åœ¨æ‰€æœ‰è¯·æ±‚ä¸­å‡ºç°
    const keys = ['stockId', 'marketType', 'marketCode', 'spreadCode', 'underlyingStockId', 'instrumentType', 'subInstrumentType', '_'];
    for (const key of keys) {
        // åªæ·»åŠ å®é™…å­˜åœ¨çš„å‚æ•°ï¼ˆè·³è¿‡ undefined/null/ç©ºå­—ç¬¦ä¸²ï¼‰
        if (queryParams[key] !== undefined && queryParams[key] !== null && queryParams[key] !== '') {
            tokenParams[key] = String(queryParams[key]);
        }
    }
    // lotSize å¦‚æœå­˜åœ¨ï¼Œä¹Ÿæ·»åŠ è¿›å»ï¼ˆéœ€è¦è°ƒæ•´åˆ°æ­£ç¡®ä½ç½®ï¼‰
    if (queryParams['lotSize'] !== undefined && queryParams['lotSize'] !== null && queryParams['lotSize'] !== '') {
        // æ’å…¥åˆ° marketCode ä¹‹åï¼ˆæ ¹æ®å®é™…APIéœ€æ±‚è°ƒæ•´ï¼‰
        const lotSize = String(queryParams['lotSize']);
        // é‡æ–°æ„é€  tokenParamsï¼Œä¿æŒæ­£ç¡®é¡ºåº
        // ... å®ç°é¡ºåºæ’å…¥é€»è¾‘
    }
}
```

#### 2. å¢å¼º getOptionDetail() è¿”å›æ•°æ®

**æ–‡ä»¶**: `api/src/services/futunn-option-chain.service.ts`

```typescript
// åœ¨ getOptionDetail() æ–¹æ³•ä¸­æ·»åŠ ï¼š
return {
  // ... ç°æœ‰å­—æ®µ

  // æ–°å¢ï¼šåº•å±‚èµ„äº§å®æ—¶ä»·æ ¼
  underlyingPrice: data.underlyingStockInfo?.price || 0,
  underlyingChange: data.underlyingStockInfo?.change || 0,
  underlyingChangeRatio: data.underlyingStockInfo?.changeRatio || '0.00%',

  // æ–°å¢ï¼šä¹°å–ç›˜æ•°é‡
  volumeBid: parseInt(data.volumeBid || '0', 10),
  volumeAsk: parseInt(data.volumeAsk || '0', 10),

  // æ–°å¢ï¼šæº¢ä»·ç‡
  premium: parsePercentage(data.option?.premium || '0'),
};
```

#### 3. ä¼˜åŒ–æœŸæƒä»·æ ¼è·å–æµç¨‹

**æ–‡ä»¶**: `api/src/services/strategy-scheduler.service.ts`

```typescript
// Line 1729-1748 ä¼˜åŒ–ä¸ºï¼š
if (currentPrice <= 0 && isOptionStrategy) {
  try {
    const optionMeta = context.optionMeta || {};
    const optionId = optionMeta.optionId || optionMeta.option_id;
    const underlyingStockId = optionMeta.underlyingStockId || optionMeta.underlying_stock_id;
    const marketType = optionMeta.marketType || optionMeta.market_type || 2;

    if (optionId && underlyingStockId) {
      // ä½¿ç”¨å¢å¼ºåçš„ getOptionDetail
      const detail = await getOptionDetail(String(optionId), String(underlyingStockId), Number(marketType) || 2);
      if (detail) {
        const bid = detail.priceBid || 0;
        const ask = detail.priceAsk || 0;

        // ä¼˜å…ˆä½¿ç”¨ midï¼Œé™çº§åˆ° bid æˆ– last
        const mid = bid > 0 && ask > 0 ? (bid + ask) / 2 : (detail.price || 0);
        currentPrice = mid || bid || detail.price || 0;

        // ç¼“å­˜ä»·æ ¼ï¼ˆ5åˆ†é’ŸTTLï¼‰
        this.cacheOptionPrice(effectiveSymbol, {
          price: currentPrice,
          bid,
          ask,
          mid,
          timestamp: Date.now(),
          underlyingPrice: detail.underlyingPrice,
        });

        logger.log(`ç­–ç•¥ ${strategyId} æœŸæƒ ${effectiveSymbol}: ä»å¯Œé€”è¯¦æƒ…è·å–ä»·æ ¼ ${currentPrice.toFixed(2)}ï¼ˆbid=${bid.toFixed(2)}, ask=${ask.toFixed(2)}ï¼‰`);
      }
    }
  } catch (error: any) {
    logger.error(`ç­–ç•¥ ${strategyId} æœŸæƒ ${effectiveSymbol}: è·å–å¯Œé€”è¯¦æƒ…å¤±è´¥: ${error.message}`);
  }
}
```

#### 4. å®ç°æœŸæƒä»·æ ¼ç¼“å­˜æœåŠ¡

**æ–°æ–‡ä»¶**: `api/src/services/option-price-cache.service.ts`

```typescript
/**
 * æœŸæƒä»·æ ¼ç¼“å­˜æœåŠ¡
 * å‡å°‘APIè°ƒç”¨é¢‘ç‡ï¼Œæé«˜æ€§èƒ½
 */
interface OptionPriceCacheEntry {
  price: number;
  bid: number;
  ask: number;
  mid: number;
  timestamp: number;
  underlyingPrice: number;
}

class OptionPriceCacheService {
  private cache: Map<string, OptionPriceCacheEntry> = new Map();
  private ttlMs = 5 * 60 * 1000; // 5åˆ†é’Ÿ

  set(symbol: string, entry: OptionPriceCacheEntry): void {
    this.cache.set(symbol, entry);
  }

  get(symbol: string): OptionPriceCacheEntry | null {
    const entry = this.cache.get(symbol);
    if (!entry) return null;

    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
    if (Date.now() - entry.timestamp > this.ttlMs) {
      this.cache.delete(symbol);
      return null;
    }

    return entry;
  }

  clear(): void {
    this.cache.clear();
  }

  // å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆæ¯10åˆ†é’Ÿï¼‰
  startCleanup(): void {
    setInterval(() => {
      const now = Date.now();
      for (const [symbol, entry] of this.cache.entries()) {
        if (now - entry.timestamp > this.ttlMs) {
          this.cache.delete(symbol);
        }
      }
    }, 10 * 60 * 1000);
  }
}

export default new OptionPriceCacheService();
```

---

## å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | é—®é¢˜ç¼–å· | å½±å“èŒƒå›´ | å·¥ä½œé‡ |
|--------|---------|---------|-------|
| ğŸ”´ P0 | é—®é¢˜1ã€2ã€3 | èµ„é‡‘ç®¡ç†/æŒä»“ç›‘æ§ | 4å°æ—¶ |
| âš ï¸ P1 | é—®é¢˜4ã€5ã€6ã€æ–°éœ€æ±‚ | åˆçº¦é€‰æ‹©/ä»·æ ¼è·å– | 6å°æ—¶ |
| ğŸ“ P2 | é—®é¢˜7ã€8ã€9ã€10 | ç¨³å®šæ€§/æµ‹è¯• | 8å°æ—¶ |

### ä¿®å¤æ–‡ä»¶åˆ—è¡¨

#### å¿…é¡»ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆP0ï¼‰
1. âœ… `api/src/services/strategy-scheduler.service.ts`
   - ä¿®å¤èµ„é‡‘é‡Šæ”¾é€»è¾‘ï¼ˆline 694-711ï¼‰
   - ä¿®å¤æŒä»“çŠ¶æ€ä¿å­˜ï¼ˆline 2272-2283ï¼‰
   - å¢å¼ºæœŸæƒä»·æ ¼è·å–ï¼ˆline 1729-1748ï¼‰

2. âœ… `api/src/services/option-price-cache.service.ts`ï¼ˆæ–°å»ºï¼‰
   - å®ç°ä»·æ ¼ç¼“å­˜æœåŠ¡

3. âœ… `edge-functions/moomooapi.js`
   - ä¿®å¤ get-stock-quote å‚æ•°æå–ï¼ˆline 118-124ï¼‰

#### é‡è¦æ”¹è¿›çš„æ–‡ä»¶ï¼ˆP1ï¼‰
4. âœ… `api/src/services/options-contract-selector.service.ts`
   - ä¿®å¤ 0DTE åˆ°æœŸæ—¥æœŸå¤„ç†ï¼ˆline 106-110ï¼‰
   - ä¿®å¤ Greeks æ•°æ®ç¼ºå¤±å¤„ç†ï¼ˆline 178-179ï¼‰
   - è¡¥å……æŒ‡æ•° stockId æ˜ å°„ï¼ˆline 72-77ï¼‰

5. âœ… `api/src/services/futunn-option-chain.service.ts`
   - å¢å¼º getOptionDetail è¿”å›æ•°æ®

#### ä¼˜åŒ–æ”¹è¿›çš„æ–‡ä»¶ï¼ˆP2ï¼‰
6. âœ… `api/src/services/__tests__/option-intraday-strategy.test.ts`ï¼ˆæ–°å»ºï¼‰
7. âœ… `api/src/services/__tests__/options-contract-selector.test.ts`ï¼ˆæ–°å»ºï¼‰
8. âœ… `api/src/services/__tests__/option-price-cache.test.ts`ï¼ˆæ–°å»ºï¼‰

---

## å®æ–½æ­¥éª¤

### é˜¶æ®µ1ï¼šP0 ä¿®å¤ï¼ˆé¢„è®¡4å°æ—¶ï¼‰

#### Step 1.1ï¼šä¿®å¤èµ„é‡‘é‡Šæ”¾é€»è¾‘ï¼ˆ1å°æ—¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `api/src/services/strategy-scheduler.service.ts`

```typescript
// Line 694-711 å®Œæ•´ä¿®æ”¹ï¼š
if (isOption) {
  const multiplier = parseInt(String(ctx?.optionMeta?.multiplier)) || 100;

  // ä¼˜å…ˆä½¿ç”¨ä¿å­˜çš„ allocationAmountï¼ˆåŒ…å«æ‰‹ç»­è´¹ï¼‰
  if (ctx.allocationAmount) {
    releaseAmount = parseFloat(ctx.allocationAmount.toString());
    logger.log(`ç­–ç•¥ ${strategyId} æœŸæƒ ${effectiveSymbol}: èµ„é‡‘é‡Šæ”¾ ${releaseAmount.toFixed(2)} USDï¼ˆæ¥è‡ªallocationAmountï¼‰`);
  } else {
    // Fallback: é‡æ–°è®¡ç®—ï¼ˆä¸åº”è¯¥èµ°åˆ°è¿™é‡Œï¼‰
    logger.warn(`ç­–ç•¥ ${strategyId} æœŸæƒ ${effectiveSymbol}: allocationAmountç¼ºå¤±ï¼Œä½¿ç”¨fallbackè®¡ç®—ï¼ˆmultiplier=${multiplier}ï¼‰`);

    // éªŒè¯ multiplier æ¥æº
    if (!ctx?.optionMeta?.multiplier) {
      logger.error(`ç­–ç•¥ ${strategyId} æœŸæƒ ${effectiveSymbol}: optionMeta.multiplierç¼ºå¤±ï¼Œä½¿ç”¨é»˜è®¤å€¼100å¯èƒ½ä¸å‡†ç¡®`);
    }

    releaseAmount = entryPrice * quantity * multiplier;

    // æ·»åŠ æ‰‹ç»­è´¹ä¼°ç®—ï¼ˆå¦‚æœæœ‰å…ƒæ•°æ®ï¼‰
    if (ctx?.optionMeta?.estimatedFees) {
      const fees = parseFloat(String(ctx.optionMeta.estimatedFees)) || 0;
      releaseAmount += fees;
      logger.log(`ç­–ç•¥ ${strategyId} æœŸæƒ ${effectiveSymbol}: æ·»åŠ æ‰‹ç»­è´¹ ${fees.toFixed(2)} USD`);
    }
  }
} else {
  // è‚¡ç¥¨é€»è¾‘ä¿æŒä¸å˜
  releaseAmount = filledPrice * filledQuantity;
}
```

#### Step 1.2ï¼šä¿®å¤æŒä»“çŠ¶æ€ä¿å­˜ï¼ˆ1å°æ—¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `api/src/services/strategy-scheduler.service.ts`

```typescript
// Line 2272-2283 å®Œæ•´ä¿®æ”¹ï¼š
const multiplier = intent.metadata?.optionMeta?.multiplier || 100;
const fees = intent.metadata?.estimatedFees || 0;

await strategyInstance.updateState(symbol, 'HOLDING', {
  entryPrice,
  quantity: qty,
  entryTime: new Date().toISOString(),
  tradedSymbol,

  // æœŸæƒä¸è®¾ç½®æ­¢ç›ˆæ­¢æŸï¼ˆé¿å…ä¸å¼ºå¹³é€»è¾‘å†²çªï¼‰
  originalStopLoss: undefined,
  originalTakeProfit: undefined,
  currentStopLoss: undefined,
  currentTakeProfit: undefined,

  // ä½¿ç”¨ intent ä¸­çš„ allocationAmountOverrideï¼ˆå·²åŒ…å«å®Œæ•´æˆæœ¬ï¼‰
  allocationAmount: intent.metadata?.allocationAmountOverride || (actualPrice * qty * multiplier + fees),

  // ä¿å­˜å®Œæ•´çš„æœŸæƒå…ƒæ•°æ®ï¼ˆç”¨äºåç»­èµ„é‡‘é‡Šæ”¾ï¼‰
  optionMeta: {
    ...intent.metadata?.optionMeta,
    multiplier,
    estimatedFees: fees,
  },
});

logger.log(`ç­–ç•¥ ${strategyId} æœŸæƒ ${tradedSymbol}: ä¿å­˜æŒä»“çŠ¶æ€ï¼ˆallocationAmount=${intent.metadata?.allocationAmountOverride?.toFixed(2)}ï¼‰`);
```

#### Step 1.3ï¼šå®ç°æœŸæƒä»·æ ¼ç¼“å­˜æœåŠ¡ï¼ˆ1å°æ—¶ï¼‰

**æ–°å»ºæ–‡ä»¶**: `api/src/services/option-price-cache.service.ts`

ï¼ˆå®Œæ•´ä»£ç è§ä¸Šæ–‡"é›†æˆæ–¹æ¡ˆ"ç« èŠ‚ï¼‰

#### Step 1.4ï¼šå¢å¼ºæœŸæƒä»·æ ¼è·å–ï¼ˆ1å°æ—¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `api/src/services/strategy-scheduler.service.ts`

ï¼ˆå®Œæ•´ä»£ç è§ä¸Šæ–‡"é›†æˆæ–¹æ¡ˆ"ç« èŠ‚ï¼‰

---

### é˜¶æ®µ2ï¼šP1 æ”¹è¿›ï¼ˆé¢„è®¡6å°æ—¶ï¼‰

#### Step 2.1ï¼šä¿®å¤è¾¹ç¼˜å‡½æ•°å‚æ•°æå–ï¼ˆ1å°æ—¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `edge-functions/moomooapi.js`

```javascript
// Line 118-124 å®Œæ•´ä¿®æ”¹ï¼š
} else if (apiPath.includes('get-stock-quote')) {
    // è‚¡ç¥¨/æœŸæƒè¡Œæƒ…ï¼šæŒ‰å®é™…APIæ–‡æ¡£é¡ºåºæå–å‚æ•°
    // å‚æ•°é¡ºåºï¼šstockId, marketType, marketCode, [lotSize], spreadCode, underlyingStockId, instrumentType, subInstrumentType, _
    // æ³¨æ„ï¼šlotSize æ˜¯å¯é€‰å‚æ•°ï¼Œä¸åœ¨æ‰€æœ‰è¯·æ±‚ä¸­å‡ºç°

    const orderedKeys = ['stockId', 'marketType', 'marketCode', 'lotSize', 'spreadCode', 'underlyingStockId', 'instrumentType', 'subInstrumentType', '_'];

    // æŒ‰é¡ºåºæ·»åŠ å®é™…å­˜åœ¨çš„å‚æ•°
    for (const key of orderedKeys) {
        if (queryParams[key] !== undefined && queryParams[key] !== null && queryParams[key] !== '') {
            tokenParams[key] = String(queryParams[key]);
        }
    }

    // æ³¨æ„ï¼šå¦‚æœ lotSize ä¸å­˜åœ¨ï¼ŒtokenParams ä¸­ä¹Ÿä¸åº”è¯¥æœ‰è¿™ä¸ªé”®
    // JSON.stringify ä¼šè‡ªåŠ¨è·³è¿‡ undefined çš„é”®
}
```

**æµ‹è¯•ç”¨ä¾‹**ï¼š
```javascript
// æµ‹è¯•1ï¼šåŒ…å« lotSize
const params1 = {
  stockId: '201335',
  marketType: '2',
  marketCode: '11',
  lotSize: '100',
  instrumentType: '3',
  subInstrumentType: '3002',
  _: '1769407802026'
};
// é¢„æœŸ tokenParams = { stockId: '201335', marketType: '2', marketCode: '11', lotSize: '100', instrumentType: '3', subInstrumentType: '3002', _: '1769407802026' }

// æµ‹è¯•2ï¼šä¸åŒ…å« lotSizeï¼ˆæœŸæƒï¼‰
const params2 = {
  stockId: '501941252',
  marketType: '2',
  marketCode: '41',
  spreadCode: '81',
  underlyingStockId: '201335',
  instrumentType: '8',
  subInstrumentType: '8002',
  _: '1769407802026'
};
// é¢„æœŸ tokenParams = { stockId: '501941252', marketType: '2', marketCode: '41', spreadCode: '81', underlyingStockId: '201335', instrumentType: '8', subInstrumentType: '8002', _: '1769407802026' }
```

#### Step 2.2ï¼šå¢å¼ºæœŸæƒè¯¦æƒ…è¿”å›æ•°æ®ï¼ˆ1å°æ—¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `api/src/services/futunn-option-chain.service.ts`

```typescript
// Line 414 é™„è¿‘ï¼ŒgetOptionDetail() æ–¹æ³•è¿”å›å€¼å¢å¼ºï¼š
return {
  // ... ç°æœ‰å­—æ®µï¼ˆprice, priceBid, priceAsk ç­‰ï¼‰

  // æ–°å¢å­—æ®µ
  volumeBid: parseInt(data.volumeBid || '0', 10),
  volumeAsk: parseInt(data.volumeAsk || '0', 10),
  premium: parsePercentage(data.option?.premium || '0'),

  // åº•å±‚èµ„äº§å®æ—¶ä»·æ ¼
  underlyingPrice: parseFloat(data.underlyingStockInfo?.price || '0'),
  underlyingChange: parseFloat(data.underlyingStockInfo?.change || '0'),
  underlyingChangeRatio: data.underlyingStockInfo?.changeRatio || '0.00%',
  underlyingPriceDirect: data.underlyingStockInfo?.priceDirect || 'flat',
};

// åŒæ—¶æ›´æ–° TypeScript ç±»å‹å®šä¹‰
export interface OptionDetailResult {
  // ... ç°æœ‰ç±»å‹
  volumeBid?: number;
  volumeAsk?: number;
  premium?: number;
  underlyingPrice?: number;
  underlyingChange?: number;
  underlyingChangeRatio?: string;
  underlyingPriceDirect?: string;
}
```

#### Step 2.3ï¼šä¿®å¤ 0DTE åˆ°æœŸæ—¥æœŸå¤„ç†ï¼ˆ2å°æ—¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `api/src/services/options-contract-selector.service.ts`

```typescript
// Line 106-110 å®Œæ•´ä¿®æ”¹ï¼š
const sorted = [...strikeDatesResp.strikeDates].sort((a, b) => a.leftDay - b.leftDay);

// æŸ¥æ‰¾å½“æ—¥åˆ°æœŸçš„æœŸæƒï¼ˆleftDay=0 ä¸”ä»åœ¨äº¤æ˜“ï¼‰
const now = new Date();
const todayExpiry = sorted.find((d) => {
  if (d.leftDay !== 0) return false;

  // éªŒè¯ï¼šåˆ°æœŸæ—¥æœŸå¿…é¡»æ˜¯ä»Šå¤©æˆ–æœªæ¥
  const strikeDate = parseInt(String(d.strikeDate), 10);
  const year = Math.floor(strikeDate / 10000);
  const month = Math.floor((strikeDate % 10000) / 100) - 1;
  const day = strikeDate % 100;
  const expiryDate = new Date(year, month, day, 23, 59, 59); // å‡è®¾åˆ°æœŸæ—¥ä¸ºå½“å¤©æ”¶ç›˜

  return expiryDate >= now;
});

// é€‰æ‹©åˆ°æœŸæ—¥æœŸ
let pickedExpiry;
if (params.expirationMode === '0DTE') {
  if (todayExpiry) {
    pickedExpiry = todayExpiry;
    logger.log(`é€‰æ‹©0DTEæœŸæƒ: strikeDate=${todayExpiry.strikeDate}, leftDay=${todayExpiry.leftDay}`);
  } else {
    // é™çº§åˆ°æœ€è¿‘çš„æœŸæƒ
    pickedExpiry = sorted[0];
    logger.warn(`0DTEæœŸæƒä¸å¯ç”¨ï¼Œé™çº§åˆ°æœ€è¿‘æœŸæƒ: strikeDate=${sorted[0].strikeDate}, leftDay=${sorted[0].leftDay}`);
  }
} else {
  pickedExpiry = sorted[0];
}

const strikeDate = pickedExpiry.strikeDate;
```

#### Step 2.4ï¼šä¿®å¤ Greeks æ•°æ®ç¼ºå¤±å¤„ç†ï¼ˆ1å°æ—¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `api/src/services/options-contract-selector.service.ts`

```typescript
// Line 178-179 å®Œæ•´ä¿®æ”¹ï¼š
const delta = detail.option?.greeks?.hpDelta ?? detail.option?.greeks?.delta;
const theta = detail.option?.greeks?.hpTheta ?? detail.option?.greeks?.theta;

// åŒºåˆ†"æ•°æ®ä¸å¯ç”¨"å’Œ"å€¼ä¸º0"
if (delta === undefined || delta === null) {
  logger.warn(`æœŸæƒ ${optionId}: Delta æ•°æ®ä¸å¯ç”¨ï¼Œè·³è¿‡`);
  continue;
}
if (theta === undefined || theta === null) {
  logger.warn(`æœŸæƒ ${optionId}: Theta æ•°æ®ä¸å¯ç”¨ï¼Œè·³è¿‡`);
  continue;
}

// è½¬æ¢ä¸ºæ•°å­—
const deltaNum = toNumber(delta, 0);
const thetaNum = toNumber(theta, 0);

// Greek filtersï¼ˆç°åœ¨å¯ä»¥å®‰å…¨åœ°è¿‡æ»¤äº†ï¼‰
if (greek.deltaMin !== undefined && deltaNum < greek.deltaMin) {
  logger.log(`æœŸæƒ ${optionId}: Delta ${deltaNum.toFixed(4)} < ${greek.deltaMin}ï¼Œè·³è¿‡`);
  continue;
}
if (greek.deltaMax !== undefined && deltaNum > greek.deltaMax) {
  logger.log(`æœŸæƒ ${optionId}: Delta ${deltaNum.toFixed(4)} > ${greek.deltaMax}ï¼Œè·³è¿‡`);
  continue;
}
if (greek.thetaMaxAbs !== undefined && Math.abs(thetaNum) > greek.thetaMaxAbs) {
  logger.log(`æœŸæƒ ${optionId}: |Theta| ${Math.abs(thetaNum).toFixed(4)} > ${greek.thetaMaxAbs}ï¼Œè·³è¿‡`);
  continue;
}
```

#### Step 2.5ï¼šè¡¥å……æŒ‡æ•° stockId æ˜ å°„ï¼ˆ30åˆ†é’Ÿï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `api/src/services/options-contract-selector.service.ts`

```typescript
// Line 72-77 å®Œæ•´ä¿®æ”¹ï¼š
const KNOWN_INDEX_STOCK_IDS: Record<string, string> = {
  // S&P 500 ç³»åˆ—
  SPX: '200003',
  SPXW: '200003',  // S&P 500 Weekly
  XSP: '200003',   // Mini-SPX

  // NASDAQ-100 ç³»åˆ—ï¼ˆéœ€è¦ç¡®è®¤å®é™… stockIdï¼‰
  NDX: '200004',   // NASDAQ-100ï¼ˆå¾…ç¡®è®¤ï¼‰
  NDXP: '200004',  // NASDAQ-100 PMï¼ˆå¾…ç¡®è®¤ï¼‰

  // é“ç¼æ–¯ç³»åˆ—
  DJX: '200005',   // Dow Jonesï¼ˆå¾…ç¡®è®¤ï¼‰

  // Russell ç³»åˆ—
  RUT: '200006',   // Russell 2000ï¼ˆå¾…ç¡®è®¤ï¼‰

  // æ³¨æ„ï¼šå¾…ç¡®è®¤çš„ ID éœ€è¦é€šè¿‡æœç´¢ API éªŒè¯åæ›´æ–°
};
```

**éªŒè¯æ­¥éª¤**ï¼š
```typescript
// æ·»åŠ æ—¥å¿—è®°å½•æœªçŸ¥æŒ‡æ•°çš„æœç´¢ç»“æœ
if (!KNOWN_INDEX_STOCK_IDS[root]) {
  const bySymbol = await getStockIdBySymbol(underlyingSymbol);
  if (bySymbol) {
    logger.log(`å‘ç°æœªæ˜ å°„çš„æŒ‡æ•°: ${root} -> stockId=${bySymbol}ï¼Œè¯·æ›´æ–° KNOWN_INDEX_STOCK_IDS`);
  }
}
```

---

### é˜¶æ®µ3ï¼šP2 ä¼˜åŒ–ï¼ˆé¢„è®¡8å°æ—¶ï¼‰

#### Step 3.1ï¼šè¡¥å……å•å…ƒæµ‹è¯•ï¼ˆ6å°æ—¶ï¼‰

##### æµ‹è¯•1ï¼šæœŸæƒæ—¥å†…ç­–ç•¥æµ‹è¯•

**æ–°å»ºæ–‡ä»¶**: `api/src/services/__tests__/option-intraday-strategy.test.ts`

```typescript
import { OptionIntradayStrategy } from '../strategies/option-intraday-strategy';

describe('OptionIntradayStrategy', () => {
  describe('generateSignal', () => {
    it('åº”è¯¥æ ¹æ®BUYä¿¡å·ç”ŸæˆCALLæœŸæƒæ„å›¾', async () => {
      // Mock tradingRecommendationService
      // Mock selectOptionContract
      // éªŒè¯è¿”å›çš„ TradingIntent
    });

    it('åº”è¯¥æ ¹æ®SELLä¿¡å·ç”ŸæˆPUTæœŸæƒæ„å›¾', async () => {
      // ...
    });

    it('åº”è¯¥åœ¨HOLDä¿¡å·æ—¶è¿”å›null', async () => {
      // ...
    });

    it('åº”è¯¥æ­£ç¡®è®¡ç®—FIXED_CONTRACTSæ¨¡å¼çš„åˆçº¦æ•°é‡', async () => {
      // ...
    });

    it('åº”è¯¥æ­£ç¡®è®¡ç®—MAX_PREMIUMæ¨¡å¼çš„åˆçº¦æ•°é‡', async () => {
      // æµ‹è¯•é¢„ç®—é™åˆ¶
      // éªŒè¯ premium * multiplier * n + fees <= budget
    });

    it('åº”è¯¥ä½¿ç”¨ASKä»·æ ¼ä½œä¸ºå…¥åœºä»·æ ¼ï¼ˆé»˜è®¤ï¼‰', async () => {
      // ...
    });

    it('åº”è¯¥ä½¿ç”¨MIDä»·æ ¼ä½œä¸ºå…¥åœºä»·æ ¼ï¼ˆé…ç½®ï¼‰', async () => {
      // ...
    });

    it('åº”è¯¥åœ¨æœŸæƒé€‰æ‹©å¤±è´¥æ—¶è¿”å›null', async () => {
      // ...
    });
  });
});
```

##### æµ‹è¯•2ï¼šæœŸæƒåˆçº¦é€‰æ‹©æµ‹è¯•

**æ–°å»ºæ–‡ä»¶**: `api/src/services/__tests__/options-contract-selector.test.ts`

```typescript
import { selectOptionContract } from '../options-contract-selector.service';

describe('selectOptionContract', () => {
  describe('0DTEæ¨¡å¼', () => {
    it('åº”è¯¥é€‰æ‹©å½“æ—¥åˆ°æœŸçš„æœŸæƒï¼ˆleftDay=0ï¼‰', async () => {
      // ...
    });

    it('åº”è¯¥åœ¨0DTEä¸å¯ç”¨æ—¶é™çº§åˆ°NEAREST', async () => {
      // ...
    });

    it('åº”è¯¥éªŒè¯åˆ°æœŸæ—¥æœŸæœ‰æ•ˆæ€§ï¼ˆä¸æ˜¯å†å²æ—¥æœŸï¼‰', async () => {
      // ...
    });
  });

  describe('æµåŠ¨æ€§è¿‡æ»¤', () => {
    it('åº”è¯¥è¿‡æ»¤æŒä»“é‡ä½äºé˜ˆå€¼çš„æœŸæƒ', async () => {
      // ...
    });

    it('åº”è¯¥è¿‡æ»¤ä¹°å–ä»·å·®è¶…è¿‡é˜ˆå€¼çš„æœŸæƒ', async () => {
      // ...
    });

    it('åº”è¯¥æŒ‰ä¹°å–ä»·å·®%æ’åº', async () => {
      // ...
    });
  });

  describe('Greeksè¿‡æ»¤', () => {
    it('åº”è¯¥è¿‡æ»¤Deltaä¸åœ¨èŒƒå›´å†…çš„æœŸæƒ', async () => {
      // ...
    });

    it('åº”è¯¥è¿‡æ»¤Thetaè¶…è¿‡é˜ˆå€¼çš„æœŸæƒ', async () => {
      // ...
    });

    it('åº”è¯¥è·³è¿‡Greeksæ•°æ®ç¼ºå¤±çš„æœŸæƒ', async () => {
      // å…³é”®æµ‹è¯•ï¼šéªŒè¯ undefined/null å¤„ç†
    });
  });

  describe('Fallbackæœºåˆ¶', () => {
    it('åº”è¯¥åœ¨æ‰€æœ‰å€™é€‰éƒ½å¤±è´¥æ—¶ä½¿ç”¨æ—¥Kçº¿æ•°æ®', async () => {
      // ...
    });

    it('åº”è¯¥åœ¨Fallbackå¤±è´¥æ—¶è¿”å›null', async () => {
      // ...
    });
  });
});
```

##### æµ‹è¯•3ï¼šæœŸæƒä»·æ ¼ç¼“å­˜æµ‹è¯•

**æ–°å»ºæ–‡ä»¶**: `api/src/services/__tests__/option-price-cache.test.ts`

```typescript
import optionPriceCacheService from '../option-price-cache.service';

describe('OptionPriceCacheService', () => {
  beforeEach(() => {
    optionPriceCacheService.clear();
  });

  it('åº”è¯¥ç¼“å­˜ä»·æ ¼æ•°æ®', () => {
    const entry = {
      price: 10.5,
      bid: 10.4,
      ask: 10.6,
      mid: 10.5,
      timestamp: Date.now(),
      underlyingPrice: 450.0,
    };
    optionPriceCacheService.set('TSLA260130C460000.US', entry);
    const cached = optionPriceCacheService.get('TSLA260130C460000.US');
    expect(cached).toEqual(entry);
  });

  it('åº”è¯¥åœ¨TTLè¿‡æœŸåè¿”å›null', () => {
    const entry = {
      price: 10.5,
      bid: 10.4,
      ask: 10.6,
      mid: 10.5,
      timestamp: Date.now() - 6 * 60 * 1000, // 6åˆ†é’Ÿå‰
      underlyingPrice: 450.0,
    };
    optionPriceCacheService.set('TSLA260130C460000.US', entry);
    const cached = optionPriceCacheService.get('TSLA260130C460000.US');
    expect(cached).toBeNull();
  });

  it('åº”è¯¥æ”¯æŒæ¸…ç©ºç¼“å­˜', () => {
    optionPriceCacheService.set('TSLA260130C460000.US', { /* ... */ });
    optionPriceCacheService.clear();
    const cached = optionPriceCacheService.get('TSLA260130C460000.US');
    expect(cached).toBeNull();
  });
});
```

#### Step 3.2ï¼šDST è¾¹ç•Œæ—¥æœŸæµ‹è¯•ï¼ˆ1å°æ—¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**: `api/src/services/__tests__/market-session.service.test.ts`

```typescript
describe('MarketSessionService - DSTè¾¹ç•Œ', () => {
  it('åº”è¯¥æ­£ç¡®å¤„ç†æ˜¥å­£DSTåˆ‡æ¢ï¼ˆ3æœˆç¬¬äºŒä¸ªå‘¨æ—¥ï¼‰', async () => {
    // 2026-03-08 02:00:00 EST -> 03:00:00 EDT
    const dstDate = new Date('2026-03-08T10:00:00Z'); // UTCæ—¶é—´
    // ...
  });

  it('åº”è¯¥æ­£ç¡®å¤„ç†ç§‹å­£DSTåˆ‡æ¢ï¼ˆ11æœˆç¬¬ä¸€ä¸ªå‘¨æ—¥ï¼‰', async () => {
    // 2026-11-01 02:00:00 EDT -> 01:00:00 EST
    const dstDate = new Date('2026-11-01T06:00:00Z'); // UTCæ—¶é—´
    // ...
  });
});
```

#### Step 3.3ï¼šè¡¥å……æ–‡æ¡£å’Œé…ç½®ç¤ºä¾‹ï¼ˆ1å°æ—¶ï¼‰

**æ–°å»ºæ–‡ä»¶**: `docs/guides\260128-æœŸæƒç­–ç•¥é…ç½®æŒ‡å—.md`

ï¼ˆè§ä¸‹æ–‡"é…ç½®ç¤ºä¾‹"ç« èŠ‚ï¼‰

---

## æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•ï¼ˆå·²è¦†ç›–ï¼‰
- âœ… `options-fee.service.test.ts`ï¼ˆ2ä¸ªç”¨ä¾‹ï¼‰
- âœ… `market-session.service.test.ts`ï¼ˆ2ä¸ªç”¨ä¾‹ï¼‰

### å•å…ƒæµ‹è¯•ï¼ˆå¾…è¡¥å……ï¼‰
- âŒ `option-intraday-strategy.test.ts`ï¼ˆè‡³å°‘8ä¸ªç”¨ä¾‹ï¼‰
- âŒ `options-contract-selector.test.ts`ï¼ˆè‡³å°‘15ä¸ªç”¨ä¾‹ï¼‰
- âŒ `option-price-cache.test.ts`ï¼ˆè‡³å°‘5ä¸ªç”¨ä¾‹ï¼‰

### é›†æˆæµ‹è¯•ï¼ˆå¾…è¡¥å……ï¼‰
- âŒ å®Œæ•´çš„æœŸæƒå¼€ä»“æµç¨‹æµ‹è¯•
- âŒ æ”¶ç›˜å‰å¼ºåˆ¶å¹³ä»“æµ‹è¯•
- âŒ èµ„é‡‘åˆ†é…å’Œé‡Šæ”¾æµ‹è¯•
- âŒ æœŸæƒä»·æ ¼è·å–é™çº§æµ‹è¯•

### ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå¾…æ‰‹å·¥éªŒè¯ï¼‰
1. **0DTEæœŸæƒäº¤æ˜“**ï¼š
   - ä½¿ç”¨SPX/SPXWåˆ›å»ºç­–ç•¥
   - éªŒè¯å½“æ—¥åˆ°æœŸæœŸæƒé€‰æ‹©
   - éªŒè¯æ”¶ç›˜å‰30åˆ†é’Ÿå¼ºåˆ¶å¹³ä»“

2. **æµåŠ¨æ€§è¿‡æ»¤**ï¼š
   - è®¾ç½® `minOpenInterest=1000`
   - éªŒè¯ä½æŒä»“é‡æœŸæƒè¢«è¿‡æ»¤

3. **Greeksè¿‡æ»¤**ï¼š
   - è®¾ç½® `deltaMin=0.3, deltaMax=0.7`
   - éªŒè¯Deltaä¸åœ¨èŒƒå›´å†…çš„æœŸæƒè¢«è¿‡æ»¤

4. **èµ„é‡‘ç®¡ç†**ï¼š
   - éªŒè¯ `allocationAmount` æ­£ç¡®ä¿å­˜
   - éªŒè¯èµ„é‡‘é‡Šæ”¾é‡‘é¢ä¸€è‡´

5. **é”™è¯¯å¤„ç†**ï¼š
   - æµ‹è¯•æ‰€æœ‰APIå¤±è´¥åœºæ™¯
   - éªŒè¯é™çº§é€»è¾‘

---

## é…ç½®ç¤ºä¾‹

### 1. åŸºç¡€0DTEç­–ç•¥é…ç½®

```json
{
  "strategyName": "SPX-0DTE-CALL",
  "strategyType": "OPTION_INTRADAY_V1",
  "symbolPool": [".SPX.US"],
  "config": {
    "assetClass": "OPTION",
    "expirationMode": "0DTE",
    "directionMode": "FOLLOW_SIGNAL",
    "positionSizing": {
      "mode": "FIXED_CONTRACTS",
      "fixedContracts": 1
    },
    "tradeWindow": {
      "noNewEntryBeforeCloseMinutes": 60,
      "forceCloseBeforeCloseMinutes": 30
    },
    "entryPriceMode": "ASK"
  },
  "capitalAllocation": {
    "allocationType": "FIXED",
    "fixedAmount": 5000
  }
}
```

### 2. é«˜çº§è¿‡æ»¤ç­–ç•¥é…ç½®

```json
{
  "strategyName": "TSLA-Option-Filtered",
  "strategyType": "OPTION_INTRADAY_V1",
  "symbolPool": ["TSLA.US"],
  "config": {
    "assetClass": "OPTION",
    "expirationMode": "NEAREST",
    "directionMode": "CALL_ONLY",
    "positionSizing": {
      "mode": "MAX_PREMIUM",
      "maxPremiumUsd": 2000
    },
    "liquidityFilters": {
      "minOpenInterest": 1000,
      "maxBidAskSpreadAbs": 1.0,
      "maxBidAskSpreadPct": 5.0
    },
    "greekFilters": {
      "deltaMin": 0.3,
      "deltaMax": 0.7,
      "thetaMaxAbs": 2.0
    },
    "tradeWindow": {
      "noNewEntryBeforeCloseMinutes": 90,
      "forceCloseBeforeCloseMinutes": 30
    },
    "feeModel": {
      "commissionPerContract": 0.10,
      "minCommissionPerOrder": 0.99,
      "platformFeePerContract": 0.30
    },
    "entryPriceMode": "MID"
  },
  "capitalAllocation": {
    "allocationType": "FIXED",
    "fixedAmount": 10000
  }
}
```

### 3. å¤šæ ‡çš„æœŸæƒç­–ç•¥é…ç½®

```json
{
  "strategyName": "Tech-Options-Portfolio",
  "strategyType": "OPTION_INTRADAY_V1",
  "symbolPool": [
    "TSLA.US",
    "NVDA.US",
    "AAPL.US",
    "AMZN.US",
    "META.US"
  ],
  "config": {
    "assetClass": "OPTION",
    "expirationMode": "0DTE",
    "directionMode": "FOLLOW_SIGNAL",
    "positionSizing": {
      "mode": "FIXED_CONTRACTS",
      "fixedContracts": 2
    },
    "liquidityFilters": {
      "minOpenInterest": 500,
      "maxBidAskSpreadPct": 10.0
    },
    "tradeWindow": {
      "noNewEntryBeforeCloseMinutes": 60,
      "forceCloseBeforeCloseMinutes": 30
    },
    "entryPriceMode": "ASK"
  },
  "capitalAllocation": {
    "allocationType": "PERCENTAGE",
    "percentage": 20.0
  }
}
```

### 4. æœ«æ—¥æœŸæƒç­–ç•¥é…ç½®

```json
{
  "strategyName": "0DTE-Index-Options",
  "strategyType": "OPTION_INTRADAY_V1",
  "symbolPool": [
    ".SPX.US",
    ".SPXW.US",
    ".XSP.US",
    ".NDX.US",
    ".NDXP.US"
  ],
  "config": {
    "assetClass": "OPTION",
    "expirationMode": "0DTE",
    "directionMode": "FOLLOW_SIGNAL",
    "positionSizing": {
      "mode": "MAX_PREMIUM",
      "maxPremiumUsd": 3000
    },
    "liquidityFilters": {
      "minOpenInterest": 2000,
      "maxBidAskSpreadAbs": 0.5
    },
    "greekFilters": {
      "deltaMin": 0.4,
      "deltaMax": 0.6,
      "thetaMaxAbs": 1.5
    },
    "tradeWindow": {
      "noNewEntryBeforeCloseMinutes": 30,
      "forceCloseBeforeCloseMinutes": 15
    },
    "entryPriceMode": "MID"
  },
  "capitalAllocation": {
    "allocationType": "FIXED",
    "fixedAmount": 15000
  }
}
```

---

## å¸¸è§é—®é¢˜è§£ç­”

### Q1ï¼šä¸ºä»€ä¹ˆæœŸæƒç­–ç•¥ä¸è®¾ç½®æ­¢ç›ˆæ­¢æŸï¼Ÿ

**A**: æœŸæƒæ—¥å†…ç­–ç•¥é‡‡ç”¨"æ”¶ç›˜å‰å¼ºåˆ¶å¹³ä»“"æœºåˆ¶ï¼Œé¿å…ä¸ä¼ ç»Ÿæ­¢ç›ˆæ­¢æŸå†²çªï¼š
- æœŸæƒæ—¶é—´ä»·å€¼è¡°å‡å¿«ï¼ŒæŒæœ‰è¿‡å¤œé£é™©å¤§
- å¼ºåˆ¶å¹³ä»“ç¡®ä¿åœ¨æ”¶ç›˜å‰30åˆ†é’Ÿï¼ˆé»˜è®¤ï¼‰å…¨éƒ¨å‡ºåœº
- å¦‚æœéœ€è¦æ­¢æŸä¿æŠ¤ï¼Œå¯ä»¥åœ¨æŒä»“ç›‘æ§ä¸­æ·»åŠ æœ€å¤§äºæŸ%é™åˆ¶

### Q2ï¼šå¦‚ä½•è°ƒæ•´æ‰‹ç»­è´¹æ¨¡å‹ï¼Ÿ

**A**: åœ¨ç­–ç•¥é…ç½®ä¸­è®¾ç½® `feeModel` å­—æ®µï¼š
```json
{
  "feeModel": {
    "commissionPerContract": 0.10,
    "minCommissionPerOrder": 0.99,
    "platformFeePerContract": 0.30
  }
}
```

å¦‚æœä¸è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼ˆä¸é•¿æ¡¥æœŸæƒè´¹ç‡ä¸€è‡´ï¼‰ã€‚

### Q3ï¼šå¦‚ä½•é¿å…é€‰æ‹©æµåŠ¨æ€§å·®çš„æœŸæƒï¼Ÿ

**A**: è®¾ç½®ä¸¥æ ¼çš„æµåŠ¨æ€§è¿‡æ»¤å™¨ï¼š
```json
{
  "liquidityFilters": {
    "minOpenInterest": 1000,        // æœ€å°æŒä»“é‡
    "maxBidAskSpreadAbs": 1.0,      // æœ€å¤§ä»·å·®ï¼ˆç»å¯¹å€¼ï¼‰
    "maxBidAskSpreadPct": 5.0       // æœ€å¤§ä»·å·®ï¼ˆç™¾åˆ†æ¯”ï¼‰
  }
}
```

### Q4ï¼šå¦‚ä½•éªŒè¯æœŸæƒç­–ç•¥æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹æ—¥å¿—å’Œæ•°æ®åº“è®°å½•ï¼š
1. ç­–ç•¥è°ƒåº¦å™¨æ—¥å¿—ï¼šæŸ¥çœ‹ä¿¡å·ç”Ÿæˆå’ŒæœŸæƒé€‰æ‹©
2. `strategy_instances` è¡¨ï¼šæ£€æŸ¥ `tradedSymbol` æ˜¯å¦æ˜¯æœŸæƒsymbol
3. `execution_orders` è¡¨ï¼šæ£€æŸ¥ `metadata` ä¸­çš„ `optionMeta` å­—æ®µ
4. `capital_allocations` è¡¨ï¼šæ£€æŸ¥èµ„é‡‘åˆ†é…å’Œé‡Šæ”¾è®°å½•

### Q5ï¼šå¦‚ä½•å¤„ç†æœŸæƒä»·æ ¼è·å–å¤±è´¥ï¼Ÿ

**A**: ç³»ç»Ÿæœ‰ä¸‰å±‚é™çº§æœºåˆ¶ï¼š
1. LongPort SDK å®æ—¶è¡Œæƒ…
2. æŒä»“ç¼“å­˜æ•°æ®
3. å¯Œé€”æœŸæƒè¯¦æƒ…æ¥å£

å¦‚æœæ‰€æœ‰ä¸‰å±‚éƒ½å¤±è´¥ï¼Œç³»ç»Ÿä¼šè·³è¿‡æœ¬æ¬¡æŒä»“æ£€æŸ¥ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚

---

## é£é™©æç¤º

### äº¤æ˜“é£é™©
- âš ï¸ æœŸæƒæ æ†é«˜ï¼ŒäºæŸå¯èƒ½å¿«é€Ÿæ‰©å¤§
- âš ï¸ 0DTEæœŸæƒæ—¶é—´ä»·å€¼è¡°å‡æå¿«ï¼Œéœ€å¯†åˆ‡ç›‘æ§
- âš ï¸ ä½æµåŠ¨æ€§æœŸæƒå¯èƒ½æ— æ³•æŒ‰ç†æƒ³ä»·æ ¼æˆäº¤

### ç³»ç»Ÿé£é™©
- âš ï¸ APIè°ƒç”¨å¤±è´¥å¯èƒ½å¯¼è‡´å¼ºåˆ¶å¹³ä»“å»¶è¿Ÿ
- âš ï¸ ä»·æ ¼æ•°æ®å»¶è¿Ÿå¯èƒ½å½±å“æ­¢æŸæ‰§è¡Œ
- âš ï¸ ç½‘ç»œé—®é¢˜å¯èƒ½å¯¼è‡´è®¢å•æäº¤å¤±è´¥

### å»ºè®®
1. ä»å°èµ„é‡‘å¼€å§‹æµ‹è¯•ï¼ˆæ¯ç­–ç•¥ä¸è¶…è¿‡5000 USDï¼‰
2. è®¾ç½®ä¸¥æ ¼çš„æµåŠ¨æ€§è¿‡æ»¤ï¼ˆminOpenInterest >= 1000ï¼‰
3. ç›‘æ§ç³»ç»Ÿæ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸
4. å®šæœŸæ£€æŸ¥èµ„é‡‘åˆ†é…å’Œé‡Šæ”¾æ˜¯å¦ä¸€è‡´
5. åœ¨å¸‚åœºæ³¢åŠ¨å‰§çƒˆæ—¶æš‚åœç­–ç•¥

---

## æ€»ç»“

### å®Œæˆçš„å·¥ä½œ
âœ… **é—®é¢˜è¯Šæ–­**ï¼šå‘ç°å¹¶åˆ†æäº†10ä¸ªå…³é”®é—®é¢˜
âœ… **æ–¹æ¡ˆè®¾è®¡**ï¼šæä¾›äº†å®Œæ•´çš„P0/P1/P2ä¿®å¤æ–¹æ¡ˆ
âœ… **æ–°éœ€æ±‚é›†æˆ**ï¼šè®¾è®¡äº†æœŸæƒè¯¦æƒ…æ¥å£é›†æˆæ–¹æ¡ˆ
âœ… **æµ‹è¯•è®¡åˆ’**ï¼šåˆ¶å®šäº†å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•è®¡åˆ’
âœ… **é…ç½®ç¤ºä¾‹**ï¼šæä¾›äº†4ç§å…¸å‹åœºæ™¯çš„é…ç½®ç¤ºä¾‹

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. å®æ–½ P0 ä¿®å¤ï¼ˆé¢„è®¡4å°æ—¶ï¼‰
2. å®æ–½ P1 æ”¹è¿›ï¼ˆé¢„è®¡6å°æ—¶ï¼‰
3. è¡¥å……å•å…ƒæµ‹è¯•ï¼ˆé¢„è®¡6å°æ—¶ï¼‰
4. ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯ï¼ˆé¢„è®¡2å°æ—¶ï¼‰
5. æ–‡æ¡£æ›´æ–°å’Œå‘å¸ƒï¼ˆé¢„è®¡2å°æ—¶ï¼‰

**æ€»é¢„è®¡å·¥ä½œé‡**: 20å°æ—¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-28
**ç»´æŠ¤è€…**: Trading System Team
