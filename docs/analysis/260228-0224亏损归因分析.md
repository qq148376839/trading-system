# 2/24 亏损归因分析（-$547）

**日期**: 2026-02-28（复盘分析）
**事件日期**: 2026-02-24
**总亏损**: -$547

## NaN 毒化导致熔断器失效

### 根因链

1. 首笔 SPY PUT 卖出 → `sellEntryPrice` 或 `avgPrice` 缺失/零值
2. `tradePnL = (avgPrice - sellEntryPrice) * sellQty * sellMultiplier - sellEntryFees * 2` → **NaN**
3. `newDailyPnL = prevDailyPnL + tradePnL` → **NaN**
4. 写入 context：`dailyRealizedPnL: NaN`
5. 后续所有 PnL 计算：`NaN + anyNumber = NaN`
6. 熔断检查：`NaN <= -300` → **false**（IEEE 754 语义：NaN 与任何数比较都是 false）
7. 熔断器从未触发，亏损从 -$51 级联到 -$547

### Docker 日志证据

```
[2026-02-24 16:32:25] Strategy 10 SPY.US: PnL=$NaN, Daily=$NaN, ConsecLosses=0
```

### 修复状态

已在生死审查（ee213f2）中修复：NaN guard on `prevDailyPnL`/`prevConsecutiveLosses`。

## 逐笔亏损归因

| 标的 | 亏损 | 占比 | 根因 | 修复 |
|---|---|---|---|---|
| SPY 686 Put | -$289 | 53% | protectionOrderId 残留 → 零保护 | ee213f2 Fix B+C |
| QQQ 606 Put | -$163 | 30% | deviation 公式压缩 TSLPPCT 至 8% | ee213f2 Fix A |
| QQQ 607 Put | -$90 | 16% | TSLPPCT 8% + 竞态拒绝 | ee213f2 Fix A+E |
| QQQ 605 Put | -$5 | 1% | TSLPPCT 10% 触发 | ee213f2 Fix A |

**系统 bug 归因占比**: ~85%（$452/$547）可追溯到已确认的代码缺陷，均已在 ee213f2 修复。

## 关联修复

- `protectionOrderId` 残留问题：已在 b188cdb（peakPnLPercent 跨交易继承修复）中通过 `POSITION_CONTEXT_RESET` 彻底解决
- NaN 毒化：已在 ee213f2（生死审查 P0 安全修复）中解决
