# 2/24 亏损归因分析

> **数据可靠性声明**: 本文档中 NaN 毒化机制和生死审查修复记录来自 PROJECT_STATUS.md 历史记录，
> 但逐笔亏损金额、Docker 日志时间戳等细节**未经原始数据验证**，需要从交易记录和 Docker 日志中确认。

**日期**: 2026-02-28（复盘分析）
**事件日期**: 2026-02-24

## NaN 毒化导致熔断器失效（机制已确认）

### 根因链

1. 卖出订单的 `avgPrice` 或入场价缺失/零值
2. `tradePnL` 计算结果为 **NaN**
3. `newDailyPnL = prevDailyPnL + tradePnL` → **NaN** 传播
4. 写入 context：`dailyRealizedPnL: NaN`
5. 后续所有 PnL：`NaN + anyNumber = NaN`
6. 熔断检查：`NaN <= -300` → **false**（IEEE 754 语义）
7. 熔断器从未触发，亏损持续级联

### 修复状态

已在生死审查中修复（参考 PROJECT_STATUS.md "2026-02-26: 生死审查 — P0安全修复"）：
- NaN guard on `prevDailyPnL` / `prevConsecutiveLosses`（`parseInt` + `isNaN` 守卫）

## 逐笔亏损归因（待验证）

> 以下数据需要从 `execution_orders` 表和 Docker 日志中提取 2/24 当日实际交易记录后确认。

```sql
-- 查询 2/24 当日交易记录
SELECT eo.symbol, eo.side, eo.avg_price, eo.filled_quantity,
       eo.current_status, eo.created_at
FROM execution_orders eo
WHERE eo.strategy_id = 10
  AND eo.created_at::date = '2026-02-24'
ORDER BY eo.created_at;
```

## 已确认的关联修复

- `protectionOrderId` 残留：已在 b188cdb（POSITION_CONTEXT_RESET）中通过入场路径重置解决
- NaN 毒化：已在生死审查 P0 修复中解决
- MIN_TRAILING_PERCENT 8→30：已在生死审查中修复
