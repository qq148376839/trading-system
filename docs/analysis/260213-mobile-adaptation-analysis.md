# 移动端适配分析报告

> 日期：2026-02-13 | 分析范围：frontend/ 全部 27 个 TSX/TS 文件，17 个页面路由

---

## 一、现状评估：移动端支持度极低

### 整体评分：2/10（桌面端专用）

| 维度 | 现状 | 严重程度 |
|------|------|---------|
| viewport 元标签 | **缺失** — layout.tsx 未配置 viewport | 致命 |
| 侧边栏导航 | 固定 200px，不可隐藏，无移动端抽屉菜单 | 致命 |
| 数据表格 | 8+ 列固定宽度，推荐列 320px，冻结左右列 | 严重 |
| 表单/弹窗 | 硬编码 `grid-cols-2` / `grid-cols-3`，小屏挤压 | 中等 |
| 图表 | 使用 `ResponsiveContainer` — 已自适应 | 正常 |
| 响应式断点覆盖 | 约 5-6 个页面用了 `xs/sm/md`，其余 11+ 页面无 | 严重 |
| 触控交互 | 无 touch 事件，无移动手势 | 中等 |

### 当前技术栈

| 技术 | 版本 | 移动端友好度 |
|------|------|-------------|
| Next.js (App Router) | 14.0.0 | 框架本身支持良好 |
| Ant Design | 6.0.0 | 组件内建基础响应式，但需手动适配布局 |
| Tailwind CSS | 3.4.0 | 响应式能力强，但项目中用量极低（<5%） |
| Recharts | 2.10.3 | ResponsiveContainer 已自适应 |

---

## 二、核心问题详解

### 问题 1：viewport 缺失（影响所有页面）

`app/layout.tsx` 缺少 viewport 导出，移动端浏览器会以 980px 宽度渲染后缩放，导致所有内容极小。

```tsx
// 当前状态 — 缺失 viewport
export const metadata: Metadata = {
  title: '长桥股票交易系统',
  description: '...',
}
```

**修复**：加一行 viewport 导出即可，零风险。

### 问题 2：固定侧边栏（AppLayout.tsx — 267 行）

```
┌─────────┬──────────────────────────────┐
│ Sider   │                              │
│ 200px   │     Content                  │
│ fixed   │     marginLeft: 200px        │
│         │                              │
└─────────┴──────────────────────────────┘
```

移动端上 200px 侧边栏会占据手机屏幕 50%+ 的宽度，且无法隐藏。需要改为：
- 小屏：抽屉式(Drawer) 导航，默认隐藏，汉堡按钮触发
- 大屏：保持现有侧边栏不变

### 问题 3：数据表格（影响 8+ 页面）

主页表格示例（`app/page.tsx` — 1818 行）：

| 列 | 固定宽度 |
|----|---------|
| 标的代码 | 200px, fixed left |
| 持仓数量 | 120px |
| 现价 | 150px |
| 涨跌额 | 100px |
| 涨跌幅 | 100px |
| 盈亏 | 120px |
| 市值 | 120px |
| 交易推荐 | **320px** |
| 操作 | 200px, fixed right |

总宽度 ~1330px，在 375px 手机屏上完全不可用。类似问题存在于：策略管理、订单管理、信号日志、系统日志、关注列表、期权链等。

### 问题 4：表单与弹窗

- `OptionTradeModal`：硬编码 `grid grid-cols-2`，小屏两列挤压
- 策略详情页：`grid grid-cols-3`，三列在手机上无法阅读
- 配置页弹窗：`maxWidth: 500` — 在小屏上尚可，但无适配

---

## 三、各页面适配现状一览

| 页面 | 路由 | 当前响应式 | 改造难度 |
|------|------|-----------|---------|
| 首页/仪表盘 | `/` | 部分（卡片有 md:grid-cols-4，表格无） | **高** — 表格列多，核心页 |
| K线图 | `/candles` | 较好（xs/sm/md） | 低 |
| 外汇行情 | `/forex` | 较好（xs/sm/md） | 低 |
| 期权链 | `/options/chain` | 无 | **高** — 双向表格结构 |
| 期权详情 | `/options/[code]` | 较好（xs/md） | 低 |
| 量化首页 | `/quant` | 较好（xs/sm/md/lg） | 低 |
| 策略管理 | `/quant/strategies` | 无 | 中 |
| 策略详情 | `/quant/strategies/[id]` | 部分 | 中 |
| 资金管理 | `/quant/capital` | 部分 | 中 |
| 信号日志 | `/quant/signals` | 无 | 中 |
| 订单管理 | `/quant/orders` | 无 | 中 |
| 回测管理 | `/quant/backtest` | 较好（xs/sm/md） | 低 |
| 回测详情 | `/quant/backtest/[id]` | 较好（xs/sm/lg） | 低 |
| 行情查询 | `/quote` | 无 | 中 |
| 关注列表 | `/watchlist` | 无 | 中 |
| 系统日志 | `/logs` | 无（scroll x:1200） | 中 |
| 系统配置 | `/config` | 部分（居中卡片） | 低 |
| API 文档 | `/api-docs` | 未分析 | 待定 |

---

## 四、改造方案与成本评估

### 方案概述

采用**渐进式响应式适配**策略 — 不重写页面，在现有代码上增加移动端断点和布局切换。

### 改造分层

#### 第一层：基础设施（必做，影响全局）

| 改动项 | 涉及文件 | 改动量 | 风险 |
|--------|---------|--------|------|
| 添加 viewport 导出 | `layout.tsx` | +3 行 | 无 |
| 添加 `useIsMobile` Hook | 新建 `hooks/useIsMobile.ts` | ~15 行 | 无 |
| AppLayout 移动端抽屉菜单 | `AppLayout.tsx` | 改 ~80 行 | **低** — Ant Design Drawer 组件成熟 |
| globals.css 增加移动基础样式 | `globals.css` | +20 行 | 无 |

**预估改动量：~120 行代码，1 个新文件**

#### 第二层：表格页面适配（核心改造）

策略：小屏时表格隐藏次要列 + 可展开行显示详情，或切换为卡片列表视图。

| 页面 | 方案 | 改动量 |
|------|------|--------|
| 首页持仓表 | 小屏隐藏 5 列 + 可展开行 | ~60 行 |
| 策略管理 | 小屏隐藏 2 列 + 可展开行 | ~30 行 |
| 订单管理 | 小屏隐藏 3 列 + 可展开行 | ~30 行 |
| 信号日志 | 小屏隐藏 3 列 + 可展开行 | ~30 行 |
| 关注列表 | 小屏隐藏 2 列 | ~20 行 |
| 系统日志 | 小屏隐藏 4 列 + 可展开行 | ~30 行 |
| 行情查询 | 小屏隐藏 2 列 | ~20 行 |
| 期权链 | 小屏切换为 Call/Put 标签页 | ~50 行 |

**预估改动量：~270 行代码分布在 8 个文件**

#### 第三层：表单/弹窗适配

| 组件 | 方案 | 改动量 |
|------|------|--------|
| OptionTradeModal | `grid-cols-2` → `grid-cols-1 md:grid-cols-2` | ~5 行 |
| 策略详情页表单 | `grid-cols-3` → `grid-cols-1 md:grid-cols-3` | ~5 行 |
| TradeModal | 检查并调整间距 | ~10 行 |
| EditStrategyModal | 已有 max-w，微调 | ~5 行 |

**预估改动量：~25 行代码分布在 4 个文件**

#### 第四层：已响应式页面微调

K线图、外汇行情、量化首页、回测等已有基础响应式的页面，仅需检查小屏下的间距和字号。

**预估改动量：~30 行代码分布在 5-6 个文件**

---

## 五、成本总结

### 总改动量

| 层次 | 涉及文件数 | 代码改动量 | 新增文件 |
|------|-----------|-----------|---------|
| 基础设施 | 3 | ~120 行 | 1 (hook) |
| 表格适配 | 8 | ~270 行 | 0 |
| 表单弹窗 | 4 | ~25 行 | 0 |
| 微调 | 5-6 | ~30 行 | 0 |
| **合计** | **~16 个文件** | **~445 行** | **1** |

### 风险评估

| 风险项 | 等级 | 说明 |
|--------|------|------|
| PC 端体验受影响 | **极低** | 所有改动通过断点隔离，大屏走原逻辑 |
| 功能回归 | **低** | 不改业务逻辑，仅增加响应式 CSS/条件渲染 |
| Ant Design 兼容性 | **低** | Drawer、responsive Col 均为官方组件 |
| 主页（1818 行）改动风险 | **中低** | 文件大，但改动集中在表格 columns 配置 |

### 关键结论

1. **成本可控** — 总共约 445 行改动，16 个文件，不涉及业务逻辑变更
2. **PC 端零影响** — 所有移动适配通过 `< md`（768px）断点隔离，大屏完全不触发
3. **渐进可拆分** — 可按 4 层优先级逐步实施，第一层完成后移动端即可基本使用
4. **最大挑战** — 主页持仓表格（9 列 1330px）和期权链表格（双向结构），需要设计合理的小屏信息降级方案
5. **无需新增依赖** — Ant Design Drawer、Tailwind 响应式断点已在项目中，不引入新包

---

## 六、建议实施顺序

```
第一层 基础设施  →  立即可做，做完移动端不再缩成一团
       ↓
第二层 首页表格  →  核心页面可用
       ↓
第二层 其余表格  →  全站表格可用
       ↓
第三层 表单弹窗  →  交互流程完整
       ↓
第四层 微调      →  体验打磨
```
