# è‚¡ç¥¨æœŸæƒåŠŸèƒ½å¯è¡Œæ€§åˆ†ææ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£åˆ†æåœ¨ç°æœ‰äº¤æ˜“ç³»ç»Ÿä¸­å¢åŠ è‚¡ç¥¨æœŸæƒåŠŸèƒ½ï¼ˆæœŸæƒé“¾å±•ç¤ºå’ŒæœŸæƒè¯¦æƒ…ï¼‰çš„å¯è¡Œæ€§ï¼ŒåŒ…æ‹¬æŠ€æœ¯å®ç°æ–¹æ¡ˆã€APIé›†æˆæ–¹æ¡ˆã€å‰ç«¯å±•ç¤ºæ–¹æ¡ˆä»¥åŠæ½œåœ¨é£é™©å’ŒæŒ‘æˆ˜ã€‚

**æ–‡æ¡£æ—¥æœŸ**: 2025-01-XX  
**é¡¹ç›®**: trading-system  
**åŠŸèƒ½**: è‚¡ç¥¨æœŸæƒé“¾å±•ç¤ºå’ŒæœŸæƒè¯¦æƒ…æŸ¥çœ‹

---

## ğŸ¯ åŠŸèƒ½éœ€æ±‚

### 1. æœŸæƒé“¾å±•ç¤ºï¼ˆå‚è€ƒå›¾1ï¼‰

**åŠŸèƒ½æè¿°**:
- å±•ç¤ºæŒ‡å®šè‚¡ç¥¨çš„æ‰€æœ‰å¯ç”¨æœŸæƒåˆ°æœŸæ—¥æœŸ
- æ¯ä¸ªåˆ°æœŸæ—¥æœŸä¸‹æ˜¾ç¤ºå¤šä¸ªè¡Œæƒä»·çš„çœ‹æ¶¨ï¼ˆCallï¼‰å’Œçœ‹è·Œï¼ˆPutï¼‰æœŸæƒ
- æ˜¾ç¤ºæœŸæƒçš„å…³é”®ä¿¡æ¯ï¼šæˆäº¤é‡ã€æ¶¨è·Œé¢ã€æ¶¨è·Œå¹…ã€æœ€æ–°ä»·ã€ä¹°ç›˜/å–ç›˜ã€è¡Œæƒä»·
- æ”¯æŒåˆ‡æ¢ä¸åŒçš„åˆ°æœŸæ—¥æœŸæŸ¥çœ‹å¯¹åº”æœŸæƒé“¾

**å±•ç¤ºæ ·å¼**:
- é¡¶éƒ¨ï¼šåˆ°æœŸæ—¥æœŸé€‰æ‹©å™¨ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰
- ä¸»ä½“ï¼šå·¦å³åˆ†æ å±•ç¤º
  - å·¦ä¾§ï¼šçœ‹æ¶¨æœŸæƒï¼ˆCall Optionsï¼‰- ä»·æ ¼ä¸Šæ¶¨æ˜¾ç¤ºçº¢è‰²
  - å³ä¾§ï¼šçœ‹è·ŒæœŸæƒï¼ˆPut Optionsï¼‰- ä»·æ ¼ä¸‹è·Œæ˜¾ç¤ºç»¿è‰²
  - ä¸­é—´ï¼šè¡Œæƒä»·ï¼ˆStrike Priceï¼‰ä½œä¸ºå…±åŒå‚è€ƒåˆ—

### 2. æœŸæƒè¯¦æƒ…é¡µï¼ˆå‚è€ƒå›¾2ï¼‰

**åŠŸèƒ½æè¿°**:
- ç‚¹å‡»æœŸæƒé“¾ä¸­çš„ä»»æ„æœŸæƒï¼Œè¿›å…¥è¯¥æœŸæƒçš„è¯¦æƒ…é¡µ
- æ˜¾ç¤ºæœŸæƒçš„å®æ—¶ä»·æ ¼å›¾è¡¨ï¼ˆåˆ†æ—¶ã€5æ—¥ã€æ—¥Kï¼‰
- æ˜¾ç¤ºæœŸæƒçš„è¯¦ç»†ä¿¡æ¯ï¼š
  - ä»·æ ¼ä¿¡æ¯ï¼šæœ€æ–°ä»·ã€æ¶¨è·Œé¢ã€æ¶¨è·Œå¹…ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€ä»Šå¼€ã€æ˜¨æ”¶
  - æˆäº¤é‡ä¿¡æ¯ï¼šæˆäº¤é‡ã€æˆäº¤é¢ã€æœªå¹³ä»“åˆçº¦æ•°
  - æœŸæƒå‚æ•°ï¼šè¡Œæƒä»·ã€åˆ°æœŸæ—¥ã€åˆçº¦ä¹˜æ•°ã€æœŸæƒç±»å‹ï¼ˆç¾å¼/æ¬§å¼ï¼‰
  - Greeksï¼šDeltaã€Gammaã€Vegaã€Thetaã€Rho
  - éšå«æ³¢åŠ¨ç‡ã€æº¢ä»·ã€å†…åœ¨ä»·å€¼ã€æ—¶é—´ä»·å€¼
  - æ æ†å€æ•°ã€æœ‰æ•ˆæ æ†

---

## âœ… æŠ€æœ¯å¯è¡Œæ€§åˆ†æ

### 1. APIé›†æˆå¯è¡Œæ€§

#### 1.1 ç°æœ‰åŸºç¡€è®¾æ–½

**ä¼˜åŠ¿**:
- âœ… å·²æœ‰å¯Œé€”ç‰›ç‰›APIé›†æˆåŸºç¡€è®¾æ–½ï¼ˆ`api/src/config/futunn.ts`ï¼‰
- âœ… å·²æœ‰`quote-token`ç”Ÿæˆç®—æ³•å®ç°ï¼ˆ`api/src/services/futunn-option-quote.service.ts`ï¼‰
- âœ… å·²æœ‰å¯Œé€”APIè¯·æ±‚å°è£…å’Œé”™è¯¯å¤„ç†æœºåˆ¶
- âœ… å·²æœ‰æœŸæƒè¡Œæƒ…è·å–æœåŠ¡ï¼ˆ`getFutunnOptionQuote`ï¼‰

**ç°æœ‰ä»£ç å¤ç”¨**:
```typescript
// å¯å¤ç”¨çš„ç»„ä»¶
- generateQuoteToken() - quote-tokenç”Ÿæˆç®—æ³•
- getFutunnHeaders() - ç»Ÿä¸€çš„è¯·æ±‚å¤´é…ç½®
- getFutunnConfig() - é…ç½®ç®¡ç†
```

#### 1.2 æ–°å¢APIæ¥å£

**æ¥å£1: è·å–æœŸæƒåˆ°æœŸæ—¥æœŸåˆ—è¡¨**

```typescript
GET https://www.moomoo.com/quote-api/quote-v2/get-option-strike-dates
å‚æ•°:
  - stockId: string (å¿…éœ€) - æ­£è‚¡ID
  - _: number (å¿…éœ€) - æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰

å“åº”æ ¼å¼:
{
  code: 0,
  message: "æˆåŠŸ",
  data: {
    strikeDates: Array<{
      strikeDate: number,      // åˆ°æœŸæ—¥æœŸæ—¶é—´æˆ³ï¼ˆç§’ï¼‰
      expiration: number,       // åˆ°æœŸç±»å‹ï¼š0=å·²è¿‡æœŸï¼Œ1=æœªè¿‡æœŸ
      suffix: string,          // åç¼€ï¼Œå¦‚ "(W)" è¡¨ç¤ºå‘¨æœŸæƒ
      leftDay: number          // è·ç¦»åˆ°æœŸå¤©æ•°
    }>,
    vol: {
      callNum: string,         // çœ‹æ¶¨æœŸæƒæˆäº¤é‡ï¼ˆæ ¼å¼åŒ–ï¼Œå¦‚ "128.96ä¸‡"ï¼‰
      putNum: string,          // çœ‹è·ŒæœŸæƒæˆäº¤é‡
      callRatio: number,       // çœ‹æ¶¨æœŸæƒå æ¯”ï¼ˆç™¾åˆ†æ¯”ï¼‰
      putRatio: number,        // çœ‹è·ŒæœŸæƒå æ¯”
      total: number            // æ€»æˆäº¤é‡
    }
  }
}
```

**æ¥å£2: è·å–æœŸæƒé“¾æ•°æ®**

```typescript
GET https://www.moomoo.com/quote-api/quote-v2/get-option-chain
å‚æ•°:
  - stockId: string (å¿…éœ€) - æ­£è‚¡ID
  - strikeDate: number (å¿…éœ€) - åˆ°æœŸæ—¥æœŸæ—¶é—´æˆ³ï¼ˆç§’ï¼‰
  - expiration: number (å¿…éœ€) - åˆ°æœŸç±»å‹ï¼š0=å·²è¿‡æœŸï¼Œ1=æœªè¿‡æœŸ
  - _: number (å¿…éœ€) - æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰

å“åº”æ ¼å¼:
{
  code: 0,
  message: "æˆåŠŸ",
  data: Array<{
    callOption?: {
      optionId: string,
      optionType: number,      // 1=çœ‹æ¶¨
      code: string,            // æœŸæƒä»£ç ï¼Œå¦‚ "TSLA251128C395000"
      strikePrice: string,     // è¡Œæƒä»·ï¼Œå¦‚ "395.00"
      strikeDate: number,      // åˆ°æœŸæ—¥æœŸæ—¶é—´æˆ³ï¼ˆç§’ï¼‰
      openInterest: string,    // æœªå¹³ä»“åˆçº¦æ•°
      // ... å…¶ä»–å­—æ®µ
    },
    putOption?: {
      optionId: string,
      optionType: number,      // 2=çœ‹è·Œ
      code: string,
      strikePrice: string,
      strikeDate: number,
      openInterest: string,
      // ... å…¶ä»–å­—æ®µ
    }
  }>
}
```

**æ¥å£3: è·å–å•ä¸ªæœŸæƒè¯¦æƒ…**

```typescript
GET https://www.moomoo.com/quote-api/quote-v2/get-stock-quote
å‚æ•°:
  - stockId: string (å¿…éœ€) - æœŸæƒIDï¼ˆä¸æ˜¯æ­£è‚¡IDï¼‰
  - marketType: number (å¿…éœ€) - å¸‚åœºç±»å‹ï¼Œç¾è‚¡ä¸º 2
  - marketCode: number (å¿…éœ€) - å¸‚åœºä»£ç ï¼Œç¾è‚¡æœŸæƒä¸º 41
  - spreadCode: number (å¿…éœ€) - ä»·å·®ä»£ç ï¼ŒæœŸæƒä¸º 81
  - underlyingStockId: string (å¿…éœ€) - æ­£è‚¡ID
  - instrumentType: number (å¿…éœ€) - å·¥å…·ç±»å‹ï¼ŒæœŸæƒä¸º 8
  - subInstrumentType: number (å¿…éœ€) - å­å·¥å…·ç±»å‹ï¼ŒæœŸæƒä¸º 8002
  - _: number (å¿…éœ€) - æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰

å“åº”æ ¼å¼:
{
  code: 0,
  message: "æˆåŠŸ",
  data: {
    // ä»·æ ¼ä¿¡æ¯
    price: string,            // æœ€æ–°ä»·
    change: string,            // æ¶¨è·Œé¢
    changeRatio: string,      // æ¶¨è·Œå¹…
    priceOpen: string,        // ä»Šå¼€
    priceLastClose: string,   // æ˜¨æ”¶
    priceHighest: string,     // æœ€é«˜ä»·
    priceLowest: string,      // æœ€ä½ä»·
    
    // æˆäº¤é‡ä¿¡æ¯
    volume: string,           // æˆäº¤é‡ï¼ˆæ ¼å¼åŒ–ï¼Œå¦‚ "1.87ä¸‡"ï¼‰
    turnover: string,         // æˆäº¤é¢
    priceBid: string,        // ä¹°ç›˜ä»·
    priceAsk: string,         // å–ç›˜ä»·
    volumeBid: number,        // ä¹°ç›˜é‡
    volumeAsk: number,        // å–ç›˜é‡
    
    // æœŸæƒç‰¹å®šä¿¡æ¯
    option: {
      priceStrike: string,           // è¡Œæƒä»·
      contractSize: string,          // åˆçº¦è§„æ¨¡
      openInterest: string,          // æœªå¹³ä»“åˆçº¦æ•°
      premium: string,               // æº¢ä»·ï¼ˆç™¾åˆ†æ¯”ï¼‰
      impliedVolatility: string,     // éšå«æ³¢åŠ¨ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
      greek: {
        delta: string,               // Delta
        gamma: string,                // Gamma
        vega: string,                 // Vega
        theta: string,                // Theta
        rho: string,                  // Rho
        hpDelta: string,             // é«˜ç²¾åº¦Delta
        hpGamma: string,              // é«˜ç²¾åº¦Gamma
        hpVega: string,              // é«˜ç²¾åº¦Vega
        hpTheta: string,             // é«˜ç²¾åº¦Theta
        hpRho: string                // é«˜ç²¾åº¦Rho
      },
      leverage: string,              // æ æ†å€æ•°
      effectiveLeverage: string,    // æœ‰æ•ˆæ æ†
      intrinsicValue: string,        // å†…åœ¨ä»·å€¼
      timeValue: string,             // æ—¶é—´ä»·å€¼
      distanceDueDate: number,       // è·ç¦»åˆ°æœŸå¤©æ•°
      optionType: number,            // æœŸæƒç±»å‹ï¼š0=çœ‹è·Œï¼Œ1=çœ‹æ¶¨
      multiplier: number             // åˆçº¦ä¹˜æ•°
    },
    
    // æ­£è‚¡ä¿¡æ¯
    underlyingStockInfo: {
      stockCode: string,             // æ­£è‚¡ä»£ç ï¼Œå¦‚ "TSLA"
      name: string,                  // æ­£è‚¡åç§°
      price: string,                 // æ­£è‚¡ä»·æ ¼
      change: string,                // æ­£è‚¡æ¶¨è·Œé¢
      changeRatio: string           // æ­£è‚¡æ¶¨è·Œå¹…
    }
  }
}
```

#### 1.3 APIé›†æˆå®ç°æ–¹æ¡ˆ

**åç«¯æœåŠ¡å±‚** (`api/src/services/futunn-option-chain.service.ts`):

```typescript
/**
 * è·å–æœŸæƒåˆ°æœŸæ—¥æœŸåˆ—è¡¨
 */
export async function getOptionStrikeDates(stockId: string): Promise<{
  strikeDates: Array<{
    strikeDate: number;
    expiration: number;
    suffix: string;
    leftDay: number;
  }>;
  vol: {
    callNum: string;
    putNum: string;
    callRatio: number;
    putRatio: number;
    total: number;
  };
} | null>

/**
 * è·å–æœŸæƒé“¾æ•°æ®
 */
export async function getOptionChain(
  stockId: string,
  strikeDate: number
): Promise<Array<{
  callOption?: OptionInfo;
  putOption?: OptionInfo;
}> | null>

/**
 * è·å–æœŸæƒè¯¦æƒ…
 */
export async function getOptionDetail(
  optionId: string,
  underlyingStockId: string,
  marketType: number
): Promise<OptionDetail | null>
```

**åç«¯è·¯ç”±å±‚** (`api/src/routes/options.ts`):

```typescript
// GET /api/options/strike-dates?stockId=201335
// GET /api/options/chain?stockId=201335&strikeDate=1764306000
// GET /api/options/detail?optionId=63939448&underlyingStockId=201335&marketType=2
```

### 2. å‰ç«¯å®ç°å¯è¡Œæ€§

#### 2.1 æŠ€æœ¯æ ˆå…¼å®¹æ€§

**ç°æœ‰æŠ€æœ¯æ ˆ**:
- âœ… Next.js 14 (App Router) - æ”¯æŒåŠ¨æ€è·¯ç”±å’ŒSSR
- âœ… TypeScript - ç±»å‹å®‰å…¨
- âœ… Tailwind CSS - æ ·å¼æ¡†æ¶ï¼Œæ”¯æŒå“åº”å¼è®¾è®¡
- âœ… Recharts - å›¾è¡¨åº“ï¼Œå¯ç”¨äºæœŸæƒä»·æ ¼å›¾è¡¨

**æ–°å¢éœ€æ±‚**:
- âœ… è¡¨æ ¼å±•ç¤ºï¼ˆæœŸæƒé“¾ï¼‰- å¯ä½¿ç”¨åŸç”ŸHTML tableæˆ–Tailwind CSS
- âœ… å›¾è¡¨å±•ç¤ºï¼ˆæœŸæƒè¯¦æƒ…ï¼‰- å¯ä½¿ç”¨Rechartsï¼ˆå·²æœ‰ï¼‰
- âœ… æ—¥æœŸé€‰æ‹©å™¨ - å¯ä½¿ç”¨åŸç”ŸHTML selectæˆ–è‡ªå®šä¹‰ç»„ä»¶

#### 2.2 å‰ç«¯é¡µé¢ç»“æ„

**æœŸæƒé“¾é¡µé¢** (`frontend/app/options/chain/page.tsx`):

```
/options/chain?symbol=TSLA.US
â”œâ”€â”€ é¡¶éƒ¨å¯¼èˆªæ 
â”‚   â”œâ”€â”€ è‚¡ç¥¨æœç´¢æ¡†ï¼ˆè‡ªåŠ¨å®Œæˆï¼‰
â”‚   â””â”€â”€ è¿”å›æŒ‰é’®
â”œâ”€â”€ åˆ°æœŸæ—¥æœŸé€‰æ‹©å™¨ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰
â”‚   â””â”€â”€ æ—¥æœŸæ ‡ç­¾ï¼ˆå¸¦åç¼€ï¼Œå¦‚ "2025/11/28 (W)"ï¼‰
â”œâ”€â”€ æœŸæƒé“¾è¡¨æ ¼
â”‚   â”œâ”€â”€ è¡¨å¤´
â”‚   â”‚   â”œâ”€â”€ çœ‹æ¶¨æœŸæƒåˆ—ï¼ˆæˆäº¤é‡ã€æ¶¨è·Œé¢ã€æ¶¨è·Œå¹…ã€æœ€æ–°ä»·ã€å–ç›˜ã€ä¹°ç›˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ è¡Œæƒä»·åˆ—ï¼ˆä¸­é—´ï¼‰
â”‚   â”‚   â””â”€â”€ çœ‹è·ŒæœŸæƒåˆ—ï¼ˆä¹°ç›˜ã€å–ç›˜ã€æœ€æ–°ä»·ã€æ¶¨è·Œå¹…ã€æ¶¨è·Œé¢ã€æˆäº¤é‡ï¼‰
â”‚   â””â”€â”€ æ•°æ®è¡Œï¼ˆæ¯è¡Œå¯¹åº”ä¸€ä¸ªè¡Œæƒä»·ï¼‰
â””â”€â”€ æˆäº¤é‡ç»Ÿè®¡ï¼ˆçœ‹æ¶¨/çœ‹è·Œæ¯”ä¾‹ï¼‰
```

**æœŸæƒè¯¦æƒ…é¡µ** (`frontend/app/options/[optionCode]/page.tsx`):

```
/options/TSLA251205P395000-US
â”œâ”€â”€ é¡¶éƒ¨ä¿¡æ¯æ 
â”‚   â”œâ”€â”€ æœŸæƒä»£ç å’Œåç§°
â”‚   â”œâ”€â”€ å½“å‰ä»·æ ¼ï¼ˆå¤§å·æ˜¾ç¤ºï¼‰
â”‚   â””â”€â”€ æ¶¨è·Œä¿¡æ¯
â”œâ”€â”€ å›¾è¡¨åŒºåŸŸ
â”‚   â”œâ”€â”€ æ—¶é—´é€‰æ‹©å™¨ï¼ˆåˆ†æ—¶ã€5æ—¥ã€æ—¥Kï¼‰
â”‚   â”œâ”€â”€ ä»·æ ¼å›¾è¡¨ï¼ˆRechartsï¼‰
â”‚   â””â”€â”€ æˆäº¤é‡å›¾è¡¨ï¼ˆRechartsï¼‰
â””â”€â”€ è¯¦ç»†ä¿¡æ¯é¢æ¿
    â”œâ”€â”€ ä»·æ ¼ä¿¡æ¯
    â”œâ”€â”€ æˆäº¤é‡ä¿¡æ¯
    â”œâ”€â”€ æœŸæƒå‚æ•°
    â”œâ”€â”€ Greeks
    â””â”€â”€ æ­£è‚¡ä¿¡æ¯
```

#### 2.3 æ•°æ®æµè®¾è®¡

```
ç”¨æˆ·æ“ä½œæµç¨‹:
1. è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ TSLAï¼‰â†’ æœç´¢æ­£è‚¡ â†’ è·å–stockId
2. é€‰æ‹©è‚¡ç¥¨ â†’ è°ƒç”¨ /api/options/strike-dates â†’ æ˜¾ç¤ºåˆ°æœŸæ—¥æœŸåˆ—è¡¨
3. é€‰æ‹©åˆ°æœŸæ—¥æœŸ â†’ è°ƒç”¨ /api/options/chain â†’ æ˜¾ç¤ºæœŸæƒé“¾
4. ç‚¹å‡»æœŸæƒ â†’ è·³è½¬åˆ° /options/[optionCode] â†’ è°ƒç”¨ /api/options/detail â†’ æ˜¾ç¤ºè¯¦æƒ…
```

### 3. æ•°æ®æ ¼å¼å…¼å®¹æ€§

#### 3.1 ä¸ç°æœ‰ç³»ç»Ÿå…¼å®¹

**ä¼˜åŠ¿**:
- âœ… å¯Œé€”APIè¿”å›æ ¼å¼ä¸ç°æœ‰æœŸæƒè¡Œæƒ…APIæ ¼å¼ç›¸ä¼¼
- âœ… å¯ä»¥ä½¿ç”¨ç°æœ‰çš„`getFutunnOptionQuote`ä½œä¸ºå‚è€ƒå®ç°
- âœ… æ—¶é—´æˆ³æ ¼å¼ç»Ÿä¸€ï¼ˆç§’çº§æ—¶é—´æˆ³ï¼‰

**éœ€è¦æ³¨æ„**:
- âš ï¸ å¯Œé€”APIè¿”å›çš„ä»·æ ¼å¯èƒ½æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼Œéœ€è¦è½¬æ¢ä¸ºæ•°å­—
- âš ï¸ æˆäº¤é‡å¯èƒ½ä½¿ç”¨"ä¸‡"ç­‰å•ä½ï¼Œéœ€è¦è§£æï¼ˆå¦‚ "1.87ä¸‡" â†’ 18700ï¼‰
- âš ï¸ ç™¾åˆ†æ¯”å­—æ®µå¯èƒ½åŒ…å«"%"ç¬¦å·ï¼Œéœ€è¦æ¸…ç†

#### 3.2 æ•°æ®è½¬æ¢å‡½æ•°

```typescript
/**
 * è§£ææˆäº¤é‡å­—ç¬¦ä¸²ï¼ˆæ”¯æŒ"ä¸‡"ç­‰å•ä½ï¼‰
 */
function parseVolume(volumeStr: string): number {
  if (volumeStr.includes('ä¸‡')) {
    return parseFloat(volumeStr) * 10000;
  }
  return parseFloat(volumeStr);
}

/**
 * è§£æç™¾åˆ†æ¯”å­—ç¬¦ä¸²
 */
function parsePercentage(percentStr: string): number {
  return parseFloat(percentStr.replace('%', ''));
}
```

---

## âš ï¸ æ½œåœ¨é£é™©å’ŒæŒ‘æˆ˜

### 1. APIç¨³å®šæ€§é£é™©

**é£é™©**:
- âš ï¸ å¯Œé€”APIæ˜¯æœªå…¬å¼€çš„å†…éƒ¨APIï¼Œå¯èƒ½éšæ—¶å˜æ›´
- âš ï¸ å¯èƒ½å­˜åœ¨è¯·æ±‚é¢‘ç‡é™åˆ¶
- âš ï¸ Cookieså’ŒCSRF Tokenå¯èƒ½è¿‡æœŸ

**ç¼“è§£æªæ–½**:
- âœ… ä½¿ç”¨ç°æœ‰çš„æ¸¸å®¢é…ç½®ï¼ˆç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼‰
- âœ… å®ç°è¯·æ±‚é‡è¯•æœºåˆ¶å’Œé”™è¯¯å¤„ç†
- âœ… æ·»åŠ è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼ˆrate limitingï¼‰
- âœ… å®ç°æ•°æ®ç¼“å­˜æœºåˆ¶ï¼ˆå‡å°‘APIè°ƒç”¨ï¼‰

### 2. æ•°æ®å‡†ç¡®æ€§é£é™©

**é£é™©**:
- âš ï¸ å¯Œé€”APIè¿”å›çš„æ•°æ®å¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼ˆ15åˆ†é’Ÿå»¶æ—¶è¡Œæƒ…ï¼‰
- âš ï¸ æ•°æ®æ ¼å¼å¯èƒ½ä¸ä¸€è‡´ï¼ˆå­—ç¬¦ä¸²/æ•°å­—æ··ç”¨ï¼‰

**ç¼“è§£æªæ–½**:
- âœ… åœ¨UIä¸Šæ˜ç¡®æ ‡æ³¨æ•°æ®æ¥æºå’Œå»¶è¿Ÿæ—¶é—´
- âœ… å®ç°ç»Ÿä¸€çš„æ•°æ®è½¬æ¢å’ŒéªŒè¯å‡½æ•°
- âœ… æ·»åŠ æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥

### 3. æ€§èƒ½é£é™©

**é£é™©**:
- âš ï¸ æœŸæƒé“¾æ•°æ®é‡å¤§ï¼ˆå¯èƒ½åŒ…å«æ•°ç™¾ä¸ªæœŸæƒï¼‰
- âš ï¸ å¤šä¸ªAPIè°ƒç”¨å¯èƒ½å¯¼è‡´é¡µé¢åŠ è½½æ…¢

**ç¼“è§£æªæ–½**:
- âœ… å®ç°æ•°æ®åˆ†é¡µæˆ–è™šæ‹Ÿæ»šåŠ¨ï¼ˆä»…æ¸²æŸ“å¯è§è¡Œï¼‰
- âœ… ä½¿ç”¨React.memoä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
- âœ… å®ç°æ•°æ®ç¼“å­˜ï¼ˆç›¸åŒè¯·æ±‚çŸ­æ—¶é—´å†…ä¸é‡å¤è°ƒç”¨ï¼‰
- âœ… ä½¿ç”¨WebSocketæˆ–è½®è¯¢å®ç°å®æ—¶æ›´æ–°ï¼ˆå¯é€‰ï¼‰

### 4. ç”¨æˆ·ä½“éªŒé£é™©

**é£é™©**:
- âš ï¸ æœŸæƒé“¾è¡¨æ ¼åœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºå›°éš¾
- âš ï¸ æ•°æ®æ›´æ–°é¢‘ç¹å¯èƒ½å¯¼è‡´é¡µé¢é—ªçƒ

**ç¼“è§£æªæ–½**:
- âœ… å®ç°å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨å¡ç‰‡å¼å¸ƒå±€ï¼‰
- âœ… ä½¿ç”¨éª¨æ¶å±ï¼ˆSkeletonï¼‰æå‡åŠ è½½ä½“éªŒ
- âœ… å®ç°å¹³æ»‘çš„æ•°æ®æ›´æ–°åŠ¨ç”»
- âœ… æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤º

---

## ğŸ“… å®æ–½è®¡åˆ’

### é˜¶æ®µ1: åç«¯APIé›†æˆï¼ˆé¢„è®¡3-5å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**:
1. âœ… åˆ›å»ºæœŸæƒé“¾æœåŠ¡ (`api/src/services/futunn-option-chain.service.ts`)
   - å®ç°`getOptionStrikeDates()`å‡½æ•°
   - å®ç°`getOptionChain()`å‡½æ•°
   - å®ç°`getOptionDetail()`å‡½æ•°
   - æ·»åŠ æ•°æ®è½¬æ¢å’Œé”™è¯¯å¤„ç†

2. âœ… åˆ›å»ºæœŸæƒè·¯ç”± (`api/src/routes/options.ts`)
   - `GET /api/options/strike-dates` - è·å–åˆ°æœŸæ—¥æœŸåˆ—è¡¨
   - `GET /api/options/chain` - è·å–æœŸæƒé“¾
   - `GET /api/options/detail` - è·å–æœŸæƒè¯¦æƒ…
   - æ·»åŠ å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†

3. âœ… é›†æˆåˆ°ä¸»æœåŠ¡å™¨ (`api/src/server.ts`)
   - æ³¨å†ŒæœŸæƒè·¯ç”±
   - æ·»åŠ è·¯ç”±æ–‡æ¡£æ³¨é‡Š

4. âœ… æµ‹è¯•APIæ¥å£
   - ç¼–å†™å•å…ƒæµ‹è¯•
   - ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•æ¥å£
   - éªŒè¯æ•°æ®æ ¼å¼å’Œé”™è¯¯å¤„ç†

### é˜¶æ®µ2: å‰ç«¯é¡µé¢å¼€å‘ï¼ˆé¢„è®¡5-7å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**:
1. âœ… åˆ›å»ºæœŸæƒé“¾é¡µé¢ (`frontend/app/options/chain/page.tsx`)
   - å®ç°è‚¡ç¥¨æœç´¢å’Œè‡ªåŠ¨å®Œæˆ
   - å®ç°åˆ°æœŸæ—¥æœŸé€‰æ‹©å™¨
   - å®ç°æœŸæƒé“¾è¡¨æ ¼ï¼ˆå·¦å³åˆ†æ ï¼‰
   - å®ç°æ•°æ®åˆ·æ–°å’ŒåŠ è½½çŠ¶æ€

2. âœ… åˆ›å»ºæœŸæƒè¯¦æƒ…é¡µ (`frontend/app/options/[optionCode]/page.tsx`)
   - å®ç°æœŸæƒä¿¡æ¯å±•ç¤º
   - é›†æˆRechartså›¾è¡¨ï¼ˆä»·æ ¼å’Œæˆäº¤é‡ï¼‰
   - å®ç°æ—¶é—´é€‰æ‹©å™¨ï¼ˆåˆ†æ—¶ã€5æ—¥ã€æ—¥Kï¼‰
   - å®ç°è¯¦ç»†ä¿¡æ¯é¢æ¿

3. âœ… åˆ›å»ºAPIå®¢æˆ·ç«¯å‡½æ•° (`frontend/lib/api.ts`)
   - `optionsApi.getStrikeDates()`
   - `optionsApi.getOptionChain()`
   - `optionsApi.getOptionDetail()`

4. âœ… åˆ›å»ºå¯å¤ç”¨ç»„ä»¶ (`frontend/components/`)
   - `OptionChainTable.tsx` - æœŸæƒé“¾è¡¨æ ¼ç»„ä»¶
   - `OptionDetailPanel.tsx` - æœŸæƒè¯¦æƒ…é¢æ¿ç»„ä»¶
   - `OptionChart.tsx` - æœŸæƒå›¾è¡¨ç»„ä»¶

5. âœ… æ ·å¼ä¼˜åŒ–å’Œå“åº”å¼è®¾è®¡
   - ç§»åŠ¨ç«¯é€‚é…
   - åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤º
   - æ•°æ®æ›´æ–°åŠ¨ç”»

### é˜¶æ®µ3: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆé¢„è®¡2-3å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**:
1. âœ… åŠŸèƒ½æµ‹è¯•
   - æµ‹è¯•ä¸åŒè‚¡ç¥¨çš„æœŸæƒé“¾å±•ç¤º
   - æµ‹è¯•æœŸæƒè¯¦æƒ…é¡µçš„å„ä¸ªåŠŸèƒ½
   - æµ‹è¯•é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

2. âœ… æ€§èƒ½ä¼˜åŒ–
   - ä¼˜åŒ–æ•°æ®åŠ è½½é€Ÿåº¦
   - å®ç°æ•°æ®ç¼“å­˜æœºåˆ¶
   - ä¼˜åŒ–ç»„ä»¶æ¸²æŸ“æ€§èƒ½

3. âœ… ç”¨æˆ·ä½“éªŒä¼˜åŒ–
   - ä¼˜åŒ–åŠ è½½çŠ¶æ€æ˜¾ç¤º
   - ä¼˜åŒ–é”™è¯¯æç¤ºä¿¡æ¯
   - ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ

---

## ğŸ“Š å·¥ä½œé‡ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| é˜¶æ®µ1 | åç«¯APIé›†æˆ | 3-5å¤© | P0 |
| é˜¶æ®µ2 | å‰ç«¯é¡µé¢å¼€å‘ | 5-7å¤© | P0 |
| é˜¶æ®µ3 | æµ‹è¯•å’Œä¼˜åŒ– | 2-3å¤© | P1 |
| **æ€»è®¡** | | **10-15å¤©** | |

---

## âœ… å¯è¡Œæ€§ç»“è®º

### æŠ€æœ¯å¯è¡Œæ€§: âœ… **é«˜åº¦å¯è¡Œ**

**ç†ç”±**:
1. âœ… ç°æœ‰åŸºç¡€è®¾æ–½å®Œå–„ï¼Œå¯ä»¥å¤ç”¨å¤§é‡ä»£ç 
2. âœ… å¯Œé€”APIæ¥å£æ¸…æ™°ï¼Œæ•°æ®æ ¼å¼æ˜ç¡®
3. âœ… å‰ç«¯æŠ€æœ¯æ ˆå®Œå…¨æ”¯æŒæ‰€éœ€åŠŸèƒ½
4. âœ… æ²¡æœ‰ä¸å¯é€¾è¶Šçš„æŠ€æœ¯éšœç¢

### å®æ–½å¯è¡Œæ€§: âœ… **å¯è¡Œ**

**ç†ç”±**:
1. âœ… å·¥ä½œé‡åˆç†ï¼ˆ10-15å¤©ï¼‰
2. âœ… é£é™©å¯æ§ï¼Œæœ‰æ˜ç¡®çš„ç¼“è§£æªæ–½
3. âœ… å¯ä»¥åˆ†é˜¶æ®µå®æ–½ï¼Œé™ä½é£é™©
4. âœ… ä¸ç°æœ‰ç³»ç»Ÿå…¼å®¹æ€§å¥½

### å»ºè®®

1. **ä¼˜å…ˆå®æ–½**: å»ºè®®ä¼˜å…ˆå®æ–½æœŸæƒé“¾å±•ç¤ºåŠŸèƒ½ï¼Œè¿™æ˜¯æ ¸å¿ƒåŠŸèƒ½
2. **åˆ†é˜¶æ®µå‘å¸ƒ**: å¯ä»¥å…ˆå‘å¸ƒåŸºç¡€åŠŸèƒ½ï¼Œåç»­é€æ­¥ä¼˜åŒ–
3. **ç›‘æ§APIç¨³å®šæ€§**: å¯†åˆ‡å…³æ³¨å¯Œé€”APIçš„å˜åŒ–ï¼ŒåŠæ—¶è°ƒæ•´
4. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**: é‡ç‚¹å…³æ³¨æ•°æ®åŠ è½½é€Ÿåº¦å’Œé”™è¯¯å¤„ç†

---

## ğŸ“ é™„å½•

### A. APIæ¥å£è¯¦ç»†è¯´æ˜

#### A.1 è·å–æœŸæƒåˆ°æœŸæ—¥æœŸåˆ—è¡¨

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X GET "https://www.moomoo.com/quote-api/quote-v2/get-option-strike-dates?stockId=201335&_=1764301284312" \
  -H "futu-x-csrf-token: f51O2KPxQvir0tU5zDCVQpMm" \
  -H "quote-token: f33ca0e4fd" \
  -H "Cookie: ..."
```

**å“åº”ç¤ºä¾‹**: è§ç”¨æˆ·æä¾›çš„æ¥å£æ–‡æ¡£

#### A.2 è·å–æœŸæƒé“¾æ•°æ®

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X GET "https://www.moomoo.com/quote-api/quote-v2/get-option-chain?stockId=201335&strikeDate=1764306000&expiration=1&_=1764301699174" \
  -H "futu-x-csrf-token: f51O2KPxQvir0tU5zDCVQpMm" \
  -H "quote-token: <calculated>" \
  -H "Cookie: ..."
```

**å“åº”ç¤ºä¾‹**: è§`OPTION_QUOTE_API.md`æ–‡æ¡£

#### A.3 è·å–æœŸæƒè¯¦æƒ…

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X GET "https://www.moomoo.com/quote-api/quote-v2/get-stock-quote?stockId=63939448&marketType=2&marketCode=41&spreadCode=81&underlyingStockId=201335&instrumentType=8&subInstrumentType=8002&_=1764301699174" \
  -H "futu-x-csrf-token: f51O2KPxQvir0tU5zDCVQpMm" \
  -H "quote-token: <calculated>" \
  -H "Cookie: ..."
```

**å“åº”ç¤ºä¾‹**: è§ç”¨æˆ·æä¾›çš„æ¥å£æ–‡æ¡£

### B. æ•°æ®æ¨¡å‹å®šä¹‰

```typescript
// æœŸæƒåˆ°æœŸæ—¥æœŸ
interface StrikeDate {
  strikeDate: number;      // æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
  expiration: number;       // 0=å·²è¿‡æœŸï¼Œ1=æœªè¿‡æœŸ
  suffix: string;          // åç¼€ï¼Œå¦‚ "(W)"
  leftDay: number;         // è·ç¦»åˆ°æœŸå¤©æ•°
}

// æœŸæƒåŸºæœ¬ä¿¡æ¯
interface OptionInfo {
  optionId: string;
  optionType: number;      // 1=çœ‹æ¶¨ï¼Œ2=çœ‹è·Œ
  code: string;           // æœŸæƒä»£ç 
  strikePrice: string;     // è¡Œæƒä»·
  strikeDate: number;      // åˆ°æœŸæ—¥æœŸæ—¶é—´æˆ³
  openInterest: string;    // æœªå¹³ä»“åˆçº¦æ•°
}

// æœŸæƒé“¾æ•°æ®
interface OptionChainRow {
  callOption?: OptionInfo;
  putOption?: OptionInfo;
}

// æœŸæƒè¯¦æƒ…
interface OptionDetail {
  // ä»·æ ¼ä¿¡æ¯
  price: number;
  change: number;
  changeRatio: number;
  priceOpen: number;
  priceLastClose: number;
  priceHighest: number;
  priceLowest: number;
  
  // æˆäº¤é‡ä¿¡æ¯
  volume: number;
  turnover: number;
  priceBid: number;
  priceAsk: number;
  volumeBid: number;
  volumeAsk: number;
  
  // æœŸæƒç‰¹å®šä¿¡æ¯
  option: {
    strikePrice: number;
    contractSize: number;
    openInterest: number;
    premium: number;
    impliedVolatility: number;
    greeks: {
      delta: number;
      gamma: number;
      vega: number;
      theta: number;
      rho: number;
    };
    leverage: number;
    effectiveLeverage: number;
    intrinsicValue: number;
    timeValue: number;
    daysToExpiration: number;
    optionType: 'Call' | 'Put';
    multiplier: number;
  };
  
  // æ­£è‚¡ä¿¡æ¯
  underlyingStock: {
    code: string;
    name: string;
    price: number;
    change: number;
    changeRatio: number;
  };
}
```

### C. å‚è€ƒæ–‡æ¡£

- [æœŸæƒè¡Œæƒ…APIæ–‡æ¡£](OPTION_QUOTE_API.md)
- [å¯Œé€”ç‰›ç‰›é…ç½®](api/src/config/futunn.ts)
- [å¯Œé€”æœŸæƒè¡Œæƒ…æœåŠ¡](api/src/services/futunn-option-quote.service.ts)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-XX  
**ä½œè€…**: AI Assistant  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸

