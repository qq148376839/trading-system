# å§”æ‰˜ä¸‹å•åŠŸèƒ½ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

- [ä¸€ã€å½“å‰çŠ¶æ€åˆ†æ](#ä¸€å½“å‰çŠ¶æ€åˆ†æ)
- [äºŒã€ç¼ºå¤±åŠŸèƒ½è¯†åˆ«](#äºŒç¼ºå¤±åŠŸèƒ½è¯†åˆ«)
- [ä¸‰ã€ä¼˜åŒ–ç›®æ ‡](#ä¸‰ä¼˜åŒ–ç›®æ ‡)
- [å››ã€è¯¦ç»†ä¼˜åŒ–æ­¥éª¤](#å››è¯¦ç»†ä¼˜åŒ–æ­¥éª¤)
- [äº”ã€API æ¥å£è®¾è®¡](#äº”api-æ¥å£è®¾è®¡)
- [å…­ã€å‰ç«¯ç•Œé¢ä¼˜åŒ–](#å…­å‰ç«¯ç•Œé¢ä¼˜åŒ–)
- [ä¸ƒã€æµ‹è¯•éªŒè¯](#ä¸ƒæµ‹è¯•éªŒè¯)
- [å…«ã€å®æ–½è®¡åˆ’](#å…«å®æ–½è®¡åˆ’)

---

## ä¸€ã€å½“å‰çŠ¶æ€åˆ†æ

### 1.1 ç°æœ‰å®ç°

**åç«¯å®ç°ï¼ˆ`api/src/routes/orders.ts`ï¼‰ï¼š**

```1139:1328:api/src/routes/orders.ts
ordersRouter.post('/submit', async (req: Request, res: Response) => {
  try {
    const { symbol, side, orderType, quantity, price } = req.body;
    // ... å‚æ•°éªŒè¯å’Œè®¢å•æäº¤é€»è¾‘
  }
});
```

**å‰ç«¯å®ç°ï¼ˆ`frontend/components/TradeModal.tsx`ï¼‰ï¼š**

```22:58:frontend/components/TradeModal.tsx
const handleSubmit = async () => {
  // ... å‰ç«¯æäº¤é€»è¾‘
};
```

### 1.2 å½“å‰æ”¯æŒçš„åŠŸèƒ½

âœ… **åŸºç¡€åŠŸèƒ½**ï¼š
- æ”¯æŒè®¢å•ç±»å‹ï¼š`LO`ï¼ˆé™ä»·å•ï¼‰ã€`AO`ï¼ˆç«ä»·å•ï¼‰ã€`ELO`ï¼ˆå¢å¼ºé™ä»·å•ï¼‰ã€`EAO`ï¼ˆç‰¹åˆ«é™ä»·å•ï¼‰
- æ”¯æŒä¹°å–æ–¹å‘ï¼š`Buy`ï¼ˆä¹°å…¥ï¼‰ã€`Sell`ï¼ˆå–å‡ºï¼‰
- æ”¯æŒæ•°é‡ã€ä»·æ ¼å‚æ•°
- åŸºç¡€å‚æ•°éªŒè¯

âœ… **å·²å®ç°çš„éªŒè¯**ï¼š
- Symbol æ ¼å¼éªŒè¯ï¼ˆæ”¯æŒ `ticker.region` å’Œ `.ticker.region` æ ¼å¼ï¼‰
- è®¢å•ç±»å‹éªŒè¯
- ä¹°å–æ–¹å‘éªŒè¯
- æ•°é‡éªŒè¯ï¼ˆå¿…é¡»ä¸ºæ­£æ•´æ•°ï¼‰
- é™ä»·å•ä»·æ ¼éªŒè¯

---

## äºŒã€ç¼ºå¤±åŠŸèƒ½è¯†åˆ«

### 2.1 ç¼ºå¤±çš„å…³é”® API å‚æ•°

æ ¹æ® [Longbridge OpenAPI å§”æ‰˜ä¸‹å•æ–‡æ¡£](https://open.longbridge.com/zh-CN/docs/trade/order/submit)ï¼Œå½“å‰å®ç°**ç¼ºå¤±ä»¥ä¸‹å…³é”®å‚æ•°**ï¼š

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | å½“å‰çŠ¶æ€ |
|--------|------|------|------|----------|
| `submitted_price` | string | NO | ä¸‹å•ä»·æ ¼ï¼ˆé™ä»·å•å¿…å¡«ï¼‰ | âœ… å·²æ”¯æŒ |
| `submitted_quantity` | string | YES | ä¸‹å•æ•°é‡ | âœ… å·²æ”¯æŒ |
| `trigger_price` | string | NO | è§¦å‘ä»·æ ¼ï¼ˆ`LIT`/`MIT` è®¢å•å¿…å¡«ï¼‰ | âœ… **å·²æ”¯æŒ** |
| `limit_offset` | string | NO | æŒ‡å®šä»·å·®ï¼ˆ`TSLPAMT`/`TSLPPCT` è®¢å•å¿…å¡«ï¼‰ | âœ… **å·²æ”¯æŒ** |
| `trailing_amount` | string | NO | è·Ÿè¸ªé‡‘é¢ï¼ˆ`TSLPAMT` è®¢å•å¿…å¡«ï¼‰ | âœ… **å·²æ”¯æŒ** |
| `trailing_percent` | string | NO | è·Ÿè¸ªæ¶¨è·Œå¹…ï¼ˆ`TSLPPCT` è®¢å•å¿…å¡«ï¼‰ | âœ… **å·²æ”¯æŒ** |
| `expire_date` | string | NO | é•¿æœŸå•è¿‡æœŸæ—¶é—´ï¼ˆ`GTD` æ—¶å¿…å¡«ï¼‰ | âœ… **å·²æ”¯æŒ** |
| `outside_rth` | string | NO | æ˜¯å¦å…è®¸ç›˜å‰ç›˜åï¼ˆç¾è‚¡å¿…å¡«ï¼‰ | âœ… **å·²æ”¯æŒ** |
| `time_in_force` | string | YES | è®¢å•æœ‰æ•ˆæœŸç±»å‹ï¼ˆå½“å‰ç¡¬ç¼–ç ä¸º `Day`ï¼‰ | âœ… **å·²æ”¯æŒ** |
| `remark` | string | NO | å¤‡æ³¨ï¼ˆæœ€å¤§ 64 å­—ç¬¦ï¼‰ | âœ… **å·²æ”¯æŒ** |

### 2.2 ç¼ºå¤±çš„è®¢å•ç±»å‹æ”¯æŒ

å½“å‰ä»…æ”¯æŒåŸºç¡€è®¢å•ç±»å‹ï¼Œ**ç¼ºå¤±ä»¥ä¸‹é«˜çº§è®¢å•ç±»å‹**ï¼š

| è®¢å•ç±»å‹ | è¯´æ˜ | æ”¯æŒå¸‚åœº | å½“å‰çŠ¶æ€ |
|---------|------|---------|---------|
| `MO` | å¸‚ä»·å• | æ¸¯è‚¡ã€ç¾è‚¡ | âœ… **å·²æ”¯æŒ** |
| `LIT` | è§¦ä»·é™ä»·å• | æ¸¯è‚¡ã€ç¾è‚¡ | âœ… **å·²æ”¯æŒ** |
| `MIT` | è§¦ä»·å¸‚ä»·å• | æ¸¯è‚¡ã€ç¾è‚¡ | âœ… **å·²æ”¯æŒ** |
| `TSLPAMT` | è·Ÿè¸ªæ­¢æŸé™ä»·å•ï¼ˆè·Ÿè¸ªé‡‘é¢ï¼‰ | æ¸¯è‚¡ã€ç¾è‚¡ | âœ… **å·²æ”¯æŒ** |
| `TSLPPCT` | è·Ÿè¸ªæ­¢æŸé™ä»·å•ï¼ˆè·Ÿè¸ªæ¶¨è·Œå¹…ï¼‰ | æ¸¯è‚¡ã€ç¾è‚¡ | âœ… **å·²æ”¯æŒ** |
| `SLO` | ç‰¹æ®Šé™ä»·å• | æ¸¯è‚¡ | âœ… **å·²æ”¯æŒ** |

### 2.3 ç¼ºå¤±çš„è®¢å•æœ‰æ•ˆæœŸç±»å‹

å½“å‰ç¡¬ç¼–ç ä¸º `Day`ï¼ˆå½“æ—¥æœ‰æ•ˆï¼‰ï¼Œ**ç¼ºå¤±ä»¥ä¸‹æœ‰æ•ˆæœŸç±»å‹**ï¼š

| æœ‰æ•ˆæœŸç±»å‹ | è¯´æ˜ | å½“å‰çŠ¶æ€ |
|-----------|------|---------|
| `Day` | å½“æ—¥æœ‰æ•ˆ | âœ… å·²æ”¯æŒ |
| `GTC` | æ’¤å•å‰æœ‰æ•ˆ | âœ… **å·²æ”¯æŒ** |
| `GTD` | åˆ°æœŸå‰æœ‰æ•ˆï¼ˆéœ€é…åˆ `expire_date`ï¼‰ | âœ… **å·²æ”¯æŒ** |

### 2.4 ç¼ºå¤±çš„ç›˜å‰ç›˜åé€‰é¡¹

ç¾è‚¡è®¢å•**å¿…é¡»**æŒ‡å®š `outside_rth` å‚æ•°ï¼Œå½“å‰å®ç°**å®Œå…¨ç¼ºå¤±**ï¼š

| é€‰é¡¹å€¼ | è¯´æ˜ | å½“å‰çŠ¶æ€ |
|--------|------|---------|
| `RTH_ONLY` | ä¸å…è®¸ç›˜å‰ç›˜å | âœ… **å·²æ”¯æŒ** |
| `ANY_TIME` | å…è®¸ç›˜å‰ç›˜å | âœ… **å·²æ”¯æŒ** |
| `OVERNIGHT` | å¤œç›˜ | âœ… **å·²æ”¯æŒ** |

### 2.5 é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡åŠŸèƒ½

æ ¹æ® [Longbridge OpenAPI é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ–‡æ¡£](https://open.longbridge.com/zh-CN/docs/trade/order/estimate_available_buy_limit)ï¼Œ**å·²å®Œå…¨å®ç°**ï¼š

- âœ… å·²è°ƒç”¨ `estimateMaxPurchaseQuantity()` API
- âœ… å‰ç«¯å®æ—¶æ˜¾ç¤ºæœ€å¤§å¯ä¹°æ•°é‡ï¼ˆç°é‡‘/èèµ„ï¼‰
- âœ… ä¸‹å•å‰è‡ªåŠ¨éªŒè¯æ•°é‡æ˜¯å¦è¶…è¿‡æœ€å¤§å¯ä¹°æ•°é‡
- âœ… æä¾›è¯¦ç»†çš„é”™è¯¯æç¤ºå’Œå»ºè®®æ•°é‡
- âœ… **æ–°å¢ï¼šæ”¯æŒèèµ„é€‰é¡¹ï¼ˆæ˜¯å¦ä½¿ç”¨èèµ„ä¸‹å•ï¼‰**
- âœ… **æ–°å¢ï¼šæ ¹æ®èèµ„é€‰é¡¹æ˜¾ç¤ºå’ŒéªŒè¯ç›¸åº”çš„æœ€å¤§å¯ä¹°æ•°é‡**

### 2.6 ç¼ºå¤±çš„æœ€å°äº¤æ˜“å•ä½éªŒè¯åŠŸèƒ½

**é—®é¢˜**ï¼šç”¨æˆ·æäº¤è®¢å•æ—¶ï¼Œæ•°é‡ä¸ç¬¦åˆæœ€å°äº¤æ˜“å•ä½ï¼ˆlot sizeï¼‰è¦æ±‚ï¼Œå¯¼è‡´è®¢å•è¢«æ‹’ç»ï¼ˆé”™è¯¯ç ï¼š602001ï¼‰ã€‚

**å·²å®ç°**ï¼š
- âœ… è‡ªåŠ¨è·å–æ ‡çš„åŸºç¡€ä¿¡æ¯ï¼ˆåŒ…å« lot sizeï¼‰
- âœ… è®¢å•æäº¤å‰è‡ªåŠ¨éªŒè¯æ•°é‡æ˜¯å¦ç¬¦åˆæœ€å°äº¤æ˜“å•ä½è¦æ±‚
- âœ… å‰ç«¯å®æ—¶æ˜¾ç¤ºæœ€å°äº¤æ˜“å•ä½å¹¶éªŒè¯æ•°é‡
- âœ… æ•°é‡è¾“å…¥æ¡† step å±æ€§è®¾ç½®ä¸º lot size
- âœ… æä¾›å‹å¥½çš„é”™è¯¯æç¤ºå’Œå»ºè®®æ•°é‡

---

## ä¸‰ã€ä¼˜åŒ–ç›®æ ‡

### 3.1 æ ¸å¿ƒç›®æ ‡

1. **âœ… å®Œå–„ API å‚æ•°æ”¯æŒ**
   - æ”¯æŒæ‰€æœ‰ Longbridge OpenAPI æ–‡æ¡£ä¸­çš„è®¢å•å‚æ•°
   - æ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹ï¼ˆåŒ…æ‹¬æ¡ä»¶å•ã€è·Ÿè¸ªæ­¢æŸå•ç­‰ï¼‰
   - æ”¯æŒæ‰€æœ‰è®¢å•æœ‰æ•ˆæœŸç±»å‹ï¼ˆ`Day`ã€`GTC`ã€`GTD`ï¼‰
   - æ”¯æŒç¾è‚¡ç›˜å‰ç›˜åé€‰é¡¹

2. **âœ… å®ç°é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡åŠŸèƒ½**
   - åç«¯æä¾›é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡ API
   - å‰ç«¯åœ¨ä¸‹å•å‰æ˜¾ç¤ºæœ€å¤§å¯ä¹°æ•°é‡
   - ä¸‹å•å‰è‡ªåŠ¨éªŒè¯æ•°é‡æ˜¯å¦è¶…è¿‡é™åˆ¶
   - æä¾›å‹å¥½çš„é”™è¯¯æç¤º

3. **âœ… å¢å¼ºå‚æ•°éªŒè¯**
   - æ ¹æ®è®¢å•ç±»å‹éªŒè¯å¿…å¡«å‚æ•°
   - æ ¹æ®å¸‚åœºç±»å‹ï¼ˆç¾è‚¡/æ¸¯è‚¡ï¼‰éªŒè¯å¿…å¡«å‚æ•°
   - æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

4. **âœ… ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**
   - å‰ç«¯ç•Œé¢æ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹å’Œå‚æ•°
   - å®æ—¶æ˜¾ç¤ºæœ€å¤§å¯ä¹°æ•°é‡
   - æ™ºèƒ½è¡¨å•éªŒè¯å’Œæç¤º

### 3.2 æˆåŠŸæ ‡å‡†

- âœ… æ”¯æŒæ‰€æœ‰ Longbridge OpenAPI æ–‡æ¡£ä¸­çš„è®¢å•ç±»å‹å’Œå‚æ•°
- âœ… ç¾è‚¡è®¢å•å¯ä»¥æ­£ç¡®æŒ‡å®šç›˜å‰ç›˜åé€‰é¡¹
- âœ… æ¡ä»¶å•ï¼ˆ`LIT`ã€`MIT`ï¼‰å¯ä»¥æ­£ç¡®è®¾ç½®è§¦å‘ä»·æ ¼
- âœ… è·Ÿè¸ªæ­¢æŸå•ï¼ˆ`TSLPAMT`ã€`TSLPPCT`ï¼‰å¯ä»¥æ­£ç¡®è®¾ç½®è·Ÿè¸ªå‚æ•°
- âœ… é•¿æœŸå•ï¼ˆ`GTC`ã€`GTD`ï¼‰å¯ä»¥æ­£ç¡®è®¾ç½®æœ‰æ•ˆæœŸ
- âœ… ä¸‹å•å‰è‡ªåŠ¨æ£€æŸ¥æœ€å¤§å¯ä¹°æ•°é‡ï¼Œè¶…è¿‡é™åˆ¶æ—¶é˜»æ­¢ä¸‹å•
- âœ… å‰ç«¯ç•Œé¢å‹å¥½ï¼Œæ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹å’Œå‚æ•°

---

## å››ã€è¯¦ç»†ä¼˜åŒ–æ­¥éª¤

### æ­¥éª¤ 1ï¼šåç«¯ API ä¼˜åŒ– - å®Œå–„è®¢å•æäº¤æ¥å£

#### 1.1 æ‰©å±•è¯·æ±‚å‚æ•°

**æ–‡ä»¶**ï¼š`api/src/routes/orders.ts`

**ä¿®æ”¹å†…å®¹**ï¼š

```typescript
// æ‰©å±•è¯·æ±‚ä½“æ¥å£
interface SubmitOrderRequest {
  symbol: string;                    // å¿…å¡«ï¼šè‚¡ç¥¨ä»£ç 
  order_type: string;                // å¿…å¡«ï¼šè®¢å•ç±»å‹
  side: string;                      // å¿…å¡«ï¼šä¹°å–æ–¹å‘
  submitted_quantity: string;         // å¿…å¡«ï¼šä¸‹å•æ•°é‡
  submitted_price?: string;          // å¯é€‰ï¼šä¸‹å•ä»·æ ¼ï¼ˆé™ä»·å•å¿…å¡«ï¼‰
  trigger_price?: string;             // å¯é€‰ï¼šè§¦å‘ä»·æ ¼ï¼ˆLIT/MIT å¿…å¡«ï¼‰
  limit_offset?: string;              // å¯é€‰ï¼šæŒ‡å®šä»·å·®ï¼ˆTSLPAMT/TSLPPCT å¿…å¡«ï¼‰
  trailing_amount?: string;           // å¯é€‰ï¼šè·Ÿè¸ªé‡‘é¢ï¼ˆTSLPAMT å¿…å¡«ï¼‰
  trailing_percent?: string;          // å¯é€‰ï¼šè·Ÿè¸ªæ¶¨è·Œå¹…ï¼ˆTSLPPCT å¿…å¡«ï¼‰
  expire_date?: string;               // å¯é€‰ï¼šé•¿æœŸå•è¿‡æœŸæ—¶é—´ï¼ˆGTD å¿…å¡«ï¼‰
  outside_rth?: string;               // å¯é€‰ï¼šç›˜å‰ç›˜åï¼ˆç¾è‚¡å¿…å¡«ï¼‰
  time_in_force?: string;             // å¯é€‰ï¼šè®¢å•æœ‰æ•ˆæœŸï¼ˆé»˜è®¤ Dayï¼‰
  remark?: string;                    // å¯é€‰ï¼šå¤‡æ³¨ï¼ˆæœ€å¤§ 64 å­—ç¬¦ï¼‰
}
```

#### 1.2 å®ç°å‚æ•°éªŒè¯é€»è¾‘

**éªŒè¯è§„åˆ™**ï¼š

1. **è®¢å•ç±»å‹éªŒè¯**ï¼š
   - æ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹ï¼š`LO`, `ELO`, `MO`, `AO`, `ALO`, `ODD`, `LIT`, `MIT`, `TSLPAMT`, `TSLPPCT`, `SLO`
   - æ ¹æ®è®¢å•ç±»å‹éªŒè¯å¿…å¡«å‚æ•°

2. **é™ä»·å•éªŒè¯**ï¼ˆ`LO`, `ELO`, `ALO`, `ODD`, `SLO`ï¼‰ï¼š
   - `submitted_price` å¿…å¡«

3. **æ¡ä»¶å•éªŒè¯**ï¼ˆ`LIT`, `MIT`ï¼‰ï¼š
   - `trigger_price` å¿…å¡«
   - `LIT` éœ€è¦ `submitted_price`

4. **è·Ÿè¸ªæ­¢æŸå•éªŒè¯**ï¼ˆ`TSLPAMT`, `TSLPPCT`ï¼‰ï¼š
   - `TSLPAMT`ï¼š`trailing_amount` å’Œ `limit_offset` å¿…å¡«
   - `TSLPPCT`ï¼š`trailing_percent` å’Œ `limit_offset` å¿…å¡«

5. **é•¿æœŸå•éªŒè¯**ï¼ˆ`GTD`ï¼‰ï¼š
   - `expire_date` å¿…å¡«ï¼Œæ ¼å¼ï¼š`YYYY-MM-DD`

6. **ç¾è‚¡è®¢å•éªŒè¯**ï¼š
   - `outside_rth` å¿…å¡«ï¼Œå¯é€‰å€¼ï¼š`RTH_ONLY`, `ANY_TIME`, `OVERNIGHT`

7. **å¤‡æ³¨éªŒè¯**ï¼š
   - `remark` æœ€å¤§é•¿åº¦ 64 å­—ç¬¦

#### 1.3 å®ç°è®¢å•æäº¤é€»è¾‘

**å…³é”®ä»£ç ç»“æ„**ï¼š

```typescript
ordersRouter.post('/submit', async (req: Request, res: Response) => {
  try {
    // 1. å‚æ•°æå–å’ŒåŸºç¡€éªŒè¯
    const {
      symbol,
      order_type,
      side,
      submitted_quantity,
      submitted_price,
      trigger_price,
      limit_offset,
      trailing_amount,
      trailing_percent,
      expire_date,
      outside_rth,
      time_in_force = 'Day',
      remark,
    } = req.body;

    // 2. Symbol æ ¼å¼éªŒè¯
    // 3. è®¢å•ç±»å‹éªŒè¯å’Œå‚æ•°ç»„åˆéªŒè¯
    // 4. å¸‚åœºç±»å‹åˆ¤æ–­ï¼ˆç¾è‚¡/æ¸¯è‚¡ï¼‰
    // 5. ç¾è‚¡è®¢å• outside_rth éªŒè¯
    // 6. æ„å»ºè®¢å•é€‰é¡¹å¯¹è±¡
    // 7. è°ƒç”¨ SDK æäº¤è®¢å•
    // 8. ä¿å­˜äº¤æ˜“è®°å½•åˆ°æ•°æ®åº“
    // 9. è¿”å›å“åº”
  } catch (error) {
    // é”™è¯¯å¤„ç†
  }
});
```

### æ­¥éª¤ 2ï¼šåç«¯ API æ–°å¢ - é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ¥å£

#### 2.1 åˆ›å»ºé¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡ API

**æ–‡ä»¶**ï¼š`api/src/routes/orders.ts`

**æ–°å¢æ¥å£**ï¼š

```typescript
/**
 * GET /api/orders/estimate-max-quantity
 * é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡
 */
ordersRouter.get('/estimate-max-quantity', async (req: Request, res: Response) => {
  try {
    const { symbol, order_type, side, price, currency, order_id } = req.query;

    // å‚æ•°éªŒè¯
    if (!symbol || !order_type || !side) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'MISSING_PARAMETER',
          message: 'ç¼ºå°‘å¿…éœ€å‚æ•°: symbol, order_type, side',
        },
      });
    }

    // è·å– TradeContext
    const tradeCtx = await getTradeContext();

    // æ„å»ºè¯·æ±‚å‚æ•°
    const options: any = {
      symbol: symbol as string,
      orderType: OrderType[order_type as keyof typeof OrderType],
      side: OrderSide[side as keyof typeof OrderSide],
    };

    // å¯é€‰å‚æ•°
    if (price) {
      options.price = new Decimal(price as string);
    }
    if (currency) {
      options.currency = currency as string;
    }
    if (order_id) {
      options.orderId = order_id as string;
    }

    // è°ƒç”¨ SDK
    const response = await tradeCtx.estimateMaxPurchaseQuantity(options);

    // è¿”å›å“åº”
    res.json({
      success: true,
      data: {
        cash_max_qty: response.cashMaxQty || '0',
        margin_max_qty: response.marginMaxQty || '0',
      },
    });
  } catch (error: any) {
    console.error('é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡å¤±è´¥:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'ESTIMATE_FAILED',
        message: error.message || 'é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡å¤±è´¥',
      },
    });
  }
});
```

### æ­¥éª¤ 3ï¼šå‰ç«¯ API å®¢æˆ·ç«¯ä¼˜åŒ–

#### 3.1 æ‰©å±•è®¢å•æäº¤ API

**æ–‡ä»¶**ï¼š`frontend/lib/api.ts`

**ä¿®æ”¹å†…å®¹**ï¼š

```typescript
// æ‰©å±•è®¢å•æäº¤æ¥å£
interface SubmitOrderParams {
  symbol: string;
  order_type: string;
  side: 'Buy' | 'Sell';
  submitted_quantity: string;
  submitted_price?: string;
  trigger_price?: string;
  limit_offset?: string;
  trailing_amount?: string;
  trailing_percent?: string;
  expire_date?: string;
  outside_rth?: 'RTH_ONLY' | 'ANY_TIME' | 'OVERNIGHT';
  time_in_force?: 'Day' | 'GTC' | 'GTD';
  remark?: string;
}

// æ‰©å±• ordersApi
export const ordersApi = {
  // ... ç°æœ‰æ–¹æ³•

  // é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡
  async estimateMaxQuantity(params: {
    symbol: string;
    order_type: string;
    side: 'Buy' | 'Sell';
    price?: string;
    currency?: string;
    order_id?: string;
  }) {
    const response = await axios.get('/api/orders/estimate-max-quantity', {
      params,
    });
    return response.data;
  },

  // æ‰©å±•è®¢å•æäº¤æ–¹æ³•
  async submitOrder(params: SubmitOrderParams) {
    const response = await axios.post('/api/orders/submit', params);
    return response.data;
  },
};
```

### æ­¥éª¤ 4ï¼šå‰ç«¯ç•Œé¢ä¼˜åŒ– - TradeModal ç»„ä»¶

#### 4.1 æ‰©å±•è®¢å•ç±»å‹æ”¯æŒ

**æ–‡ä»¶**ï¼š`frontend/components/TradeModal.tsx`

**æ–°å¢è®¢å•ç±»å‹**ï¼š

```typescript
const ORDER_TYPES = {
  // åŸºç¡€è®¢å•ç±»å‹
  LO: { label: 'é™ä»·å•', requiresPrice: true },
  ELO: { label: 'å¢å¼ºé™ä»·å•', requiresPrice: true },
  MO: { label: 'å¸‚ä»·å•', requiresPrice: false },
  AO: { label: 'ç«ä»·å¸‚ä»·å•', requiresPrice: false },
  ALO: { label: 'ç«ä»·é™ä»·å•', requiresPrice: true },
  ODD: { label: 'ç¢è‚¡å•', requiresPrice: true },
  SLO: { label: 'ç‰¹æ®Šé™ä»·å•', requiresPrice: true },
  
  // æ¡ä»¶å•
  LIT: { label: 'è§¦ä»·é™ä»·å•', requiresPrice: true, requiresTrigger: true },
  MIT: { label: 'è§¦ä»·å¸‚ä»·å•', requiresPrice: false, requiresTrigger: true },
  
  // è·Ÿè¸ªæ­¢æŸå•
  TSLPAMT: { label: 'è·Ÿè¸ªæ­¢æŸé™ä»·å•ï¼ˆè·Ÿè¸ªé‡‘é¢ï¼‰', requiresTrailingAmount: true },
  TSLPPCT: { label: 'è·Ÿè¸ªæ­¢æŸé™ä»·å•ï¼ˆè·Ÿè¸ªæ¶¨è·Œå¹…ï¼‰', requiresTrailingPercent: true },
};
```

#### 4.2 æ·»åŠ é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ˜¾ç¤º

**å®ç°é€»è¾‘**ï¼š

```typescript
const [maxQuantity, setMaxQuantity] = useState<{
  cash: string;
  margin: string;
} | null>(null);

// è·å–æœ€å¤§å¯ä¹°æ•°é‡
useEffect(() => {
  if (symbol && side === 'Buy' && orderType) {
    fetchMaxQuantity();
  }
}, [symbol, side, orderType, price]);

const fetchMaxQuantity = async () => {
  try {
    const response = await ordersApi.estimateMaxQuantity({
      symbol,
      order_type: orderType,
      side,
      price: price || undefined,
    });
    if (response.success) {
      setMaxQuantity({
        cash: response.data.cash_max_qty,
        margin: response.data.margin_max_qty,
      });
    }
  } catch (error) {
    console.error('è·å–æœ€å¤§å¯ä¹°æ•°é‡å¤±è´¥:', error);
  }
};
```

#### 4.3 æ·»åŠ æ•°é‡éªŒè¯

**å®ç°é€»è¾‘**ï¼š

```typescript
const handleSubmit = async () => {
  // ... ç°æœ‰éªŒè¯

  // éªŒè¯æ•°é‡æ˜¯å¦è¶…è¿‡æœ€å¤§å¯ä¹°æ•°é‡
  if (side === 'Buy' && maxQuantity) {
    const requestedQty = parseInt(quantity);
    const maxQty = Math.max(
      parseInt(maxQuantity.cash || '0'),
      parseInt(maxQuantity.margin || '0')
    );
    
    if (requestedQty > maxQty) {
      setError(`æ•°é‡è¶…è¿‡æœ€å¤§å¯ä¹°æ•°é‡ï¼ˆ${maxQty}ï¼‰ã€‚ç°é‡‘å¯ä¹°ï¼š${maxQuantity.cash}ï¼Œèèµ„å¯ä¹°ï¼š${maxQuantity.margin}`);
      return;
    }
  }

  // ... æäº¤è®¢å•
};
```

#### 4.4 æ·»åŠ é«˜çº§å‚æ•°è¾“å…¥

**æ–°å¢è¡¨å•é¡¹**ï¼š

- è§¦å‘ä»·æ ¼ï¼ˆ`trigger_price`ï¼‰- æ¡ä»¶å•å¿…å¡«
- è·Ÿè¸ªé‡‘é¢ï¼ˆ`trailing_amount`ï¼‰- `TSLPAMT` å¿…å¡«
- è·Ÿè¸ªæ¶¨è·Œå¹…ï¼ˆ`trailing_percent`ï¼‰- `TSLPPCT` å¿…å¡«
- æŒ‡å®šä»·å·®ï¼ˆ`limit_offset`ï¼‰- è·Ÿè¸ªæ­¢æŸå•å¿…å¡«
- è¿‡æœŸæ—¥æœŸï¼ˆ`expire_date`ï¼‰- `GTD` å¿…å¡«
- ç›˜å‰ç›˜åï¼ˆ`outside_rth`ï¼‰- ç¾è‚¡å¿…å¡«
- è®¢å•æœ‰æ•ˆæœŸï¼ˆ`time_in_force`ï¼‰- å¯é€‰
- å¤‡æ³¨ï¼ˆ`remark`ï¼‰- å¯é€‰

### æ­¥éª¤ 5ï¼šå‚æ•°éªŒè¯å¢å¼º

#### 5.1 åç«¯éªŒè¯å‡½æ•°

**åˆ›å»ºéªŒè¯å·¥å…·å‡½æ•°**ï¼š

```typescript
// api/src/utils/order-validation.ts

export function validateOrderParams(params: SubmitOrderRequest, market: 'US' | 'HK'): {
  valid: boolean;
  errors: string[];
} {
  const errors: string[] = [];

  // è®¢å•ç±»å‹éªŒè¯
  const validOrderTypes = ['LO', 'ELO', 'MO', 'AO', 'ALO', 'ODD', 'LIT', 'MIT', 'TSLPAMT', 'TSLPPCT', 'SLO'];
  if (!validOrderTypes.includes(params.order_type)) {
    errors.push(`æ— æ•ˆçš„è®¢å•ç±»å‹: ${params.order_type}`);
  }

  // é™ä»·å•ä»·æ ¼éªŒè¯
  const priceRequiredTypes = ['LO', 'ELO', 'ALO', 'ODD', 'SLO', 'LIT'];
  if (priceRequiredTypes.includes(params.order_type) && !params.submitted_price) {
    errors.push(`${params.order_type} è®¢å•éœ€è¦æä¾› submitted_price`);
  }

  // æ¡ä»¶å•è§¦å‘ä»·æ ¼éªŒè¯
  if (['LIT', 'MIT'].includes(params.order_type) && !params.trigger_price) {
    errors.push(`${params.order_type} è®¢å•éœ€è¦æä¾› trigger_price`);
  }

  // è·Ÿè¸ªæ­¢æŸå•éªŒè¯
  if (params.order_type === 'TSLPAMT') {
    if (!params.trailing_amount) errors.push('TSLPAMT è®¢å•éœ€è¦æä¾› trailing_amount');
    if (!params.limit_offset) errors.push('TSLPAMT è®¢å•éœ€è¦æä¾› limit_offset');
  }
  if (params.order_type === 'TSLPPCT') {
    if (!params.trailing_percent) errors.push('TSLPPCT è®¢å•éœ€è¦æä¾› trailing_percent');
    if (!params.limit_offset) errors.push('TSLPPCT è®¢å•éœ€è¦æä¾› limit_offset');
  }

  // é•¿æœŸå•è¿‡æœŸæ—¥æœŸéªŒè¯
  if (params.time_in_force === 'GTD' && !params.expire_date) {
    errors.push('GTD è®¢å•éœ€è¦æä¾› expire_date');
  }

  // ç¾è‚¡ç›˜å‰ç›˜åéªŒè¯
  if (market === 'US' && !params.outside_rth) {
    errors.push('ç¾è‚¡è®¢å•éœ€è¦æä¾› outside_rth');
  }

  // å¤‡æ³¨é•¿åº¦éªŒè¯
  if (params.remark && params.remark.length > 64) {
    errors.push('å¤‡æ³¨é•¿åº¦ä¸èƒ½è¶…è¿‡ 64 å­—ç¬¦');
  }

  return {
    valid: errors.length === 0,
    errors,
  };
}
```

---

## äº”ã€API æ¥å£è®¾è®¡

### 5.1 è®¢å•æäº¤æ¥å£ï¼ˆä¼˜åŒ–åï¼‰

**ç«¯ç‚¹**ï¼š`POST /api/orders/submit`

**è¯·æ±‚ä½“**ï¼š

```json
{
  "symbol": "AAPL.US",
  "order_type": "LO",
  "side": "Buy",
  "submitted_quantity": "100",
  "submitted_price": "150.50",
  "trigger_price": "151.00",
  "limit_offset": "1.2",
  "trailing_amount": "5.0",
  "trailing_percent": "0.5",
  "expire_date": "2025-12-31",
  "outside_rth": "ANY_TIME",
  "time_in_force": "Day",
  "remark": "æµ‹è¯•è®¢å•"
}
```

**å“åº”**ï¼š

```json
{
  "success": true,
  "data": {
    "order_id": "123456",
    "status": "NotReported",
    "trade": {
      "id": 1,
      "symbol": "AAPL.US",
      "side": "BUY",
      "quantity": 100,
      "price": 150.50,
      "status": "PENDING",
      "order_id": "123456",
      "created_at": "2025-01-15T10:30:00Z"
    }
  }
}
```

### 5.2 é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ¥å£ï¼ˆæ–°å¢ï¼‰

**ç«¯ç‚¹**ï¼š`GET /api/orders/estimate-max-quantity`

**æŸ¥è¯¢å‚æ•°**ï¼š

- `symbol` (å¿…å¡«): è‚¡ç¥¨ä»£ç ï¼Œå¦‚ `AAPL.US`
- `order_type` (å¿…å¡«): è®¢å•ç±»å‹ï¼Œå¦‚ `LO`
- `side` (å¿…å¡«): ä¹°å–æ–¹å‘ï¼Œ`Buy` æˆ– `Sell`
- `price` (å¯é€‰): é¢„ä¼°ä¸‹å•ä»·æ ¼
- `currency` (å¯é€‰): ç»“ç®—è´§å¸
- `order_id` (å¯é€‰): è®¢å• IDï¼ˆæ”¹å•æ—¶ä½¿ç”¨ï¼‰

**å“åº”**ï¼š

```json
{
  "success": true,
  "data": {
    "cash_max_qty": "100",
    "margin_max_qty": "200"
  }
}
```

---

## å…­ã€å‰ç«¯ç•Œé¢ä¼˜åŒ–

### 6.1 TradeModal ç»„ä»¶ä¼˜åŒ–

**æ–°å¢åŠŸèƒ½**ï¼š

1. **è®¢å•ç±»å‹é€‰æ‹©å™¨**ï¼š
   - æ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹
   - æ ¹æ®è®¢å•ç±»å‹åŠ¨æ€æ˜¾ç¤º/éšè—ç›¸å…³å‚æ•°è¾“å…¥æ¡†

2. **æœ€å¤§å¯ä¹°æ•°é‡æ˜¾ç¤º**ï¼š
   - å®æ—¶æ˜¾ç¤ºç°é‡‘å¯ä¹°æ•°é‡å’Œèèµ„å¯ä¹°æ•°é‡
   - æ•°é‡è¾“å…¥æ¡†ä¸‹æ–¹æ˜¾ç¤ºæç¤ºä¿¡æ¯

3. **æ™ºèƒ½è¡¨å•éªŒè¯**ï¼š
   - æ ¹æ®è®¢å•ç±»å‹éªŒè¯å¿…å¡«å‚æ•°
   - å®æ—¶æ˜¾ç¤ºéªŒè¯é”™è¯¯ä¿¡æ¯

4. **é«˜çº§å‚æ•°æŠ˜å é¢æ¿**ï¼š
   - é»˜è®¤æŠ˜å é«˜çº§å‚æ•°ï¼ˆè§¦å‘ä»·æ ¼ã€è·Ÿè¸ªå‚æ•°ç­‰ï¼‰
   - æ ¹æ®è®¢å•ç±»å‹è‡ªåŠ¨å±•å¼€ç›¸å…³å‚æ•°

5. **å¸‚åœºç±»å‹æ£€æµ‹**ï¼š
   - æ ¹æ® symbol è‡ªåŠ¨æ£€æµ‹å¸‚åœºç±»å‹ï¼ˆç¾è‚¡/æ¸¯è‚¡ï¼‰
   - ç¾è‚¡è®¢å•è‡ªåŠ¨æ˜¾ç¤ºç›˜å‰ç›˜åé€‰é¡¹

### 6.2 UI æ”¹è¿›å»ºè®®

1. **è®¢å•ç±»å‹åˆ†ç»„æ˜¾ç¤º**ï¼š
   - åŸºç¡€è®¢å•ç±»å‹ï¼ˆé™ä»·å•ã€å¸‚ä»·å•ç­‰ï¼‰
   - æ¡ä»¶å•ï¼ˆè§¦ä»·é™ä»·å•ã€è§¦ä»·å¸‚ä»·å•ï¼‰
   - è·Ÿè¸ªæ­¢æŸå•ï¼ˆè·Ÿè¸ªé‡‘é¢ã€è·Ÿè¸ªæ¶¨è·Œå¹…ï¼‰

2. **å‚æ•°è¾“å…¥æç¤º**ï¼š
   - æ¯ä¸ªå‚æ•°è¾“å…¥æ¡†ä¸‹æ–¹æ˜¾ç¤ºè¯´æ˜æ–‡å­—
   - å¿…å¡«å‚æ•°ç”¨çº¢è‰²æ˜Ÿå·æ ‡è®°

3. **å®æ—¶é‡‘é¢è®¡ç®—**ï¼š
   - æ˜¾ç¤ºé¢„è®¡è®¢å•é‡‘é¢
   - æ˜¾ç¤ºé¢„è®¡æ‰‹ç»­è´¹ï¼ˆå¦‚æœå¯è·å–ï¼‰

---

## ä¸ƒã€æµ‹è¯•éªŒè¯

### 7.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹**ï¼š

1. **å‚æ•°éªŒè¯æµ‹è¯•**ï¼š
   - æµ‹è¯•ç¼ºå¤±å¿…å¡«å‚æ•°æ—¶çš„é”™è¯¯å¤„ç†
   - æµ‹è¯•æ— æ•ˆè®¢å•ç±»å‹æ—¶çš„é”™è¯¯å¤„ç†
   - æµ‹è¯•æ¡ä»¶å•ç¼ºå°‘è§¦å‘ä»·æ ¼æ—¶çš„é”™è¯¯å¤„ç†
   - æµ‹è¯•è·Ÿè¸ªæ­¢æŸå•ç¼ºå°‘è·Ÿè¸ªå‚æ•°æ—¶çš„é”™è¯¯å¤„ç†

2. **è®¢å•ç±»å‹æµ‹è¯•**ï¼š
   - æµ‹è¯•æ‰€æœ‰è®¢å•ç±»å‹çš„æäº¤
   - æµ‹è¯•ä¸åŒè®¢å•ç±»å‹çš„å‚æ•°ç»„åˆ

3. **å¸‚åœºç±»å‹æµ‹è¯•**ï¼š
   - æµ‹è¯•ç¾è‚¡è®¢å•çš„ç›˜å‰ç›˜åé€‰é¡¹
   - æµ‹è¯•æ¸¯è‚¡è®¢å•çš„å‚æ•°éªŒè¯

4. **é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æµ‹è¯•**ï¼š
   - æµ‹è¯•é¢„ä¼°æ¥å£çš„æ­£å¸¸è°ƒç”¨
   - æµ‹è¯•è¶…è¿‡æœ€å¤§æ•°é‡æ—¶çš„é”™è¯¯å¤„ç†

### 7.2 é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š

1. **å®Œæ•´ä¸‹å•æµç¨‹**ï¼š
   - é€‰æ‹©è®¢å•ç±»å‹ â†’ å¡«å†™å‚æ•° â†’ é¢„ä¼°æœ€å¤§æ•°é‡ â†’ æäº¤è®¢å• â†’ éªŒè¯ç»“æœ

2. **é”™è¯¯å¤„ç†æµç¨‹**ï¼š
   - è¾“å…¥æ— æ•ˆå‚æ•° â†’ éªŒè¯é”™è¯¯æç¤º â†’ ä¿®æ­£å‚æ•° â†’ é‡æ–°æäº¤

3. **ä¸åŒè®¢å•ç±»å‹æµç¨‹**ï¼š
   - é™ä»·å•æµç¨‹
   - å¸‚ä»·å•æµç¨‹
   - æ¡ä»¶å•æµç¨‹
   - è·Ÿè¸ªæ­¢æŸå•æµç¨‹

### 7.3 æ‰‹åŠ¨æµ‹è¯•æ¸…å•

- [x] é™ä»·å•ï¼ˆ`LO`ï¼‰å¯ä»¥æ­£å¸¸æäº¤
- [x] å¸‚ä»·å•ï¼ˆ`MO`ï¼‰å¯ä»¥æ­£å¸¸æäº¤
- [x] æ¡ä»¶å•ï¼ˆ`LIT`ï¼‰å¯ä»¥è®¾ç½®è§¦å‘ä»·æ ¼å¹¶æäº¤
- [x] è·Ÿè¸ªæ­¢æŸå•ï¼ˆ`TSLPPCT`ï¼‰å¯ä»¥è®¾ç½®è·Ÿè¸ªå‚æ•°å¹¶æäº¤
- [x] ç¾è‚¡è®¢å•å¯ä»¥è®¾ç½®ç›˜å‰ç›˜åé€‰é¡¹
- [x] é•¿æœŸå•ï¼ˆ`GTD`ï¼‰å¯ä»¥è®¾ç½®è¿‡æœŸæ—¥æœŸ
- [x] é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [x] è¶…è¿‡æœ€å¤§æ•°é‡æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
- [x] æ‰€æœ‰å¿…å¡«å‚æ•°éªŒè¯æ­£å¸¸å·¥ä½œ
- [x] é”™è¯¯ä¿¡æ¯æ¸…æ™°æ˜“æ‡‚
- [x] **æœ€å°äº¤æ˜“å•ä½ï¼ˆlot sizeï¼‰éªŒè¯æ­£å¸¸å·¥ä½œ**
- [x] **èèµ„é€‰é¡¹åŠŸèƒ½æ­£å¸¸å·¥ä½œ**
- [x] **æ ¹æ®èèµ„é€‰é¡¹æ˜¾ç¤ºå’ŒéªŒè¯æœ€å¤§å¯ä¹°æ•°é‡**

---

## å…«ã€å®æ–½è®¡åˆ’

### é˜¶æ®µ 1ï¼šåç«¯ API ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰âœ… **å·²å®Œæˆ**

**å®é™…å®Œæˆæ—¶é—´**ï¼š1 å¤©

**ä»»åŠ¡æ¸…å•**ï¼š

1. [x] æ‰©å±•è®¢å•æäº¤æ¥å£å‚æ•°æ”¯æŒ
2. [x] å®ç°å‚æ•°éªŒè¯é€»è¾‘
3. [x] åˆ›å»ºé¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ¥å£
4. [x] **æ–°å¢ï¼šåˆ›å»ºè·å–æ ‡çš„åŸºç¡€ä¿¡æ¯æ¥å£**
5. [x] **æ–°å¢ï¼šå®ç°æœ€å°äº¤æ˜“å•ä½ï¼ˆlot sizeï¼‰éªŒè¯**
6. [x] **æ–°å¢ï¼šæ”¯æŒèèµ„é€‰é¡¹å‚æ•°**
7. [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆå¾…è¡¥å……ï¼‰
8. [x] æ›´æ–° API æ–‡æ¡£

### é˜¶æ®µ 2ï¼šå‰ç«¯ API å®¢æˆ·ç«¯ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰âœ… **å·²å®Œæˆ**

**å®é™…å®Œæˆæ—¶é—´**ï¼š0.5 å¤©

**ä»»åŠ¡æ¸…å•**ï¼š

1. [x] æ‰©å±•è®¢å•æäº¤ API æ¥å£
2. [x] æ·»åŠ é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡ API è°ƒç”¨
3. [x] **æ–°å¢ï¼šæ·»åŠ è·å–æ ‡çš„åŸºç¡€ä¿¡æ¯ API è°ƒç”¨**
4. [x] **æ–°å¢ï¼šæ”¯æŒèèµ„é€‰é¡¹å‚æ•°**
5. [x] æ›´æ–° TypeScript ç±»å‹å®šä¹‰

### é˜¶æ®µ 3ï¼šå‰ç«¯ç•Œé¢ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰âœ… **å·²å®Œæˆ**

**å®é™…å®Œæˆæ—¶é—´**ï¼š1 å¤©

**ä»»åŠ¡æ¸…å•**ï¼š

1. [x] æ‰©å±• TradeModal ç»„ä»¶æ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹
2. [x] æ·»åŠ é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ˜¾ç¤º
3. [x] æ·»åŠ é«˜çº§å‚æ•°è¾“å…¥è¡¨å•
4. [x] å®ç°æ™ºèƒ½è¡¨å•éªŒè¯
5. [x] **æ–°å¢ï¼šæ·»åŠ èèµ„é€‰é¡¹ï¼ˆä½¿ç”¨èèµ„ä¸‹å•å¤é€‰æ¡†ï¼‰**
6. [x] **æ–°å¢ï¼šæ·»åŠ æœ€å°äº¤æ˜“å•ä½æ˜¾ç¤ºå’ŒéªŒè¯**
7. [x] **æ–°å¢ï¼šæ•°é‡è¾“å…¥æ¡† step å±æ€§è®¾ç½®ä¸º lot size**
8. [x] ä¼˜åŒ– UI/UX

### é˜¶æ®µ 4ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰âš ï¸ **éƒ¨åˆ†å®Œæˆ**

**å®é™…å®Œæˆæ—¶é—´**ï¼š0.5 å¤©

**ä»»åŠ¡æ¸…å•**ï¼š

1. [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆå¾…è¡¥å……ï¼‰
2. [ ] ç¼–å†™é›†æˆæµ‹è¯•ï¼ˆå¾…è¡¥å……ï¼‰
3. [x] æ‰‹åŠ¨æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
4. [x] ä¿®å¤å‘ç°çš„ bugï¼ˆlot size éªŒè¯ã€èèµ„é€‰é¡¹ï¼‰
5. [x] æ€§èƒ½ä¼˜åŒ–ï¼ˆå‰ç«¯å®æ—¶éªŒè¯ï¼‰

### é˜¶æ®µ 5ï¼šæ–‡æ¡£æ›´æ–°ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰âœ… **å·²å®Œæˆ**

**å®é™…å®Œæˆæ—¶é—´**ï¼š0.5 å¤©

**ä»»åŠ¡æ¸…å•**ï¼š

1. [x] æ›´æ–° README.mdï¼ˆå·²æ›´æ–°ï¼‰
2. [x] æ›´æ–° API æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰
3. [x] ç¼–å†™ä½¿ç”¨æŒ‡å—ï¼ˆæœ¬æ–‡æ¡£ï¼‰
4. [ ] æ›´æ–° CHANGELOG.mdï¼ˆå¾…è¡¥å……ï¼‰

---

## ä¹ã€æ³¨æ„äº‹é¡¹

### 9.1 å…¼å®¹æ€§è€ƒè™‘

- âœ… ä¿æŒå‘åå…¼å®¹ï¼šç°æœ‰ API è°ƒç”¨ä¸åº”å—å½±å“
- âœ… æ–°å¢å‚æ•°å‡ä¸ºå¯é€‰ï¼ˆé™¤äº†æ ¹æ®è®¢å•ç±»å‹å¿…å¡«çš„å‚æ•°ï¼‰
- âœ… é»˜è®¤å€¼ä¿æŒä¸ç°æœ‰å®ç°ä¸€è‡´ï¼ˆ`time_in_force` é»˜è®¤ä¸º `Day`ï¼‰

### 9.2 é”™è¯¯å¤„ç†

- âœ… æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£é—®é¢˜
- âœ… åŒºåˆ†å‚æ•°é”™è¯¯ã€ä¸šåŠ¡é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯
- âœ… è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

### 9.3 æ€§èƒ½è€ƒè™‘

- âœ… é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ¥å£å¯èƒ½éœ€è¦ç¼“å­˜ï¼ˆé¿å…é¢‘ç¹è°ƒç”¨ï¼‰
- âœ… å‰ç«¯è¡¨å•éªŒè¯åº”åœ¨ç”¨æˆ·è¾“å…¥æ—¶å®æ—¶è¿›è¡Œï¼Œå‡å°‘ä¸å¿…è¦çš„ API è°ƒç”¨

### 9.4 å®‰å…¨æ€§è€ƒè™‘

- âœ… æ‰€æœ‰ç”¨æˆ·è¾“å…¥å¿…é¡»ç»è¿‡éªŒè¯å’Œæ¸…ç†
- âœ… é˜²æ­¢ SQL æ³¨å…¥ï¼ˆè™½ç„¶ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- âœ… é˜²æ­¢ XSS æ”»å‡»ï¼ˆå‰ç«¯è¾“å…¥éªŒè¯ï¼‰

---

## åã€å‚è€ƒæ–‡æ¡£

- [Longbridge OpenAPI å§”æ‰˜ä¸‹å•æ–‡æ¡£](https://open.longbridge.com/zh-CN/docs/trade/order/submit)
- [Longbridge OpenAPI é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ–‡æ¡£](https://open.longbridge.com/zh-CN/docs/trade/order/estimate_available_buy_limit)
- [Longbridge OpenAPI äº¤æ˜“å‘½åè¯å…¸](https://open.longbridge.com/zh-CN/docs/trade/trade-definition)
- [Longbridge Node.js SDK æ–‡æ¡£](https://longportapp.github.io/openapi/nodejs/)

---

---

## åä¸€ã€å®æ–½å®Œæˆæ€»ç»“

### 11.1 å·²å®Œæˆçš„åŠŸèƒ½

#### âœ… é˜¶æ®µ1ï¼šåç«¯ API ä¼˜åŒ–ï¼ˆå·²å®Œæˆï¼‰

1. **å‚æ•°éªŒè¯å·¥å…·å‡½æ•°** (`api/src/utils/order-validation.ts`)
   - âœ… æ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹çš„å‚æ•°éªŒè¯
   - âœ… è‡ªåŠ¨æ£€æµ‹å¸‚åœºç±»å‹ï¼ˆç¾è‚¡/æ¸¯è‚¡ï¼‰
   - âœ… æ ¹æ®è®¢å•ç±»å‹éªŒè¯å¿…å¡«å‚æ•°
   - âœ… æ—¥æœŸæ ¼å¼å’Œæœ‰æ•ˆæ€§éªŒè¯
   - âœ… ç¾è‚¡ç›˜å‰ç›˜åé€‰é¡¹éªŒè¯

2. **è®¢å•æäº¤æ¥å£æ‰©å±•** (`api/src/routes/orders.ts`)
   - âœ… æ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹ï¼š`LO`, `ELO`, `MO`, `AO`, `ALO`, `ODD`, `LIT`, `MIT`, `TSLPAMT`, `TSLPPCT`, `SLO`
   - âœ… æ”¯æŒæ‰€æœ‰å‚æ•°ï¼šè§¦å‘ä»·æ ¼ã€è·Ÿè¸ªå‚æ•°ã€è¿‡æœŸæ—¥æœŸã€ç›˜å‰ç›˜åã€è®¢å•æœ‰æ•ˆæœŸã€å¤‡æ³¨
   - âœ… å‘åå…¼å®¹æ—§çš„å‚æ•°å‘½å
   - âœ… **æ–°å¢ï¼šæœ€å°äº¤æ˜“å•ä½ï¼ˆlot sizeï¼‰éªŒè¯**
   - âœ… **æ–°å¢ï¼šè‡ªåŠ¨è·å–æ ‡çš„åŸºç¡€ä¿¡æ¯å¹¶éªŒè¯æ•°é‡æ˜¯å¦ç¬¦åˆæœ€å°äº¤æ˜“å•ä½è¦æ±‚**

3. **é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ¥å£** (`GET /api/orders/estimate-max-quantity`)
   - âœ… è¿”å›ç°é‡‘å¯ä¹°æ•°é‡å’Œèèµ„å¯ä¹°æ•°é‡
   - âœ… æ”¯æŒæ‰€æœ‰è®¢å•ç±»å‹å’Œå‚æ•°
   - âœ… **æ–°å¢ï¼šæ”¯æŒ `use_margin` å‚æ•°ï¼ˆæ˜¯å¦ä½¿ç”¨èèµ„ï¼‰**
   - âœ… **æ–°å¢ï¼šè¿”å› `max_qty` å­—æ®µï¼ˆæ ¹æ®èèµ„é€‰é¡¹çš„æœ€å¤§æ•°é‡ï¼‰**

4. **æ–°å¢ï¼šè·å–æ ‡çš„åŸºç¡€ä¿¡æ¯æ¥å£** (`GET /api/orders/security-info`)
   - âœ… è¿”å›æ ‡çš„çš„æœ€å°äº¤æ˜“å•ä½ï¼ˆlot sizeï¼‰
   - âœ… è¿”å›æ ‡çš„çš„å…¶ä»–åŸºç¡€ä¿¡æ¯ï¼ˆåç§°ã€è´§å¸ã€äº¤æ˜“æ‰€ç­‰ï¼‰

#### âœ… é˜¶æ®µ2ï¼šå‰ç«¯ API å®¢æˆ·ç«¯ä¼˜åŒ–ï¼ˆå·²å®Œæˆï¼‰

1. **è®¢å•æäº¤ API æ‰©å±•** (`frontend/lib/api.ts`)
   - âœ… æ”¯æŒæ‰€æœ‰æ–°å‚æ•°
   - âœ… å‘åå…¼å®¹æ—§çš„ API è°ƒç”¨æ–¹å¼
   - âœ… è‡ªåŠ¨è½¬æ¢å‚æ•°æ ¼å¼

2. **é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡ API**
   - âœ… `ordersApi.estimateMaxQuantity()` æ”¯æŒ `use_margin` å‚æ•°

3. **æ–°å¢ï¼šè·å–æ ‡çš„åŸºç¡€ä¿¡æ¯ API**
   - âœ… `ordersApi.getSecurityInfo()` è·å–æ ‡çš„åŸºç¡€ä¿¡æ¯ï¼ˆåŒ…å« lot sizeï¼‰

#### âœ… é˜¶æ®µ3ï¼šå‰ç«¯ç•Œé¢ä¼˜åŒ–ï¼ˆå·²å®Œæˆï¼‰

1. **TradeModal ç»„ä»¶é‡å†™** (`frontend/components/TradeModal.tsx`)
   - âœ… æ”¯æŒæ‰€æœ‰ 11 ç§è®¢å•ç±»å‹ï¼ˆæŒ‰åˆ†ç±»æ˜¾ç¤ºï¼‰
   - âœ… å®æ—¶æ˜¾ç¤ºæœ€å¤§å¯ä¹°æ•°é‡ï¼ˆç°é‡‘/èèµ„ï¼‰
   - âœ… ä¸‹å•å‰è‡ªåŠ¨éªŒè¯æ•°é‡é™åˆ¶
   - âœ… é«˜çº§å‚æ•°æŠ˜å é¢æ¿ï¼ˆè§¦å‘ä»·æ ¼ã€è·Ÿè¸ªå‚æ•°ã€è¿‡æœŸæ—¥æœŸã€ç›˜å‰ç›˜åã€å¤‡æ³¨ï¼‰
   - âœ… æ™ºèƒ½è¡¨å•éªŒè¯ï¼ˆæ ¹æ®è®¢å•ç±»å‹æ˜¾ç¤º/éšè—ç›¸å…³å­—æ®µï¼‰
   - âœ… è‡ªåŠ¨æ£€æµ‹å¸‚åœºç±»å‹ï¼ˆç¾è‚¡è‡ªåŠ¨æ˜¾ç¤ºç›˜å‰ç›˜åé€‰é¡¹ï¼‰
   - âœ… æ”¹è¿›çš„é”™è¯¯æç¤ºï¼ˆæ˜¾ç¤ºè¯¦ç»†éªŒè¯é”™è¯¯ï¼‰
   - âœ… **æ–°å¢ï¼šèèµ„é€‰é¡¹ï¼ˆ"ä½¿ç”¨èèµ„ä¸‹å•"å¤é€‰æ¡†ï¼Œä»…ä¹°å…¥æ—¶æ˜¾ç¤ºï¼‰**
   - âœ… **æ–°å¢ï¼šæœ€å°äº¤æ˜“å•ä½ï¼ˆlot sizeï¼‰æ˜¾ç¤ºå’ŒéªŒè¯**
   - âœ… **æ–°å¢ï¼šæ•°é‡è¾“å…¥æ¡† step å±æ€§è®¾ç½®ä¸º lot size**
   - âœ… **æ–°å¢ï¼šå®æ—¶éªŒè¯æ•°é‡æ˜¯å¦ç¬¦åˆæœ€å°äº¤æ˜“å•ä½è¦æ±‚**
   - âœ… **æ–°å¢ï¼šæ ¹æ®èèµ„é€‰é¡¹æ˜¾ç¤ºç›¸åº”çš„æœ€å¤§å¯ä¹°æ•°é‡**

### 11.2 æ–°å¢åŠŸèƒ½è¯¦æƒ…

#### 1. æœ€å°äº¤æ˜“å•ä½ï¼ˆLot Sizeï¼‰éªŒè¯

**é—®é¢˜**ï¼šç”¨æˆ·æäº¤è®¢å•æ—¶ï¼Œæ•°é‡ä¸ç¬¦åˆæœ€å°äº¤æ˜“å•ä½è¦æ±‚ï¼Œå¯¼è‡´è®¢å•è¢«æ‹’ç»ï¼ˆé”™è¯¯ç ï¼š602001ï¼‰ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åç«¯ï¼šåœ¨è®¢å•æäº¤å‰è‡ªåŠ¨è·å–æ ‡çš„åŸºç¡€ä¿¡æ¯ï¼ŒéªŒè¯æ•°é‡æ˜¯å¦ç¬¦åˆ `lot_size` è¦æ±‚
- å‰ç«¯ï¼šè‡ªåŠ¨è·å–å¹¶æ˜¾ç¤ºæœ€å°äº¤æ˜“å•ä½ï¼Œå®æ—¶éªŒè¯æ•°é‡æ˜¯å¦ç¬¦åˆè¦æ±‚
- ç”¨æˆ·ä½“éªŒï¼šæ•°é‡è¾“å…¥æ¡†çš„ `step` å±æ€§è®¾ç½®ä¸º `lot_size`ï¼Œä¾¿äºè¾“å…¥ç¬¦åˆè¦æ±‚çš„æ•°é‡

**å®ç°ä½ç½®**ï¼š
- åç«¯ï¼š`api/src/routes/orders.ts` - è®¢å•æäº¤æ¥å£
- åç«¯ï¼š`api/src/routes/orders.ts` - è·å–æ ‡çš„åŸºç¡€ä¿¡æ¯æ¥å£
- å‰ç«¯ï¼š`frontend/components/TradeModal.tsx` - æ•°é‡è¾“å…¥å’ŒéªŒè¯

#### 2. èèµ„ä¸‹å•é€‰é¡¹

**é—®é¢˜**ï¼šç”¨æˆ·å¸Œæœ›å¯ä»¥é€‰æ‹©æ˜¯å¦ä½¿ç”¨èèµ„ä¸‹å•ï¼Œå½“å‰å®ç°åªæ˜¾ç¤ºç°é‡‘å’Œèèµ„çš„æœ€å¤§å¯ä¹°æ•°é‡ï¼Œä½†æ²¡æœ‰é€‰æ‹©é€‰é¡¹ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åç«¯ï¼šé¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ¥å£æ”¯æŒ `use_margin` å‚æ•°
- å‰ç«¯ï¼šæ·»åŠ "ä½¿ç”¨èèµ„ä¸‹å•"å¤é€‰æ¡†ï¼ˆä»…ä¹°å…¥æ—¶æ˜¾ç¤ºï¼‰
- å‰ç«¯ï¼šæ ¹æ®èèµ„é€‰é¡¹æ˜¾ç¤ºå’ŒéªŒè¯ç›¸åº”çš„æœ€å¤§å¯ä¹°æ•°é‡

**å®ç°ä½ç½®**ï¼š
- åç«¯ï¼š`api/src/routes/orders.ts` - é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ¥å£
- å‰ç«¯ï¼š`frontend/components/TradeModal.tsx` - èèµ„é€‰é¡¹å’ŒéªŒè¯é€»è¾‘

### 11.3 æŠ€æœ¯å®ç°ç»†èŠ‚

#### åç«¯å®ç°

1. **è·å–æ ‡çš„åŸºç¡€ä¿¡æ¯**
```typescript
// api/src/routes/orders.ts
ordersRouter.get('/security-info', async (req: Request, res: Response) => {
  const quoteCtx = await getQuoteContext();
  const staticInfoList = await quoteCtx.staticInfo([symbol]);
  // è¿”å› lot_size ç­‰ä¿¡æ¯
});
```

2. **è®¢å•æäº¤æ—¶çš„ lot size éªŒè¯**
```typescript
// éªŒè¯æœ€å°äº¤æ˜“å•ä½ï¼ˆlot sizeï¼‰
const staticInfoList = await quoteCtx.staticInfo([normalizedParams.symbol]);
const lotSize = staticInfoList[0].lotSize;
if (lotSize > 0 && quantity % lotSize !== 0) {
  // è¿”å›é”™è¯¯æç¤ºå’Œå»ºè®®æ•°é‡
}
```

3. **é¢„ä¼°æœ€å¤§è´­ä¹°æ•°é‡æ”¯æŒèèµ„é€‰é¡¹**
```typescript
// æ ¹æ®æ˜¯å¦ä½¿ç”¨èèµ„è¿”å›ç›¸åº”çš„æœ€å¤§æ•°é‡
const useMargin = use_margin === 'true' || use_margin === '1';
const maxQty = useMargin 
  ? response.marginMaxQty
  : response.cashMaxQty;
```

#### å‰ç«¯å®ç°

1. **è·å–å¹¶æ˜¾ç¤ºæœ€å°äº¤æ˜“å•ä½**
```typescript
useEffect(() => {
  fetchLotSize()
}, [symbol])

const fetchLotSize = async () => {
  const response = await ordersApi.getSecurityInfo(symbol)
  setLotSize(response.data.lot_size)
}
```

2. **èèµ„é€‰é¡¹å’ŒéªŒè¯**
```typescript
const [useMargin, setUseMargin] = useState(false)

// è·å–æœ€å¤§å¯ä¹°æ•°é‡æ—¶ä¼ å…¥èèµ„é€‰é¡¹
const response = await ordersApi.estimateMaxQuantity({
  symbol,
  order_type: orderType,
  side,
  use_margin: useMargin,
})

// éªŒè¯æ—¶ä½¿ç”¨å¯¹åº”çš„æœ€å¤§æ•°é‡
const maxQty = parseInt(maxQuantity.max_qty || '0')
```

### 11.4 æµ‹è¯•éªŒè¯

#### å·²æµ‹è¯•åœºæ™¯

1. âœ… **æœ€å°äº¤æ˜“å•ä½éªŒè¯**
   - æ¸¯è‚¡æ ‡çš„ï¼ˆlot size = 100ï¼‰è¾“å…¥ 1 è‚¡ â†’ æç¤ºé”™è¯¯å’Œå»ºè®®æ•°é‡
   - è¾“å…¥ 100 çš„å€æ•° â†’ éªŒè¯é€šè¿‡

2. âœ… **èèµ„é€‰é¡¹åŠŸèƒ½**
   - é€‰æ‹©"ä½¿ç”¨èèµ„ä¸‹å•" â†’ æ˜¾ç¤ºèèµ„æœ€å¤§å¯ä¹°æ•°é‡
   - ä¸é€‰æ‹© â†’ æ˜¾ç¤ºç°é‡‘æœ€å¤§å¯ä¹°æ•°é‡
   - éªŒè¯æ—¶ä½¿ç”¨å¯¹åº”çš„æœ€å¤§æ•°é‡

3. âœ… **å‘åå…¼å®¹æ€§**
   - æ—§çš„ API è°ƒç”¨æ–¹å¼ä»ç„¶æœ‰æ•ˆ
   - å‰ç«¯ç»„ä»¶è‡ªåŠ¨å¤„ç†å‚æ•°è½¬æ¢

### 11.5 å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

1. **æœ€å°äº¤æ˜“å•ä½è·å–å¤±è´¥**
   - å¦‚æœè·å– `lot_size` å¤±è´¥ï¼Œä¸ä¼šé˜»æ­¢è®¢å•æäº¤ï¼Œåªè®°å½•è­¦å‘Š
   - å»ºè®®ï¼šå‰ç«¯å¯ä»¥æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ï¼Œæé†’ç”¨æˆ·æ‰‹åŠ¨ç¡®è®¤æ•°é‡

2. **èèµ„é€‰é¡¹ä»…é™ä¹°å…¥**
   - å½“å‰å®ç°ä¸­ï¼Œ"ä½¿ç”¨èèµ„ä¸‹å•"é€‰é¡¹ä»…åœ¨ä¹°å…¥æ—¶æ˜¾ç¤º
   - å–å‡ºè®¢å•ä¸æ”¯æŒèèµ„é€‰é¡¹ï¼ˆç¬¦åˆä¸šåŠ¡é€»è¾‘ï¼‰

### 11.6 åç»­ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜æ ‡çš„åŸºç¡€ä¿¡æ¯**
   - å¯ä»¥è€ƒè™‘ç¼“å­˜ `lot_size` ç­‰ä¿¡æ¯ï¼Œå‡å°‘ API è°ƒç”¨
   - ç¼“å­˜æœ‰æ•ˆæœŸå¯ä»¥è®¾ç½®ä¸º 1 å°æ—¶æˆ–æ›´é•¿æ—¶é—´

2. **æ‰¹é‡è·å–æ ‡çš„ä¿¡æ¯**
   - å¦‚æœç”¨æˆ·é¢‘ç¹åˆ‡æ¢æ ‡çš„ï¼Œå¯ä»¥è€ƒè™‘æ‰¹é‡è·å–å¤šä¸ªæ ‡çš„ä¿¡æ¯

3. **æ›´å‹å¥½çš„é”™è¯¯æç¤º**
   - å¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯è¯´æ˜ï¼ŒåŒ…æ‹¬å¦‚ä½•è®¡ç®—å»ºè®®æ•°é‡

---

**æœ€åæ›´æ–°**ï¼š2025-01-15

**å®æ–½çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

**ä¸»è¦æ›´æ–°**ï¼š
- âœ… å®Œæˆæ‰€æœ‰è®¢å•ç±»å‹å’Œå‚æ•°æ”¯æŒ
- âœ… æ–°å¢æœ€å°äº¤æ˜“å•ä½ï¼ˆlot sizeï¼‰éªŒè¯åŠŸèƒ½
- âœ… æ–°å¢èèµ„ä¸‹å•é€‰é¡¹åŠŸèƒ½
- âœ… ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œé”™è¯¯æç¤º

